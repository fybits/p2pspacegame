let e,t,r,i,s,n,o,a,h,l,u,c,d,p,f,m,g,y,_,v,b,x,T,E,w,A,S,C,R,I,P,M,D,k,O,B,L,F,N,U,G,j,H,z,V,X,W,$,Y,q,K;var J,Z,Q,ee,et,er,ei,es,en,eo,ea,eh,el,eu,ec,ed,ep,ef,em,eg,ey,e_,ev,eb,ex,eT,eE,ew=globalThis;function eA(e){return e&&e.__esModule?e.default:e}function eS(e,t,r,i){Object.defineProperty(e,t,{get:r,set:i,enumerable:!0,configurable:!0})}var eC={},eR={},eI=ew.parcelRequire676f;null==eI&&((eI=function(e){if(e in eC)return eC[e].exports;if(e in eR){var t=eR[e];delete eR[e];var r={id:e,exports:{}};return eC[e]=r,t.call(r.exports,r,r.exports),r.exports}var i=Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}).register=function(e,t){eR[e]=t},ew.parcelRequire676f=eI);var eP=eI.register;eP("dybpk",function(e,t){var r=eI("79Ayg");function i(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var s=/^([a-z0-9.+-]+:)/i,n=/:[0-9]*$/,o=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,a=["'"].concat(["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","	"])),h=["%","/","?",";","#"].concat(a),l=["/","?","#"],u=/^[+a-z0-9A-Z_-]{0,63}$/,c=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,d={javascript:!0,"javascript:":!0},p={javascript:!0,"javascript:":!0},f={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},m=eI("8ucWi");function g(e,t,r){if(e&&"object"==typeof e&&e instanceof i)return e;var s=new i;return s.parse(e,t,r),s}i.prototype.parse=function(e,t,i){if("string"!=typeof e)throw TypeError("Parameter 'url' must be a string, not "+typeof e);var n=e.indexOf("?"),g=-1!==n&&n<e.indexOf("#")?"?":"#",y=e.split(g);y[0]=y[0].replace(/\\/g,"/");var _=e=y.join(g);if(_=_.trim(),!i&&1===e.split("#").length){var v=o.exec(_);if(v)return this.path=_,this.href=_,this.pathname=v[1],v[2]?(this.search=v[2],t?this.query=m.parse(this.search.substr(1)):this.query=this.search.substr(1)):t&&(this.search="",this.query={}),this}var b=s.exec(_);if(b){var x=(b=b[0]).toLowerCase();this.protocol=x,_=_.substr(b.length)}if(i||b||_.match(/^\/\/[^@/]+@[^@/]+/)){var T="//"===_.substr(0,2);T&&!(b&&p[b])&&(_=_.substr(2),this.slashes=!0)}if(!p[b]&&(T||b&&!f[b])){for(var E,w,A=-1,S=0;S<l.length;S++){var C=_.indexOf(l[S]);-1!==C&&(-1===A||C<A)&&(A=C)}-1!==(w=-1===A?_.lastIndexOf("@"):_.lastIndexOf("@",A))&&(E=_.slice(0,w),_=_.slice(w+1),this.auth=decodeURIComponent(E)),A=-1;for(var S=0;S<h.length;S++){var C=_.indexOf(h[S]);-1!==C&&(-1===A||C<A)&&(A=C)}-1===A&&(A=_.length),this.host=_.slice(0,A),_=_.slice(A),this.parseHost(),this.hostname=this.hostname||"";var R="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!R)for(var I=this.hostname.split(/\./),S=0,P=I.length;S<P;S++){var M=I[S];if(M&&!M.match(u)){for(var D="",k=0,O=M.length;k<O;k++)M.charCodeAt(k)>127?D+="x":D+=M[k];if(!D.match(u)){var B=I.slice(0,S),L=I.slice(S+1),F=M.match(c);F&&(B.push(F[1]),L.unshift(F[2])),L.length&&(_="/"+L.join(".")+_),this.hostname=B.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),R||(this.hostname=r.toASCII(this.hostname));var N=this.port?":"+this.port:"",U=this.hostname||"";this.host=U+N,this.href+=this.host,R&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==_[0]&&(_="/"+_))}if(!d[x])for(var S=0,P=a.length;S<P;S++){var G=a[S];if(-1!==_.indexOf(G)){var j=encodeURIComponent(G);j===G&&(j=escape(G)),_=_.split(G).join(j)}}var H=_.indexOf("#");-1!==H&&(this.hash=_.substr(H),_=_.slice(0,H));var z=_.indexOf("?");if(-1!==z?(this.search=_.substr(z),this.query=_.substr(z+1),t&&(this.query=m.parse(this.query)),_=_.slice(0,z)):t&&(this.search="",this.query={}),_&&(this.pathname=_),f[x]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var N=this.pathname||"",V=this.search||"";this.path=N+V}return this.href=this.format(),this},i.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":")+"@");var t=this.protocol||"",r=this.pathname||"",i=this.hash||"",s=!1,n="";this.host?s=e+this.host:this.hostname&&(s=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(s+=":"+this.port)),this.query&&"object"==typeof this.query&&Object.keys(this.query).length&&(n=m.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var o=this.search||n&&"?"+n||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||f[t])&&!1!==s?(s="//"+(s||""),r&&"/"!==r.charAt(0)&&(r="/"+r)):s||(s=""),i&&"#"!==i.charAt(0)&&(i="#"+i),o&&"?"!==o.charAt(0)&&(o="?"+o),t+s+(r=r.replace(/[?#]/g,function(e){return encodeURIComponent(e)}))+(o=o.replace("#","%23"))+i},i.prototype.resolve=function(e){return this.resolveObject(g(e,!1,!0)).format()},i.prototype.resolveObject=function(e){if("string"==typeof e){var t=new i;t.parse(e,!1,!0),e=t}for(var r=new i,s=Object.keys(this),n=0;n<s.length;n++){var o=s[n];r[o]=this[o]}if(r.hash=e.hash,""===e.href)return r.href=r.format(),r;if(e.slashes&&!e.protocol){for(var a=Object.keys(e),h=0;h<a.length;h++){var l=a[h];"protocol"!==l&&(r[l]=e[l])}return f[r.protocol]&&r.hostname&&!r.pathname&&(r.pathname="/",r.path=r.pathname),r.href=r.format(),r}if(e.protocol&&e.protocol!==r.protocol){if(!f[e.protocol]){for(var u=Object.keys(e),c=0;c<u.length;c++){var d=u[c];r[d]=e[d]}return r.href=r.format(),r}if(r.protocol=e.protocol,e.host||p[e.protocol])r.pathname=e.pathname;else{for(var m=(e.pathname||"").split("/");m.length&&!(e.host=m.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==m[0]&&m.unshift(""),m.length<2&&m.unshift(""),r.pathname=m.join("/")}if(r.search=e.search,r.query=e.query,r.host=e.host||"",r.auth=e.auth,r.hostname=e.hostname||e.host,r.port=e.port,r.pathname||r.search){var g=r.pathname||"",y=r.search||"";r.path=g+y}return r.slashes=r.slashes||e.slashes,r.href=r.format(),r}var _=r.pathname&&"/"===r.pathname.charAt(0),v=e.host||e.pathname&&"/"===e.pathname.charAt(0),b=v||_||r.host&&e.pathname,x=b,T=r.pathname&&r.pathname.split("/")||[],m=e.pathname&&e.pathname.split("/")||[],E=r.protocol&&!f[r.protocol];if(E&&(r.hostname="",r.port=null,r.host&&(""===T[0]?T[0]=r.host:T.unshift(r.host)),r.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===m[0]?m[0]=e.host:m.unshift(e.host)),e.host=null),b=b&&(""===m[0]||""===T[0])),v)r.host=e.host||""===e.host?e.host:r.host,r.hostname=e.hostname||""===e.hostname?e.hostname:r.hostname,r.search=e.search,r.query=e.query,T=m;else if(m.length)T||(T=[]),T.pop(),T=T.concat(m),r.search=e.search,r.query=e.query;else if(null!=e.search){if(E){r.host=T.shift(),r.hostname=r.host;var w=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@");w&&(r.auth=w.shift(),r.hostname=w.shift(),r.host=r.hostname)}return r.search=e.search,r.query=e.query,(null!==r.pathname||null!==r.search)&&(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.href=r.format(),r}if(!T.length)return r.pathname=null,r.search?r.path="/"+r.search:r.path=null,r.href=r.format(),r;for(var A=T.slice(-1)[0],S=(r.host||e.host||T.length>1)&&("."===A||".."===A)||""===A,C=0,R=T.length;R>=0;R--)"."===(A=T[R])?T.splice(R,1):".."===A?(T.splice(R,1),C++):C&&(T.splice(R,1),C--);if(!b&&!x)for(;C--;C)T.unshift("..");b&&""!==T[0]&&(!T[0]||"/"!==T[0].charAt(0))&&T.unshift(""),S&&"/"!==T.join("/").substr(-1)&&T.push("");var I=""===T[0]||T[0]&&"/"===T[0].charAt(0);if(E){r.hostname=I?"":T.length?T.shift():"",r.host=r.hostname;var w=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@");w&&(r.auth=w.shift(),r.hostname=w.shift(),r.host=r.hostname)}return(b=b||r.host&&T.length)&&!I&&T.unshift(""),T.length>0?r.pathname=T.join("/"):(r.pathname=null,r.path=null),(null!==r.pathname||null!==r.search)&&(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.auth=e.auth||r.auth,r.slashes=r.slashes||e.slashes,r.href=r.format(),r},i.prototype.parseHost=function(){var e=this.host,t=n.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)},t.parse=g,t.resolve=function(e,t){return g(e,!1,!0).resolve(t)},t.resolveObject=function(e,t){return e?g(e,!1,!0).resolveObject(t):t},t.format=function(e){return("string"==typeof e&&(e=g(e)),e instanceof i)?e.format():i.prototype.format.call(e)},t.Url=i}),eP("79Ayg",function(e,t){!function(r){var i=t&&!t.nodeType&&t,s=e&&!e.nodeType&&e,n="object"==typeof ew&&ew;(n.global===n||n.window===n||n.self===n)&&(r=n);var o,a,h=/^xn--/,l=/[^\x20-\x7E]/,u=/[\x2E\u3002\uFF0E\uFF61]/g,c={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},d=Math.floor,p=String.fromCharCode;function f(e){throw RangeError(c[e])}function m(e,t){for(var r=e.length,i=[];r--;)i[r]=t(e[r]);return i}function g(e,t){var r=e.split("@"),i="";return r.length>1&&(i=r[0]+"@",e=r[1]),i+m((e=e.replace(u,".")).split("."),t).join(".")}function y(e){for(var t,r,i=[],s=0,n=e.length;s<n;)(t=e.charCodeAt(s++))>=55296&&t<=56319&&s<n?(64512&(r=e.charCodeAt(s++)))==56320?i.push(((1023&t)<<10)+(1023&r)+65536):(i.push(t),s--):i.push(t);return i}function _(e){return m(e,function(e){var t="";return e>65535&&(e-=65536,t+=p(e>>>10&1023|55296),e=56320|1023&e),t+=p(e)}).join("")}function v(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function b(e,t,r){var i=0;for(e=r?d(e/700):e>>1,e+=d(e/t);e>455;i+=36)e=d(e/35);return d(i+36*e/(e+38))}function x(e){var t,r,i,s,n,o,a,h,l,u,c,p=[],m=e.length,g=0,y=128,v=72;for((i=e.lastIndexOf("-"))<0&&(i=0),s=0;s<i;++s)e.charCodeAt(s)>=128&&f("not-basic"),p.push(e.charCodeAt(s));for(n=i>0?i+1:0;n<m;){for(o=g,a=1,h=36;n>=m&&f("invalid-input"),((l=(t=e.charCodeAt(n++))-48<10?t-22:t-65<26?t-65:t-97<26?t-97:36)>=36||l>d((2147483647-g)/a))&&f("overflow"),g+=l*a,!(l<(u=h<=v?1:h>=v+26?26:h-v));h+=36)a>d(2147483647/(c=36-u))&&f("overflow"),a*=c;v=b(g-o,r=p.length+1,0==o),d(g/r)>2147483647-y&&f("overflow"),y+=d(g/r),g%=r,p.splice(g++,0,y)}return _(p)}function T(e){var t,r,i,s,n,o,a,h,l,u,c,m,g,_,x,T=[];for(o=0,m=(e=y(e)).length,t=128,r=0,n=72;o<m;++o)(c=e[o])<128&&T.push(p(c));for(i=s=T.length,s&&T.push("-");i<m;){for(a=2147483647,o=0;o<m;++o)(c=e[o])>=t&&c<a&&(a=c);for(a-t>d((2147483647-r)/(g=i+1))&&f("overflow"),r+=(a-t)*g,t=a,o=0;o<m;++o)if((c=e[o])<t&&++r>2147483647&&f("overflow"),c==t){for(h=r,l=36;!(h<(u=l<=n?1:l>=n+26?26:l-n));l+=36)x=h-u,_=36-u,T.push(p(v(u+x%_,0))),h=d(x/_);T.push(p(v(h,0))),n=b(r,g,i==s),r=0,++i}++r,++t}return T.join("")}if(o={version:"1.4.1",ucs2:{decode:y,encode:_},decode:x,encode:T,toASCII:function(e){return g(e,function(e){return l.test(e)?"xn--"+T(e):e})},toUnicode:function(e){return g(e,function(e){return h.test(e)?x(e.slice(4).toLowerCase()):e})}},"function"==typeof define&&"object"==typeof define.amd&&define.amd)define("punycode",function(){return o});else if(i&&s){if(e.exports==i)s.exports=o;else for(a in o)o.hasOwnProperty(a)&&(i[a]=o[a])}else r.punycode=o}(this)}),eP("8ucWi",function(e,t){var r=eI("iQOOo"),i=eI("2Q6CU"),s=eI("7quPe");e.exports={formats:s,parse:i,stringify:r}}),eP("iQOOo",function(e,t){var r=eI("eoSaX"),i=eI("1ODJ0"),s=eI("7quPe"),n=Object.prototype.hasOwnProperty,o={brackets:function(e){return e+"[]"},comma:"comma",indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},a=Array.isArray,h=Array.prototype.push,l=function(e,t){h.apply(e,a(t)?t:[t])},u=Date.prototype.toISOString,c=s.default,d={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:i.encode,encodeValuesOnly:!1,format:c,formatter:s.formatters[c],indices:!1,serializeDate:function(e){return u.call(e)},skipNulls:!1,strictNullHandling:!1},p={},f=function e(t,s,n,o,h,u,c,f,m,g,y,_,v,b,x,T,E,w){for(var A,S,C=t,R=w,I=0,P=!1;void 0!==(R=R.get(p))&&!P;){var M=R.get(t);if(I+=1,void 0!==M){if(M===I)throw RangeError("Cyclic object value");P=!0}void 0===R.get(p)&&(I=0)}if("function"==typeof g?C=g(s,C):C instanceof Date?C=v(C):"comma"===n&&a(C)&&(C=i.maybeMap(C,function(e){return e instanceof Date?v(e):e})),null===C){if(u)return m&&!T?m(s,d.encoder,E,"key",b):s;C=""}if("string"==typeof(A=C)||"number"==typeof A||"boolean"==typeof A||"symbol"==typeof A||"bigint"==typeof A||i.isBuffer(C))return m?[x(T?s:m(s,d.encoder,E,"key",b))+"="+x(m(C,d.encoder,E,"value",b))]:[x(s)+"="+x(String(C))];var D=[];if(void 0===C)return D;if("comma"===n&&a(C))T&&m&&(C=i.maybeMap(C,m)),S=[{value:C.length>0?C.join(",")||null:void 0}];else if(a(g))S=g;else{var k=Object.keys(C);S=y?k.sort(y):k}var O=f?s.replace(/\./g,"%2E"):s,B=o&&a(C)&&1===C.length?O+"[]":O;if(h&&a(C)&&0===C.length)return B+"[]";for(var L=0;L<S.length;++L){var F=S[L],N="object"==typeof F&&void 0!==F.value?F.value:C[F];if(!c||null!==N){var U=_&&f?F.replace(/\./g,"%2E"):F,G=a(C)?"function"==typeof n?n(B,U):B:B+(_?"."+U:"["+U+"]");w.set(t,I);var j=r();j.set(p,w),l(D,e(N,G,n,o,h,u,c,f,"comma"===n&&T&&a(C)?null:m,g,y,_,v,b,x,T,E,j))}}return D},m=function(e){if(!e)return d;if(void 0!==e.allowEmptyArrays&&"boolean"!=typeof e.allowEmptyArrays)throw TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==e.encodeDotInKeys&&"boolean"!=typeof e.encodeDotInKeys)throw TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw TypeError("Encoder has to be a function.");var t,r=e.charset||d.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var i=s.default;if(void 0!==e.format){if(!n.call(s.formatters,e.format))throw TypeError("Unknown format option provided.");i=e.format}var h=s.formatters[i],l=d.filter;if(("function"==typeof e.filter||a(e.filter))&&(l=e.filter),t=e.arrayFormat in o?e.arrayFormat:"indices"in e?e.indices?"indices":"repeat":d.arrayFormat,"commaRoundTrip"in e&&"boolean"!=typeof e.commaRoundTrip)throw TypeError("`commaRoundTrip` must be a boolean, or absent");var u=void 0===e.allowDots?!0===e.encodeDotInKeys||d.allowDots:!!e.allowDots;return{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:d.addQueryPrefix,allowDots:u,allowEmptyArrays:"boolean"==typeof e.allowEmptyArrays?!!e.allowEmptyArrays:d.allowEmptyArrays,arrayFormat:t,charset:r,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:d.charsetSentinel,commaRoundTrip:e.commaRoundTrip,delimiter:void 0===e.delimiter?d.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:d.encode,encodeDotInKeys:"boolean"==typeof e.encodeDotInKeys?e.encodeDotInKeys:d.encodeDotInKeys,encoder:"function"==typeof e.encoder?e.encoder:d.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:d.encodeValuesOnly,filter:l,format:i,formatter:h,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:d.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:d.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:d.strictNullHandling}};e.exports=function(e,t){var i,s=e,n=m(t);"function"==typeof n.filter?s=(0,n.filter)("",s):a(n.filter)&&(i=n.filter);var h=[];if("object"!=typeof s||null===s)return"";var u=o[n.arrayFormat],c="comma"===u&&n.commaRoundTrip;i||(i=Object.keys(s)),n.sort&&i.sort(n.sort);for(var d=r(),p=0;p<i.length;++p){var g=i[p];n.skipNulls&&null===s[g]||l(h,f(s[g],g,u,c,n.allowEmptyArrays,n.strictNullHandling,n.skipNulls,n.encodeDotInKeys,n.encode?n.encoder:null,n.filter,n.sort,n.allowDots,n.serializeDate,n.format,n.formatter,n.encodeValuesOnly,n.charset,d))}var y=h.join(n.delimiter),_=!0===n.addQueryPrefix?"?":"";return n.charsetSentinel&&("iso-8859-1"===n.charset?_+="utf8=%26%2310003%3B&":_+="utf8=%E2%9C%93&"),y.length>0?_+y:""}}),eP("eoSaX",function(e,t){var r=eI("55Qsv"),i=eI("haYig"),s=eI("lNVTp"),n=eI("jQFIR"),o=r("%WeakMap%",!0),a=r("%Map%",!0),h=i("WeakMap.prototype.get",!0),l=i("WeakMap.prototype.set",!0),u=i("WeakMap.prototype.has",!0),c=i("Map.prototype.get",!0),d=i("Map.prototype.set",!0),p=i("Map.prototype.has",!0),f=function(e,t){for(var r,i=e;null!==(r=i.next);i=r)if(r.key===t)return i.next=r.next,r.next=e.next,e.next=r,r},m=function(e,t){var r=f(e,t);return r&&r.value},g=function(e,t,r){var i=f(e,t);i?i.value=r:e.next={key:t,next:e.next,value:r}};e.exports=function(){var e,t,r,i={assert:function(e){if(!i.has(e))throw new n("Side channel does not contain "+s(e))},get:function(i){if(o&&i&&("object"==typeof i||"function"==typeof i)){if(e)return h(e,i)}else if(a){if(t)return c(t,i)}else if(r)return m(r,i)},has:function(i){if(o&&i&&("object"==typeof i||"function"==typeof i)){if(e)return u(e,i)}else if(a){if(t)return p(t,i)}else if(r)return!!f(r,i);return!1},set:function(i,s){o&&i&&("object"==typeof i||"function"==typeof i)?(e||(e=new o),l(e,i,s)):a?(t||(t=new a),d(t,i,s)):(r||(r={key:{},next:null}),g(r,i,s))}};return i}}),eP("55Qsv",function(e,t){var r=eI("2DlCe"),i=eI("TtWO0"),s=eI("aG0Ti"),n=eI("cwaZa"),o=eI("1rcCL"),a=eI("jQFIR"),h=eI("6Unty"),l=Function,u=function(e){try{return l('"use strict"; return ('+e+").constructor;")()}catch(e){}},c=Object.getOwnPropertyDescriptor;if(c)try{c({},"")}catch(e){c=null}var d=function(){throw new a},p=c?function(){try{return arguments.callee,d}catch(e){try{return c(arguments,"callee").get}catch(e){return d}}}():d,f=eI("eke6n")(),m=eI("sg7kb")(),g=Object.getPrototypeOf||(m?function(e){return e.__proto__}:null),y={},_="undefined"!=typeof Uint8Array&&g?g(Uint8Array):void 0,v={__proto__:null,"%AggregateError%":"undefined"==typeof AggregateError?void 0:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?void 0:ArrayBuffer,"%ArrayIteratorPrototype%":f&&g?g([][Symbol.iterator]()):void 0,"%AsyncFromSyncIteratorPrototype%":void 0,"%AsyncFunction%":y,"%AsyncGenerator%":y,"%AsyncGeneratorFunction%":y,"%AsyncIteratorPrototype%":y,"%Atomics%":"undefined"==typeof Atomics?void 0:Atomics,"%BigInt%":"undefined"==typeof BigInt?void 0:BigInt,"%BigInt64Array%":"undefined"==typeof BigInt64Array?void 0:BigInt64Array,"%BigUint64Array%":"undefined"==typeof BigUint64Array?void 0:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?void 0:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":r,"%eval%":eval,"%EvalError%":i,"%Float32Array%":"undefined"==typeof Float32Array?void 0:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?void 0:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?void 0:FinalizationRegistry,"%Function%":l,"%GeneratorFunction%":y,"%Int8Array%":"undefined"==typeof Int8Array?void 0:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?void 0:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?void 0:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":f&&g?g(g([][Symbol.iterator]())):void 0,"%JSON%":"object"==typeof JSON?JSON:void 0,"%Map%":"undefined"==typeof Map?void 0:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&f&&g?g(new Map()[Symbol.iterator]()):void 0,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?void 0:Promise,"%Proxy%":"undefined"==typeof Proxy?void 0:Proxy,"%RangeError%":s,"%ReferenceError%":n,"%Reflect%":"undefined"==typeof Reflect?void 0:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?void 0:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&f&&g?g(new Set()[Symbol.iterator]()):void 0,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?void 0:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":f&&g?g(""[Symbol.iterator]()):void 0,"%Symbol%":f?Symbol:void 0,"%SyntaxError%":o,"%ThrowTypeError%":p,"%TypedArray%":_,"%TypeError%":a,"%Uint8Array%":"undefined"==typeof Uint8Array?void 0:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?void 0:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?void 0:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?void 0:Uint32Array,"%URIError%":h,"%WeakMap%":"undefined"==typeof WeakMap?void 0:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?void 0:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?void 0:WeakSet};if(g)try{null.error}catch(e){var b=g(g(e));v["%Error.prototype%"]=b}var x=function e(t){var r;if("%AsyncFunction%"===t)r=u("async function () {}");else if("%GeneratorFunction%"===t)r=u("function* () {}");else if("%AsyncGeneratorFunction%"===t)r=u("async function* () {}");else if("%AsyncGenerator%"===t){var i=e("%AsyncGeneratorFunction%");i&&(r=i.prototype)}else if("%AsyncIteratorPrototype%"===t){var s=e("%AsyncGenerator%");s&&g&&(r=g(s.prototype))}return v[t]=r,r},T={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},E=eI("1rs7J"),w=eI("9VOPG"),A=E.call(Function.call,Array.prototype.concat),S=E.call(Function.apply,Array.prototype.splice),C=E.call(Function.call,String.prototype.replace),R=E.call(Function.call,String.prototype.slice),I=E.call(Function.call,RegExp.prototype.exec),P=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,M=/\\(\\)?/g,D=function(e){var t=R(e,0,1),r=R(e,-1);if("%"===t&&"%"!==r)throw new o("invalid intrinsic syntax, expected closing `%`");if("%"===r&&"%"!==t)throw new o("invalid intrinsic syntax, expected opening `%`");var i=[];return C(e,P,function(e,t,r,s){i[i.length]=r?C(s,M,"$1"):t||e}),i},k=function(e,t){var r,i=e;if(w(T,i)&&(i="%"+(r=T[i])[0]+"%"),w(v,i)){var s=v[i];if(s===y&&(s=x(i)),void 0===s&&!t)throw new a("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:r,name:i,value:s}}throw new o("intrinsic "+e+" does not exist!")};e.exports=function(e,t){if("string"!=typeof e||0===e.length)throw new a("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof t)throw new a('"allowMissing" argument must be a boolean');if(null===I(/^%?[^%]*%?$/,e))throw new o("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var r=D(e),i=r.length>0?r[0]:"",s=k("%"+i+"%",t),n=s.name,h=s.value,l=!1,u=s.alias;u&&(i=u[0],S(r,A([0,1],u)));for(var d=1,p=!0;d<r.length;d+=1){var f=r[d],m=R(f,0,1),g=R(f,-1);if(('"'===m||"'"===m||"`"===m||'"'===g||"'"===g||"`"===g)&&m!==g)throw new o("property names with quotes must have matching quotes");if("constructor"!==f&&p||(l=!0),i+="."+f,w(v,n="%"+i+"%"))h=v[n];else if(null!=h){if(!(f in h)){if(!t)throw new a("base intrinsic for "+e+" exists, but the property is not available.");return}if(c&&d+1>=r.length){var y=c(h,f);h=(p=!!y)&&"get"in y&&!("originalValue"in y.get)?y.get:h[f]}else p=w(h,f),h=h[f];p&&!l&&(v[n]=h)}}return h}}),eP("2DlCe",function(e,t){e.exports=Error}),eP("TtWO0",function(e,t){e.exports=EvalError}),eP("aG0Ti",function(e,t){e.exports=RangeError}),eP("cwaZa",function(e,t){e.exports=ReferenceError}),eP("1rcCL",function(e,t){e.exports=SyntaxError}),eP("jQFIR",function(e,t){e.exports=TypeError}),eP("6Unty",function(e,t){e.exports=URIError}),eP("eke6n",function(e,t){var r="undefined"!=typeof Symbol&&Symbol,i=eI("i50ZI");e.exports=function(){return"function"==typeof r&&"function"==typeof Symbol&&"symbol"==typeof r("foo")&&"symbol"==typeof Symbol("bar")&&i()}}),eP("i50ZI",function(e,t){e.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var e={},t=Symbol("test"),r=Object(t);if("string"==typeof t||"[object Symbol]"!==Object.prototype.toString.call(t)||"[object Symbol]"!==Object.prototype.toString.call(r))return!1;for(t in e[t]=42,e)return!1;if("function"==typeof Object.keys&&0!==Object.keys(e).length||"function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(e).length)return!1;var i=Object.getOwnPropertySymbols(e);if(1!==i.length||i[0]!==t||!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var s=Object.getOwnPropertyDescriptor(e,t);if(42!==s.value||!0!==s.enumerable)return!1}return!0}}),eP("sg7kb",function(e,t){var r={__proto__:null,foo:{}},i=Object;e.exports=function(){return({__proto__:r}).foo===r.foo&&!(r instanceof i)}}),eP("1rs7J",function(e,t){var r=eI("eXzJr");e.exports=Function.prototype.bind||r}),eP("eXzJr",function(e,t){var r=Object.prototype.toString,i=Math.max,s=function(e,t){for(var r=[],i=0;i<e.length;i+=1)r[i]=e[i];for(var s=0;s<t.length;s+=1)r[s+e.length]=t[s];return r},n=function(e,t){for(var r=[],i=t||0,s=0;i<e.length;i+=1,s+=1)r[s]=e[i];return r},o=function(e,t){for(var r="",i=0;i<e.length;i+=1)r+=e[i],i+1<e.length&&(r+=t);return r};e.exports=function(e){var t,a=this;if("function"!=typeof a||"[object Function]"!==r.apply(a))throw TypeError("Function.prototype.bind called on incompatible "+a);for(var h=n(arguments,1),l=i(0,a.length-h.length),u=[],c=0;c<l;c++)u[c]="$"+c;if(t=Function("binder","return function ("+o(u,",")+"){ return binder.apply(this,arguments); }")(function(){if(this instanceof t){var r=a.apply(this,s(h,arguments));return Object(r)===r?r:this}return a.apply(e,s(h,arguments))}),a.prototype){var d=function(){};d.prototype=a.prototype,t.prototype=new d,d.prototype=null}return t}}),eP("9VOPG",function(e,t){var r=Function.prototype.call,i=Object.prototype.hasOwnProperty,s=eI("1rs7J");e.exports=s.call(r,i)}),eP("haYig",function(e,t){var r=eI("55Qsv"),i=eI("5M0y1"),s=i(r("String.prototype.indexOf"));e.exports=function(e,t){var n=r(e,!!t);return"function"==typeof n&&s(e,".prototype.")>-1?i(n):n}}),eP("5M0y1",function(e,t){var r=eI("1rs7J"),i=eI("55Qsv"),s=eI("djZMj"),n=eI("jQFIR"),o=i("%Function.prototype.apply%"),a=i("%Function.prototype.call%"),h=i("%Reflect.apply%",!0)||r.call(a,o),l=eI("7PuDr"),u=i("%Math.max%");e.exports=function(e){if("function"!=typeof e)throw new n("a function is required");var t=h(r,a,arguments);return s(t,1+u(0,e.length-(arguments.length-1)),!0)};var c=function(){return h(r,o,arguments)};l?l(e.exports,"apply",{value:c}):e.exports.apply=c}),eP("djZMj",function(e,t){var r=eI("55Qsv"),i=eI("6dipk"),s=eI("dp7dD")(),n=eI("aJeoY"),o=eI("jQFIR"),a=r("%Math.floor%");e.exports=function(e,t){if("function"!=typeof e)throw new o("`fn` is not a function");if("number"!=typeof t||t<0||t>4294967295||a(t)!==t)throw new o("`length` must be a positive 32-bit integer");var r=arguments.length>2&&!!arguments[2],h=!0,l=!0;if("length"in e&&n){var u=n(e,"length");u&&!u.configurable&&(h=!1),u&&!u.writable&&(l=!1)}return(h||l||!r)&&(s?i(e,"length",t,!0,!0):i(e,"length",t)),e}}),eP("6dipk",function(e,t){var r=eI("7PuDr"),i=eI("1rcCL"),s=eI("jQFIR"),n=eI("aJeoY");e.exports=function(e,t,o){if(!e||"object"!=typeof e&&"function"!=typeof e)throw new s("`obj` must be an object or a function`");if("string"!=typeof t&&"symbol"!=typeof t)throw new s("`property` must be a string or a symbol`");if(arguments.length>3&&"boolean"!=typeof arguments[3]&&null!==arguments[3])throw new s("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&"boolean"!=typeof arguments[4]&&null!==arguments[4])throw new s("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&"boolean"!=typeof arguments[5]&&null!==arguments[5])throw new s("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&"boolean"!=typeof arguments[6])throw new s("`loose`, if provided, must be a boolean");var a=arguments.length>3?arguments[3]:null,h=arguments.length>4?arguments[4]:null,l=arguments.length>5?arguments[5]:null,u=arguments.length>6&&arguments[6],c=!!n&&n(e,t);if(r)r(e,t,{configurable:null===l&&c?c.configurable:!l,enumerable:null===a&&c?c.enumerable:!a,value:o,writable:null===h&&c?c.writable:!h});else if(!u&&(a||h||l))throw new i("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.");else e[t]=o}}),eP("7PuDr",function(e,t){var r=eI("55Qsv")("%Object.defineProperty%",!0)||!1;if(r)try{r({},"a",{value:1})}catch(e){r=!1}e.exports=r}),eP("aJeoY",function(e,t){var r=eI("55Qsv")("%Object.getOwnPropertyDescriptor%",!0);if(r)try{r([],"length")}catch(e){r=null}e.exports=r}),eP("dp7dD",function(e,t){var r=eI("7PuDr"),i=function(){return!!r};i.hasArrayLengthDefineBug=function(){if(!r)return null;try{return 1!==r([],"length",{value:1}).length}catch(e){return!0}},e.exports=i}),eP("lNVTp",function(e,t){var r="function"==typeof Map&&Map.prototype,i=Object.getOwnPropertyDescriptor&&r?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,s=r&&i&&"function"==typeof i.get?i.get:null,n=r&&Map.prototype.forEach,o="function"==typeof Set&&Set.prototype,a=Object.getOwnPropertyDescriptor&&o?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,h=o&&a&&"function"==typeof a.get?a.get:null,l=o&&Set.prototype.forEach,u="function"==typeof WeakMap&&WeakMap.prototype?WeakMap.prototype.has:null,c="function"==typeof WeakSet&&WeakSet.prototype?WeakSet.prototype.has:null,d="function"==typeof WeakRef&&WeakRef.prototype?WeakRef.prototype.deref:null,p=Boolean.prototype.valueOf,f=Object.prototype.toString,m=Function.prototype.toString,g=String.prototype.match,y=String.prototype.slice,_=String.prototype.replace,v=String.prototype.toUpperCase,b=String.prototype.toLowerCase,x=RegExp.prototype.test,T=Array.prototype.concat,E=Array.prototype.join,w=Array.prototype.slice,A=Math.floor,S="function"==typeof BigInt?BigInt.prototype.valueOf:null,C=Object.getOwnPropertySymbols,R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?Symbol.prototype.toString:null,I="function"==typeof Symbol&&"object"==typeof Symbol.iterator,P="function"==typeof Symbol&&Symbol.toStringTag&&(typeof Symbol.toStringTag===I?"object":"symbol")?Symbol.toStringTag:null,M=Object.prototype.propertyIsEnumerable,D=("function"==typeof Reflect?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(e){return e.__proto__}:null);function k(e,t){if(e===1/0||e===-1/0||e!=e||e&&e>-1e3&&e<1e3||x.call(/e/,t))return t;var r=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if("number"==typeof e){var i=e<0?-A(-e):A(e);if(i!==e){var s=String(i),n=y.call(t,s.length+1);return _.call(s,r,"$&_")+"."+_.call(_.call(n,/([0-9]{3})/g,"$&_"),/_$/,"")}}return _.call(t,r,"$&_")}var O=eI("ippNs"),B=O.custom,L=G(B)?B:null;function F(e,t,r){var i="double"===(r.quoteStyle||t)?'"':"'";return i+e+i}function N(e){return"[object Array]"===z(e)&&(!P||!("object"==typeof e&&P in e))}function U(e){return"[object RegExp]"===z(e)&&(!P||!("object"==typeof e&&P in e))}function G(e){if(I)return e&&"object"==typeof e&&e instanceof Symbol;if("symbol"==typeof e)return!0;if(!e||"object"!=typeof e||!R)return!1;try{return R.call(e),!0}catch(e){}return!1}e.exports=function e(t,r,i,o){var a=r||{};if(H(a,"quoteStyle")&&"single"!==a.quoteStyle&&"double"!==a.quoteStyle)throw TypeError('option "quoteStyle" must be "single" or "double"');if(H(a,"maxStringLength")&&("number"==typeof a.maxStringLength?a.maxStringLength<0&&a.maxStringLength!==1/0:null!==a.maxStringLength))throw TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var f=!H(a,"customInspect")||a.customInspect;if("boolean"!=typeof f&&"symbol"!==f)throw TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(H(a,"indent")&&null!==a.indent&&"	"!==a.indent&&!(parseInt(a.indent,10)===a.indent&&a.indent>0))throw TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(H(a,"numericSeparator")&&"boolean"!=typeof a.numericSeparator)throw TypeError('option "numericSeparator", if provided, must be `true` or `false`');var v=a.numericSeparator;if(void 0===t)return"undefined";if(null===t)return"null";if("boolean"==typeof t)return t?"true":"false";if("string"==typeof t)return function e(t,r){if(t.length>r.maxStringLength){var i=t.length-r.maxStringLength;return e(y.call(t,0,r.maxStringLength),r)+"... "+i+" more character"+(i>1?"s":"")}return F(_.call(_.call(t,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,X),"single",r)}(t,a);if("number"==typeof t){if(0===t)return 1/0/t>0?"0":"-0";var x=String(t);return v?k(t,x):x}if("bigint"==typeof t){var A=String(t)+"n";return v?k(t,A):A}var C=void 0===a.depth?5:a.depth;if(void 0===i&&(i=0),i>=C&&C>0&&"object"==typeof t)return N(t)?"[Array]":"[Object]";var B=function(e,t){var r;if("	"===e.indent)r="	";else{if("number"!=typeof e.indent||!(e.indent>0))return null;r=E.call(Array(e.indent+1)," ")}return{base:r,prev:E.call(Array(t+1),r)}}(a,i);if(void 0===o)o=[];else if(V(o,t)>=0)return"[Circular]";function j(t,r,s){if(r&&(o=w.call(o)).push(r),s){var n={depth:a.depth};return H(a,"quoteStyle")&&(n.quoteStyle=a.quoteStyle),e(t,n,i+1,o)}return e(t,a,i+1,o)}if("function"==typeof t&&!U(t)){var J=function(e){if(e.name)return e.name;var t=g.call(m.call(e),/^function\s*([\w$]+)/);return t?t[1]:null}(t),Z=K(t,j);return"[Function"+(J?": "+J:" (anonymous)")+"]"+(Z.length>0?" { "+E.call(Z,", ")+" }":"")}if(G(t)){var Q=I?_.call(String(t),/^(Symbol\(.*\))_[^)]*$/,"$1"):R.call(t);return"object"!=typeof t||I?Q:W(Q)}if(t&&"object"==typeof t&&("undefined"!=typeof HTMLElement&&t instanceof HTMLElement||"string"==typeof t.nodeName&&"function"==typeof t.getAttribute)){for(var ee,et="<"+b.call(String(t.nodeName)),er=t.attributes||[],ei=0;ei<er.length;ei++)et+=" "+er[ei].name+"="+F((ee=er[ei].value,_.call(String(ee),/"/g,"&quot;")),"double",a);return et+=">",t.childNodes&&t.childNodes.length&&(et+="..."),et+="</"+b.call(String(t.nodeName))+">"}if(N(t)){if(0===t.length)return"[]";var es=K(t,j);return B&&!function(e){for(var t=0;t<e.length;t++)if(V(e[t],"\n")>=0)return!1;return!0}(es)?"["+q(es,B)+"]":"[ "+E.call(es,", ")+" ]"}if("[object Error]"===z(t)&&(!P||!("object"==typeof t&&P in t))){var en=K(t,j);return"cause"in Error.prototype||!("cause"in t)||M.call(t,"cause")?0===en.length?"["+String(t)+"]":"{ ["+String(t)+"] "+E.call(en,", ")+" }":"{ ["+String(t)+"] "+E.call(T.call("[cause]: "+j(t.cause),en),", ")+" }"}if("object"==typeof t&&f){if(L&&"function"==typeof t[L]&&O)return O(t,{depth:C-i});if("symbol"!==f&&"function"==typeof t.inspect)return t.inspect()}if(function(e){if(!s||!e||"object"!=typeof e)return!1;try{s.call(e);try{h.call(e)}catch(e){return!0}return e instanceof Map}catch(e){}return!1}(t)){var eo=[];return n&&n.call(t,function(e,r){eo.push(j(r,t,!0)+" => "+j(e,t))}),Y("Map",s.call(t),eo,B)}if(function(e){if(!h||!e||"object"!=typeof e)return!1;try{h.call(e);try{s.call(e)}catch(e){return!0}return e instanceof Set}catch(e){}return!1}(t)){var ea=[];return l&&l.call(t,function(e){ea.push(j(e,t))}),Y("Set",h.call(t),ea,B)}if(function(e){if(!u||!e||"object"!=typeof e)return!1;try{u.call(e,u);try{c.call(e,c)}catch(e){return!0}return e instanceof WeakMap}catch(e){}return!1}(t))return $("WeakMap");if(function(e){if(!c||!e||"object"!=typeof e)return!1;try{c.call(e,c);try{u.call(e,u)}catch(e){return!0}return e instanceof WeakSet}catch(e){}return!1}(t))return $("WeakSet");if(function(e){if(!d||!e||"object"!=typeof e)return!1;try{return d.call(e),!0}catch(e){}return!1}(t))return $("WeakRef");if("[object Number]"===z(t)&&(!P||!("object"==typeof t&&P in t)))return W(j(Number(t)));if(function(e){if(!e||"object"!=typeof e||!S)return!1;try{return S.call(e),!0}catch(e){}return!1}(t))return W(j(S.call(t)));if("[object Boolean]"===z(t)&&(!P||!("object"==typeof t&&P in t)))return W(p.call(t));if("[object String]"===z(t)&&(!P||!("object"==typeof t&&P in t)))return W(j(String(t)));if("undefined"!=typeof window&&t===window)return"{ [object Window] }";if(t===ew)return"{ [object globalThis] }";if(!("[object Date]"===z(t)&&(!P||!("object"==typeof t&&P in t)))&&!U(t)){var eh=K(t,j),el=D?D(t)===Object.prototype:t instanceof Object||t.constructor===Object,eu=t instanceof Object?"":"null prototype",ec=!el&&P&&Object(t)===t&&P in t?y.call(z(t),8,-1):eu?"Object":"",ed=(el||"function"!=typeof t.constructor?"":t.constructor.name?t.constructor.name+" ":"")+(ec||eu?"["+E.call(T.call([],ec||[],eu||[]),": ")+"] ":"");return 0===eh.length?ed+"{}":B?ed+"{"+q(eh,B)+"}":ed+"{ "+E.call(eh,", ")+" }"}return String(t)};var j=Object.prototype.hasOwnProperty||function(e){return e in this};function H(e,t){return j.call(e,t)}function z(e){return f.call(e)}function V(e,t){if(e.indexOf)return e.indexOf(t);for(var r=0,i=e.length;r<i;r++)if(e[r]===t)return r;return -1}function X(e){var t=e.charCodeAt(0),r={8:"b",9:"t",10:"n",12:"f",13:"r"}[t];return r?"\\"+r:"\\x"+(t<16?"0":"")+v.call(t.toString(16))}function W(e){return"Object("+e+")"}function $(e){return e+" { ? }"}function Y(e,t,r,i){return e+" ("+t+") {"+(i?q(r,i):E.call(r,", "))+"}"}function q(e,t){if(0===e.length)return"";var r="\n"+t.prev+t.base;return r+E.call(e,","+r)+"\n"+t.prev}function K(e,t){var r,i=N(e),s=[];if(i){s.length=e.length;for(var n=0;n<e.length;n++)s[n]=H(e,n)?t(e[n],e):""}var o="function"==typeof C?C(e):[];if(I){r={};for(var a=0;a<o.length;a++)r["$"+o[a]]=o[a]}for(var h in e)if(H(e,h)&&(!i||String(Number(h))!==h||!(h<e.length))){if(I&&r["$"+h]instanceof Symbol)continue;x.call(/[^\w$]/,h)?s.push(t(h,e)+": "+t(e[h],e)):s.push(h+": "+t(e[h],e))}if("function"==typeof C)for(var l=0;l<o.length;l++)M.call(e,o[l])&&s.push("["+t(o[l])+"]: "+t(e[o[l]],e));return s}}),eP("ippNs",function(e,t){}),eP("1ODJ0",function(e,t){var r=eI("7quPe"),i=Object.prototype.hasOwnProperty,s=Array.isArray,n=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}(),o=function(e){for(;e.length>1;){var t=e.pop(),r=t.obj[t.prop];if(s(r)){for(var i=[],n=0;n<r.length;++n)void 0!==r[n]&&i.push(r[n]);t.obj[t.prop]=i}}},a=function(e,t){for(var r=t&&t.plainObjects?Object.create(null):{},i=0;i<e.length;++i)void 0!==e[i]&&(r[i]=e[i]);return r};e.exports={arrayToObject:a,assign:function(e,t){return Object.keys(t).reduce(function(e,r){return e[r]=t[r],e},e)},combine:function(e,t){return[].concat(e,t)},compact:function(e){for(var t=[{obj:{o:e},prop:"o"}],r=[],i=0;i<t.length;++i)for(var s=t[i],n=s.obj[s.prop],a=Object.keys(n),h=0;h<a.length;++h){var l=a[h],u=n[l];"object"==typeof u&&null!==u&&-1===r.indexOf(u)&&(t.push({obj:n,prop:l}),r.push(u))}return o(t),e},decode:function(e,t,r){var i=e.replace(/\+/g," ");if("iso-8859-1"===r)return i.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(i)}catch(e){return i}},encode:function(e,t,i,s,o){if(0===e.length)return e;var a=e;if("symbol"==typeof e?a=Symbol.prototype.toString.call(e):"string"!=typeof e&&(a=String(e)),"iso-8859-1"===i)return escape(a).replace(/%u[0-9a-f]{4}/gi,function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"});for(var h="",l=0;l<a.length;++l){var u=a.charCodeAt(l);if(45===u||46===u||95===u||126===u||u>=48&&u<=57||u>=65&&u<=90||u>=97&&u<=122||o===r.RFC1738&&(40===u||41===u)){h+=a.charAt(l);continue}if(u<128){h+=n[u];continue}if(u<2048){h+=n[192|u>>6]+n[128|63&u];continue}if(u<55296||u>=57344){h+=n[224|u>>12]+n[128|u>>6&63]+n[128|63&u];continue}l+=1,h+=n[240|(u=65536+((1023&u)<<10|1023&a.charCodeAt(l)))>>18]+n[128|u>>12&63]+n[128|u>>6&63]+n[128|63&u]}return h},isBuffer:function(e){return!!e&&"object"==typeof e&&!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))},isRegExp:function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},maybeMap:function(e,t){if(s(e)){for(var r=[],i=0;i<e.length;i+=1)r.push(t(e[i]));return r}return t(e)},merge:function e(t,r,n){if(!r)return t;if("object"!=typeof r){if(s(t))t.push(r);else{if(!t||"object"!=typeof t)return[t,r];(n&&(n.plainObjects||n.allowPrototypes)||!i.call(Object.prototype,r))&&(t[r]=!0)}return t}if(!t||"object"!=typeof t)return[t].concat(r);var o=t;return(s(t)&&!s(r)&&(o=a(t,n)),s(t)&&s(r))?(r.forEach(function(r,s){if(i.call(t,s)){var o=t[s];o&&"object"==typeof o&&r&&"object"==typeof r?t[s]=e(o,r,n):t.push(r)}else t[s]=r}),t):Object.keys(r).reduce(function(t,s){var o=r[s];return i.call(t,s)?t[s]=e(t[s],o,n):t[s]=o,t},o)}}}),eP("7quPe",function(e,t){var r=String.prototype.replace,i=/%20/g,s="RFC3986";e.exports={default:s,formatters:{RFC1738:function(e){return r.call(e,i,"+")},RFC3986:function(e){return String(e)}},RFC1738:"RFC1738",RFC3986:s}}),eP("2Q6CU",function(e,t){var r=eI("1ODJ0"),i=Object.prototype.hasOwnProperty,s=Array.isArray,n={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!0,decoder:r.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},o=function(e,t){return e&&"string"==typeof e&&t.comma&&e.indexOf(",")>-1?e.split(","):e},a=function(e,t){var a={__proto__:null},h=t.ignoreQueryPrefix?e.replace(/^\?/,""):e,l=t.parameterLimit===1/0?void 0:t.parameterLimit,u=h.split(t.delimiter,l),c=-1,d=t.charset;if(t.charsetSentinel)for(p=0;p<u.length;++p)0===u[p].indexOf("utf8=")&&("utf8=%E2%9C%93"===u[p]?d="utf-8":"utf8=%26%2310003%3B"===u[p]&&(d="iso-8859-1"),c=p,p=u.length);for(p=0;p<u.length;++p)if(p!==c){var p,f,m,g=u[p],y=g.indexOf("]="),_=-1===y?g.indexOf("="):y+1;-1===_?(f=t.decoder(g,n.decoder,d,"key"),m=t.strictNullHandling?null:""):(f=t.decoder(g.slice(0,_),n.decoder,d,"key"),m=r.maybeMap(o(g.slice(_+1),t),function(e){return t.decoder(e,n.decoder,d,"value")})),m&&t.interpretNumericEntities&&"iso-8859-1"===d&&(m=m.replace(/&#(\d+);/g,function(e,t){return String.fromCharCode(parseInt(t,10))})),g.indexOf("[]=")>-1&&(m=s(m)?[m]:m);var v=i.call(a,f);v&&"combine"===t.duplicates?a[f]=r.combine(a[f],m):v&&"last"!==t.duplicates||(a[f]=m)}return a},h=function(e,t,r,i){for(var s=i?t:o(t,r),n=e.length-1;n>=0;--n){var a,h=e[n];if("[]"===h&&r.parseArrays)a=r.allowEmptyArrays&&""===s?[]:[].concat(s);else{a=r.plainObjects?Object.create(null):{};var l="["===h.charAt(0)&&"]"===h.charAt(h.length-1)?h.slice(1,-1):h,u=r.decodeDotInKeys?l.replace(/%2E/g,"."):l,c=parseInt(u,10);r.parseArrays||""!==u?!isNaN(c)&&h!==u&&String(c)===u&&c>=0&&r.parseArrays&&c<=r.arrayLimit?(a=[])[c]=s:"__proto__"!==u&&(a[u]=s):a={0:s}}s=a}return s},l=function(e,t,r,s){if(e){var n=r.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,o=/(\[[^[\]]*])/g,a=r.depth>0&&/(\[[^[\]]*])/.exec(n),l=a?n.slice(0,a.index):n,u=[];if(l){if(!r.plainObjects&&i.call(Object.prototype,l)&&!r.allowPrototypes)return;u.push(l)}for(var c=0;r.depth>0&&null!==(a=o.exec(n))&&c<r.depth;){if(c+=1,!r.plainObjects&&i.call(Object.prototype,a[1].slice(1,-1))&&!r.allowPrototypes)return;u.push(a[1])}return a&&u.push("["+n.slice(a.index)+"]"),h(u,t,r,s)}},u=function(e){if(!e)return n;if(void 0!==e.allowEmptyArrays&&"boolean"!=typeof e.allowEmptyArrays)throw TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==e.decodeDotInKeys&&"boolean"!=typeof e.decodeDotInKeys)throw TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.decoder&&void 0!==e.decoder&&"function"!=typeof e.decoder)throw TypeError("Decoder has to be a function.");if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var t=void 0===e.charset?n.charset:e.charset,i=void 0===e.duplicates?n.duplicates:e.duplicates;if("combine"!==i&&"first"!==i&&"last"!==i)throw TypeError("The duplicates option must be either combine, first, or last");return{allowDots:void 0===e.allowDots?!0===e.decodeDotInKeys||n.allowDots:!!e.allowDots,allowEmptyArrays:"boolean"==typeof e.allowEmptyArrays?!!e.allowEmptyArrays:n.allowEmptyArrays,allowPrototypes:"boolean"==typeof e.allowPrototypes?e.allowPrototypes:n.allowPrototypes,allowSparse:"boolean"==typeof e.allowSparse?e.allowSparse:n.allowSparse,arrayLimit:"number"==typeof e.arrayLimit?e.arrayLimit:n.arrayLimit,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:n.charsetSentinel,comma:"boolean"==typeof e.comma?e.comma:n.comma,decodeDotInKeys:"boolean"==typeof e.decodeDotInKeys?e.decodeDotInKeys:n.decodeDotInKeys,decoder:"function"==typeof e.decoder?e.decoder:n.decoder,delimiter:"string"==typeof e.delimiter||r.isRegExp(e.delimiter)?e.delimiter:n.delimiter,depth:"number"==typeof e.depth||!1===e.depth?+e.depth:n.depth,duplicates:i,ignoreQueryPrefix:!0===e.ignoreQueryPrefix,interpretNumericEntities:"boolean"==typeof e.interpretNumericEntities?e.interpretNumericEntities:n.interpretNumericEntities,parameterLimit:"number"==typeof e.parameterLimit?e.parameterLimit:n.parameterLimit,parseArrays:!1!==e.parseArrays,plainObjects:"boolean"==typeof e.plainObjects?e.plainObjects:n.plainObjects,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:n.strictNullHandling}};e.exports=function(e,t){var i=u(t);if(""===e||null==e)return i.plainObjects?Object.create(null):{};for(var s="string"==typeof e?a(e,i):e,n=i.plainObjects?Object.create(null):{},o=Object.keys(s),h=0;h<o.length;++h){var c=o[h],d=l(c,s[c],i,"string"==typeof e);n=r.merge(n,d,i)}return!0===i.allowSparse?n:r.compact(n)}});var eM=((E=eM||{})[E.WEBGL_LEGACY=0]="WEBGL_LEGACY",E[E.WEBGL=1]="WEBGL",E[E.WEBGL2=2]="WEBGL2",E),eD=((w=eD||{})[w.UNKNOWN=0]="UNKNOWN",w[w.WEBGL=1]="WEBGL",w[w.CANVAS=2]="CANVAS",w),ek=((A=ek||{})[A.COLOR=16384]="COLOR",A[A.DEPTH=256]="DEPTH",A[A.STENCIL=1024]="STENCIL",A),eO=((S=eO||{})[S.NORMAL=0]="NORMAL",S[S.ADD=1]="ADD",S[S.MULTIPLY=2]="MULTIPLY",S[S.SCREEN=3]="SCREEN",S[S.OVERLAY=4]="OVERLAY",S[S.DARKEN=5]="DARKEN",S[S.LIGHTEN=6]="LIGHTEN",S[S.COLOR_DODGE=7]="COLOR_DODGE",S[S.COLOR_BURN=8]="COLOR_BURN",S[S.HARD_LIGHT=9]="HARD_LIGHT",S[S.SOFT_LIGHT=10]="SOFT_LIGHT",S[S.DIFFERENCE=11]="DIFFERENCE",S[S.EXCLUSION=12]="EXCLUSION",S[S.HUE=13]="HUE",S[S.SATURATION=14]="SATURATION",S[S.COLOR=15]="COLOR",S[S.LUMINOSITY=16]="LUMINOSITY",S[S.NORMAL_NPM=17]="NORMAL_NPM",S[S.ADD_NPM=18]="ADD_NPM",S[S.SCREEN_NPM=19]="SCREEN_NPM",S[S.NONE=20]="NONE",S[S.SRC_OVER=0]="SRC_OVER",S[S.SRC_IN=21]="SRC_IN",S[S.SRC_OUT=22]="SRC_OUT",S[S.SRC_ATOP=23]="SRC_ATOP",S[S.DST_OVER=24]="DST_OVER",S[S.DST_IN=25]="DST_IN",S[S.DST_OUT=26]="DST_OUT",S[S.DST_ATOP=27]="DST_ATOP",S[S.ERASE=26]="ERASE",S[S.SUBTRACT=28]="SUBTRACT",S[S.XOR=29]="XOR",S),eB=((C=eB||{})[C.POINTS=0]="POINTS",C[C.LINES=1]="LINES",C[C.LINE_LOOP=2]="LINE_LOOP",C[C.LINE_STRIP=3]="LINE_STRIP",C[C.TRIANGLES=4]="TRIANGLES",C[C.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",C[C.TRIANGLE_FAN=6]="TRIANGLE_FAN",C),eL=((R=eL||{})[R.RGBA=6408]="RGBA",R[R.RGB=6407]="RGB",R[R.RG=33319]="RG",R[R.RED=6403]="RED",R[R.RGBA_INTEGER=36249]="RGBA_INTEGER",R[R.RGB_INTEGER=36248]="RGB_INTEGER",R[R.RG_INTEGER=33320]="RG_INTEGER",R[R.RED_INTEGER=36244]="RED_INTEGER",R[R.ALPHA=6406]="ALPHA",R[R.LUMINANCE=6409]="LUMINANCE",R[R.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",R[R.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",R[R.DEPTH_STENCIL=34041]="DEPTH_STENCIL",R),eF=((I=eF||{})[I.TEXTURE_2D=3553]="TEXTURE_2D",I[I.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",I[I.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",I[I.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",I[I.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",I[I.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",I[I.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",I[I.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",I[I.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",I),eN=((P=eN||{})[P.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",P[P.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",P[P.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",P[P.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",P[P.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",P[P.UNSIGNED_INT=5125]="UNSIGNED_INT",P[P.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",P[P.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",P[P.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",P[P.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",P[P.BYTE=5120]="BYTE",P[P.SHORT=5122]="SHORT",P[P.INT=5124]="INT",P[P.FLOAT=5126]="FLOAT",P[P.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",P[P.HALF_FLOAT=36193]="HALF_FLOAT",P),eU=((M=eU||{})[M.FLOAT=0]="FLOAT",M[M.INT=1]="INT",M[M.UINT=2]="UINT",M),eG=((D=eG||{})[D.NEAREST=0]="NEAREST",D[D.LINEAR=1]="LINEAR",D),ej=((k=ej||{})[k.CLAMP=33071]="CLAMP",k[k.REPEAT=10497]="REPEAT",k[k.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",k),eH=((O=eH||{})[O.OFF=0]="OFF",O[O.POW2=1]="POW2",O[O.ON=2]="ON",O[O.ON_MANUAL=3]="ON_MANUAL",O),ez=((B=ez||{})[B.NPM=0]="NPM",B[B.UNPACK=1]="UNPACK",B[B.PMA=2]="PMA",B[B.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",B[B.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",B[B.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",B),eV=((L=eV||{})[L.NO=0]="NO",L[L.YES=1]="YES",L[L.AUTO=2]="AUTO",L[L.BLEND=0]="BLEND",L[L.CLEAR=1]="CLEAR",L[L.BLIT=2]="BLIT",L),eX=((F=eX||{})[F.AUTO=0]="AUTO",F[F.MANUAL=1]="MANUAL",F),eW=((N=eW||{}).LOW="lowp",N.MEDIUM="mediump",N.HIGH="highp",N),e$=((U=e$||{})[U.NONE=0]="NONE",U[U.SCISSOR=1]="SCISSOR",U[U.STENCIL=2]="STENCIL",U[U.SPRITE=3]="SPRITE",U[U.COLOR=4]="COLOR",U),eY=((G=eY||{})[G.RED=1]="RED",G[G.GREEN=2]="GREEN",G[G.BLUE=4]="BLUE",G[G.ALPHA=8]="ALPHA",G),eq=((j=eq||{})[j.NONE=0]="NONE",j[j.LOW=2]="LOW",j[j.MEDIUM=4]="MEDIUM",j[j.HIGH=8]="HIGH",j),eK=((H=eK||{})[H.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",H[H.ARRAY_BUFFER=34962]="ARRAY_BUFFER",H[H.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",H);const eJ={ADAPTER:{createCanvas:(e,t)=>{let r=document.createElement("canvas");return r.width=e,r.height=t,r},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(e,t)=>fetch(e,t),parseXML:e=>new DOMParser().parseFromString(e,"text/xml")},RESOLUTION:1,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var eZ=/iPhone/i,eQ=/iPod/i,e0=/iPad/i,e1=/\biOS-universal(?:.+)Mac\b/i,e2=/\bAndroid(?:.+)Mobile\b/i,e3=/Android/i,e4=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,e6=/Silk/i,e5=/Windows Phone/i,e8=/\bWindows(?:.+)ARM\b/i,e9=/BlackBerry/i,e7=/BB10/i,te=/Opera Mini/i,tt=/\b(CriOS|Chrome)(?:.+)Mobile/i,tr=/Mobile(?:.+)Firefox\b/i,ti=function(e){return void 0!==e&&"MacIntel"===e.platform&&"number"==typeof e.maxTouchPoints&&e.maxTouchPoints>1&&"undefined"==typeof MSStream};function ts(e){var t,r={userAgent:"",platform:"",maxTouchPoints:0};e||"undefined"==typeof navigator?"string"==typeof e?r.userAgent=e:e&&e.userAgent&&(r={userAgent:e.userAgent,platform:e.platform,maxTouchPoints:e.maxTouchPoints||0}):r={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0};var i=r.userAgent,s=i.split("[FBAN");void 0!==s[1]&&(i=s[0]),void 0!==(s=i.split("Twitter"))[1]&&(i=s[0]);var n=(t=i,function(e){return e.test(t)}),o={apple:{phone:n(eZ)&&!n(e5),ipod:n(eQ),tablet:!n(eZ)&&(n(e0)||ti(r))&&!n(e5),universal:n(e1),device:(n(eZ)||n(eQ)||n(e0)||n(e1)||ti(r))&&!n(e5)},amazon:{phone:n(e4),tablet:!n(e4)&&n(e6),device:n(e4)||n(e6)},android:{phone:!n(e5)&&n(e4)||!n(e5)&&n(e2),tablet:!n(e5)&&!n(e4)&&!n(e2)&&(n(e6)||n(e3)),device:!n(e5)&&(n(e4)||n(e6)||n(e2)||n(e3))||n(/\bokhttp\b/i)},windows:{phone:n(e5),tablet:n(e8),device:n(e5)||n(e8)},other:{blackberry:n(e9),blackberry10:n(e7),opera:n(te),firefox:n(tr),chrome:n(tt),device:n(e9)||n(e7)||n(te)||n(tr)||n(tt)},any:!1,phone:!1,tablet:!1};return o.any=o.apple.device||o.android.device||o.windows.device||o.other.device,o.phone=o.apple.phone||o.android.phone||o.windows.phone,o.tablet=o.apple.tablet||o.android.tablet||o.windows.tablet,o}const tn=(ts.default??ts)(globalThis.navigator);var to={};eS(to,"BaseTextureCache",()=>rk),eS(to,"BoundingBox",()=>rP),eS(to,"CanvasRenderTarget",()=>rL),eS(to,"DATA_URI",()=>ry),eS(to,"EventEmitter",()=>eA(ta)),eS(to,"ProgramCache",()=>rM),eS(to,"TextureCache",()=>rD),eS(to,"clearTextureCache",()=>rB),eS(to,"correctBlendMode",()=>rp),eS(to,"createIndicesForQuads",()=>r_),eS(to,"decomposeDataUri",()=>rj),eS(to,"deprecation",()=>tB),eS(to,"destroyTextureCache",()=>rO),eS(to,"detectVideoAlphaMode",()=>tG),eS(to,"determineCrossOrigin",()=>rH),eS(to,"earcut",()=>eA(tm)),eS(to,"getBufferType",()=>rv),eS(to,"getCanvasBoundingBox",()=>rU),eS(to,"getResolutionOfUrl",()=>rz),eS(to,"hex2rgb",()=>rh),eS(to,"hex2string",()=>rl),eS(to,"interleaveTypedArrays",()=>rx),eS(to,"isMobile",()=>tn),eS(to,"isPow2",()=>rE),eS(to,"isWebGLSupported",()=>tz),eS(to,"log2",()=>rw),eS(to,"nextPow2",()=>rT),eS(to,"path",()=>tU),eS(to,"premultiplyBlendMode",()=>rd),eS(to,"premultiplyRgba",()=>rf),eS(to,"premultiplyTint",()=>rm),eS(to,"premultiplyTintToRgba",()=>rg),eS(to,"removeItems",()=>rA),eS(to,"rgb2hex",()=>rc),eS(to,"sayHello",()=>tH),eS(to,"sign",()=>rS),eS(to,"skipHello",()=>tj),eS(to,"string2hex",()=>ru),eS(to,"trimCanvas",()=>rG),eS(to,"uid",()=>rR),eS(to,"url",()=>tL),eJ.RETINA_PREFIX=/@([0-9\.]+)x/,eJ.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var ta={},th=Object.prototype.hasOwnProperty,tl="~";function tu(){}function tc(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function td(e,t,r,i,s){if("function"!=typeof r)throw TypeError("The listener must be a function");var n=new tc(r,i||e,s),o=tl?tl+t:t;return e._events[o]?e._events[o].fn?e._events[o]=[e._events[o],n]:e._events[o].push(n):(e._events[o]=n,e._eventsCount++),e}function tp(e,t){0==--e._eventsCount?e._events=new tu:delete e._events[t]}function tf(){this._events=new tu,this._eventsCount=0}Object.create&&(tu.prototype=Object.create(null),new tu().__proto__||(tl=!1)),tf.prototype.eventNames=function(){var e,t,r=[];if(0===this._eventsCount)return r;for(t in e=this._events)th.call(e,t)&&r.push(tl?t.slice(1):t);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},tf.prototype.listeners=function(e){var t=tl?tl+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,s=r.length,n=Array(s);i<s;i++)n[i]=r[i].fn;return n},tf.prototype.listenerCount=function(e){var t=tl?tl+e:e,r=this._events[t];return r?r.fn?1:r.length:0},tf.prototype.emit=function(e,t,r,i,s,n){var o=tl?tl+e:e;if(!this._events[o])return!1;var a,h,l=this._events[o],u=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),u){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,r),!0;case 4:return l.fn.call(l.context,t,r,i),!0;case 5:return l.fn.call(l.context,t,r,i,s),!0;case 6:return l.fn.call(l.context,t,r,i,s,n),!0}for(h=1,a=Array(u-1);h<u;h++)a[h-1]=arguments[h];l.fn.apply(l.context,a)}else{var c,d=l.length;for(h=0;h<d;h++)switch(l[h].once&&this.removeListener(e,l[h].fn,void 0,!0),u){case 1:l[h].fn.call(l[h].context);break;case 2:l[h].fn.call(l[h].context,t);break;case 3:l[h].fn.call(l[h].context,t,r);break;case 4:l[h].fn.call(l[h].context,t,r,i);break;default:if(!a)for(c=1,a=Array(u-1);c<u;c++)a[c-1]=arguments[c];l[h].fn.apply(l[h].context,a)}}return!0},tf.prototype.on=function(e,t,r){return td(this,e,t,r,!1)},tf.prototype.once=function(e,t,r){return td(this,e,t,r,!0)},tf.prototype.removeListener=function(e,t,r,i){var s=tl?tl+e:e;if(!this._events[s])return this;if(!t)return tp(this,s),this;var n=this._events[s];if(n.fn)n.fn!==t||i&&!n.once||r&&n.context!==r||tp(this,s);else{for(var o=0,a=[],h=n.length;o<h;o++)(n[o].fn!==t||i&&!n[o].once||r&&n[o].context!==r)&&a.push(n[o]);a.length?this._events[s]=1===a.length?a[0]:a:tp(this,s)}return this},tf.prototype.removeAllListeners=function(e){var t;return e?(t=tl?tl+e:e,this._events[t]&&tp(this,t)):(this._events=new tu,this._eventsCount=0),this},tf.prototype.off=tf.prototype.removeListener,tf.prototype.addListener=tf.prototype.on,tf.prefixed=tl,tf.EventEmitter=tf,ta=tf;var tm={};function tg(e,t,r){r=r||2;var i,s,n,o,a,h,l,u=t&&t.length,c=u?t[0]*r:e.length,d=ty(e,0,c,r,!0),p=[];if(!d||d.next===d.prev)return p;if(u&&(d=function(e,t,r,i){var s,n,o,a,h,l=[];for(s=0,n=t.length;s<n;s++)o=t[s]*i,a=s<n-1?t[s+1]*i:e.length,(h=ty(e,o,a,i,!1))===h.next&&(h.steiner=!0),l.push(function(e){var t=e,r=e;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==e)return r}(h));for(l.sort(tv),s=0;s<l.length;s++)r=function(e,t){var r=function(e,t){var r,i,s,n=t,o=e.x,a=e.y,h=-1/0;do{if(a<=n.y&&a>=n.next.y&&n.next.y!==n.y){var l=n.x+(a-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(l<=o&&l>h&&(h=l,s=n.x<n.next.x?n:n.next,l===o))return s}n=n.next}while(n!==t)if(!s)return null;var u,c=s,d=s.x,p=s.y,f=1/0;n=s;do o>=n.x&&n.x>=d&&o!==n.x&&tx(a<p?o:h,a,d,p,a<p?h:o,a,n.x,n.y)&&(u=Math.abs(a-n.y)/(o-n.x),tC(n,e)&&(u<f||u===f&&(n.x>s.x||n.x===s.x&&(r=s,i=n,0>tT(r.prev,r,i.prev)&&0>tT(i.next,r,r.next))))&&(s=n,f=u)),n=n.next;while(n!==c)return s}(e,t);if(!r)return t;var i=tR(r,e);return t_(i,i.next),t_(r,r.next)}(l[s],r);return r}(e,t,d,r)),e.length>80*r){i=n=e[0],s=o=e[1];for(var f=r;f<c;f+=r)a=e[f],h=e[f+1],a<i&&(i=a),h<s&&(s=h),a>n&&(n=a),h>o&&(o=h);l=0!==(l=Math.max(n-i,o-s))?32767/l:0}return function e(t,r,i,s,n,o,a){if(t){!a&&o&&function(e,t,r,i){var s=e;do 0===s.z&&(s.z=tb(s.x,s.y,t,r,i)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==e)s.prevZ.nextZ=null,s.prevZ=null,function(e){var t,r,i,s,n,o,a,h,l=1;do{for(r=e,e=null,n=null,o=0;r;){for(o++,i=r,a=0,t=0;t<l&&(a++,i=i.nextZ);t++);for(h=l;a>0||h>0&&i;)0!==a&&(0===h||!i||r.z<=i.z)?(s=r,r=r.nextZ,a--):(s=i,i=i.nextZ,h--),n?n.nextZ=s:e=s,s.prevZ=n,n=s;r=i}n.nextZ=null,l*=2}while(o>1)}(s)}(t,s,n,o);for(var h,l,u=t;t.prev!==t.next;){if(h=t.prev,l=t.next,o?function(e,t,r,i){var s=e.prev,n=e.next;if(tT(s,e,n)>=0)return!1;for(var o=s.x,a=e.x,h=n.x,l=s.y,u=e.y,c=n.y,d=o<a?o<h?o:h:a<h?a:h,p=l<u?l<c?l:c:u<c?u:c,f=o>a?o>h?o:h:a>h?a:h,m=l>u?l>c?l:c:u>c?u:c,g=tb(d,p,t,r,i),y=tb(f,m,t,r,i),_=e.prevZ,v=e.nextZ;_&&_.z>=g&&v&&v.z<=y;){if(_.x>=d&&_.x<=f&&_.y>=p&&_.y<=m&&_!==s&&_!==n&&tx(o,l,a,u,h,c,_.x,_.y)&&tT(_.prev,_,_.next)>=0||(_=_.prevZ,v.x>=d&&v.x<=f&&v.y>=p&&v.y<=m&&v!==s&&v!==n&&tx(o,l,a,u,h,c,v.x,v.y)&&tT(v.prev,v,v.next)>=0))return!1;v=v.nextZ}for(;_&&_.z>=g;){if(_.x>=d&&_.x<=f&&_.y>=p&&_.y<=m&&_!==s&&_!==n&&tx(o,l,a,u,h,c,_.x,_.y)&&tT(_.prev,_,_.next)>=0)return!1;_=_.prevZ}for(;v&&v.z<=y;){if(v.x>=d&&v.x<=f&&v.y>=p&&v.y<=m&&v!==s&&v!==n&&tx(o,l,a,u,h,c,v.x,v.y)&&tT(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}(t,s,n,o):function(e){var t=e.prev,r=e.next;if(tT(t,e,r)>=0)return!1;for(var i=t.x,s=e.x,n=r.x,o=t.y,a=e.y,h=r.y,l=i<s?i<n?i:n:s<n?s:n,u=o<a?o<h?o:h:a<h?a:h,c=i>s?i>n?i:n:s>n?s:n,d=o>a?o>h?o:h:a>h?a:h,p=r.next;p!==t;){if(p.x>=l&&p.x<=c&&p.y>=u&&p.y<=d&&tx(i,o,s,a,n,h,p.x,p.y)&&tT(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}(t)){r.push(h.i/i|0),r.push(t.i/i|0),r.push(l.i/i|0),tP(t),t=l.next,u=l.next;continue}if((t=l)===u){a?1===a?e(t=function(e,t,r){var i=e;do{var s=i.prev,n=i.next.next;!tE(s,n)&&tw(s,i,i.next,n)&&tC(s,n)&&tC(n,s)&&(t.push(s.i/r|0),t.push(i.i/r|0),t.push(n.i/r|0),tP(i),tP(i.next),i=e=n),i=i.next}while(i!==e)return t_(i)}(t_(t),r,i),r,i,s,n,o,2):2===a&&function(t,r,i,s,n,o){var a=t;do{for(var h,l,u=a.next.next;u!==a.prev;){if(a.i!==u.i&&(h=a,l=u,h.next.i!==l.i&&h.prev.i!==l.i&&!function(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&tw(r,r.next,e,t))return!0;r=r.next}while(r!==e)return!1}(h,l)&&(tC(h,l)&&tC(l,h)&&function(e,t){var r=e,i=!1,s=(e.x+t.x)/2,n=(e.y+t.y)/2;do r.y>n!=r.next.y>n&&r.next.y!==r.y&&s<(r.next.x-r.x)*(n-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next;while(r!==e)return i}(h,l)&&(tT(h.prev,h,l.prev)||tT(h,l.prev,l))||tE(h,l)&&tT(h.prev,h,h.next)>0&&tT(l.prev,l,l.next)>0))){var c=tR(a,u);a=t_(a,a.next),c=t_(c,c.next),e(a,r,i,s,n,o,0),e(c,r,i,s,n,o,0);return}u=u.next}a=a.next}while(a!==t)}(t,r,i,s,n,o):e(t_(t),r,i,s,n,o,1);break}}}}(d,p,r,i,s,l,0),p}function ty(e,t,r,i,s){var n,o;if(s===tD(e,t,r,i)>0)for(n=t;n<r;n+=i)o=tI(n,e[n],e[n+1],o);else for(n=r-i;n>=t;n-=i)o=tI(n,e[n],e[n+1],o);return o&&tE(o,o.next)&&(tP(o),o=o.next),o}function t_(e,t){if(!e)return e;t||(t=e);var r,i=e;do if(r=!1,!i.steiner&&(tE(i,i.next)||0===tT(i.prev,i,i.next))){if(tP(i),(i=t=i.prev)===i.next)break;r=!0}else i=i.next;while(r||i!==t)return t}function tv(e,t){return e.x-t.x}function tb(e,t,r,i,s){return(e=((e=((e=((e=((e=(e-r)*s|0)|e<<8)&16711935)|e<<4)&252645135)|e<<2)&858993459)|e<<1)&1431655765)|(t=((t=((t=((t=((t=(t-i)*s|0)|t<<8)&16711935)|t<<4)&252645135)|t<<2)&858993459)|t<<1)&1431655765)<<1}function tx(e,t,r,i,s,n,o,a){return(s-o)*(t-a)>=(e-o)*(n-a)&&(e-o)*(i-a)>=(r-o)*(t-a)&&(r-o)*(n-a)>=(s-o)*(i-a)}function tT(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function tE(e,t){return e.x===t.x&&e.y===t.y}function tw(e,t,r,i){var s=tS(tT(e,t,r)),n=tS(tT(e,t,i)),o=tS(tT(r,i,e)),a=tS(tT(r,i,t));return!!(s!==n&&o!==a||0===s&&tA(e,r,t)||0===n&&tA(e,i,t)||0===o&&tA(r,e,i)||0===a&&tA(r,t,i))}function tA(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function tS(e){return e>0?1:e<0?-1:0}function tC(e,t){return 0>tT(e.prev,e,e.next)?tT(e,t,e.next)>=0&&tT(e,e.prev,t)>=0:0>tT(e,t,e.prev)||0>tT(e,e.next,t)}function tR(e,t){var r=new tM(e.i,e.x,e.y),i=new tM(t.i,t.x,t.y),s=e.next,n=t.prev;return e.next=t,t.prev=e,r.next=s,s.prev=r,i.next=r,r.prev=i,n.next=i,i.prev=n,i}function tI(e,t,r,i){var s=new tM(e,t,r);return i?(s.next=i.next,s.prev=i,i.next.prev=s,i.next=s):(s.prev=s,s.next=s),s}function tP(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function tM(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function tD(e,t,r,i){for(var s=0,n=t,o=r-i;n<r;n+=i)s+=(e[o]-e[n])*(e[n+1]+e[o+1]),o=n;return s}(tm=tg).default=tg,tg.deviation=function(e,t,r,i){var s=t&&t.length,n=s?t[0]*r:e.length,o=Math.abs(tD(e,0,n,r));if(s)for(var a=0,h=t.length;a<h;a++){var l=t[a]*r,u=a<h-1?t[a+1]*r:e.length;o-=Math.abs(tD(e,l,u,r))}var c=0;for(a=0;a<i.length;a+=3){var d=i[a]*r,p=i[a+1]*r,f=i[a+2]*r;c+=Math.abs((e[d]-e[f])*(e[p+1]-e[d+1])-(e[d]-e[p])*(e[f+1]-e[d+1]))}return 0===o&&0===c?0:Math.abs((c-o)/o)},tg.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},i=0,s=0;s<e.length;s++){for(var n=0;n<e[s].length;n++)for(var o=0;o<t;o++)r.vertices.push(e[s][n][o]);s>0&&(i+=e[s-1].length,r.holes.push(i))}return r};var tk=eI("dybpk");const tO={};function tB(e,t,r=3){if(tO[t])return;let i=Error().stack;typeof i>"u"?console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${e}`):(i=i.split(`
`).splice(r).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${t}
Deprecated since v${e}`),console.warn(i),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${e}`),console.warn(i))),tO[t]=!0}const tL={get parse(){return tB("7.3.0","utils.url.parse is deprecated, use native URL API instead."),tk.parse},get format(){return tB("7.3.0","utils.url.format is deprecated, use native URL API instead."),tk.format},get resolve(){return tB("7.3.0","utils.url.resolve is deprecated, use native URL API instead."),tk.resolve}};function tF(e){if("string"!=typeof e)throw TypeError(`Path must be a string. Received ${JSON.stringify(e)}`)}function tN(e){return e.split("?")[0].split("#")[0]}const tU={toPosix:e=>e.replace(RegExp("\\".replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g"),"/"),isUrl(e){return/^https?:/.test(this.toPosix(e))},isDataUrl:e=>/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(e),isBlobUrl:e=>e.startsWith("blob:"),hasProtocol(e){return/^[^/:]+:/.test(this.toPosix(e))},getProtocol(e){tF(e),e=this.toPosix(e);let t=/^file:\/\/\//.exec(e);if(t)return t[0];let r=/^[^/:]+:\/{0,2}/.exec(e);return r?r[0]:""},toAbsolute(e,t,r){if(tF(e),this.isDataUrl(e)||this.isBlobUrl(e))return e;let i=tN(this.toPosix(t??eJ.ADAPTER.getBaseUrl())),s=tN(this.toPosix(r??this.rootname(i)));return(e=this.toPosix(e)).startsWith("/")?tU.join(s,e.slice(1)):this.isAbsolute(e)?e:this.join(i,e)},normalize(e){if(tF(e),0===e.length)return".";if(this.isDataUrl(e)||this.isBlobUrl(e))return e;e=this.toPosix(e);let t="",r=e.startsWith("/");this.hasProtocol(e)&&(t=this.rootname(e),e=e.slice(t.length));let i=e.endsWith("/");return(e=function(e,t){let r="",i=0,s=-1,n=0,o=-1;for(let a=0;a<=e.length;++a){if(a<e.length)o=e.charCodeAt(a);else{if(47===o)break;o=47}if(47===o){if(!(s===a-1||1===n)){if(s!==a-1&&2===n){if(r.length<2||2!==i||46!==r.charCodeAt(r.length-1)||46!==r.charCodeAt(r.length-2)){if(r.length>2){let e=r.lastIndexOf("/");if(e!==r.length-1){-1===e?(r="",i=0):i=(r=r.slice(0,e)).length-1-r.lastIndexOf("/"),s=a,n=0;continue}}else if(2===r.length||1===r.length){r="",i=0,s=a,n=0;continue}}t&&(r.length>0?r+="/..":r="..",i=2)}else r.length>0?r+=`/${e.slice(s+1,a)}`:r=e.slice(s+1,a),i=a-s-1}s=a,n=0}else 46===o&&-1!==n?++n:n=-1}return r}(e,!1)).length>0&&i&&(e+="/"),r?`/${e}`:t+e},isAbsolute(e){return tF(e),e=this.toPosix(e),!!this.hasProtocol(e)||e.startsWith("/")},join(...e){let t;if(0===e.length)return".";for(let r=0;r<e.length;++r){let i=e[r];if(tF(i),i.length>0){if(void 0===t)t=i;else{let s=e[r-1]??"";this.joinExtensions.includes(this.extname(s).toLowerCase())?t+=`/../${i}`:t+=`/${i}`}}}return void 0===t?".":this.normalize(t)},dirname(e){if(tF(e),0===e.length)return".";let t=(e=this.toPosix(e)).charCodeAt(0),r=47===t,i=-1,s=!0,n=this.getProtocol(e),o=e;e=e.slice(n.length);for(let r=e.length-1;r>=1;--r)if(47===(t=e.charCodeAt(r))){if(!s){i=r;break}}else s=!1;return -1===i?r?"/":this.isUrl(o)?n+e:n:r&&1===i?"//":n+e.slice(0,i)},rootname(e){tF(e);let t="";if(t=(e=this.toPosix(e)).startsWith("/")?"/":this.getProtocol(e),this.isUrl(e)){let r=e.indexOf("/",t.length);(t=-1!==r?e.slice(0,r):e).endsWith("/")||(t+="/")}return t},basename(e,t){tF(e),t&&tF(t),e=tN(this.toPosix(e));let r=0,i=-1,s=!0,n;if(void 0!==t&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";let o=t.length-1,a=-1;for(n=e.length-1;n>=0;--n){let h=e.charCodeAt(n);if(47===h){if(!s){r=n+1;break}}else -1===a&&(s=!1,a=n+1),o>=0&&(h===t.charCodeAt(o)?-1==--o&&(i=n):(o=-1,i=a))}return r===i?i=a:-1===i&&(i=e.length),e.slice(r,i)}for(n=e.length-1;n>=0;--n)if(47===e.charCodeAt(n)){if(!s){r=n+1;break}}else -1===i&&(s=!1,i=n+1);return -1===i?"":e.slice(r,i)},extname(e){tF(e),e=tN(this.toPosix(e));let t=-1,r=0,i=-1,s=!0,n=0;for(let o=e.length-1;o>=0;--o){let a=e.charCodeAt(o);if(47===a){if(!s){r=o+1;break}continue}-1===i&&(s=!1,i=o+1),46===a?-1===t?t=o:1!==n&&(n=1):-1!==t&&(n=-1)}return -1===t||-1===i||0===n||1===n&&t===i-1&&t===r+1?"":e.slice(t,i)},parse(e){let t;tF(e);let r={root:"",dir:"",base:"",ext:"",name:""};if(0===e.length)return r;let i=(e=tN(this.toPosix(e))).charCodeAt(0),s=this.isAbsolute(e);r.root=this.rootname(e),t=s||this.hasProtocol(e)?1:0;let n=-1,o=0,a=-1,h=!0,l=e.length-1,u=0;for(;l>=t;--l){if(47===(i=e.charCodeAt(l))){if(!h){o=l+1;break}continue}-1===a&&(h=!1,a=l+1),46===i?-1===n?n=l:1!==u&&(u=1):-1!==n&&(u=-1)}return -1===n||-1===a||0===u||1===u&&n===a-1&&n===o+1?-1!==a&&(0===o&&s?r.base=r.name=e.slice(1,a):r.base=r.name=e.slice(o,a)):(0===o&&s?(r.name=e.slice(1,n),r.base=e.slice(1,a)):(r.name=e.slice(o,n),r.base=e.slice(o,a)),r.ext=e.slice(n,a)),r.dir=this.dirname(e),r},sep:"/",delimiter:":",joinExtensions:[".html"]};async function tG(){return e??(e=(async()=>{let e=document.createElement("canvas").getContext("webgl");if(!e)return ez.UNPACK;let t=await new Promise(e=>{let t=document.createElement("video");t.onloadeddata=()=>e(t),t.onerror=()=>e(null),t.autoplay=!1,t.crossOrigin="anonymous",t.preload="auto",t.src="data:video/webm;base64,GkXfo59ChoEBQveBAULygQRC84EIQoKEd2VibUKHgQJChYECGFOAZwEAAAAAAAHTEU2bdLpNu4tTq4QVSalmU6yBoU27i1OrhBZUrmtTrIHGTbuMU6uEElTDZ1OsggEXTbuMU6uEHFO7a1OsggG97AEAAAAAAABZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmoCrXsYMPQkBNgIRMYXZmV0GETGF2ZkSJiEBEAAAAAAAAFlSua8yuAQAAAAAAAEPXgQFzxYgAAAAAAAAAAZyBACK1nIN1bmSIgQCGhVZfVlA5g4EBI+ODhAJiWgDglLCBArqBApqBAlPAgQFVsIRVuYEBElTDZ9Vzc9JjwItjxYgAAAAAAAAAAWfInEWjh0VOQ09ERVJEh49MYXZjIGxpYnZweC12cDlnyKJFo4hEVVJBVElPTkSHlDAwOjAwOjAwLjA0MDAwMDAwMAAAH0O2dcfngQCgwqGggQAAAIJJg0IAABAAFgA4JBwYSgAAICAAEb///4r+AAB1oZ2mm+6BAaWWgkmDQgAAEAAWADgkHBhKAAAgIABIQBxTu2uRu4+zgQC3iveBAfGCAXHwgQM=",t.load()});if(!t)return ez.UNPACK;let r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r);let i=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,i),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t);let s=new Uint8Array(4);return e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,s),e.deleteFramebuffer(i),e.deleteTexture(r),e.getExtension("WEBGL_lose_context")?.loseContext(),s[0]<=s[3]?ez.PMA:ez.UNPACK})()),e}function tj(){tB("7.0.0","skipHello is deprecated, please use settings.RENDER_OPTIONS.hello")}function tH(){tB("7.0.0",'sayHello is deprecated, please use Renderer\'s "hello" option')}function tz(){return typeof t>"u"&&(t=function(){let e={stencil:!0,failIfMajorPerformanceCaveat:eJ.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!eJ.ADAPTER.getWebGLRenderingContext())return!1;let t=eJ.ADAPTER.createCanvas(),r=t.getContext("webgl",e)||t.getContext("experimental-webgl",e),i=!!r?.getContextAttributes()?.stencil;if(r){let e=r.getExtension("WEBGL_lose_context");e&&e.loseContext()}return r=null,i}catch{return!1}}()),t}var tV={grad:.9,turn:360,rad:360/(2*Math.PI)},tX=function(e){return"string"==typeof e?e.length>0:"number"==typeof e},tW=function(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=Math.pow(10,t)),Math.round(r*e)/r+0},t$=function(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=1),e>r?r:e>t?e:t},tY=function(e){return(e=isFinite(e)?e%360:0)>0?e:e+360},tq=function(e){return{r:t$(e.r,0,255),g:t$(e.g,0,255),b:t$(e.b,0,255),a:t$(e.a)}},tK=function(e){return{r:tW(e.r),g:tW(e.g),b:tW(e.b),a:tW(e.a,3)}},tJ=/^#([0-9a-f]{3,8})$/i,tZ=function(e){var t=e.toString(16);return t.length<2?"0"+t:t},tQ=function(e){var t=e.r,r=e.g,i=e.b,s=e.a,n=Math.max(t,r,i),o=n-Math.min(t,r,i),a=o?n===t?(r-i)/o:n===r?2+(i-t)/o:4+(t-r)/o:0;return{h:60*(a<0?a+6:a),s:n?o/n*100:0,v:n/255*100,a:s}},t0=function(e){var t=e.h,r=e.s,i=e.v,s=e.a;t=t/360*6,r/=100,i/=100;var n=Math.floor(t),o=i*(1-r),a=i*(1-(t-n)*r),h=i*(1-(1-t+n)*r),l=n%6;return{r:255*[i,a,o,o,h,i][l],g:255*[h,i,i,a,o,o][l],b:255*[o,o,h,i,i,a][l],a:s}},t1=function(e){return{h:tY(e.h),s:t$(e.s,0,100),l:t$(e.l,0,100),a:t$(e.a)}},t2=function(e){return{h:tW(e.h),s:tW(e.s),l:tW(e.l),a:tW(e.a,3)}},t3=function(e){var t,r;return t0((t=e.s,{h:e.h,s:(t*=((r=e.l)<50?r:100-r)/100)>0?2*t/(r+t)*100:0,v:r+t,a:e.a}))},t4=function(e){var t,r,i,s;return{h:(t=tQ(e)).h,s:(s=(200-(r=t.s))*(i=t.v)/100)>0&&s<200?r*i/100/(s<=100?s:200-s)*100:0,l:s/2,a:t.a}},t6=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,t5=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,t8=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,t9=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,t7={string:[[function(e){var t=tJ.exec(e);return t?(e=t[1]).length<=4?{r:parseInt(e[0]+e[0],16),g:parseInt(e[1]+e[1],16),b:parseInt(e[2]+e[2],16),a:4===e.length?tW(parseInt(e[3]+e[3],16)/255,2):1}:6===e.length||8===e.length?{r:parseInt(e.substr(0,2),16),g:parseInt(e.substr(2,2),16),b:parseInt(e.substr(4,2),16),a:8===e.length?tW(parseInt(e.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(e){var t=t8.exec(e)||t9.exec(e);return t?t[2]!==t[4]||t[4]!==t[6]?null:tq({r:Number(t[1])/(t[2]?100/255:1),g:Number(t[3])/(t[4]?100/255:1),b:Number(t[5])/(t[6]?100/255:1),a:void 0===t[7]?1:Number(t[7])/(t[8]?100:1)}):null},"rgb"],[function(e){var t,r,i=t6.exec(e)||t5.exec(e);return i?t3(t1({h:(t=i[1],void 0===(r=i[2])&&(r="deg"),Number(t)*(tV[r]||1)),s:Number(i[3]),l:Number(i[4]),a:void 0===i[5]?1:Number(i[5])/(i[6]?100:1)})):null},"hsl"]],object:[[function(e){var t=e.r,r=e.g,i=e.b,s=e.a;return tX(t)&&tX(r)&&tX(i)?tq({r:Number(t),g:Number(r),b:Number(i),a:Number(void 0===s?1:s)}):null},"rgb"],[function(e){var t=e.h,r=e.s,i=e.l,s=e.a;return tX(t)&&tX(r)&&tX(i)?t3(t1({h:Number(t),s:Number(r),l:Number(i),a:Number(void 0===s?1:s)})):null},"hsl"],[function(e){var t,r=e.h,i=e.s,s=e.v,n=e.a;return tX(r)&&tX(i)&&tX(s)?t0({h:tY((t={h:Number(r),s:Number(i),v:Number(s),a:Number(void 0===n?1:n)}).h),s:t$(t.s,0,100),v:t$(t.v,0,100),a:t$(t.a)}):null},"hsv"]]},re=function(e,t){for(var r=0;r<t.length;r++){var i=t[r][0](e);if(i)return[i,t[r][1]]}return[null,void 0]},rt=function(e,t){var r=t4(e);return{h:r.h,s:t$(r.s+100*t,0,100),l:r.l,a:r.a}},rr=function(e){return(299*e.r+587*e.g+114*e.b)/1e3/255},ri=function(e,t){var r=t4(e);return{h:r.h,s:r.s,l:t$(r.l+100*t,0,100),a:r.a}},rs=function(){function e(e){this.parsed=("string"==typeof e?re(e.trim(),t7.string):"object"==typeof e&&null!==e?re(e,t7.object):[null,void 0])[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return e.prototype.isValid=function(){return null!==this.parsed},e.prototype.brightness=function(){return tW(rr(this.rgba),2)},e.prototype.isDark=function(){return .5>rr(this.rgba)},e.prototype.isLight=function(){return rr(this.rgba)>=.5},e.prototype.toHex=function(){var e,t,r,i,s,n;return t=(e=tK(this.rgba)).r,r=e.g,i=e.b,n=(s=e.a)<1?tZ(tW(255*s)):"","#"+tZ(t)+tZ(r)+tZ(i)+n},e.prototype.toRgb=function(){return tK(this.rgba)},e.prototype.toRgbString=function(){var e,t,r,i,s;return t=(e=tK(this.rgba)).r,r=e.g,i=e.b,(s=e.a)<1?"rgba("+t+", "+r+", "+i+", "+s+")":"rgb("+t+", "+r+", "+i+")"},e.prototype.toHsl=function(){return t2(t4(this.rgba))},e.prototype.toHslString=function(){var e,t,r,i,s;return t=(e=t2(t4(this.rgba))).h,r=e.s,i=e.l,(s=e.a)<1?"hsla("+t+", "+r+"%, "+i+"%, "+s+")":"hsl("+t+", "+r+"%, "+i+"%)"},e.prototype.toHsv=function(){var e;return{h:tW((e=tQ(this.rgba)).h),s:tW(e.s),v:tW(e.v),a:tW(e.a,3)}},e.prototype.invert=function(){var e;return rn({r:255-(e=this.rgba).r,g:255-e.g,b:255-e.b,a:e.a})},e.prototype.saturate=function(e){return void 0===e&&(e=.1),rn(rt(this.rgba,e))},e.prototype.desaturate=function(e){return void 0===e&&(e=.1),rn(rt(this.rgba,-e))},e.prototype.grayscale=function(){return rn(rt(this.rgba,-1))},e.prototype.lighten=function(e){return void 0===e&&(e=.1),rn(ri(this.rgba,e))},e.prototype.darken=function(e){return void 0===e&&(e=.1),rn(ri(this.rgba,-e))},e.prototype.rotate=function(e){return void 0===e&&(e=15),this.hue(this.hue()+e)},e.prototype.alpha=function(e){var t;return"number"==typeof e?rn({r:(t=this.rgba).r,g:t.g,b:t.b,a:e}):tW(this.rgba.a,3)},e.prototype.hue=function(e){var t=t4(this.rgba);return"number"==typeof e?rn({h:e,s:t.s,l:t.l,a:t.a}):tW(t.h)},e.prototype.isEqual=function(e){return this.toHex()===rn(e).toHex()},e}(),rn=function(e){return e instanceof rs?e:new rs(e)},ro=[];!function(e){e.forEach(function(e){0>ro.indexOf(e)&&(e(rs,t7),ro.push(e))})}([function(e,t){var r={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},i={};for(var s in r)i[r[s]]=s;var n={};e.prototype.toName=function(t){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var s,o=i[this.toHex()];if(o)return o;if(null==t?void 0:t.closest){var a=this.toRgb(),h=1/0,l="black";if(!n.length)for(var u in r)n[u]=new e(r[u]).toRgb();for(var c in r){var d=(s=n[c],Math.pow(a.r-s.r,2)+Math.pow(a.g-s.g,2)+Math.pow(a.b-s.b,2));d<h&&(h=d,l=c)}return l}},t.string.push([function(t){var i=t.toLowerCase(),s="transparent"===i?"#0000":r[i];return s?new e(s).toRgb():null},"name"])}]);const ra=class e{constructor(e=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=e}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(e){return this.value=e,this}set value(t){if(t instanceof e)this._value=this.cloneSource(t._value),this._int=t._int,this._components.set(t._components);else{if(null===t)throw Error("Cannot set PIXI.Color#value to null");null!==this._value&&this.isSourceEqual(this._value,t)||(this.normalize(t),this._value=this.cloneSource(t))}}get value(){return this._value}cloneSource(e){return"string"==typeof e||"number"==typeof e||e instanceof Number||null===e?e:Array.isArray(e)||ArrayBuffer.isView(e)?e.slice(0):"object"==typeof e&&null!==e?{...e}:e}isSourceEqual(e,t){let r=typeof e;if(r!==typeof t)return!1;if("number"===r||"string"===r||e instanceof Number)return e===t;if(Array.isArray(e)&&Array.isArray(t)||ArrayBuffer.isView(e)&&ArrayBuffer.isView(t))return e.length===t.length&&e.every((e,r)=>e===t[r]);if(null!==e&&null!==t){let r=Object.keys(e),i=Object.keys(t);return r.length===i.length&&r.every(r=>e[r]===t[r])}return e===t}toRgba(){let[e,t,r,i]=this._components;return{r:e,g:t,b:r,a:i}}toRgb(){let[e,t,r]=this._components;return{r:e,g:t,b:r}}toRgbaString(){let[e,t,r]=this.toUint8RgbArray();return`rgba(${e},${t},${r},${this.alpha})`}toUint8RgbArray(e){let[t,r,i]=this._components;return(e=e??[])[0]=Math.round(255*t),e[1]=Math.round(255*r),e[2]=Math.round(255*i),e}toRgbArray(e){e=e??[];let[t,r,i]=this._components;return e[0]=t,e[1]=r,e[2]=i,e}toNumber(){return this._int}toLittleEndianNumber(){let e=this._int;return(e>>16)+(65280&e)+((255&e)<<16)}multiply(t){let[r,i,s,n]=e.temp.setValue(t)._components;return this._components[0]*=r,this._components[1]*=i,this._components[2]*=s,this._components[3]*=n,this.refreshInt(),this._value=null,this}premultiply(e,t=!0){return t&&(this._components[0]*=e,this._components[1]*=e,this._components[2]*=e),this._components[3]=e,this.refreshInt(),this._value=null,this}toPremultiplied(e,t=!0){if(1===e)return -16777216+this._int;if(0===e)return t?0:this._int;let r=this._int>>16&255,i=this._int>>8&255,s=255&this._int;return t&&(r=r*e+.5|0,i=i*e+.5|0,s=s*e+.5|0),(255*e<<24)+(r<<16)+(i<<8)+s}toHex(){let e=this._int.toString(16);return`#${"000000".substring(0,6-e.length)+e}`}toHexa(){let e=Math.round(255*this._components[3]).toString(16);return this.toHex()+"00".substring(0,2-e.length)+e}setAlpha(e){return this._components[3]=this._clamp(e),this}round(e){let[t,r,i]=this._components;return this._components[0]=Math.round(t*e)/e,this._components[1]=Math.round(r*e)/e,this._components[2]=Math.round(i*e)/e,this.refreshInt(),this._value=null,this}toArray(e){e=e??[];let[t,r,i,s]=this._components;return e[0]=t,e[1]=r,e[2]=i,e[3]=s,e}normalize(t){let r,i,s,n;if(("number"==typeof t||t instanceof Number)&&t>=0&&t<=16777215){let e=t;r=(e>>16&255)/255,i=(e>>8&255)/255,s=(255&e)/255,n=1}else if((Array.isArray(t)||t instanceof Float32Array)&&t.length>=3&&t.length<=4)t=this._clamp(t),[r,i,s,n=1]=t;else if((t instanceof Uint8Array||t instanceof Uint8ClampedArray)&&t.length>=3&&t.length<=4)t=this._clamp(t,0,255),[r,i,s,n=255]=t,r/=255,i/=255,s/=255,n/=255;else if("string"==typeof t||"object"==typeof t){if("string"==typeof t){let r=e.HEX_PATTERN.exec(t);r&&(t=`#${r[2]}`)}let o=rn(t);o.isValid()&&({r:r,g:i,b:s,a:n}=o.rgba,r/=255,i/=255,s/=255)}if(void 0!==r)this._components[0]=r,this._components[1]=i,this._components[2]=s,this._components[3]=n,this.refreshInt();else throw Error(`Unable to convert color ${t}`)}refreshInt(){this._clamp(this._components);let[e,t,r]=this._components;this._int=(255*e<<16)+(255*t<<8)+(255*r|0)}_clamp(e,t=0,r=1){return"number"==typeof e?Math.min(Math.max(e,t),r):(e.forEach((i,s)=>{e[s]=Math.min(Math.max(i,t),r)}),e)}};function rh(e,t=[]){return tB("7.2.0","utils.hex2rgb is deprecated, use Color#toRgbArray instead"),ra.shared.setValue(e).toRgbArray(t)}function rl(e){return tB("7.2.0","utils.hex2string is deprecated, use Color#toHex instead"),ra.shared.setValue(e).toHex()}function ru(e){return tB("7.2.0","utils.string2hex is deprecated, use Color#toNumber instead"),ra.shared.setValue(e).toNumber()}function rc(e){return tB("7.2.0","utils.rgb2hex is deprecated, use Color#toNumber instead"),ra.shared.setValue(e).toNumber()}ra.shared=new ra,ra.temp=new ra,ra.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;const rd=function(){let e=[],t=[];for(let r=0;r<32;r++)e[r]=r,t[r]=r;e[eO.NORMAL_NPM]=eO.NORMAL,e[eO.ADD_NPM]=eO.ADD,e[eO.SCREEN_NPM]=eO.SCREEN,t[eO.NORMAL]=eO.NORMAL_NPM,t[eO.ADD]=eO.ADD_NPM,t[eO.SCREEN]=eO.SCREEN_NPM;let r=[];return r.push(t),r.push(e),r}();function rp(e,t){return rd[t?1:0][e]}function rf(e,t,r,i=!0){return tB("7.2.0","utils.premultiplyRgba has moved to Color.premultiply"),ra.shared.setValue(e).premultiply(t,i).toArray(r??new Float32Array(4))}function rm(e,t){return tB("7.2.0","utils.premultiplyTint has moved to Color.toPremultiplied"),ra.shared.setValue(e).toPremultiplied(t)}function rg(e,t,r,i=!0){return tB("7.2.0","utils.premultiplyTintToRgba has moved to Color.premultiply"),ra.shared.setValue(e).premultiply(t,i).toArray(r??new Float32Array(4))}const ry=/^\s*data:(?:([\w-]+)\/([\w+.-]+))?(?:;charset=([\w-]+))?(?:;(base64))?,(.*)/i;function r_(e,t=null){let r=6*e;if((t=t||new Uint16Array(r)).length!==r)throw Error(`Out buffer length is incorrect, got ${t.length} and expected ${r}`);for(let e=0,i=0;e<r;e+=6,i+=4)t[e+0]=i+0,t[e+1]=i+1,t[e+2]=i+2,t[e+3]=i+0,t[e+4]=i+2,t[e+5]=i+3;return t}function rv(e){if(4===e.BYTES_PER_ELEMENT)return e instanceof Float32Array?"Float32Array":e instanceof Uint32Array?"Uint32Array":"Int32Array";if(2===e.BYTES_PER_ELEMENT){if(e instanceof Uint16Array)return"Uint16Array"}else if(1===e.BYTES_PER_ELEMENT&&e instanceof Uint8Array)return"Uint8Array";return null}const rb={Float32Array:Float32Array,Uint32Array:Uint32Array,Int32Array:Int32Array,Uint8Array:Uint8Array};function rx(e,t){let r=0,i=0,s={};for(let s=0;s<e.length;s++)i+=t[s],r+=e[s].length;let n=new ArrayBuffer(4*r),o=null,a=0;for(let r=0;r<e.length;r++){let h=t[r],l=e[r],u=rv(l);s[u]||(s[u]=new rb[u](n)),o=s[u];for(let e=0;e<l.length;e++)o[(e/h|0)*i+a+e%h]=l[e];a+=h}return new Float32Array(n)}function rT(e){return e+=0===e?1:0,--e,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,(e|=e>>>16)+1}function rE(e){return!(e&e-1)&&!!e}function rw(e){let t=(e>65535?1:0)<<4,r=((e>>>=t)>255?1:0)<<3;return e>>>=r,t|=r,r=(e>15?1:0)<<2,e>>>=r,t|=r,r=(e>3?1:0)<<1,e>>>=r,(t|=r)|e>>1}function rA(e,t,r){let i;let s=e.length;if(t>=s||0===r)return;r=t+r>s?s-t:r;let n=s-r;for(i=t;i<n;++i)e[i]=e[i+r];e.length=n}function rS(e){return 0===e?0:e<0?-1:1}let rC=0;function rR(){return++rC}const rI=class{constructor(e,t,r,i){this.left=e,this.top=t,this.right=r,this.bottom=i}get width(){return this.right-this.left}get height(){return this.bottom-this.top}isEmpty(){return this.left===this.right||this.top===this.bottom}};rI.EMPTY=new rI(0,0,0,0);let rP=rI;const rM={},rD=Object.create(null),rk=Object.create(null);function rO(){let e;for(e in rD)rD[e].destroy();for(e in rk)rk[e].destroy()}function rB(){let e;for(e in rD)delete rD[e];for(e in rk)delete rk[e]}class rL{constructor(e,t,r){this._canvas=eJ.ADAPTER.createCanvas(),this._context=this._canvas.getContext("2d"),this.resolution=r||eJ.RESOLUTION,this.resize(e,t)}clear(){this._checkDestroyed(),this._context.setTransform(1,0,0,1,0,0),this._context.clearRect(0,0,this._canvas.width,this._canvas.height)}resize(e,t){this._checkDestroyed(),this._canvas.width=Math.round(e*this.resolution),this._canvas.height=Math.round(t*this.resolution)}destroy(){this._context=null,this._canvas=null}get width(){return this._checkDestroyed(),this._canvas.width}set width(e){this._checkDestroyed(),this._canvas.width=Math.round(e)}get height(){return this._checkDestroyed(),this._canvas.height}set height(e){this._checkDestroyed(),this._canvas.height=Math.round(e)}get canvas(){return this._checkDestroyed(),this._canvas}get context(){return this._checkDestroyed(),this._context}_checkDestroyed(){if(null===this._canvas)throw TypeError("The CanvasRenderTarget has already been destroyed")}}function rF(e,t,r){for(let i=0,s=4*r*t;i<t;++i,s+=4)if(0!==e[s+3])return!1;return!0}function rN(e,t,r,i,s){let n=4*t;for(let t=i,o=i*n+4*r;t<=s;++t,o+=n)if(0!==e[o+3])return!1;return!0}function rU(e){let{width:t,height:r}=e,i=e.getContext("2d",{willReadFrequently:!0});if(null===i)throw TypeError("Failed to get canvas 2D context");let s=i.getImageData(0,0,t,r).data,n=0,o=0,a=t-1,h=r-1;for(;o<r&&rF(s,t,o);)++o;if(o===r)return rP.EMPTY;for(;rF(s,t,h);)--h;for(;rN(s,t,n,o,h);)++n;for(;rN(s,t,a,o,h);)--a;return new rP(n,o,++a,++h)}function rG(e){let t=rU(e),{width:r,height:i}=t,s=null;if(!t.isEmpty()){let n=e.getContext("2d");if(null===n)throw TypeError("Failed to get canvas 2D context");s=n.getImageData(t.left,t.top,r,i)}return{width:r,height:i,data:s}}function rj(e){let t=ry.exec(e);if(t)return{mediaType:t[1]?t[1].toLowerCase():void 0,subType:t[2]?t[2].toLowerCase():void 0,charset:t[3]?t[3].toLowerCase():void 0,encoding:t[4]?t[4].toLowerCase():void 0,data:t[5]}}function rH(e,t=globalThis.location){if(e.startsWith("data:"))return"";t=t||globalThis.location;let r=new URL(e,document.baseURI);return r.hostname!==t.hostname||r.port!==t.port||r.protocol!==t.protocol?"anonymous":""}function rz(e,t=1){let r=eJ.RETINA_PREFIX?.exec(e);return r?parseFloat(r[1]):t}var rV=((z=rV||{}).Renderer="renderer",z.Application="application",z.RendererSystem="renderer-webgl-system",z.RendererPlugin="renderer-webgl-plugin",z.CanvasRendererSystem="renderer-canvas-system",z.CanvasRendererPlugin="renderer-canvas-plugin",z.Asset="asset",z.LoadParser="load-parser",z.ResolveParser="resolve-parser",z.CacheParser="cache-parser",z.DetectionParser="detection-parser",z);const rX=e=>{if("function"==typeof e||"object"==typeof e&&e.extension){if(!e.extension)throw Error("Extension class must have an extension object");e={..."object"!=typeof e.extension?{type:e.extension}:e.extension,ref:e}}if("object"==typeof e)e={...e};else throw Error("Invalid extension type");return"string"==typeof e.type&&(e.type=[e.type]),e},rW=(e,t)=>rX(e).priority??t,r$={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...e){return e.map(rX).forEach(e=>{e.type.forEach(t=>this._removeHandlers[t]?.(e))}),this},add(...e){return e.map(rX).forEach(e=>{e.type.forEach(t=>{let r=this._addHandlers,i=this._queue;r[t]?r[t]?.(e):(i[t]=i[t]||[],i[t]?.push(e))})}),this},handle(e,t,r){let i=this._addHandlers,s=this._removeHandlers;if(i[e]||s[e])throw Error(`Extension type ${e} already has a handler`);i[e]=t,s[e]=r;let n=this._queue;return n[e]&&(n[e]?.forEach(e=>t(e)),delete n[e]),this},handleByMap(e,t){return this.handle(e,e=>{e.name&&(t[e.name]=e.ref)},e=>{e.name&&delete t[e.name]})},handleByList(e,t,r=-1){return this.handle(e,e=>{t.includes(e.ref)||(t.push(e.ref),t.sort((e,t)=>rW(t,r)-rW(e,r)))},e=>{let r=t.indexOf(e.ref);-1!==r&&t.splice(r,1)})}};class rY{constructor(e){"number"==typeof e?this.rawBinaryData=new ArrayBuffer(e):e instanceof Uint8Array?this.rawBinaryData=e.buffer:this.rawBinaryData=e,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(e){return this[`${e}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(e){switch(e){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw Error(`${e} isn't a valid view type`)}}}const rq=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);class rK{constructor(){this.data=0,this.blendMode=eO.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(1&this.data)}set blend(e){!!(1&this.data)!==e&&(this.data^=1)}get offsets(){return!!(2&this.data)}set offsets(e){!!(2&this.data)!==e&&(this.data^=2)}get culling(){return!!(4&this.data)}set culling(e){!!(4&this.data)!==e&&(this.data^=4)}get depthTest(){return!!(8&this.data)}set depthTest(e){!!(8&this.data)!==e&&(this.data^=8)}get depthMask(){return!!(32&this.data)}set depthMask(e){!!(32&this.data)!==e&&(this.data^=32)}get clockwiseFrontFace(){return!!(16&this.data)}set clockwiseFrontFace(e){!!(16&this.data)!==e&&(this.data^=16)}get blendMode(){return this._blendMode}set blendMode(e){this.blend=e!==eO.NONE,this._blendMode=e}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){this.offsets=!!e,this._polygonOffset=e}static for2d(){let e=new rK;return e.depthTest=!1,e.blend=!0,e}}rK.prototype.toString=function(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`};const rJ=[];function rZ(e,t){if(!e)return null;let r="";if("string"==typeof e){let t=/\.(\w{3,4})(?:$|\?|#)/i.exec(e);t&&(r=t[1].toLowerCase())}for(let i=rJ.length-1;i>=0;--i){let s=rJ[i];if(s.test&&s.test(e,r))return new s(e,t)}throw Error("Unrecognized source type to auto-detect Resource")}class rQ{constructor(e){this.items=[],this._name=e,this._aliasCount=0}emit(e,t,r,i,s,n,o,a){if(arguments.length>8)throw Error("max arguments reached");let{name:h,items:l}=this;this._aliasCount++;for(let u=0,c=l.length;u<c;u++)l[u][h](e,t,r,i,s,n,o,a);return l===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(e){return e[this._name]&&(this.ensureNonAliasedItems(),this.remove(e),this.items.push(e)),this}remove(e){let t=this.items.indexOf(e);return -1!==t&&(this.ensureNonAliasedItems(),this.items.splice(t,1)),this}contains(e){return this.items.includes(e)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items.length=0,this._name=""}get empty(){return 0===this.items.length}get name(){return this._name}}Object.defineProperties(rQ.prototype,{dispatch:{value:rQ.prototype.emit},run:{value:rQ.prototype.emit}});class r0{constructor(e=0,t=0){this._width=e,this._height=t,this.destroyed=!1,this.internal=!1,this.onResize=new rQ("setRealSize"),this.onUpdate=new rQ("update"),this.onError=new rQ("onError")}bind(e){this.onResize.add(e),this.onUpdate.add(e),this.onError.add(e),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(e){this.onResize.remove(e),this.onUpdate.remove(e),this.onError.remove(e)}resize(e,t){(e!==this._width||t!==this._height)&&(this._width=e,this._height=t,this.onResize.emit(e,t))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(e,t,r){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(e,t){return!1}}class r1 extends r0{constructor(e,t){let{width:r,height:i}=t||{};if(!r||!i)throw Error("BufferResource width or height invalid");super(r,i),this.data=e,this.unpackAlignment=t.unpackAlignment??4}upload(e,t,r){let i=e.gl;i.pixelStorei(i.UNPACK_ALIGNMENT,this.unpackAlignment),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.alphaMode===ez.UNPACK);let s=t.realWidth,n=t.realHeight;return r.width===s&&r.height===n?i.texSubImage2D(t.target,0,0,0,s,n,t.format,r.type,this.data):(r.width=s,r.height=n,i.texImage2D(t.target,0,r.internalFormat,s,n,0,t.format,r.type,this.data)),!0}dispose(){this.data=null}static test(e){return null===e||e instanceof Int8Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array}}const r2={scaleMode:eG.NEAREST,alphaMode:ez.NPM},r3=class e extends eA(ta){constructor(t=null,r=null){super();let{alphaMode:i,mipmap:s,anisotropicLevel:n,scaleMode:o,width:a,height:h,wrapMode:l,format:u,type:c,target:d,resolution:p,resourceOptions:f}=r=Object.assign({},e.defaultOptions,r);!t||t instanceof r0||((t=rZ(t,f)).internal=!0),this.resolution=p||eJ.RESOLUTION,this.width=Math.round((a||0)*this.resolution)/this.resolution,this.height=Math.round((h||0)*this.resolution)/this.resolution,this._mipmap=s,this.anisotropicLevel=n,this._wrapMode=l,this._scaleMode=o,this.format=u,this.type=c,this.target=d,this.alphaMode=i,this.uid=rR(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=a>0&&h>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(t)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(e){this._mipmap!==e&&(this._mipmap=e,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(e){this._scaleMode!==e&&(this._scaleMode=e,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(e){this._wrapMode!==e&&(this._wrapMode=e,this.dirtyStyleId++)}setStyle(e,t){let r;return void 0!==e&&e!==this.scaleMode&&(this.scaleMode=e,r=!0),void 0!==t&&t!==this.mipmap&&(this.mipmap=t,r=!0),r&&this.dirtyStyleId++,this}setSize(e,t,r){return r=r||this.resolution,this.setRealSize(e*r,t*r,r)}setRealSize(e,t,r){return this.resolution=r||this.resolution,this.width=Math.round(e)/this.resolution,this.height=Math.round(t)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=rE(this.realWidth)&&rE(this.realHeight)}setResolution(e){let t=this.resolution;return t===e||(this.resolution=e,this.valid&&(this.width=Math.round(this.width*t)/e,this.height=Math.round(this.height*t)/e,this.emit("update",this)),this._refreshPOT()),this}setResource(e){if(this.resource===e)return this;if(this.resource)throw Error("Resource can be set only once");return e.bind(this),this.resource=e,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(e){this.emit("error",this,e)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete rk[this.cacheId],delete rD[this.cacheId],this.cacheId=null),this.valid=!1,this.dispose(),e.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(t,r,i=eJ.STRICT_TEXTURE_CACHE){let s="string"==typeof t,n=null;if(s)n=t;else{if(!t._pixiId){let e=r?.pixiIdPrefix||"pixiid";t._pixiId=`${e}_${rR()}`}n=t._pixiId}let o=rk[n];if(s&&i&&!o)throw Error(`The cacheId "${n}" does not exist in BaseTextureCache.`);return o||((o=new e(t,r)).cacheId=n,e.addToCache(o,n)),o}static fromBuffer(t,r,i,s){let n,o;let a=new r1(t=t||new Float32Array(r*i*4),{width:r,height:i,...s?.resourceOptions});return t instanceof Float32Array?(n=eL.RGBA,o=eN.FLOAT):t instanceof Int32Array?(n=eL.RGBA_INTEGER,o=eN.INT):t instanceof Uint32Array?(n=eL.RGBA_INTEGER,o=eN.UNSIGNED_INT):t instanceof Int16Array?(n=eL.RGBA_INTEGER,o=eN.SHORT):t instanceof Uint16Array?(n=eL.RGBA_INTEGER,o=eN.UNSIGNED_SHORT):t instanceof Int8Array?(n=eL.RGBA,o=eN.BYTE):(n=eL.RGBA,o=eN.UNSIGNED_BYTE),a.internal=!0,new e(a,Object.assign({},r2,{type:o,format:n},s))}static addToCache(e,t){t&&(e.textureCacheIds.includes(t)||e.textureCacheIds.push(t),rk[t]&&rk[t]!==e&&console.warn(`BaseTexture added to the cache with an id [${t}] that already had an entry`),rk[t]=e)}static removeFromCache(e){if("string"==typeof e){let t=rk[e];if(t){let r=t.textureCacheIds.indexOf(e);return r>-1&&t.textureCacheIds.splice(r,1),delete rk[e],t}}else if(e?.textureCacheIds){for(let t=0;t<e.textureCacheIds.length;++t)delete rk[e.textureCacheIds[t]];return e.textureCacheIds.length=0,e}return null}};r3.defaultOptions={mipmap:eH.POW2,anisotropicLevel:0,scaleMode:eG.LINEAR,wrapMode:ej.CLAMP,alphaMode:ez.UNPACK,target:eF.TEXTURE_2D,format:eL.RGBA,type:eN.UNSIGNED_BYTE},r3._globalBatch=0;let r4=r3;class r6{constructor(){this.texArray=null,this.blend=0,this.type=eB.TRIANGLES,this.start=0,this.size=0,this.data=null}}let r5=0;class r8{constructor(e,t=!0,r=!1){this.data=e||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=r,this.static=t,this.id=r5++,this.disposeRunner=new rQ("disposeBuffer")}update(e){e instanceof Array&&(e=new Float32Array(e)),this.data=e||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(e){this.type=e?eK.ELEMENT_ARRAY_BUFFER:eK.ARRAY_BUFFER}get index(){return this.type===eK.ELEMENT_ARRAY_BUFFER}static from(e){return e instanceof Array&&(e=new Float32Array(e)),new r8(e)}}class r9{constructor(e,t=0,r=!1,i=eN.FLOAT,s,n,o,a=1){this.buffer=e,this.size=t,this.normalized=r,this.type=i,this.stride=s,this.start=n,this.instance=o,this.divisor=a}destroy(){this.buffer=null}static from(e,t,r,i,s){return new r9(e,t,r,i,s)}}const r7={Float32Array:Float32Array,Uint32Array:Uint32Array,Int32Array:Int32Array,Uint8Array:Uint8Array},ie={5126:4,5123:2,5121:1};let it=0;const ir={Float32Array:Float32Array,Uint32Array:Uint32Array,Int32Array:Int32Array,Uint8Array:Uint8Array,Uint16Array:Uint16Array};class ii{constructor(e=[],t={}){this.buffers=e,this.indexBuffer=null,this.attributes=t,this.glVertexArrayObjects={},this.id=it++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new rQ("disposeGeometry"),this.refCount=0}addAttribute(e,t,r=0,i=!1,s,n,o,a=!1){if(!t)throw Error("You must pass a buffer when creating an attribute");t instanceof r8||(t instanceof Array&&(t=new Float32Array(t)),t=new r8(t));let h=e.split("|");if(h.length>1){for(let e=0;e<h.length;e++)this.addAttribute(h[e],t,r,i,s);return this}let l=this.buffers.indexOf(t);return -1===l&&(this.buffers.push(t),l=this.buffers.length-1),this.attributes[e]=new r9(l,r,i,s,n,o,a),this.instanced=this.instanced||a,this}getAttribute(e){return this.attributes[e]}getBuffer(e){return this.buffers[this.getAttribute(e).buffer]}addIndex(e){return e instanceof r8||(e instanceof Array&&(e=new Uint16Array(e)),e=new r8(e)),e.type=eK.ELEMENT_ARRAY_BUFFER,this.indexBuffer=e,this.buffers.includes(e)||this.buffers.push(e),this}getIndex(){return this.indexBuffer}interleave(){let e;if(1===this.buffers.length||2===this.buffers.length&&this.indexBuffer)return this;let t=[],r=[],i=new r8;for(e in this.attributes){let i=this.attributes[e],s=this.buffers[i.buffer];t.push(s.data),r.push(i.size*ie[i.type]/4),i.buffer=0}for(i.data=function(e,t){let r=0,i=0,s={};for(let s=0;s<e.length;s++)i+=t[s],r+=e[s].length;let n=new ArrayBuffer(4*r),o=null,a=0;for(let r=0;r<e.length;r++){let h=t[r],l=e[r],u=rv(l);s[u]||(s[u]=new r7[u](n)),o=s[u];for(let e=0;e<l.length;e++)o[(e/h|0)*i+a+e%h]=l[e];a+=h}return new Float32Array(n)}(t,r),e=0;e<this.buffers.length;e++)this.buffers[e]!==this.indexBuffer&&this.buffers[e].destroy();return this.buffers=[i],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(let e in this.attributes){let t=this.attributes[e];return this.buffers[t.buffer].data.length/(t.stride/4||t.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){let e=new ii;for(let t=0;t<this.buffers.length;t++)e.buffers[t]=new r8(this.buffers[t].data.slice(0));for(let t in this.attributes){let r=this.attributes[t];e.attributes[t]=new r9(r.buffer,r.size,r.normalized,r.type,r.stride,r.start,r.instance)}return this.indexBuffer&&(e.indexBuffer=e.buffers[this.buffers.indexOf(this.indexBuffer)],e.indexBuffer.type=eK.ELEMENT_ARRAY_BUFFER),e}static merge(e){let t;let r=new ii,i=[],s=[],n=[];for(let r=0;r<e.length;r++){t=e[r];for(let e=0;e<t.buffers.length;e++)s[e]=s[e]||0,s[e]+=t.buffers[e].data.length,n[e]=0}for(let e=0;e<t.buffers.length;e++)i[e]=new ir[rv(t.buffers[e].data)](s[e]),r.buffers[e]=new r8(i[e]);for(let r=0;r<e.length;r++){t=e[r];for(let e=0;e<t.buffers.length;e++)i[e].set(t.buffers[e].data,n[e]),n[e]+=t.buffers[e].data.length}if(r.attributes=t.attributes,t.indexBuffer){r.indexBuffer=r.buffers[t.buffers.indexOf(t.indexBuffer)],r.indexBuffer.type=eK.ELEMENT_ARRAY_BUFFER;let i=0,s=0,n=0,o=0;for(let e=0;e<t.buffers.length;e++)if(t.buffers[e]!==t.indexBuffer){o=e;break}for(let e in t.attributes){let r=t.attributes[e];(0|r.buffer)===o&&(s+=r.size*ie[r.type]/4)}for(let t=0;t<e.length;t++){let a=e[t].indexBuffer.data;for(let e=0;e<a.length;e++)r.indexBuffer.data[e+n]+=i;i+=e[t].buffers[o].data.length/s,n+=a.length}}return r}}class is extends ii{constructor(e=!1){super(),this._buffer=new r8(null,e,!1),this._indexBuffer=new r8(null,e,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,eN.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,eN.FLOAT).addAttribute("aColor",this._buffer,4,!0,eN.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,eN.FLOAT).addIndex(this._indexBuffer)}}const io=2*Math.PI,ia=180/Math.PI,ih=Math.PI/180;var il=((V=il||{})[V.POLY=0]="POLY",V[V.RECT=1]="RECT",V[V.CIRC=2]="CIRC",V[V.ELIP=3]="ELIP",V[V.RREC=4]="RREC",V);class iu{constructor(e=0,t=0){this.x=0,this.y=0,this.x=e,this.y=t}clone(){return new iu(this.x,this.y)}copyFrom(e){return this.set(e.x,e.y),this}copyTo(e){return e.set(this.x,this.y),e}equals(e){return e.x===this.x&&e.y===this.y}set(e=0,t=e){return this.x=e,this.y=t,this}}iu.prototype.toString=function(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`};const ic=[new iu,new iu,new iu,new iu];class id{constructor(e=0,t=0,r=0,i=0){this.x=Number(e),this.y=Number(t),this.width=Number(r),this.height=Number(i),this.type=il.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new id(0,0,0,0)}clone(){return new id(this.x,this.y,this.width,this.height)}copyFrom(e){return this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,this}copyTo(e){return e.x=this.x,e.y=this.y,e.width=this.width,e.height=this.height,e}contains(e,t){return!(this.width<=0)&&!(this.height<=0)&&e>=this.x&&e<this.x+this.width&&t>=this.y&&t<this.y+this.height}intersects(e,t){if(!t){let t=this.x<e.x?e.x:this.x;if((this.right>e.right?e.right:this.right)<=t)return!1;let r=this.y<e.y?e.y:this.y;return(this.bottom>e.bottom?e.bottom:this.bottom)>r}let r=this.left,i=this.right,s=this.top,n=this.bottom;if(i<=r||n<=s)return!1;let o=ic[0].set(e.left,e.top),a=ic[1].set(e.left,e.bottom),h=ic[2].set(e.right,e.top),l=ic[3].set(e.right,e.bottom);if(h.x<=o.x||a.y<=o.y)return!1;let u=Math.sign(t.a*t.d-t.b*t.c);if(0===u||(t.apply(o,o),t.apply(a,a),t.apply(h,h),t.apply(l,l),Math.max(o.x,a.x,h.x,l.x)<=r||Math.min(o.x,a.x,h.x,l.x)>=i||Math.max(o.y,a.y,h.y,l.y)<=s||Math.min(o.y,a.y,h.y,l.y)>=n))return!1;let c=u*(a.y-o.y),d=u*(o.x-a.x),p=c*r+d*s,f=c*i+d*s,m=c*r+d*n,g=c*i+d*n;if(Math.max(p,f,m,g)<=c*o.x+d*o.y||Math.min(p,f,m,g)>=c*l.x+d*l.y)return!1;let y=u*(o.y-h.y),_=u*(h.x-o.x),v=y*r+_*s,b=y*i+_*s,x=y*r+_*n,T=y*i+_*n;return!(Math.max(v,b,x,T)<=y*o.x+_*o.y||Math.min(v,b,x,T)>=y*l.x+_*l.y)}pad(e=0,t=e){return this.x-=e,this.y-=t,this.width+=2*e,this.height+=2*t,this}fit(e){let t=Math.max(this.x,e.x),r=Math.min(this.x+this.width,e.x+e.width),i=Math.max(this.y,e.y),s=Math.min(this.y+this.height,e.y+e.height);return this.x=t,this.width=Math.max(r-t,0),this.y=i,this.height=Math.max(s-i,0),this}ceil(e=1,t=.001){let r=Math.ceil((this.x+this.width-t)*e)/e,i=Math.ceil((this.y+this.height-t)*e)/e;return this.x=Math.floor((this.x+t)*e)/e,this.y=Math.floor((this.y+t)*e)/e,this.width=r-this.x,this.height=i-this.y,this}enlarge(e){let t=Math.min(this.x,e.x),r=Math.max(this.x+this.width,e.x+e.width),i=Math.min(this.y,e.y),s=Math.max(this.y+this.height,e.y+e.height);return this.x=t,this.width=r-t,this.y=i,this.height=s-i,this}}id.prototype.toString=function(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};class ip{constructor(e=0,t=0,r=0){this.x=e,this.y=t,this.radius=r,this.type=il.CIRC}clone(){return new ip(this.x,this.y,this.radius)}contains(e,t){if(this.radius<=0)return!1;let r=this.radius*this.radius,i=this.x-e,s=this.y-t;return i*=i,s*=s,i+s<=r}getBounds(){return new id(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)}}ip.prototype.toString=function(){return`[@pixi/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`};class im{constructor(e=0,t=0,r=0,i=0){this.x=e,this.y=t,this.width=r,this.height=i,this.type=il.ELIP}clone(){return new im(this.x,this.y,this.width,this.height)}contains(e,t){if(this.width<=0||this.height<=0)return!1;let r=(e-this.x)/this.width,i=(t-this.y)/this.height;return r*=r,i*=i,r+i<=1}getBounds(){return new id(this.x-this.width,this.y-this.height,this.width,this.height)}}im.prototype.toString=function(){return`[@pixi/math:Ellipse x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};class ig{constructor(...e){let t=Array.isArray(e[0])?e[0]:e;if("number"!=typeof t[0]){let e=[];for(let r=0,i=t.length;r<i;r++)e.push(t[r].x,t[r].y);t=e}this.points=t,this.type=il.POLY,this.closeStroke=!0}clone(){let e=new ig(this.points.slice());return e.closeStroke=this.closeStroke,e}contains(e,t){let r=!1,i=this.points.length/2;for(let s=0,n=i-1;s<i;n=s++){let i=this.points[2*s],o=this.points[2*s+1],a=this.points[2*n],h=this.points[2*n+1];o>t!=h>t&&e<(t-o)/(h-o)*(a-i)+i&&(r=!r)}return r}}ig.prototype.toString=function(){return`[@pixi/math:PolygoncloseStroke=${this.closeStroke}points=${this.points.reduce((e,t)=>`${e}, ${t}`,"")}]`};class iy{constructor(e=0,t=0,r=0,i=0,s=20){this.x=e,this.y=t,this.width=r,this.height=i,this.radius=s,this.type=il.RREC}clone(){return new iy(this.x,this.y,this.width,this.height,this.radius)}contains(e,t){if(this.width<=0||this.height<=0)return!1;if(e>=this.x&&e<=this.x+this.width&&t>=this.y&&t<=this.y+this.height){let r=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(t>=this.y+r&&t<=this.y+this.height-r||e>=this.x+r&&e<=this.x+this.width-r)return!0;let i=e-(this.x+r),s=t-(this.y+r),n=r*r;if(i*i+s*s<=n||(i=e-(this.x+this.width-r))*i+s*s<=n||i*i+(s=t-(this.y+this.height-r))*s<=n||(i=e-(this.x+r))*i+s*s<=n)return!0}return!1}}iy.prototype.toString=function(){return`[@pixi/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`};class i_{constructor(e=1,t=0,r=0,i=1,s=0,n=0){this.array=null,this.a=e,this.b=t,this.c=r,this.d=i,this.tx=s,this.ty=n}fromArray(e){this.a=e[0],this.b=e[1],this.c=e[3],this.d=e[4],this.tx=e[2],this.ty=e[5]}set(e,t,r,i,s,n){return this.a=e,this.b=t,this.c=r,this.d=i,this.tx=s,this.ty=n,this}toArray(e,t){this.array||(this.array=new Float32Array(9));let r=t||this.array;return e?(r[0]=this.a,r[1]=this.b,r[2]=0,r[3]=this.c,r[4]=this.d,r[5]=0,r[6]=this.tx,r[7]=this.ty):(r[0]=this.a,r[1]=this.c,r[2]=this.tx,r[3]=this.b,r[4]=this.d,r[5]=this.ty,r[6]=0,r[7]=0),r[8]=1,r}apply(e,t){t=t||new iu;let r=e.x,i=e.y;return t.x=this.a*r+this.c*i+this.tx,t.y=this.b*r+this.d*i+this.ty,t}applyInverse(e,t){t=t||new iu;let r=1/(this.a*this.d+-(this.c*this.b)),i=e.x,s=e.y;return t.x=this.d*r*i+-this.c*r*s+(this.ty*this.c-this.tx*this.d)*r,t.y=this.a*r*s+-this.b*r*i+(-this.ty*this.a+this.tx*this.b)*r,t}translate(e,t){return this.tx+=e,this.ty+=t,this}scale(e,t){return this.a*=e,this.d*=t,this.c*=e,this.b*=t,this.tx*=e,this.ty*=t,this}rotate(e){let t=Math.cos(e),r=Math.sin(e),i=this.a,s=this.c,n=this.tx;return this.a=i*t-this.b*r,this.b=i*r+this.b*t,this.c=s*t-this.d*r,this.d=s*r+this.d*t,this.tx=n*t-this.ty*r,this.ty=n*r+this.ty*t,this}append(e){let t=this.a,r=this.b,i=this.c,s=this.d;return this.a=e.a*t+e.b*i,this.b=e.a*r+e.b*s,this.c=e.c*t+e.d*i,this.d=e.c*r+e.d*s,this.tx=e.tx*t+e.ty*i+this.tx,this.ty=e.tx*r+e.ty*s+this.ty,this}setTransform(e,t,r,i,s,n,o,a,h){return this.a=Math.cos(o+h)*s,this.b=Math.sin(o+h)*s,this.c=-Math.sin(o-a)*n,this.d=Math.cos(o-a)*n,this.tx=e-(r*this.a+i*this.c),this.ty=t-(r*this.b+i*this.d),this}prepend(e){let t=this.tx;if(1!==e.a||0!==e.b||0!==e.c||1!==e.d){let t=this.a,r=this.c;this.a=t*e.a+this.b*e.c,this.b=t*e.b+this.b*e.d,this.c=r*e.a+this.d*e.c,this.d=r*e.b+this.d*e.d}return this.tx=t*e.a+this.ty*e.c+e.tx,this.ty=t*e.b+this.ty*e.d+e.ty,this}decompose(e){let t=this.a,r=this.b,i=this.c,s=this.d,n=e.pivot,o=-Math.atan2(-i,s),a=Math.atan2(r,t),h=Math.abs(o+a);return h<1e-5||1e-5>Math.abs(io-h)?(e.rotation=a,e.skew.x=e.skew.y=0):(e.rotation=0,e.skew.x=o,e.skew.y=a),e.scale.x=Math.sqrt(t*t+r*r),e.scale.y=Math.sqrt(i*i+s*s),e.position.x=this.tx+(n.x*t+n.y*i),e.position.y=this.ty+(n.x*r+n.y*s),e}invert(){let e=this.a,t=this.b,r=this.c,i=this.d,s=this.tx,n=e*i-t*r;return this.a=i/n,this.b=-t/n,this.c=-r/n,this.d=e/n,this.tx=(r*this.ty-i*s)/n,this.ty=-(e*this.ty-t*s)/n,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){let e=new i_;return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e}copyTo(e){return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e}copyFrom(e){return this.a=e.a,this.b=e.b,this.c=e.c,this.d=e.d,this.tx=e.tx,this.ty=e.ty,this}static get IDENTITY(){return new i_}static get TEMP_MATRIX(){return new i_}}i_.prototype.toString=function(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`};const iv=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],ib=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],ix=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],iT=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],iE=[],iw=[],iA=Math.sign;!function(){for(let e=0;e<16;e++){let t=[];iE.push(t);for(let r=0;r<16;r++){let i=iA(iv[e]*iv[r]+ix[e]*ib[r]),s=iA(ib[e]*iv[r]+iT[e]*ib[r]),n=iA(iv[e]*ix[r]+ix[e]*iT[r]),o=iA(ib[e]*ix[r]+iT[e]*iT[r]);for(let e=0;e<16;e++)if(iv[e]===i&&ib[e]===s&&ix[e]===n&&iT[e]===o){t.push(e);break}}}for(let e=0;e<16;e++){let t=new i_;t.set(iv[e],ib[e],ix[e],iT[e],0,0),iw.push(t)}}();const iS={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:e=>iv[e],uY:e=>ib[e],vX:e=>ix[e],vY:e=>iT[e],inv:e=>8&e?15&e:7&-e,add:(e,t)=>iE[e][t],sub:(e,t)=>iE[e][iS.inv(t)],rotate180:e=>4^e,isVertical:e=>(3&e)==2,byDirection:(e,t)=>2*Math.abs(e)<=Math.abs(t)?t>=0?iS.S:iS.N:2*Math.abs(t)<=Math.abs(e)?e>0?iS.E:iS.W:t>0?e>0?iS.SE:iS.SW:e>0?iS.NE:iS.NW,matrixAppendRotationInv:(e,t,r=0,i=0)=>{let s=iw[iS.inv(t)];s.tx=r,s.ty=i,e.append(s)}};class iC{constructor(e,t,r=0,i=0){this._x=r,this._y=i,this.cb=e,this.scope=t}clone(e=this.cb,t=this.scope){return new iC(e,t,this._x,this._y)}set(e=0,t=e){return(this._x!==e||this._y!==t)&&(this._x=e,this._y=t,this.cb.call(this.scope)),this}copyFrom(e){return(this._x!==e.x||this._y!==e.y)&&(this._x=e.x,this._y=e.y,this.cb.call(this.scope)),this}copyTo(e){return e.set(this._x,this._y),e}equals(e){return e.x===this._x&&e.y===this._y}get x(){return this._x}set x(e){this._x!==e&&(this._x=e,this.cb.call(this.scope))}get y(){return this._y}set y(e){this._y!==e&&(this._y=e,this.cb.call(this.scope))}}iC.prototype.toString=function(){return`[@pixi/math:ObservablePoint x=${this.x} y=${this.y} scope=${this.scope}]`};const iR=class{constructor(){this.worldTransform=new i_,this.localTransform=new i_,this.position=new iC(this.onChange,this,0,0),this.scale=new iC(this.onChange,this,1,1),this.pivot=new iC(this.onChange,this,0,0),this.skew=new iC(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}updateLocalTransform(){let e=this.localTransform;this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(e){let t=this.localTransform;if(this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==e._worldID){let r=e.worldTransform,i=this.worldTransform;i.a=t.a*r.a+t.b*r.c,i.b=t.a*r.b+t.b*r.d,i.c=t.c*r.a+t.d*r.c,i.d=t.c*r.b+t.d*r.d,i.tx=t.tx*r.a+t.ty*r.c+r.tx,i.ty=t.tx*r.b+t.ty*r.d+r.ty,this._parentID=e._worldID,this._worldID++}}setFromMatrix(e){e.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(e){this._rotation!==e&&(this._rotation=e,this.updateSkew())}};iR.IDENTITY=new iR,iR.prototype.toString=function(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`};var iI=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`,iP=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`;function iM(e,t,r){let i=e.createShader(t);return e.shaderSource(i,r),e.compileShader(i),i}function iD(e){let t=Array(e);for(let e=0;e<t.length;e++)t[e]=!1;return t}function ik(e,t){switch(e){case"float":case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"vec2":return new Float32Array(2*t);case"vec3":return new Float32Array(3*t);case"vec4":return new Float32Array(4*t);case"ivec2":return new Int32Array(2*t);case"ivec3":return new Int32Array(3*t);case"ivec4":return new Int32Array(4*t);case"uvec2":return new Uint32Array(2*t);case"uvec3":return new Uint32Array(3*t);case"uvec4":return new Uint32Array(4*t);case"bool":return!1;case"bvec2":return iD(2*t);case"bvec3":return iD(3*t);case"bvec4":return iD(4*t);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const iO=[{test:e=>"float"===e.type&&1===e.size&&!e.isArray,code:e=>`
            if(uv["${e}"] !== ud["${e}"].value)
            {
                ud["${e}"].value = uv["${e}"]
                gl.uniform1f(ud["${e}"].location, uv["${e}"])
            }
            `},{test:(e,t)=>("sampler2D"===e.type||"samplerCube"===e.type||"sampler2DArray"===e.type)&&1===e.size&&!e.isArray&&(null==t||void 0!==t.castToBaseTexture),code:e=>`t = syncData.textureCount++;

            renderer.texture.bind(uv["${e}"], t);

            if(ud["${e}"].value !== t)
            {
                ud["${e}"].value = t;
                gl.uniform1i(ud["${e}"].location, t);
; // eslint-disable-line max-len
            }`},{test:(e,t)=>"mat3"===e.type&&1===e.size&&!e.isArray&&void 0!==t.a,code:e=>`
            gl.uniformMatrix3fv(ud["${e}"].location, false, uv["${e}"].toArray(true));
            `,codeUbo:e=>`
                var ${e}_matrix = uv.${e}.toArray(true);

                data[offset] = ${e}_matrix[0];
                data[offset+1] = ${e}_matrix[1];
                data[offset+2] = ${e}_matrix[2];
        
                data[offset + 4] = ${e}_matrix[3];
                data[offset + 5] = ${e}_matrix[4];
                data[offset + 6] = ${e}_matrix[5];
        
                data[offset + 8] = ${e}_matrix[6];
                data[offset + 9] = ${e}_matrix[7];
                data[offset + 10] = ${e}_matrix[8];
            `},{test:(e,t)=>"vec2"===e.type&&1===e.size&&!e.isArray&&void 0!==t.x,code:e=>`
                cv = ud["${e}"].value;
                v = uv["${e}"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["${e}"].location, v.x, v.y);
                }`,codeUbo:e=>`
                v = uv.${e};

                data[offset] = v.x;
                data[offset+1] = v.y;
            `},{test:e=>"vec2"===e.type&&1===e.size&&!e.isArray,code:e=>`
                cv = ud["${e}"].value;
                v = uv["${e}"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["${e}"].location, v[0], v[1]);
                }
            `},{test:(e,t)=>"vec4"===e.type&&1===e.size&&!e.isArray&&void 0!==t.width,code:e=>`
                cv = ud["${e}"].value;
                v = uv["${e}"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["${e}"].location, v.x, v.y, v.width, v.height)
                }`,codeUbo:e=>`
                    v = uv.${e};

                    data[offset] = v.x;
                    data[offset+1] = v.y;
                    data[offset+2] = v.width;
                    data[offset+3] = v.height;
                `},{test:(e,t)=>"vec4"===e.type&&1===e.size&&!e.isArray&&void 0!==t.red,code:e=>`
                cv = ud["${e}"].value;
                v = uv["${e}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
                    cv[3] = v.alpha;
                    gl.uniform4f(ud["${e}"].location, v.red, v.green, v.blue, v.alpha)
                }`,codeUbo:e=>`
                    v = uv.${e};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                    data[offset+3] = v.alpha;
                `},{test:(e,t)=>"vec3"===e.type&&1===e.size&&!e.isArray&&void 0!==t.red,code:e=>`
                cv = ud["${e}"].value;
                v = uv["${e}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.a)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
    
                    gl.uniform3f(ud["${e}"].location, v.red, v.green, v.blue)
                }`,codeUbo:e=>`
                    v = uv.${e};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                `},{test:e=>"vec4"===e.type&&1===e.size&&!e.isArray,code:e=>`
                cv = ud["${e}"].value;
                v = uv["${e}"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["${e}"].location, v[0], v[1], v[2], v[3])
                }`}],iB={float:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,vec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,int:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,ivec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,ivec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,ivec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,uint:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,uvec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,uvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,uvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,bool:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,bvec2:`
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,bvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,bvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,samplerCube:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,sampler2DArray:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`},iL={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"},iF={};let iN=iF;function iU(e,t){let r=e.getShaderSource(t).split(`
`).map((e,t)=>`${t}: ${e}`),i=e.getShaderInfoLog(t),s=i.split(`
`),n={},o=s.map(e=>parseFloat(e.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(e=>!!e&&!n[e]&&(n[e]=!0,!0)),a=[""];o.forEach(e=>{r[e-1]=`%c${r[e-1]}%c`,a.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});let h=r.join(`
`);a[0]=h,console.error(i),console.groupCollapsed("click to view full shader code"),console.warn(...a),console.groupEnd()}const iG={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};let ij=null;const iH={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function iz(e,t){if(!ij){let t=Object.keys(iH);ij={};for(let r=0;r<t.length;++r){let i=t[r];ij[e[i]]=iH[i]}}return ij[t]}function iV(e,t,r){if("precision"!==e.substring(0,9)){let i=t;return t===eW.HIGH&&r!==eW.HIGH&&(i=eW.MEDIUM),`precision ${i} float;
${e}`}return r!==eW.HIGH&&"precision highp"===e.substring(0,15)?e.replace("precision highp","precision mediump"):e}let iX=0;const iW={},i$=class e{constructor(t,i,s="pixi-shader",n={}){this.extra={},this.id=iX++,this.vertexSrc=t||e.defaultVertexSrc,this.fragmentSrc=i||e.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=n,"#version"!==this.vertexSrc.substring(0,8)&&(iW[s=s.replace(/\s+/g,"-")]?(iW[s]++,s+=`-${iW[s]}`):iW[s]=1,this.vertexSrc=`#define SHADER_NAME ${s}
${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${s}
${this.fragmentSrc}`,this.vertexSrc=iV(this.vertexSrc,e.defaultVertexPrecision,eW.HIGH),this.fragmentSrc=iV(this.fragmentSrc,e.defaultFragmentPrecision,function(){if(!r){r=eW.MEDIUM;let e=function(){if(iN===iF||iN?.isContextLost()){let e;let t=eJ.ADAPTER.createCanvas();eJ.PREFER_ENV>=eM.WEBGL2&&(e=t.getContext("webgl2",{})),e||((e=t.getContext("webgl",{})||t.getContext("experimental-webgl",{}))?e.getExtension("WEBGL_draw_buffers"):e=null),iN=e}return iN}();if(e&&e.getShaderPrecisionFormat){let t=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT);t&&(r=t.precision?eW.HIGH:eW.MEDIUM)}}return r}())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return iP}static get defaultFragmentSrc(){return iI}static from(t,r,i){let s=t+r,n=rM[s];return n||(rM[s]=n=new e(t,r,i)),n}};i$.defaultVertexPrecision=eW.HIGH,i$.defaultFragmentPrecision=tn.apple.device?eW.HIGH:eW.MEDIUM;let iY=0;class iq{constructor(e,t,r){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=iY++,this.static=!!t,this.ubo=!!r,e instanceof r8?(this.buffer=e,this.buffer.type=eK.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=e,this.ubo&&(this.buffer=new r8(new Float32Array(1)),this.buffer.type=eK.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(e,t,r){if(this.ubo)throw Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them");this.uniforms[e]=new iq(t,r)}static from(e,t,r){return new iq(e,t,r)}static uboFrom(e,t){return new iq(e,t??!0,!0)}}class iK{constructor(e,t){this.uniformBindCount=0,this.program=e,t?t instanceof iq?this.uniformGroup=t:this.uniformGroup=new iq(t):this.uniformGroup=new iq({}),this.disposeRunner=new rQ("disposeShader")}checkUniformExists(e,t){if(t.uniforms[e])return!0;for(let r in t.uniforms){let i=t.uniforms[r];if(!0===i.group&&this.checkUniformExists(e,i))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(e,t,r){return new iK(i$.from(e,t),r)}}class iJ{constructor(e,t){if(this.vertexSrc=e,this.fragTemplate=t,this.programCache={},this.defaultGroupCache={},!t.includes("%count%"))throw Error('Fragment template must contain "%count%".');if(!t.includes("%forloop%"))throw Error('Fragment template must contain "%forloop%".')}generateShader(e){if(!this.programCache[e]){let t=new Int32Array(e);for(let r=0;r<e;r++)t[r]=r;this.defaultGroupCache[e]=iq.from({uSamplers:t},!0);let r=this.fragTemplate;r=(r=r.replace(/%count%/gi,`${e}`)).replace(/%forloop%/gi,this.generateSampleSrc(e)),this.programCache[e]=new i$(this.vertexSrc,r)}let t={tint:new Float32Array([1,1,1,1]),translationMatrix:new i_,default:this.defaultGroupCache[e]};return new iK(this.programCache[e],t)}generateSampleSrc(e){let t="";t+=`

`;for(let r=0;r<e;r++)r>0&&(t+=`
else `),r<e-1&&(t+=`if(vTextureId < ${r}.5)`),t+=`
{
	color = texture2D(uSamplers[${r}], vTextureCoord);
}`;return t+`

`}}class iZ{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let e=0;e<this.count;e++)this.elements[e]=null;this.count=0}}class iQ{constructor(e){this.renderer=e}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(e){}}var i0=`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`,i1=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`;const i2=class e extends iQ{constructor(t){super(t),this.setShaderGenerator(),this.geometryClass=is,this.vertexSize=6,this.state=rK.for2d(),this.size=4*e.defaultBatchSize,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),t.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){return this._defaultMaxTextures=this._defaultMaxTextures??function(e){let t=!0,r=eJ.ADAPTER.getNavigator();if(tn.tablet||tn.phone){if(tn.apple.device){let e=r.userAgent.match(/OS (\d+)_(\d+)?/);e&&11>parseInt(e[1],10)&&(t=!1)}if(tn.android.device){let e=r.userAgent.match(/Android\s([0-9.]*)/);e&&7>parseInt(e[1],10)&&(t=!1)}}return t?32:4}(0),this._defaultMaxTextures}static set defaultMaxTextures(e){this._defaultMaxTextures=e}static get canUploadSameBuffer(){return this._canUploadSameBuffer=this._canUploadSameBuffer??!tn.apple.device,this._canUploadSameBuffer}static set canUploadSameBuffer(e){this._canUploadSameBuffer=e}get MAX_TEXTURES(){return tB("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return i1}static get defaultFragmentTemplate(){return i0}setShaderGenerator({vertex:t=e.defaultVertexSrc,fragment:r=e.defaultFragmentTemplate}={}){this.shaderGenerator=new iJ(t,r)}contextChange(){let t=this.renderer.gl;eJ.PREFER_ENV===eM.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),e.defaultMaxTextures),this.maxTextures=function(e,t){if(0===e)throw Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");let r=t.createShader(t.FRAGMENT_SHADER);for(;;){let i=rq.replace(/%forloop%/gi,function(e){let t="";for(let r=0;r<e;++r)r>0&&(t+=`
else `),r<e-1&&(t+=`if(test == ${r}.0){}`);return t}(e));if(t.shaderSource(r,i),t.compileShader(r),t.getShaderParameter(r,t.COMPILE_STATUS))break;e=e/2|0}return e}(this.maxTextures,t)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){let{_drawCallPool:t,_textureArrayPool:r}=e,i=this.size/4,s=Math.floor(i/this.maxTextures)+1;for(;t.length<i;)t.push(new r6);for(;r.length<s;)r.push(new iZ);for(let e=0;e<this.maxTextures;e++)this._tempBoundTextures[e]=null}onPrerender(){this._flushId=0}render(e){e._texture.valid&&(this._vertexCount+e.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=e.vertexData.length/2,this._indexCount+=e.indices.length,this._bufferedTextures[this._bufferSize]=e._texture.baseTexture,this._bufferedElements[this._bufferSize++]=e)}buildTexturesAndDrawCalls(){let{_bufferedTextures:t,maxTextures:r}=this,i=e._textureArrayPool,s=this.renderer.batch,n=this._tempBoundTextures,o=this.renderer.textureGC.count,a=++r4._globalBatch,h=0,l=i[0],u=0;s.copyBoundTextures(n,r);for(let e=0;e<this._bufferSize;++e){let c=t[e];t[e]=null,c._batchEnabled!==a&&(l.count>=r&&(s.boundArray(l,n,a,r),this.buildDrawCalls(l,u,e),u=e,l=i[++h],++a),c._batchEnabled=a,c.touched=o,l.elements[l.count++]=c)}l.count>0&&(s.boundArray(l,n,a,r),this.buildDrawCalls(l,u,this._bufferSize),++h,++a);for(let e=0;e<n.length;e++)n[e]=null;r4._globalBatch=a}buildDrawCalls(t,r,i){let{_bufferedElements:s,_attributeBuffer:n,_indexBuffer:o,vertexSize:a}=this,h=e._drawCallPool,l=this._dcIndex,u=this._aIndex,c=this._iIndex,d=h[l];d.start=this._iIndex,d.texArray=t;for(let e=r;e<i;++e){let i=s[e],p=rd[i._texture.baseTexture.alphaMode?1:0][i.blendMode];s[e]=null,r<e&&d.blend!==p&&(d.size=c-d.start,r=e,(d=h[++l]).texArray=t,d.start=c),this.packInterleavedGeometry(i,n,o,u,c),u+=i.vertexData.length/2*a,c+=i.indices.length,d.blend=p}r<i&&(d.size=c-d.start,++l),this._dcIndex=l,this._aIndex=u,this._iIndex=c}bindAndClearTexArray(e){let t=this.renderer.texture;for(let r=0;r<e.count;r++)t.bind(e.elements[r],e.ids[r]),e.elements[r]=null;e.count=0}updateGeometry(){let{_packedGeometries:t,_attributeBuffer:r,_indexBuffer:i}=this;e.canUploadSameBuffer?(t[this._flushId]._buffer.update(r.rawBinaryData),t[this._flushId]._indexBuffer.update(i),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,t[this._flushId]=new this.geometryClass),t[this._flushId]._buffer.update(r.rawBinaryData),t[this._flushId]._indexBuffer.update(i),this.renderer.geometry.bind(t[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){let t=this._dcIndex,{gl:r,state:i}=this.renderer,s=e._drawCallPool,n=null;for(let e=0;e<t;e++){let{texArray:t,type:o,size:a,start:h,blend:l}=s[e];n!==t&&(n=t,this.bindAndClearTexArray(t)),this.state.blendMode=l,i.set(this.state),r.drawElements(o,a,r.UNSIGNED_SHORT,2*h)}}flush(){0!==this._vertexCount&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),e.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]&&this._packedGeometries[e].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(e){let t=rT(Math.ceil(e/8)),r=rw(t),i=8*t;this._aBuffers.length<=r&&(this._iBuffers.length=r+1);let s=this._aBuffers[i];return s||(this._aBuffers[i]=s=new rY(i*this.vertexSize*4)),s}getIndexBuffer(e){let t=rT(Math.ceil(e/12)),r=rw(t);this._iBuffers.length<=r&&(this._iBuffers.length=r+1);let i=this._iBuffers[r];return i||(this._iBuffers[r]=i=new Uint16Array(12*t)),i}packInterleavedGeometry(e,t,r,i,s){let{uint32View:n,float32View:o}=t,a=i/this.vertexSize,h=e.uvs,l=e.indices,u=e.vertexData,c=e._texture.baseTexture._batchLocation,d=Math.min(e.worldAlpha,1),p=ra.shared.setValue(e._tintRGB).toPremultiplied(d,e._texture.baseTexture.alphaMode>0);for(let e=0;e<u.length;e+=2)o[i++]=u[e],o[i++]=u[e+1],o[i++]=h[e],o[i++]=h[e+1],n[i++]=p,o[i++]=c;for(let e=0;e<l.length;e++)r[s++]=a+l[e]}};i2.defaultBatchSize=4096,i2.extension={name:"batch",type:rV.RendererPlugin},i2._drawCallPool=[],i2._textureArrayPool=[],r$.add(i2);var i3=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`,i4=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const i6=class e extends iK{constructor(t,r,i){super(i$.from(t||e.defaultVertexSrc,r||e.defaultFragmentSrc),i),this.padding=0,this.resolution=e.defaultResolution,this.multisample=e.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new rK}apply(e,t,r,i,s){e.applyFilter(this,t,r,i)}get blendMode(){return this.state.blendMode}set blendMode(e){this.state.blendMode=e}get resolution(){return this._resolution}set resolution(e){this._resolution=e}static get defaultVertexSrc(){return i4}static get defaultFragmentSrc(){return i3}};i6.defaultResolution=1,i6.defaultMultisample=eq.NONE;let i5=i6;class i8{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new ra(0),this.alpha=1}init(e){this.clearBeforeRender=e.clearBeforeRender;let{backgroundColor:t,background:r,backgroundAlpha:i}=e,s=r??t;void 0!==s&&(this.color=s),this.alpha=i}get color(){return this._backgroundColor.value}set color(e){this._backgroundColor.setValue(e)}get alpha(){return this._backgroundColor.alpha}set alpha(e){this._backgroundColor.setAlpha(e)}get backgroundColor(){return this._backgroundColor}destroy(){}}i8.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0},i8.extension={type:[rV.RendererSystem,rV.CanvasRendererSystem],name:"background"},r$.add(i8);class i9{constructor(e){this.renderer=e,this.emptyRenderer=new iQ(e),this.currentRenderer=this.emptyRenderer}setObjectRenderer(e){this.currentRenderer!==e&&(this.currentRenderer.stop(),this.currentRenderer=e,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(e,t){let{boundTextures:r}=this.renderer.texture;for(let i=t-1;i>=0;--i)e[i]=r[i]||null,e[i]&&(e[i]._batchLocation=i)}boundArray(e,t,r,i){let{elements:s,ids:n,count:o}=e,a=0;for(let e=0;e<o;e++){let o=s[e],h=o._batchLocation;if(h>=0&&h<i&&t[h]===o){n[e]=h;continue}for(;a<i;){let i=t[a];if(i&&i._batchEnabled===r&&i._batchLocation===a){a++;continue}n[e]=a,o._batchLocation=a,t[a]=o;break}}}destroy(){this.renderer=null}}i9.extension={type:rV.RendererSystem,name:"batch"},r$.add(i9);let i7=0;class se{constructor(e){this.renderer=e,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(e){this.gl=e,this.renderer.gl=e,this.renderer.CONTEXT_UID=i7++}init(e){if(e.context)this.initFromContext(e.context);else{let t=this.renderer.background.alpha<1,r=e.premultipliedAlpha;this.preserveDrawingBuffer=e.preserveDrawingBuffer,this.useContextAlpha=e.useContextAlpha,this.powerPreference=e.powerPreference,this.initFromOptions({alpha:t,premultipliedAlpha:r,antialias:e.antialias,stencil:!0,preserveDrawingBuffer:e.preserveDrawingBuffer,powerPreference:e.powerPreference})}}initFromContext(e){this.gl=e,this.validateContext(e),this.renderer.gl=e,this.renderer.CONTEXT_UID=i7++,this.renderer.runners.contextChange.emit(e);let t=this.renderer.view;void 0!==t.addEventListener&&(t.addEventListener("webglcontextlost",this.handleContextLost,!1),t.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(e){let t=this.createContext(this.renderer.view,e);this.initFromContext(t)}createContext(e,t){let r;if(eJ.PREFER_ENV>=eM.WEBGL2&&(r=e.getContext("webgl2",t)),r)this.webGLVersion=2;else if(this.webGLVersion=1,!(r=e.getContext("webgl",t)||e.getContext("experimental-webgl",t)))throw Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=r,this.getExtensions(),this.gl}getExtensions(){let{gl:e}=this,t={loseContext:e.getExtension("WEBGL_lose_context"),anisotropicFiltering:e.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:e.getExtension("OES_texture_float_linear"),s3tc:e.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:e.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:e.getExtension("WEBGL_compressed_texture_etc"),etc1:e.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:e.getExtension("WEBGL_compressed_texture_atc"),astc:e.getExtension("WEBGL_compressed_texture_astc"),bptc:e.getExtension("EXT_texture_compression_bptc")};1===this.webGLVersion?Object.assign(this.extensions,t,{drawBuffers:e.getExtension("WEBGL_draw_buffers"),depthTexture:e.getExtension("WEBGL_depth_texture"),vertexArrayObject:e.getExtension("OES_vertex_array_object")||e.getExtension("MOZ_OES_vertex_array_object")||e.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:e.getExtension("OES_element_index_uint"),floatTexture:e.getExtension("OES_texture_float"),floatTextureLinear:e.getExtension("OES_texture_float_linear"),textureHalfFloat:e.getExtension("OES_texture_half_float"),textureHalfFloatLinear:e.getExtension("OES_texture_half_float_linear")}):2===this.webGLVersion&&Object.assign(this.extensions,t,{colorBufferFloat:e.getExtension("EXT_color_buffer_float")})}handleContextLost(e){e.preventDefault(),setTimeout(()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()},0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){let e=this.renderer.view;this.renderer=null,void 0!==e.removeEventListener&&(e.removeEventListener("webglcontextlost",this.handleContextLost),e.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(e){let t=e.getContextAttributes(),r="WebGL2RenderingContext"in globalThis&&e instanceof globalThis.WebGL2RenderingContext;r&&(this.webGLVersion=2),t&&!t.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");let i=r||!!e.getExtension("OES_element_index_uint");this.supports.uint32Indices=i,i||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}}se.defaultOptions={context:null,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"default"},se.extension={type:rV.RendererSystem,name:"context"},r$.add(se);class st{constructor(e,t){if(this.width=Math.round(e),this.height=Math.round(t),!this.width||!this.height)throw Error("Framebuffer width or height is zero");this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new rQ("disposeFramebuffer"),this.multisample=eq.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(e=0,t){return this.colorTextures[e]=t||new r4(null,{scaleMode:eG.NEAREST,resolution:1,mipmap:eH.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(e){return this.depthTexture=e||new r4(null,{scaleMode:eG.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:eH.OFF,format:eL.DEPTH_COMPONENT,type:eN.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(e,t){if(e=Math.round(e),t=Math.round(t),!e||!t)throw Error("Framebuffer width and height must not be zero");if(!(e===this.width&&t===this.height)){this.width=e,this.height=t,this.dirtyId++,this.dirtySize++;for(let r=0;r<this.colorTextures.length;r++){let i=this.colorTextures[r],s=i.resolution;i.setSize(e/s,t/s)}if(this.depthTexture){let r=this.depthTexture.resolution;this.depthTexture.setSize(e/r,t/r)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class sr extends r4{constructor(e={}){if("number"==typeof e){let t=arguments[0],r=arguments[1],i=arguments[2],s=arguments[3];e={width:t,height:r,scaleMode:i,resolution:s}}e.width=e.width??100,e.height=e.height??100,e.multisample??(e.multisample=eq.NONE),super(null,e),this.mipmap=eH.OFF,this.valid=!0,this._clear=new ra([0,0,0,0]),this.framebuffer=new st(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=e.multisample,this.maskStack=[],this.filterStack=[{}]}set clearColor(e){this._clear.setValue(e)}get clearColor(){return this._clear.value}get clear(){return this._clear}get multisample(){return this.framebuffer.multisample}set multisample(e){this.framebuffer.multisample=e}resize(e,t){this.framebuffer.resize(e*this.resolution,t*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}class si extends r0{constructor(e){super(e.naturalWidth||e.videoWidth||e.displayWidth||e.width,e.naturalHeight||e.videoHeight||e.displayHeight||e.height),this.source=e,this.noSubImage=!1}static crossOrigin(e,t,r){void 0!==r||t.startsWith("data:")?!1!==r&&(e.crossOrigin="string"==typeof r?r:"anonymous"):e.crossOrigin=rH(t)}upload(e,t,r,i){let s=e.gl,n=t.realWidth,o=t.realHeight;if(i=i||this.source,"u">typeof HTMLImageElement&&i instanceof HTMLImageElement){if(!i.complete||0===i.naturalWidth)return!1}else if("u">typeof HTMLVideoElement&&i instanceof HTMLVideoElement&&i.readyState<=1)return!1;return s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.alphaMode===ez.UNPACK),this.noSubImage||t.target!==s.TEXTURE_2D||r.width!==n||r.height!==o?(r.width=n,r.height=o,s.texImage2D(t.target,0,r.internalFormat,t.format,r.type,i)):s.texSubImage2D(s.TEXTURE_2D,0,0,0,t.format,r.type,i),!0}update(){if(this.destroyed)return;let e=this.source,t=e.naturalWidth||e.videoWidth||e.width,r=e.naturalHeight||e.videoHeight||e.height;this.resize(t,r),super.update()}dispose(){this.source=null}}class ss extends si{constructor(e,t){if(t=t||{},"string"==typeof e){let r=new Image;si.crossOrigin(r,e,t.crossorigin),r.src=e,e=r}super(e),!e.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=e.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(t.createBitmap??eJ.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode="number"==typeof t.alphaMode?t.alphaMode:null,this.bitmap=null,this._load=null,!1!==t.autoLoad&&this.load()}load(e){return this._load||(void 0!==e&&(this.createBitmap=e),this._load=new Promise((e,t)=>{let r=this.source;this.url=r.src;let i=()=>{this.destroyed||(r.onload=null,r.onerror=null,this.update(),this._load=null,this.createBitmap?e(this.process()):e(this))};r.complete&&r.src?i():(r.onload=i,r.onerror=e=>{t(e),this.onError.emit(e)})})),this._load}process(){let e=this.source;if(null!==this._process)return this._process;if(null!==this.bitmap||!globalThis.createImageBitmap)return Promise.resolve(this);let t=globalThis.createImageBitmap,r=!e.crossOrigin||"anonymous"===e.crossOrigin;return this._process=fetch(e.src,{mode:r?"cors":"no-cors"}).then(e=>e.blob()).then(r=>t(r,0,0,e.width,e.height,{premultiplyAlpha:null===this.alphaMode||this.alphaMode===ez.UNPACK?"premultiply":"none"})).then(e=>this.destroyed?Promise.reject():(this.bitmap=e,this.update(),this._process=null,Promise.resolve(this))),this._process}upload(e,t,r){if("number"==typeof this.alphaMode&&(t.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(e,t,r);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(e,t,r,this.bitmap),!this.preserveBitmap){let e=!0,i=t._glTextures;for(let s in i){let n=i[s];if(n!==r&&n.dirtyId!==t.dirtyId){e=!1;break}}e&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(e){return"u">typeof HTMLImageElement&&("string"==typeof e||e instanceof HTMLImageElement)}}class sn{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(e,t,r){let i=t.width,s=t.height;if(r){let t=e.width/2/i,n=e.height/2/s,o=e.x/i+t,a=e.y/s+n;r=iS.add(r,iS.NW),this.x0=o+t*iS.uX(r),this.y0=a+n*iS.uY(r),r=iS.add(r,2),this.x1=o+t*iS.uX(r),this.y1=a+n*iS.uY(r),r=iS.add(r,2),this.x2=o+t*iS.uX(r),this.y2=a+n*iS.uY(r),r=iS.add(r,2),this.x3=o+t*iS.uX(r),this.y3=a+n*iS.uY(r)}else this.x0=e.x/i,this.y0=e.y/s,this.x1=(e.x+e.width)/i,this.y1=e.y/s,this.x2=(e.x+e.width)/i,this.y2=(e.y+e.height)/s,this.x3=e.x/i,this.y3=(e.y+e.height)/s;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}}sn.prototype.toString=function(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`};const so=new sn;function sa(e){e.destroy=function(){},e.on=function(){},e.once=function(){},e.emit=function(){}}class sh extends eA(ta){constructor(e,t,r,i,s,n,o){if(super(),this.noFrame=!1,t||(this.noFrame=!0,t=new id(0,0,1,1)),e instanceof sh&&(e=e.baseTexture),this.baseTexture=e,this._frame=t,this.trim=i,this.valid=!1,this.destroyed=!1,this._uvs=so,this.uvMatrix=null,this.orig=r||t,this._rotate=Number(s||0),!0===s)this._rotate=2;else if(this._rotate%2!=0)throw Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=n?new iu(n.x,n.y):new iu(0,0),this.defaultBorders=o,this._updateID=0,this.textureCacheIds=[],e.valid?this.noFrame?e.valid&&this.onBaseTextureUpdated(e):this.frame=t:e.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&e.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(e){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=e.width,this._frame.height=e.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(e){if(this.baseTexture){if(e){let{resource:e}=this.baseTexture;e?.url&&rD[e.url]&&sh.removeFromCache(e.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,sh.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}clone(){let e=this._frame.clone(),t=this._frame===this.orig?e:this.orig.clone(),r=new sh(this.baseTexture,!this.noFrame&&e,t,this.trim?.clone(),this.rotate,this.defaultAnchor,this.defaultBorders);return this.noFrame&&(r._frame=e),r}updateUvs(){this._uvs===so&&(this._uvs=new sn),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(e,t={},r=eJ.STRICT_TEXTURE_CACHE){let i="string"==typeof e,s=null;if(i)s=e;else if(e instanceof r4){if(!e.cacheId){let r=t?.pixiIdPrefix||"pixiid";e.cacheId=`${r}-${rR()}`,r4.addToCache(e,e.cacheId)}s=e.cacheId}else{if(!e._pixiId){let r=t?.pixiIdPrefix||"pixiid";e._pixiId=`${r}_${rR()}`}s=e._pixiId}let n=rD[s];if(i&&r&&!n)throw Error(`The cacheId "${s}" does not exist in TextureCache.`);return n||e instanceof r4?!n&&e instanceof r4&&(n=new sh(e),sh.addToCache(n,s)):(t.resolution||(t.resolution=rz(e)),(n=new sh(new r4(e,t))).baseTexture.cacheId=s,r4.addToCache(n.baseTexture,s),sh.addToCache(n,s)),n}static fromURL(e,t){let r=Object.assign({autoLoad:!1},t?.resourceOptions),i=sh.from(e,Object.assign({resourceOptions:r},t),!1),s=i.baseTexture.resource;return i.baseTexture.valid?Promise.resolve(i):s.load().then(()=>Promise.resolve(i))}static fromBuffer(e,t,r,i){return new sh(r4.fromBuffer(e,t,r,i))}static fromLoader(e,t,r,i){let s=new r4(e,Object.assign({scaleMode:r4.defaultOptions.scaleMode,resolution:rz(t)},i)),{resource:n}=s;n instanceof ss&&(n.url=t);let o=new sh(s);return r||(r=t),r4.addToCache(o.baseTexture,r),sh.addToCache(o,r),r!==t&&(r4.addToCache(o.baseTexture,t),sh.addToCache(o,t)),o.baseTexture.valid?Promise.resolve(o):new Promise(e=>{o.baseTexture.once("loaded",()=>e(o))})}static addToCache(e,t){t&&(e.textureCacheIds.includes(t)||e.textureCacheIds.push(t),rD[t]&&rD[t]!==e&&console.warn(`Texture added to the cache with an id [${t}] that already had an entry`),rD[t]=e)}static removeFromCache(e){if("string"==typeof e){let t=rD[e];if(t){let r=t.textureCacheIds.indexOf(e);return r>-1&&t.textureCacheIds.splice(r,1),delete rD[e],t}}else if(e?.textureCacheIds){for(let t=0;t<e.textureCacheIds.length;++t)rD[e.textureCacheIds[t]]===e&&delete rD[e.textureCacheIds[t]];return e.textureCacheIds.length=0,e}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(e){this._frame=e,this.noFrame=!1;let{x:t,y:r,width:i,height:s}=e,n=t+i>this.baseTexture.width,o=r+s>this.baseTexture.height;if(n||o){let e=`X: ${t} + ${i} = ${t+i} > ${this.baseTexture.width}`,a=`Y: ${r} + ${s} = ${r+s} > ${this.baseTexture.height}`;throw Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${e} ${n&&o?"and":"or"} ${a}`)}this.valid=i&&s&&this.baseTexture.valid,this.trim||this.rotate||(this.orig=e),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(e){this._rotate=e,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return sh._EMPTY||(sh._EMPTY=new sh(new r4),sa(sh._EMPTY),sa(sh._EMPTY.baseTexture)),sh._EMPTY}static get WHITE(){if(!sh._WHITE){let e=eJ.ADAPTER.createCanvas(16,16),t=e.getContext("2d");e.width=16,e.height=16,t.fillStyle="white",t.fillRect(0,0,16,16),sh._WHITE=new sh(r4.from(e)),sa(sh._WHITE),sa(sh._WHITE.baseTexture)}return sh._WHITE}}class sl extends sh{constructor(e,t){super(e,t),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(e){this.framebuffer.multisample=e}resize(e,t,r=!0){let i=this.baseTexture.resolution,s=Math.round(e*i)/i,n=Math.round(t*i)/i;this.valid=s>0&&n>0,this._frame.width=this.orig.width=s,this._frame.height=this.orig.height=n,r&&this.baseTexture.resize(s,n),this.updateUvs()}setResolution(e){let{baseTexture:t}=this;t.resolution!==e&&(t.setResolution(e),this.resize(t.width,t.height,!1))}static create(e){return new sl(new sr(e))}}class su{constructor(e){this.texturePool={},this.textureOptions=e||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(e,t,r=eq.NONE){return new sl(new sr(Object.assign({width:e,height:t,resolution:1,multisample:r},this.textureOptions)))}getOptimalTexture(e,t,r=1,i=eq.NONE){let s;e=Math.max(Math.ceil(e*r-1e-6),1),t=Math.max(Math.ceil(t*r-1e-6),1),this.enableFullScreen&&e===this._pixelsWidth&&t===this._pixelsHeight?s=i>1?-i:-1:(e=rT(e),t=rT(t),s=((65535&e)<<16|65535&t)>>>0,i>1&&(s+=4294967296*i)),this.texturePool[s]||(this.texturePool[s]=[]);let n=this.texturePool[s].pop();return n||(n=this.createTexture(e,t,i)),n.filterPoolKey=s,n.setResolution(r),n}getFilterTexture(e,t,r){let i=this.getOptimalTexture(e.width,e.height,t||e.resolution,r||eq.NONE);return i.filterFrame=e.filterFrame,i}returnTexture(e){let t=e.filterPoolKey;e.filterFrame=null,this.texturePool[t].push(e)}returnFilterTexture(e){this.returnTexture(e)}clear(e){if(e=!1!==e)for(let e in this.texturePool){let t=this.texturePool[e];if(t)for(let e=0;e<t.length;e++)t[e].destroy(!0)}this.texturePool={}}setScreenSize(e){if(!(e.width===this._pixelsWidth&&e.height===this._pixelsHeight)){for(let t in this.enableFullScreen=e.width>0&&e.height>0,this.texturePool){if(!(0>Number(t)))continue;let e=this.texturePool[t];if(e)for(let t=0;t<e.length;t++)e[t].destroy(!0);this.texturePool[t]=[]}this._pixelsWidth=e.width,this._pixelsHeight=e.height}}}su.SCREEN_KEY=-1;class sc extends ii{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}}class sd extends ii{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new r8(this.vertices),this.uvBuffer=new r8(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(e,t){let r=0,i=0;return this.uvs[0]=r,this.uvs[1]=i,this.uvs[2]=r+t.width/e.width,this.uvs[3]=i,this.uvs[4]=r+t.width/e.width,this.uvs[5]=i+t.height/e.height,this.uvs[6]=r,this.uvs[7]=i+t.height/e.height,r=t.x,i=t.y,this.vertices[0]=r,this.vertices[1]=i,this.vertices[2]=r+t.width,this.vertices[3]=i,this.vertices[4]=r+t.width,this.vertices[5]=i+t.height,this.vertices[6]=r,this.vertices[7]=i+t.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}class sp{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=eq.NONE,this.sourceFrame=new id,this.destinationFrame=new id,this.bindingSourceFrame=new id,this.bindingDestinationFrame=new id,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const sf=[new iu,new iu,new iu,new iu],sm=new i_;class sg{constructor(e){this.renderer=e,this.defaultFilterStack=[{}],this.texturePool=new su,this.statePool=[],this.quad=new sc,this.quadUv=new sd,this.tempRect=new id,this.activeState={},this.globalUniforms=new iq({outputFrame:new id,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(e,t){let r,i;let s=this.renderer,n=this.defaultFilterStack,o=this.statePool.pop()||new sp,a=s.renderTexture;if(a.current){let e=a.current;r=e.resolution,i=e.multisample}else r=s.resolution,i=s.multisample;let h=t[0].resolution||r,l=t[0].multisample??i,u=t[0].padding,c=t[0].autoFit,d=t[0].legacy??!0;for(let e=1;e<t.length;e++){let s=t[e];h=Math.min(h,s.resolution||r),l=Math.min(l,s.multisample??i),u=this.useMaxPadding?Math.max(u,s.padding):u+s.padding,c=c&&s.autoFit,d=d||(s.legacy??!0)}1===n.length&&(this.defaultFilterStack[0].renderTexture=a.current),n.push(o),o.resolution=h,o.multisample=l,o.legacy=d,o.target=e,o.sourceFrame.copyFrom(e.filterArea||e.getBounds(!0)),o.sourceFrame.pad(u);let p=this.tempRect.copyFrom(a.sourceFrame);s.projection.transform&&this.transformAABB(sm.copyFrom(s.projection.transform).invert(),p),c?(o.sourceFrame.fit(p),(o.sourceFrame.width<=0||o.sourceFrame.height<=0)&&(o.sourceFrame.width=0,o.sourceFrame.height=0)):o.sourceFrame.intersects(p)||(o.sourceFrame.width=0,o.sourceFrame.height=0),this.roundFrame(o.sourceFrame,a.current?a.current.resolution:s.resolution,a.sourceFrame,a.destinationFrame,s.projection.transform),o.renderTexture=this.getOptimalFilterTexture(o.sourceFrame.width,o.sourceFrame.height,h,l),o.filters=t,o.destinationFrame.width=o.renderTexture.width,o.destinationFrame.height=o.renderTexture.height;let f=this.tempRect;f.x=0,f.y=0,f.width=o.sourceFrame.width,f.height=o.sourceFrame.height,o.renderTexture.filterFrame=o.sourceFrame,o.bindingSourceFrame.copyFrom(a.sourceFrame),o.bindingDestinationFrame.copyFrom(a.destinationFrame),o.transform=s.projection.transform,s.projection.transform=null,a.bind(o.renderTexture,o.sourceFrame,f),s.framebuffer.clear(0,0,0,0)}pop(){let e=this.defaultFilterStack,t=e.pop(),r=t.filters;this.activeState=t;let i=this.globalUniforms.uniforms;i.outputFrame=t.sourceFrame,i.resolution=t.resolution;let s=i.inputSize,n=i.inputPixel,o=i.inputClamp;if(s[0]=t.destinationFrame.width,s[1]=t.destinationFrame.height,s[2]=1/s[0],s[3]=1/s[1],n[0]=Math.round(s[0]*t.resolution),n[1]=Math.round(s[1]*t.resolution),n[2]=1/n[0],n[3]=1/n[1],o[0]=.5*n[2],o[1]=.5*n[3],o[2]=t.sourceFrame.width*s[2]-.5*n[2],o[3]=t.sourceFrame.height*s[3]-.5*n[3],t.legacy){let e=i.filterArea;e[0]=t.destinationFrame.width,e[1]=t.destinationFrame.height,e[2]=t.sourceFrame.x,e[3]=t.sourceFrame.y,i.filterClamp=i.inputClamp}this.globalUniforms.update();let a=e[e.length-1];if(this.renderer.framebuffer.blit(),1===r.length)r[0].apply(this,t.renderTexture,a.renderTexture,eV.BLEND,t),this.returnFilterTexture(t.renderTexture);else{let e=t.renderTexture,i=this.getOptimalFilterTexture(e.width,e.height,t.resolution);i.filterFrame=e.filterFrame;let s=0;for(s=0;s<r.length-1;++s){1===s&&t.multisample>1&&((i=this.getOptimalFilterTexture(e.width,e.height,t.resolution)).filterFrame=e.filterFrame),r[s].apply(this,e,i,eV.CLEAR,t);let n=e;e=i,i=n}r[s].apply(this,e,a.renderTexture,eV.BLEND,t),s>1&&t.multisample>1&&this.returnFilterTexture(t.renderTexture),this.returnFilterTexture(e),this.returnFilterTexture(i)}t.clear(),this.statePool.push(t)}bindAndClear(e,t=eV.CLEAR){let{renderTexture:r,state:i}=this.renderer;if(e===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,e?.filterFrame){let t=this.tempRect;t.x=0,t.y=0,t.width=e.filterFrame.width,t.height=e.filterFrame.height,r.bind(e,e.filterFrame,t)}else e!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?r.bind(e):this.renderer.renderTexture.bind(e,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);let s=1&i.stateId||this.forceClear;(t===eV.CLEAR||t===eV.BLIT&&s)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(e,t,r,i){let s=this.renderer;s.state.set(e.state),this.bindAndClear(r,i),e.uniforms.uSampler=t,e.uniforms.filterGlobals=this.globalUniforms,s.shader.bind(e),e.legacy=!!e.program.attributeData.aTextureCoord,e.legacy?(this.quadUv.map(t._frame,t.filterFrame),s.geometry.bind(this.quadUv),s.geometry.draw(eB.TRIANGLES)):(s.geometry.bind(this.quad),s.geometry.draw(eB.TRIANGLE_STRIP))}calculateSpriteMatrix(e,t){let{sourceFrame:r,destinationFrame:i}=this.activeState,{orig:s}=t._texture,n=e.set(i.width,0,0,i.height,r.x,r.y),o=t.worldTransform.copyTo(i_.TEMP_MATRIX);return o.invert(),n.prepend(o),n.scale(1/s.width,1/s.height),n.translate(t.anchor.x,t.anchor.y),n}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(e,t,r=1,i=eq.NONE){return this.texturePool.getOptimalTexture(e,t,r,i)}getFilterTexture(e,t,r){if("number"==typeof e){let r=e;e=t,t=r}e=e||this.activeState.renderTexture;let i=this.texturePool.getOptimalTexture(e.width,e.height,t||e.resolution,r||eq.NONE);return i.filterFrame=e.filterFrame,i}returnFilterTexture(e){this.texturePool.returnTexture(e)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(e,t){let r=sf[0],i=sf[1],s=sf[2],n=sf[3];r.set(t.left,t.top),i.set(t.left,t.bottom),s.set(t.right,t.top),n.set(t.right,t.bottom),e.apply(r,r),e.apply(i,i),e.apply(s,s),e.apply(n,n);let o=Math.min(r.x,i.x,s.x,n.x),a=Math.min(r.y,i.y,s.y,n.y),h=Math.max(r.x,i.x,s.x,n.x),l=Math.max(r.y,i.y,s.y,n.y);t.x=o,t.y=a,t.width=h-o,t.height=l-a}roundFrame(e,t,r,i,s){if(!(e.width<=0||e.height<=0||r.width<=0||r.height<=0)){if(s){let{a:e,b:t,c:r,d:i}=s;if((Math.abs(t)>1e-4||Math.abs(r)>1e-4)&&(Math.abs(e)>1e-4||Math.abs(i)>1e-4))return}(s=s?sm.copyFrom(s):sm.identity()).translate(-r.x,-r.y).scale(i.width/r.width,i.height/r.height).translate(i.x,i.y),this.transformAABB(s,e),e.ceil(t),this.transformAABB(s.invert(),e)}}}sg.extension={type:rV.RendererSystem,name:"filter"},r$.add(sg);class sy{constructor(e){this.framebuffer=e,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=eq.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const s_=new id;class sv{constructor(e){this.renderer=e,this.managedFramebuffers=[],this.unknownFramebuffer=new st(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);let e=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new id,this.hasMRT=!0,this.writeDepthTexture=!0,1===this.renderer.context.webGLVersion){let t=this.renderer.context.extensions.drawBuffers,r=this.renderer.context.extensions.depthTexture;eJ.PREFER_ENV===eM.WEBGL_LEGACY&&(t=null,r=null),t?e.drawBuffers=e=>t.drawBuffersWEBGL(e):(this.hasMRT=!1,e.drawBuffers=()=>{}),r||(this.writeDepthTexture=!1)}else this.msaaSamples=e.getInternalformatParameter(e.RENDERBUFFER,e.RGBA8,e.SAMPLES)}bind(e,t,r=0){let{gl:i}=this;if(e){let s=e.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(e);this.current!==e&&(this.current=e,i.bindFramebuffer(i.FRAMEBUFFER,s.framebuffer)),s.mipLevel!==r&&(e.dirtyId++,e.dirtyFormat++,s.mipLevel=r),s.dirtyId!==e.dirtyId&&(s.dirtyId=e.dirtyId,s.dirtyFormat!==e.dirtyFormat?(s.dirtyFormat=e.dirtyFormat,s.dirtySize=e.dirtySize,this.updateFramebuffer(e,r)):s.dirtySize!==e.dirtySize&&(s.dirtySize=e.dirtySize,this.resizeFramebuffer(e)));for(let t=0;t<e.colorTextures.length;t++){let r=e.colorTextures[t];this.renderer.texture.unbind(r.parentTextureArray||r)}if(e.depthTexture&&this.renderer.texture.unbind(e.depthTexture),t){let e=t.width>>r,i=t.height>>r,s=e/t.width;this.setViewport(t.x*s,t.y*s,e,i)}else{let t=e.width>>r,i=e.height>>r;this.setViewport(0,0,t,i)}}else this.current&&(this.current=null,i.bindFramebuffer(i.FRAMEBUFFER,null)),t?this.setViewport(t.x,t.y,t.width,t.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(e,t,r,i){let s=this.viewport;e=Math.round(e),t=Math.round(t),r=Math.round(r),i=Math.round(i),(s.width!==r||s.height!==i||s.x!==e||s.y!==t)&&(s.x=e,s.y=t,s.width=r,s.height=i,this.gl.viewport(e,t,r,i))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(e,t,r,i,s=ek.COLOR|ek.DEPTH){let{gl:n}=this;n.clearColor(e,t,r,i),n.clear(s)}initFramebuffer(e){let{gl:t}=this,r=new sy(t.createFramebuffer());return r.multisample=this.detectSamples(e.multisample),e.glFramebuffers[this.CONTEXT_UID]=r,this.managedFramebuffers.push(e),e.disposeRunner.add(this),r}resizeFramebuffer(e){let{gl:t}=this,r=e.glFramebuffers[this.CONTEXT_UID];if(r.stencil){let i;t.bindRenderbuffer(t.RENDERBUFFER,r.stencil),i=1===this.renderer.context.webGLVersion?t.DEPTH_STENCIL:e.depth&&e.stencil?t.DEPTH24_STENCIL8:e.depth?t.DEPTH_COMPONENT24:t.STENCIL_INDEX8,r.msaaBuffer?t.renderbufferStorageMultisample(t.RENDERBUFFER,r.multisample,i,e.width,e.height):t.renderbufferStorage(t.RENDERBUFFER,i,e.width,e.height)}let i=e.colorTextures,s=i.length;t.drawBuffers||(s=Math.min(s,1));for(let n=0;n<s;n++){let s=i[n],o=s.parentTextureArray||s;this.renderer.texture.bind(o,0),0===n&&r.msaaBuffer&&(t.bindRenderbuffer(t.RENDERBUFFER,r.msaaBuffer),t.renderbufferStorageMultisample(t.RENDERBUFFER,r.multisample,o._glTextures[this.CONTEXT_UID].internalFormat,e.width,e.height))}e.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(e.depthTexture,0)}updateFramebuffer(e,t){let{gl:r}=this,i=e.glFramebuffers[this.CONTEXT_UID],s=e.colorTextures,n=s.length;r.drawBuffers||(n=Math.min(n,1)),i.multisample>1&&this.canMultisampleFramebuffer(e)?i.msaaBuffer=i.msaaBuffer||r.createRenderbuffer():i.msaaBuffer&&(r.deleteRenderbuffer(i.msaaBuffer),i.msaaBuffer=null,i.blitFramebuffer&&(i.blitFramebuffer.dispose(),i.blitFramebuffer=null));let o=[];for(let a=0;a<n;a++){let n=s[a],h=n.parentTextureArray||n;this.renderer.texture.bind(h,0),0===a&&i.msaaBuffer?(r.bindRenderbuffer(r.RENDERBUFFER,i.msaaBuffer),r.renderbufferStorageMultisample(r.RENDERBUFFER,i.multisample,h._glTextures[this.CONTEXT_UID].internalFormat,e.width,e.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,i.msaaBuffer)):(r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+a,n.target,h._glTextures[this.CONTEXT_UID].texture,t),o.push(r.COLOR_ATTACHMENT0+a))}if(o.length>1&&r.drawBuffers(o),e.depthTexture&&this.writeDepthTexture){let i=e.depthTexture;this.renderer.texture.bind(i,0),r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,i._glTextures[this.CONTEXT_UID].texture,t)}if((e.stencil||e.depth)&&!(e.depthTexture&&this.writeDepthTexture)){let t,s;i.stencil=i.stencil||r.createRenderbuffer(),1===this.renderer.context.webGLVersion?(t=r.DEPTH_STENCIL_ATTACHMENT,s=r.DEPTH_STENCIL):e.depth&&e.stencil?(t=r.DEPTH_STENCIL_ATTACHMENT,s=r.DEPTH24_STENCIL8):e.depth?(t=r.DEPTH_ATTACHMENT,s=r.DEPTH_COMPONENT24):(t=r.STENCIL_ATTACHMENT,s=r.STENCIL_INDEX8),r.bindRenderbuffer(r.RENDERBUFFER,i.stencil),i.msaaBuffer?r.renderbufferStorageMultisample(r.RENDERBUFFER,i.multisample,s,e.width,e.height):r.renderbufferStorage(r.RENDERBUFFER,s,e.width,e.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,t,r.RENDERBUFFER,i.stencil)}else i.stencil&&(r.deleteRenderbuffer(i.stencil),i.stencil=null)}canMultisampleFramebuffer(e){return 1!==this.renderer.context.webGLVersion&&e.colorTextures.length<=1&&!e.depthTexture}detectSamples(e){let{msaaSamples:t}=this,r=eq.NONE;if(e<=1||null===t)return r;for(let i=0;i<t.length;i++)if(t[i]<=e){r=t[i];break}return 1===r&&(r=eq.NONE),r}blit(e,t,r){let{current:i,renderer:s,gl:n,CONTEXT_UID:o}=this;if(2!==s.context.webGLVersion||!i)return;let a=i.glFramebuffers[o];if(!a)return;if(!e){if(!a.msaaBuffer)return;let t=i.colorTextures[0];if(!t)return;a.blitFramebuffer||(a.blitFramebuffer=new st(i.width,i.height),a.blitFramebuffer.addColorTexture(0,t)),(e=a.blitFramebuffer).colorTextures[0]!==t&&(e.colorTextures[0]=t,e.dirtyId++,e.dirtyFormat++),(e.width!==i.width||e.height!==i.height)&&(e.width=i.width,e.height=i.height,e.dirtyId++,e.dirtySize++)}t||((t=s_).width=i.width,t.height=i.height),r||(r=t);let h=t.width===r.width&&t.height===r.height;this.bind(e),n.bindFramebuffer(n.READ_FRAMEBUFFER,a.framebuffer),n.blitFramebuffer(t.left,t.top,t.right,t.bottom,r.left,r.top,r.right,r.bottom,n.COLOR_BUFFER_BIT,h?n.NEAREST:n.LINEAR),n.bindFramebuffer(n.READ_FRAMEBUFFER,e.glFramebuffers[this.CONTEXT_UID].framebuffer)}disposeFramebuffer(e,t){let r=e.glFramebuffers[this.CONTEXT_UID],i=this.gl;if(!r)return;delete e.glFramebuffers[this.CONTEXT_UID];let s=this.managedFramebuffers.indexOf(e);s>=0&&this.managedFramebuffers.splice(s,1),e.disposeRunner.remove(this),t||(i.deleteFramebuffer(r.framebuffer),r.msaaBuffer&&i.deleteRenderbuffer(r.msaaBuffer),r.stencil&&i.deleteRenderbuffer(r.stencil)),r.blitFramebuffer&&this.disposeFramebuffer(r.blitFramebuffer,t)}disposeAll(e){let t=this.managedFramebuffers;this.managedFramebuffers=[];for(let r=0;r<t.length;r++)this.disposeFramebuffer(t[r],e)}forceStencil(){let e,t;let r=this.current;if(!r)return;let i=r.glFramebuffers[this.CONTEXT_UID];if(!i||i.stencil&&r.stencil)return;r.stencil=!0;let s=r.width,n=r.height,o=this.gl,a=i.stencil=o.createRenderbuffer();o.bindRenderbuffer(o.RENDERBUFFER,a),1===this.renderer.context.webGLVersion?(e=o.DEPTH_STENCIL_ATTACHMENT,t=o.DEPTH_STENCIL):r.depth?(e=o.DEPTH_STENCIL_ATTACHMENT,t=o.DEPTH24_STENCIL8):(e=o.STENCIL_ATTACHMENT,t=o.STENCIL_INDEX8),i.msaaBuffer?o.renderbufferStorageMultisample(o.RENDERBUFFER,i.multisample,t,s,n):o.renderbufferStorage(o.RENDERBUFFER,t,s,n),o.framebufferRenderbuffer(o.FRAMEBUFFER,e,o.RENDERBUFFER,a)}reset(){this.current=this.unknownFramebuffer,this.viewport=new id}destroy(){this.renderer=null}}sv.extension={type:rV.RendererSystem,name:"framebuffer"},r$.add(sv);const sb={5126:4,5123:2,5121:1};class sx{constructor(e){this.renderer=e,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);let e=this.gl=this.renderer.gl,t=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,2!==t.webGLVersion){let t=this.renderer.context.extensions.vertexArrayObject;eJ.PREFER_ENV===eM.WEBGL_LEGACY&&(t=null),t?(e.createVertexArray=()=>t.createVertexArrayOES(),e.bindVertexArray=e=>t.bindVertexArrayOES(e),e.deleteVertexArray=e=>t.deleteVertexArrayOES(e)):(this.hasVao=!1,e.createVertexArray=()=>null,e.bindVertexArray=()=>null,e.deleteVertexArray=()=>null)}if(2!==t.webGLVersion){let t=e.getExtension("ANGLE_instanced_arrays");t?(e.vertexAttribDivisor=(e,r)=>t.vertexAttribDivisorANGLE(e,r),e.drawElementsInstanced=(e,r,i,s,n)=>t.drawElementsInstancedANGLE(e,r,i,s,n),e.drawArraysInstanced=(e,r,i,s)=>t.drawArraysInstancedANGLE(e,r,i,s)):this.hasInstance=!1}this.canUseUInt32ElementIndex=2===t.webGLVersion||!!t.extensions.uint32ElementIndex}bind(e,t){t=t||this.renderer.shader.shader;let{gl:r}=this,i=e.glVertexArrayObjects[this.CONTEXT_UID],s=!1;i||(this.managedGeometries[e.id]=e,e.disposeRunner.add(this),e.glVertexArrayObjects[this.CONTEXT_UID]=i={},s=!0);let n=i[t.program.id]||this.initGeometryVao(e,t,s);this._activeGeometry=e,this._activeVao!==n&&(this._activeVao=n,this.hasVao?r.bindVertexArray(n):this.activateVao(e,t.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){let e=this._activeGeometry,t=this.renderer.buffer;for(let r=0;r<e.buffers.length;r++){let i=e.buffers[r];t.update(i)}}checkCompatibility(e,t){let r=e.attributes,i=t.attributeData;for(let e in i)if(!r[e])throw Error(`shader and geometry incompatible, geometry missing the "${e}" attribute`)}getSignature(e,t){let r=e.attributes,i=t.attributeData,s=["g",e.id];for(let e in r)i[e]&&s.push(e,i[e].location);return s.join("-")}initGeometryVao(e,t,r=!0){let i=this.gl,s=this.CONTEXT_UID,n=this.renderer.buffer,o=t.program;o.glPrograms[s]||this.renderer.shader.generateProgram(t),this.checkCompatibility(e,o);let a=this.getSignature(e,o),h=e.glVertexArrayObjects[this.CONTEXT_UID],l=h[a];if(l)return h[o.id]=l,l;let u=e.buffers,c=e.attributes,d={},p={};for(let e in u)d[e]=0,p[e]=0;for(let e in c)!c[e].size&&o.attributeData[e]?c[e].size=o.attributeData[e].size:c[e].size||console.warn(`PIXI Geometry attribute '${e}' size cannot be determined (likely the bound shader does not have the attribute)`),d[c[e].buffer]+=c[e].size*sb[c[e].type];for(let e in c){let t=c[e],r=t.size;void 0===t.stride&&(d[t.buffer]===r*sb[t.type]?t.stride=0:t.stride=d[t.buffer]),void 0===t.start&&(t.start=p[t.buffer],p[t.buffer]+=r*sb[t.type])}l=i.createVertexArray(),i.bindVertexArray(l);for(let e=0;e<u.length;e++){let t=u[e];n.bind(t),r&&t._glBuffers[s].refCount++}return this.activateVao(e,o),h[o.id]=l,h[a]=l,i.bindVertexArray(null),n.unbind(eK.ARRAY_BUFFER),l}disposeGeometry(e,t){if(!this.managedGeometries[e.id])return;delete this.managedGeometries[e.id];let r=e.glVertexArrayObjects[this.CONTEXT_UID],i=this.gl,s=e.buffers,n=this.renderer?.buffer;if(e.disposeRunner.remove(this),r){if(n)for(let e=0;e<s.length;e++){let r=s[e]._glBuffers[this.CONTEXT_UID];r&&(r.refCount--,0!==r.refCount||t||n.dispose(s[e],t))}if(!t){for(let e in r)if("g"===e[0]){let t=r[e];this._activeVao===t&&this.unbind(),i.deleteVertexArray(t)}}delete e.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(e){let t=Object.keys(this.managedGeometries);for(let r=0;r<t.length;r++)this.disposeGeometry(this.managedGeometries[t[r]],e)}activateVao(e,t){let r=this.gl,i=this.CONTEXT_UID,s=this.renderer.buffer,n=e.buffers,o=e.attributes;e.indexBuffer&&s.bind(e.indexBuffer);let a=null;for(let e in o){let h=o[e],l=n[h.buffer],u=l._glBuffers[i];if(t.attributeData[e]){a!==u&&(s.bind(l),a=u);let i=t.attributeData[e].location;if(r.enableVertexAttribArray(i),r.vertexAttribPointer(i,h.size,h.type||r.FLOAT,h.normalized,h.stride,h.start),h.instance){if(this.hasInstance)r.vertexAttribDivisor(i,h.divisor);else throw Error("geometry error, GPU Instancing is not supported on this device")}}}}draw(e,t,r,i){let{gl:s}=this,n=this._activeGeometry;if(n.indexBuffer){let o=n.indexBuffer.data.BYTES_PER_ELEMENT,a=2===o?s.UNSIGNED_SHORT:s.UNSIGNED_INT;2===o||4===o&&this.canUseUInt32ElementIndex?n.instanced?s.drawElementsInstanced(e,t||n.indexBuffer.data.length,a,(r||0)*o,i||1):s.drawElements(e,t||n.indexBuffer.data.length,a,(r||0)*o):console.warn("unsupported index buffer type: uint32")}else n.instanced?s.drawArraysInstanced(e,r,t||n.getSize(),i||1):s.drawArrays(e,r,t||n.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}sx.extension={type:rV.RendererSystem,name:"geometry"},r$.add(sx);const sT=new i_;class sE{constructor(e,t){this._texture=e,this.mapCoord=new i_,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof t>"u"?.5:t,this.isSimple=!1}get texture(){return this._texture}set texture(e){this._texture=e,this._textureID=-1}multiplyUvs(e,t){void 0===t&&(t=e);let r=this.mapCoord;for(let i=0;i<e.length;i+=2){let s=e[i],n=e[i+1];t[i]=s*r.a+n*r.c+r.tx,t[i+1]=s*r.b+n*r.d+r.ty}return t}update(e){let t=this._texture;if(!t||!t.valid||!e&&this._textureID===t._updateID)return!1;this._textureID=t._updateID,this._updateID++;let r=t._uvs;this.mapCoord.set(r.x1-r.x0,r.y1-r.y0,r.x3-r.x0,r.y3-r.y0,r.x0,r.y0);let i=t.orig,s=t.trim;s&&(sT.set(i.width/s.width,0,0,i.height/s.height,-s.x/s.width,-s.y/s.height),this.mapCoord.append(sT));let n=t.baseTexture,o=this.uClampFrame,a=this.clampMargin/n.resolution,h=this.clampOffset;return o[0]=(t._frame.x+a+h)/n.width,o[1]=(t._frame.y+a+h)/n.height,o[2]=(t._frame.x+t._frame.width-a+h)/n.width,o[3]=(t._frame.y+t._frame.height-a+h)/n.height,this.uClampOffset[0]=h/n.realWidth,this.uClampOffset[1]=h/n.realHeight,this.isSimple=t._frame.width===n.width&&t._frame.height===n.height&&0===t.rotate,!0}}var sw=`varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`,sA=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`;class sS extends i5{constructor(e,t,r){let i=null;"string"!=typeof e&&void 0===t&&void 0===r&&(i=e,e=void 0,t=void 0,r=void 0),super(e||sA,t||sw,r),this.maskSprite=i,this.maskMatrix=new i_}get maskSprite(){return this._maskSprite}set maskSprite(e){this._maskSprite=e,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(e,t,r,i){let s=this._maskSprite,n=s._texture;n.valid&&(n.uvMatrix||(n.uvMatrix=new sE(n,0)),n.uvMatrix.update(),this.uniforms.npmAlpha=n.baseTexture.alphaMode?0:1,this.uniforms.mask=n,this.uniforms.otherMatrix=e.calculateSpriteMatrix(this.maskMatrix,s).prepend(n.uvMatrix.mapCoord),this.uniforms.alpha=s.worldAlpha,this.uniforms.maskClamp=n.uvMatrix.uClampFrame,e.applyFilter(this,t,r,i))}}class sC{constructor(e=null){this.type=e$.NONE,this.autoDetect=!0,this.maskObject=e||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=i5.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(e){e?this._filters?this._filters[0]=e:this._filters=[e]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=e$.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(e){e?(this._stencilCounter=e._stencilCounter,this._scissorCounter=e._scissorCounter,this._scissorRect=e._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}class sR{constructor(e){this.renderer=e,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(e){this.maskStack=e,this.renderer.scissor.setMaskStack(e),this.renderer.stencil.setMaskStack(e)}push(e,t){let r=t;if(!r.isMaskData){let e=this.maskDataPool.pop()||new sC;e.pooled=!0,e.maskObject=t,r=e}let i=0!==this.maskStack.length?this.maskStack[this.maskStack.length-1]:null;if(r.copyCountersOrReset(i),r._colorMask=i?i._colorMask:15,r.autoDetect&&this.detect(r),r._target=e,r.type!==e$.SPRITE&&this.maskStack.push(r),r.enabled)switch(r.type){case e$.SCISSOR:this.renderer.scissor.push(r);break;case e$.STENCIL:this.renderer.stencil.push(r);break;case e$.SPRITE:r.copyCountersOrReset(null),this.pushSpriteMask(r);break;case e$.COLOR:this.pushColorMask(r)}r.type===e$.SPRITE&&this.maskStack.push(r)}pop(e){let t=this.maskStack.pop();if(!(!t||t._target!==e)){if(t.enabled)switch(t.type){case e$.SCISSOR:this.renderer.scissor.pop(t);break;case e$.STENCIL:this.renderer.stencil.pop(t.maskObject);break;case e$.SPRITE:this.popSpriteMask(t);break;case e$.COLOR:this.popColorMask(t)}if(t.reset(),t.pooled&&this.maskDataPool.push(t),0!==this.maskStack.length){let e=this.maskStack[this.maskStack.length-1];e.type===e$.SPRITE&&e._filters&&(e._filters[0].maskSprite=e.maskObject)}}}detect(e){let t=e.maskObject;t?t.isSprite?e.type=e$.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(e)?e.type=e$.SCISSOR:e.type=e$.STENCIL:e.type=e$.COLOR}pushSpriteMask(e){let{maskObject:t}=e,r=e._target,i=e._filters;i||(i=this.alphaMaskPool[this.alphaMaskIndex])||(i=this.alphaMaskPool[this.alphaMaskIndex]=[new sS]),i[0].resolution=e.resolution,i[0].multisample=e.multisample,i[0].maskSprite=t;let s=r.filterArea;r.filterArea=t.getBounds(!0),this.renderer.filter.push(r,i),r.filterArea=s,e._filters||this.alphaMaskIndex++}popSpriteMask(e){this.renderer.filter.pop(),e._filters?e._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(e){let t=e._colorMask,r=e._colorMask=t&e.colorMask;r!==t&&this.renderer.gl.colorMask((1&r)!=0,(2&r)!=0,(4&r)!=0,(8&r)!=0)}popColorMask(e){let t=e._colorMask,r=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;r!==t&&this.renderer.gl.colorMask((1&r)!=0,(2&r)!=0,(4&r)!=0,(8&r)!=0)}destroy(){this.renderer=null}}sR.extension={type:rV.RendererSystem,name:"mask"},r$.add(sR);class sI{constructor(e){this.renderer=e,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(e){let{gl:t}=this.renderer,r=this.getStackLength();this.maskStack=e;let i=this.getStackLength();i!==r&&(0===i?t.disable(this.glConst):(t.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const sP=new i_,sM=[],sD=class e extends sI{constructor(e){super(e),this.glConst=eJ.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){let e=this.maskStack[this.maskStack.length-1];return e?e._scissorCounter:0}calcScissorRect(e){if(e._scissorRectLocal)return;let t=e._scissorRect,{maskObject:r}=e,{renderer:i}=this,s=i.renderTexture,n=r.getBounds(!0,sM.pop()??new id);this.roundFrameToPixels(n,s.current?s.current.resolution:i.resolution,s.sourceFrame,s.destinationFrame,i.projection.transform),t&&n.fit(t),e._scissorRectLocal=n}static isMatrixRotated(e){if(!e)return!1;let{a:t,b:r,c:i,d:s}=e;return(Math.abs(r)>1e-4||Math.abs(i)>1e-4)&&(Math.abs(t)>1e-4||Math.abs(s)>1e-4)}testScissor(t){let{maskObject:r}=t;if(!r.isFastRect||!r.isFastRect()||e.isMatrixRotated(r.worldTransform)||e.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(t);let i=t._scissorRectLocal;return i.width>0&&i.height>0}roundFrameToPixels(t,r,i,s,n){e.isMatrixRotated(n)||((n=n?sP.copyFrom(n):sP.identity()).translate(-i.x,-i.y).scale(s.width/i.width,s.height/i.height).translate(s.x,s.y),this.renderer.filter.transformAABB(n,t),t.fit(s),t.x=Math.round(t.x*r),t.y=Math.round(t.y*r),t.width=Math.round(t.width*r),t.height=Math.round(t.height*r))}push(e){e._scissorRectLocal||this.calcScissorRect(e);let{gl:t}=this.renderer;e._scissorRect||t.enable(t.SCISSOR_TEST),e._scissorCounter++,e._scissorRect=e._scissorRectLocal,this._useCurrent()}pop(e){let{gl:t}=this.renderer;e&&sM.push(e._scissorRectLocal),this.getStackLength()>0?this._useCurrent():t.disable(t.SCISSOR_TEST)}_useCurrent(){let e;let t=this.maskStack[this.maskStack.length-1]._scissorRect;e=this.renderer.renderTexture.current?t.y:this.renderer.height-t.height-t.y,this.renderer.gl.scissor(t.x,e,t.width,t.height)}};sD.extension={type:rV.RendererSystem,name:"scissor"},r$.add(sD);class sk extends sI{constructor(e){super(e),this.glConst=eJ.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){let e=this.maskStack[this.maskStack.length-1];return e?e._stencilCounter:0}push(e){let t=e.maskObject,{gl:r}=this.renderer,i=e._stencilCounter;0===i&&(this.renderer.framebuffer.forceStencil(),r.clearStencil(0),r.clear(r.STENCIL_BUFFER_BIT),r.enable(r.STENCIL_TEST)),e._stencilCounter++;let s=e._colorMask;0!==s&&(e._colorMask=0,r.colorMask(!1,!1,!1,!1)),r.stencilFunc(r.EQUAL,i,4294967295),r.stencilOp(r.KEEP,r.KEEP,r.INCR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,0!==s&&(e._colorMask=s,r.colorMask((1&s)!=0,(2&s)!=0,(4&s)!=0,(8&s)!=0)),this._useCurrent()}pop(e){let t=this.renderer.gl;if(0===this.getStackLength())t.disable(t.STENCIL_TEST);else{let r=0!==this.maskStack.length?this.maskStack[this.maskStack.length-1]:null,i=r?r._colorMask:15;0!==i&&(r._colorMask=0,t.colorMask(!1,!1,!1,!1)),t.stencilOp(t.KEEP,t.KEEP,t.DECR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,0!==i&&(r._colorMask=i,t.colorMask((1&i)!=0,(2&i)!=0,(4&i)!=0,(8&i)!=0)),this._useCurrent()}}_useCurrent(){let e=this.renderer.gl;e.stencilFunc(e.EQUAL,this.getStackLength(),4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP)}}sk.extension={type:rV.RendererSystem,name:"stencil"},r$.add(sk);class sO{constructor(e){this.renderer=e,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get:()=>(tB("7.0.0","renderer.plugins.extract has moved to renderer.extract"),e.extract)},prepare:{enumerable:!1,get:()=>(tB("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),e.prepare)},interaction:{enumerable:!1,get:()=>(tB("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),e.events)}})}init(){let e=this.rendererPlugins;for(let t in e)this.plugins[t]=new e[t](this.renderer)}destroy(){for(let e in this.plugins)this.plugins[e].destroy(),this.plugins[e]=null}}sO.extension={type:[rV.RendererSystem,rV.CanvasRendererSystem],name:"_plugin"},r$.add(sO);class sB{constructor(e){this.renderer=e,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new i_,this.transform=null}update(e,t,r,i){this.destinationFrame=e||this.destinationFrame||this.defaultFrame,this.sourceFrame=t||this.sourceFrame||e,this.calculateProjection(this.destinationFrame,this.sourceFrame,r,i),this.transform&&this.projectionMatrix.append(this.transform);let s=this.renderer;s.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,s.globalUniforms.update(),s.shader.shader&&s.shader.syncUniformGroup(s.shader.shader.uniforms.globals)}calculateProjection(e,t,r,i){let s=this.projectionMatrix,n=i?-1:1;s.identity(),s.a=1/t.width*2,s.d=1/t.height*2*n,s.tx=-1-t.x*s.a,s.ty=-n-t.y*s.d}setTransform(e){}destroy(){this.renderer=null}}sB.extension={type:rV.RendererSystem,name:"projection"},r$.add(sB);const sL=new iR,sF=new id;class sN{constructor(e){this.renderer=e,this._tempMatrix=new i_}generateTexture(e,t){let{region:r,...i}=t||{},s=r?.copyTo(sF)||e.getLocalBounds(sF,!0),n=i.resolution||this.renderer.resolution;s.width=Math.max(s.width,1/n),s.height=Math.max(s.height,1/n),i.width=s.width,i.height=s.height,i.resolution=n,i.multisample??(i.multisample=this.renderer.multisample);let o=sl.create(i);this._tempMatrix.tx=-s.x,this._tempMatrix.ty=-s.y;let a=e.transform;return e.transform=sL,this.renderer.render(e,{renderTexture:o,transform:this._tempMatrix,skipUpdateTransform:!!e.parent,blit:!0}),e.transform=a,o}destroy(){}}sN.extension={type:[rV.RendererSystem,rV.CanvasRendererSystem],name:"textureGenerator"},r$.add(sN);const sU=new id,sG=new id;class sj{constructor(e){this.renderer=e,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new id,this.destinationFrame=new id,this.viewportFrame=new id}contextChange(){let e=this.renderer?.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(e&&e.alpha&&e.premultipliedAlpha)}bind(e=null,t,r){let i,s,n;let o=this.renderer;this.current=e,e?(n=(i=e.baseTexture).resolution,t||(sU.width=e.frame.width,sU.height=e.frame.height,t=sU),r||(sG.x=e.frame.x,sG.y=e.frame.y,sG.width=t.width,sG.height=t.height,r=sG),s=i.framebuffer):(n=o.resolution,t||(sU.width=o._view.screen.width,sU.height=o._view.screen.height,t=sU),r||((r=sU).width=t.width,r.height=t.height));let a=this.viewportFrame;a.x=r.x*n,a.y=r.y*n,a.width=r.width*n,a.height=r.height*n,e||(a.y=o.view.height-(a.y+a.height)),a.ceil(),this.renderer.framebuffer.bind(s,a),this.renderer.projection.update(r,t,n,!s),e?this.renderer.mask.setMaskStack(i.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(t),this.destinationFrame.copyFrom(r)}clear(e,t){let r=this.current?this.current.baseTexture.clear:this.renderer.background.backgroundColor,i=ra.shared.setValue(e||r);(this.current&&this.current.baseTexture.alphaMode>0||!this.current&&this._rendererPremultipliedAlpha)&&i.premultiply(i.alpha);let s=this.destinationFrame,n=this.current?this.current.baseTexture:this.renderer._view.screen,o=s.width!==n.width||s.height!==n.height;if(o){let{x:e,y:t,width:r,height:i}=this.viewportFrame;e=Math.round(e),t=Math.round(t),r=Math.round(r),i=Math.round(i),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(e,t,r,i)}this.renderer.framebuffer.clear(i.red,i.green,i.blue,i.alpha,t),o&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}sj.extension={type:rV.RendererSystem,name:"renderTexture"},r$.add(sj);class sH{constructor(e,t){this.program=e,this.uniformData=t,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function sz(e,t,r,i,s){r.buffer.update(s)}const sV={float:`
        data[offset] = v;
    `,vec2:`
        data[offset] = v[0];
        data[offset+1] = v[1];
    `,vec3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

    `,vec4:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];
        data[offset+3] = v[3];
    `,mat2:`
        data[offset] = v[0];
        data[offset+1] = v[1];

        data[offset+4] = v[2];
        data[offset+5] = v[3];
    `,mat3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];

        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];
    `,mat4:`
        for(var i = 0; i < 16; i++)
        {
            data[offset + i] = v[i];
        }
    `},sX={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:32,mat3:48,mat4:64};let sW=0;const s$={textureCount:0,uboCount:0};class sY{constructor(e){this.destroyed=!1,this.renderer=e,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=sW++}systemCheck(){if(!function(){if("boolean"==typeof i)return i;try{i=!0===Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")}catch{i=!1}return i}())throw Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(e){this.gl=e,this.reset()}bind(e,t){e.disposeRunner.add(this),e.uniforms.globals=this.renderer.globalUniforms;let r=e.program,i=r.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(e);return this.shader=e,this.program!==r&&(this.program=r,this.gl.useProgram(i.program)),t||(s$.textureCount=0,s$.uboCount=0,this.syncUniformGroup(e.uniformGroup,s$)),i}setUniforms(e){let t=this.shader.program,r=t.glPrograms[this.renderer.CONTEXT_UID];t.syncUniforms(r.uniformData,e,this.renderer)}syncUniformGroup(e,t){let r=this.getGlProgram();e.static&&e.dirtyId===r.uniformDirtyGroups[e.id]||(r.uniformDirtyGroups[e.id]=e.dirtyId,this.syncUniforms(e,r,t))}syncUniforms(e,t,r){(e.syncUniforms[this.shader.program.id]||this.createSyncGroups(e))(t.uniformData,e.uniforms,this.renderer,r)}createSyncGroups(e){let t=this.getSignature(e,this.shader.program.uniformData,"u");return this.cache[t]||(this.cache[t]=function(e,t){let r=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `];for(let i in e.uniforms){let s=t[i];if(!s){e.uniforms[i]?.group===!0&&(e.uniforms[i].ubo?r.push(`
                        renderer.shader.syncUniformBufferGroup(uv.${i}, '${i}');
                    `):r.push(`
                        renderer.shader.syncUniformGroup(uv.${i}, syncData);
                    `));continue}let n=e.uniforms[i],o=!1;for(let e=0;e<iO.length;e++)if(iO[e].test(s,n)){r.push(iO[e].code(i,n)),o=!0;break}if(!o){let e=(1!==s.size||s.isArray?iL:iB)[s.type].replace("location",`ud["${i}"].location`);r.push(`
            cu = ud["${i}"];
            cv = cu.value;
            v = uv["${i}"];
            ${e};`)}}return Function("ud","uv","renderer","syncData",r.join(`
`))}(e,this.shader.program.uniformData)),e.syncUniforms[this.shader.program.id]=this.cache[t],e.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(e,t){let r=this.getGlProgram();if(!e.static||0!==e.dirtyId||!r.uniformGroups[e.id]){e.dirtyId=0;let i=r.uniformGroups[e.id]||this.createSyncBufferGroup(e,r,t);e.buffer.update(),i(r.uniformData,e.uniforms,this.renderer,s$,e.buffer)}this.renderer.buffer.bindBufferBase(e.buffer,r.uniformBufferBindings[t])}createSyncBufferGroup(e,t,r){let{gl:i}=this.renderer;this.renderer.buffer.bind(e.buffer);let s=this.gl.getUniformBlockIndex(t.program,r);t.uniformBufferBindings[r]=this.shader.uniformBindCount,i.uniformBlockBinding(t.program,s,this.shader.uniformBindCount),this.shader.uniformBindCount++;let n=this.getSignature(e,this.shader.program.uniformData,"ubo"),o=this._uboCache[n];if(o||(o=this._uboCache[n]=function(e,t){if(!e.autoManage)return{size:0,syncFunc:sz};let{uboElements:r,size:i}=function(e){let t=e.map(e=>({data:e,offset:0,dataLen:0,dirty:0})),r=0,i=0,s=0;for(let e=0;e<t.length;e++){let n=t[e];if(r=sX[n.data.type],n.data.size>1&&(r=Math.max(r,16)*n.data.size),n.dataLen=r,i%r!=0&&i<16){let e=i%r%16;i+=e,s+=e}i+r>16?(s=16*Math.ceil(s/16),n.offset=s,s+=r,i=r):(n.offset=s,i+=r,s+=r)}return{uboElements:t,size:s=16*Math.ceil(s/16)}}(function(e,t){let r=[];for(let i in e)t[i]&&r.push(t[i]);return r.sort((e,t)=>e.index-t.index),r}(e.uniforms,t)),s=[`
    var v = null;
    var v2 = null;
    var cv = null;
    var t = 0;
    var gl = renderer.gl
    var index = 0;
    var data = buffer.data;
    `];for(let t=0;t<r.length;t++){let i=r[t],n=e.uniforms[i.data.name],o=i.data.name,a=!1;for(let e=0;e<iO.length;e++){let t=iO[e];if(t.codeUbo&&t.test(i.data,n)){s.push(`offset = ${i.offset/4};`,iO[e].codeUbo(i.data.name,n)),a=!0;break}}if(!a){if(i.data.size>1){let e=iG[i.data.type],t=Math.max(sX[i.data.type]/16,1),r=e/t,n=(4-r%4)%4;s.push(`
                cv = ud.${o}.value;
                v = uv.${o};
                offset = ${i.offset/4};

                t = 0;

                for(var i=0; i < ${i.data.size*t}; i++)
                {
                    for(var j = 0; j < ${r}; j++)
                    {
                        data[offset++] = v[t++];
                    }
                    offset += ${n};
                }

                `)}else{let e=sV[i.data.type];s.push(`
                cv = ud.${o}.value;
                v = uv.${o};
                offset = ${i.offset/4};
                ${e};
                `)}}}return s.push(`
       renderer.buffer.update(buffer);
    `),{size:i,syncFunc:Function("ud","uv","renderer","syncData","buffer",s.join(`
`))}}(e,this.shader.program.uniformData)),e.autoManage){let t=new Float32Array(o.size/4);e.buffer.update(t)}return t.uniformGroups[e.id]=o.syncFunc,t.uniformGroups[e.id]}getSignature(e,t,r){let i=e.uniforms,s=[`${r}-`];for(let e in i)s.push(e),t[e]&&s.push(t[e].type);return s.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(e){let t=this.gl,r=e.program,i=function(e,t){let r=iM(e,e.VERTEX_SHADER,t.vertexSrc),i=iM(e,e.FRAGMENT_SHADER,t.fragmentSrc),s=e.createProgram();e.attachShader(s,r),e.attachShader(s,i);let n=t.extra?.transformFeedbackVaryings;if(n&&("function"!=typeof e.transformFeedbackVaryings?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):e.transformFeedbackVaryings(s,n.names,"separate"===n.bufferMode?e.SEPARATE_ATTRIBS:e.INTERLEAVED_ATTRIBS)),e.linkProgram(s),e.getProgramParameter(s,e.LINK_STATUS)||e.getProgramParameter(s,e.LINK_STATUS)||(e.getShaderParameter(r,e.COMPILE_STATUS)||iU(e,r),e.getShaderParameter(i,e.COMPILE_STATUS)||iU(e,i),console.error("PixiJS Error: Could not initialize shader."),""!==e.getProgramInfoLog(s)&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",e.getProgramInfoLog(s))),t.attributeData=function(e,t){let r={},i=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let s=0;s<i;s++){let i=t.getActiveAttrib(e,s);if(i.name.startsWith("gl_"))continue;let n=iz(t,i.type),o={type:n,name:i.name,size:iG[n],location:t.getAttribLocation(e,i.name)};r[i.name]=o}return r}(s,e),t.uniformData=function(e,t){let r={},i=t.getProgramParameter(e,t.ACTIVE_UNIFORMS);for(let s=0;s<i;s++){let i=t.getActiveUniform(e,s),n=i.name.replace(/\[.*?\]$/,""),o=!!i.name.match(/\[.*?\]$/),a=iz(t,i.type);r[n]={name:n,index:s,type:a,size:i.size,isArray:o,value:ik(a,i.size)}}return r}(s,e),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(t.vertexSrc)){let r=Object.keys(t.attributeData);r.sort((e,t)=>e>t?1:-1);for(let i=0;i<r.length;i++)t.attributeData[r[i]].location=i,e.bindAttribLocation(s,i,r[i]);e.linkProgram(s)}e.deleteShader(r),e.deleteShader(i);let o={};for(let r in t.uniformData){let i=t.uniformData[r];o[r]={location:e.getUniformLocation(s,r),value:ik(i.type,i.size)}}return new sH(s,o)}(t,r);return r.glPrograms[this.renderer.CONTEXT_UID]=i,i}reset(){this.program=null,this.shader=null}disposeShader(e){this.shader===e&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}sY.extension={type:rV.RendererSystem,name:"shader"},r$.add(sY);class sq{constructor(e){this.renderer=e}run(e){let{renderer:t}=this;t.runners.init.emit(t.options),e.hello&&console.log(`PixiJS 7.4.0 - ${t.rendererLogId} - https://pixijs.com`),t.resize(t.screen.width,t.screen.height)}destroy(){}}sq.defaultOptions={hello:!1},sq.extension={type:[rV.RendererSystem,rV.CanvasRendererSystem],name:"startup"},r$.add(sq);const sK=class e{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=eO.NONE,this._blendEq=!1,this.map=[],this.map[0]=this.setBlend,this.map[1]=this.setOffset,this.map[2]=this.setCullFace,this.map[3]=this.setDepthTest,this.map[4]=this.setFrontFace,this.map[5]=this.setDepthMask,this.checks=[],this.defaultState=new rK,this.defaultState.blend=!0}contextChange(e){this.gl=e,this.blendModes=function(e,t=[]){return t[eO.NORMAL]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[eO.ADD]=[e.ONE,e.ONE],t[eO.MULTIPLY]=[e.DST_COLOR,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[eO.SCREEN]=[e.ONE,e.ONE_MINUS_SRC_COLOR,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[eO.OVERLAY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[eO.DARKEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[eO.LIGHTEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[eO.COLOR_DODGE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[eO.COLOR_BURN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[eO.HARD_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[eO.SOFT_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[eO.DIFFERENCE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[eO.EXCLUSION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[eO.HUE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[eO.SATURATION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[eO.COLOR]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[eO.LUMINOSITY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[eO.NONE]=[0,0],t[eO.NORMAL_NPM]=[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[eO.ADD_NPM]=[e.SRC_ALPHA,e.ONE,e.ONE,e.ONE],t[eO.SCREEN_NPM]=[e.SRC_ALPHA,e.ONE_MINUS_SRC_COLOR,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[eO.SRC_IN]=[e.DST_ALPHA,e.ZERO],t[eO.SRC_OUT]=[e.ONE_MINUS_DST_ALPHA,e.ZERO],t[eO.SRC_ATOP]=[e.DST_ALPHA,e.ONE_MINUS_SRC_ALPHA],t[eO.DST_OVER]=[e.ONE_MINUS_DST_ALPHA,e.ONE],t[eO.DST_IN]=[e.ZERO,e.SRC_ALPHA],t[eO.DST_OUT]=[e.ZERO,e.ONE_MINUS_SRC_ALPHA],t[eO.DST_ATOP]=[e.ONE_MINUS_DST_ALPHA,e.SRC_ALPHA],t[eO.XOR]=[e.ONE_MINUS_DST_ALPHA,e.ONE_MINUS_SRC_ALPHA],t[eO.SUBTRACT]=[e.ONE,e.ONE,e.ONE,e.ONE,e.FUNC_REVERSE_SUBTRACT,e.FUNC_ADD],t}(e),this.set(this.defaultState),this.reset()}set(e){if(e=e||this.defaultState,this.stateId!==e.data){let t=this.stateId^e.data,r=0;for(;t;)1&t&&this.map[r].call(this,!!(e.data&1<<r)),t>>=1,r++;this.stateId=e.data}for(let t=0;t<this.checks.length;t++)this.checks[t](this,e)}forceState(e){e=e||this.defaultState;for(let t=0;t<this.map.length;t++)this.map[t].call(this,!!(e.data&1<<t));for(let t=0;t<this.checks.length;t++)this.checks[t](this,e);this.stateId=e.data}setBlend(t){this.updateCheck(e.checkBlendMode,t),this.gl[t?"enable":"disable"](this.gl.BLEND)}setOffset(t){this.updateCheck(e.checkPolygonOffset,t),this.gl[t?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(e){this.gl[e?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(e){this.gl.depthMask(e)}setCullFace(e){this.gl[e?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(e){this.gl.frontFace(this.gl[e?"CW":"CCW"])}setBlendMode(e){if(e===this.blendMode)return;this.blendMode=e;let t=this.blendModes[e],r=this.gl;2===t.length?r.blendFunc(t[0],t[1]):r.blendFuncSeparate(t[0],t[1],t[2],t[3]),6===t.length?(this._blendEq=!0,r.blendEquationSeparate(t[4],t[5])):this._blendEq&&(this._blendEq=!1,r.blendEquationSeparate(r.FUNC_ADD,r.FUNC_ADD))}setPolygonOffset(e,t){this.gl.polygonOffset(e,t)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(e,t){let r=this.checks.indexOf(e);t&&-1===r?this.checks.push(e):t||-1===r||this.checks.splice(r,1)}static checkBlendMode(e,t){e.setBlendMode(t.blendMode)}static checkPolygonOffset(e,t){e.setPolygonOffset(1,t.polygonOffset)}destroy(){this.gl=null}};sK.extension={type:rV.RendererSystem,name:"state"},r$.add(sK);class sJ extends eA(ta){constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(e){this.addRunners(...e.runners);let t=(e.priority??[]).filter(t=>e.systems[t]);for(let r of[...t,...Object.keys(e.systems).filter(e=>!t.includes(e))])this.addSystem(e.systems[r],r)}addRunners(...e){e.forEach(e=>{this.runners[e]=new rQ(e)})}addSystem(e,t){let r=new e(this);if(this[t])throw Error(`Whoops! The name "${t}" is already in use`);for(let e in this[t]=r,this._systemsHash[t]=r,this.runners)this.runners[e].add(r);return this}emitWithCustomOptions(e,t){let r=Object.keys(this._systemsHash);e.items.forEach(i=>{let s=r.find(e=>this._systemsHash[e]===i);i[e.name](t[s])})}destroy(){Object.values(this.runners).forEach(e=>{e.destroy()}),this._systemsHash={}}}const sZ=class e{constructor(t){this.renderer=t,this.count=0,this.checkCount=0,this.maxIdle=e.defaultMaxIdle,this.checkCountMax=e.defaultCheckCountMax,this.mode=e.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==eX.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){let e=this.renderer.texture,t=e.managedTextures,r=!1;for(let i=0;i<t.length;i++){let s=t[i];s.resource&&this.count-s.touched>this.maxIdle&&(e.destroyTexture(s,!0),t[i]=null,r=!0)}if(r){let e=0;for(let r=0;r<t.length;r++)null!==t[r]&&(t[e++]=t[r]);t.length=e}}unload(e){let t=this.renderer.texture,r=e._texture;r&&!r.framebuffer&&t.destroyTexture(r);for(let t=e.children.length-1;t>=0;t--)this.unload(e.children[t])}destroy(){this.renderer=null}};sZ.defaultMode=eX.AUTO,sZ.defaultMaxIdle=3600,sZ.defaultCheckCountMax=600,sZ.extension={type:rV.RendererSystem,name:"textureGC"},r$.add(sZ);class sQ{constructor(e){this.texture=e,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=eN.UNSIGNED_BYTE,this.internalFormat=eL.RGBA,this.samplerType=0}}class s0{constructor(e){this.renderer=e,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new r4,this.hasIntegerTextures=!1}contextChange(){let e=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats="WebGL2RenderingContext"in globalThis&&e instanceof globalThis.WebGL2RenderingContext?{[eN.UNSIGNED_BYTE]:{[eL.RGBA]:e.RGBA8,[eL.RGB]:e.RGB8,[eL.RG]:e.RG8,[eL.RED]:e.R8,[eL.RGBA_INTEGER]:e.RGBA8UI,[eL.RGB_INTEGER]:e.RGB8UI,[eL.RG_INTEGER]:e.RG8UI,[eL.RED_INTEGER]:e.R8UI,[eL.ALPHA]:e.ALPHA,[eL.LUMINANCE]:e.LUMINANCE,[eL.LUMINANCE_ALPHA]:e.LUMINANCE_ALPHA},[eN.BYTE]:{[eL.RGBA]:e.RGBA8_SNORM,[eL.RGB]:e.RGB8_SNORM,[eL.RG]:e.RG8_SNORM,[eL.RED]:e.R8_SNORM,[eL.RGBA_INTEGER]:e.RGBA8I,[eL.RGB_INTEGER]:e.RGB8I,[eL.RG_INTEGER]:e.RG8I,[eL.RED_INTEGER]:e.R8I},[eN.UNSIGNED_SHORT]:{[eL.RGBA_INTEGER]:e.RGBA16UI,[eL.RGB_INTEGER]:e.RGB16UI,[eL.RG_INTEGER]:e.RG16UI,[eL.RED_INTEGER]:e.R16UI,[eL.DEPTH_COMPONENT]:e.DEPTH_COMPONENT16},[eN.SHORT]:{[eL.RGBA_INTEGER]:e.RGBA16I,[eL.RGB_INTEGER]:e.RGB16I,[eL.RG_INTEGER]:e.RG16I,[eL.RED_INTEGER]:e.R16I},[eN.UNSIGNED_INT]:{[eL.RGBA_INTEGER]:e.RGBA32UI,[eL.RGB_INTEGER]:e.RGB32UI,[eL.RG_INTEGER]:e.RG32UI,[eL.RED_INTEGER]:e.R32UI,[eL.DEPTH_COMPONENT]:e.DEPTH_COMPONENT24},[eN.INT]:{[eL.RGBA_INTEGER]:e.RGBA32I,[eL.RGB_INTEGER]:e.RGB32I,[eL.RG_INTEGER]:e.RG32I,[eL.RED_INTEGER]:e.R32I},[eN.FLOAT]:{[eL.RGBA]:e.RGBA32F,[eL.RGB]:e.RGB32F,[eL.RG]:e.RG32F,[eL.RED]:e.R32F,[eL.DEPTH_COMPONENT]:e.DEPTH_COMPONENT32F},[eN.HALF_FLOAT]:{[eL.RGBA]:e.RGBA16F,[eL.RGB]:e.RGB16F,[eL.RG]:e.RG16F,[eL.RED]:e.R16F},[eN.UNSIGNED_SHORT_5_6_5]:{[eL.RGB]:e.RGB565},[eN.UNSIGNED_SHORT_4_4_4_4]:{[eL.RGBA]:e.RGBA4},[eN.UNSIGNED_SHORT_5_5_5_1]:{[eL.RGBA]:e.RGB5_A1},[eN.UNSIGNED_INT_2_10_10_10_REV]:{[eL.RGBA]:e.RGB10_A2,[eL.RGBA_INTEGER]:e.RGB10_A2UI},[eN.UNSIGNED_INT_10F_11F_11F_REV]:{[eL.RGB]:e.R11F_G11F_B10F},[eN.UNSIGNED_INT_5_9_9_9_REV]:{[eL.RGB]:e.RGB9_E5},[eN.UNSIGNED_INT_24_8]:{[eL.DEPTH_STENCIL]:e.DEPTH24_STENCIL8},[eN.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[eL.DEPTH_STENCIL]:e.DEPTH32F_STENCIL8}}:{[eN.UNSIGNED_BYTE]:{[eL.RGBA]:e.RGBA,[eL.RGB]:e.RGB,[eL.ALPHA]:e.ALPHA,[eL.LUMINANCE]:e.LUMINANCE,[eL.LUMINANCE_ALPHA]:e.LUMINANCE_ALPHA},[eN.UNSIGNED_SHORT_5_6_5]:{[eL.RGB]:e.RGB},[eN.UNSIGNED_SHORT_4_4_4_4]:{[eL.RGBA]:e.RGBA},[eN.UNSIGNED_SHORT_5_5_5_1]:{[eL.RGBA]:e.RGBA}},this.samplerTypes="WebGL2RenderingContext"in globalThis&&e instanceof globalThis.WebGL2RenderingContext?{[e.RGB]:eU.FLOAT,[e.RGBA]:eU.FLOAT,[e.ALPHA]:eU.FLOAT,[e.LUMINANCE]:eU.FLOAT,[e.LUMINANCE_ALPHA]:eU.FLOAT,[e.R8]:eU.FLOAT,[e.R8_SNORM]:eU.FLOAT,[e.RG8]:eU.FLOAT,[e.RG8_SNORM]:eU.FLOAT,[e.RGB8]:eU.FLOAT,[e.RGB8_SNORM]:eU.FLOAT,[e.RGB565]:eU.FLOAT,[e.RGBA4]:eU.FLOAT,[e.RGB5_A1]:eU.FLOAT,[e.RGBA8]:eU.FLOAT,[e.RGBA8_SNORM]:eU.FLOAT,[e.RGB10_A2]:eU.FLOAT,[e.RGB10_A2UI]:eU.FLOAT,[e.SRGB8]:eU.FLOAT,[e.SRGB8_ALPHA8]:eU.FLOAT,[e.R16F]:eU.FLOAT,[e.RG16F]:eU.FLOAT,[e.RGB16F]:eU.FLOAT,[e.RGBA16F]:eU.FLOAT,[e.R32F]:eU.FLOAT,[e.RG32F]:eU.FLOAT,[e.RGB32F]:eU.FLOAT,[e.RGBA32F]:eU.FLOAT,[e.R11F_G11F_B10F]:eU.FLOAT,[e.RGB9_E5]:eU.FLOAT,[e.R8I]:eU.INT,[e.R8UI]:eU.UINT,[e.R16I]:eU.INT,[e.R16UI]:eU.UINT,[e.R32I]:eU.INT,[e.R32UI]:eU.UINT,[e.RG8I]:eU.INT,[e.RG8UI]:eU.UINT,[e.RG16I]:eU.INT,[e.RG16UI]:eU.UINT,[e.RG32I]:eU.INT,[e.RG32UI]:eU.UINT,[e.RGB8I]:eU.INT,[e.RGB8UI]:eU.UINT,[e.RGB16I]:eU.INT,[e.RGB16UI]:eU.UINT,[e.RGB32I]:eU.INT,[e.RGB32UI]:eU.UINT,[e.RGBA8I]:eU.INT,[e.RGBA8UI]:eU.UINT,[e.RGBA16I]:eU.INT,[e.RGBA16UI]:eU.UINT,[e.RGBA32I]:eU.INT,[e.RGBA32UI]:eU.UINT,[e.DEPTH_COMPONENT16]:eU.FLOAT,[e.DEPTH_COMPONENT24]:eU.FLOAT,[e.DEPTH_COMPONENT32F]:eU.FLOAT,[e.DEPTH_STENCIL]:eU.FLOAT,[e.DEPTH24_STENCIL8]:eU.FLOAT,[e.DEPTH32F_STENCIL8]:eU.FLOAT}:{[e.RGB]:eU.FLOAT,[e.RGBA]:eU.FLOAT,[e.ALPHA]:eU.FLOAT,[e.LUMINANCE]:eU.FLOAT,[e.LUMINANCE_ALPHA]:eU.FLOAT,[e.DEPTH_STENCIL]:eU.FLOAT};let t=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=t;for(let e=0;e<t;e++)this.boundTextures[e]=null;this.emptyTextures={};let r=new sQ(e.createTexture());e.bindTexture(e.TEXTURE_2D,r.texture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[e.TEXTURE_2D]=r,this.emptyTextures[e.TEXTURE_CUBE_MAP]=new sQ(e.createTexture()),e.bindTexture(e.TEXTURE_CUBE_MAP,this.emptyTextures[e.TEXTURE_CUBE_MAP].texture);for(let t=0;t<6;t++)e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,null);e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.LINEAR);for(let e=0;e<this.boundTextures.length;e++)this.bind(null,e)}bind(e,t=0){let{gl:r}=this;if(e=e?.castToBaseTexture(),e?.valid&&!e.parentTextureArray){e.touched=this.renderer.textureGC.count;let i=e._glTextures[this.CONTEXT_UID]||this.initTexture(e);this.boundTextures[t]!==e&&(this.currentLocation!==t&&(this.currentLocation=t,r.activeTexture(r.TEXTURE0+t)),r.bindTexture(e.target,i.texture)),i.dirtyId!==e.dirtyId?(this.currentLocation!==t&&(this.currentLocation=t,r.activeTexture(r.TEXTURE0+t)),this.updateTexture(e)):i.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(e),this.boundTextures[t]=e}else this.currentLocation!==t&&(this.currentLocation=t,r.activeTexture(r.TEXTURE0+t)),r.bindTexture(r.TEXTURE_2D,this.emptyTextures[r.TEXTURE_2D].texture),this.boundTextures[t]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let e=0;e<this.boundTextures.length;e++)this.boundTextures[e]=this.unknownTexture}unbind(e){let{gl:t,boundTextures:r}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let e=0;e<r.length;e++)r[e]===this.unknownTexture&&this.bind(null,e)}for(let i=0;i<r.length;i++)r[i]===e&&(this.currentLocation!==i&&(t.activeTexture(t.TEXTURE0+i),this.currentLocation=i),t.bindTexture(e.target,this.emptyTextures[e.target].texture),r[i]=null)}ensureSamplerType(e){let{boundTextures:t,hasIntegerTextures:r,CONTEXT_UID:i}=this;if(r)for(let r=e-1;r>=0;--r){let e=t[r];e&&e._glTextures[i].samplerType!==eU.FLOAT&&this.renderer.texture.unbind(e)}}initTexture(e){let t=new sQ(this.gl.createTexture());return t.dirtyId=-1,e._glTextures[this.CONTEXT_UID]=t,this.managedTextures.push(e),e.on("dispose",this.destroyTexture,this),t}initTextureType(e,t){t.internalFormat=this.internalFormats[e.type]?.[e.format]??e.format,t.samplerType=this.samplerTypes[t.internalFormat]??eU.FLOAT,2===this.webGLVersion&&e.type===eN.HALF_FLOAT?t.type=this.gl.HALF_FLOAT:t.type=e.type}updateTexture(e){let t=e._glTextures[this.CONTEXT_UID];if(!t)return;let r=this.renderer;if(this.initTextureType(e,t),e.resource?.upload(r,e,t))t.samplerType!==eU.FLOAT&&(this.hasIntegerTextures=!0);else{let i=e.realWidth,s=e.realHeight,n=r.gl;(t.width!==i||t.height!==s||t.dirtyId<0)&&(t.width=i,t.height=s,n.texImage2D(e.target,0,t.internalFormat,i,s,0,e.format,t.type,null))}e.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(e),t.dirtyId=e.dirtyId}destroyTexture(e,t){let{gl:r}=this;if((e=e.castToBaseTexture())._glTextures[this.CONTEXT_UID]&&(this.unbind(e),r.deleteTexture(e._glTextures[this.CONTEXT_UID].texture),e.off("dispose",this.destroyTexture,this),delete e._glTextures[this.CONTEXT_UID],!t)){let t=this.managedTextures.indexOf(e);-1!==t&&rA(this.managedTextures,t,1)}}updateTextureStyle(e){let t=e._glTextures[this.CONTEXT_UID];t&&(e.mipmap!==eH.POW2&&2===this.webGLVersion||e.isPowerOfTwo?t.mipmap=e.mipmap>=1:t.mipmap=!1,2===this.webGLVersion||e.isPowerOfTwo?t.wrapMode=e.wrapMode:t.wrapMode=ej.CLAMP,e.resource?.style(this.renderer,e,t)||this.setStyle(e,t),t.dirtyStyleId=e.dirtyStyleId)}setStyle(e,t){let r=this.gl;if(t.mipmap&&e.mipmap!==eH.ON_MANUAL&&r.generateMipmap(e.target),r.texParameteri(e.target,r.TEXTURE_WRAP_S,t.wrapMode),r.texParameteri(e.target,r.TEXTURE_WRAP_T,t.wrapMode),t.mipmap){r.texParameteri(e.target,r.TEXTURE_MIN_FILTER,e.scaleMode===eG.LINEAR?r.LINEAR_MIPMAP_LINEAR:r.NEAREST_MIPMAP_NEAREST);let t=this.renderer.context.extensions.anisotropicFiltering;if(t&&e.anisotropicLevel>0&&e.scaleMode===eG.LINEAR){let i=Math.min(e.anisotropicLevel,r.getParameter(t.MAX_TEXTURE_MAX_ANISOTROPY_EXT));r.texParameterf(e.target,t.TEXTURE_MAX_ANISOTROPY_EXT,i)}}else r.texParameteri(e.target,r.TEXTURE_MIN_FILTER,e.scaleMode===eG.LINEAR?r.LINEAR:r.NEAREST);r.texParameteri(e.target,r.TEXTURE_MAG_FILTER,e.scaleMode===eG.LINEAR?r.LINEAR:r.NEAREST)}destroy(){this.renderer=null}}s0.extension={type:rV.RendererSystem,name:"texture"},r$.add(s0);class s1{constructor(e){this.renderer=e}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(e){let{gl:t,CONTEXT_UID:r}=this,i=e._glTransformFeedbacks[r]||this.createGLTransformFeedback(e);t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,i)}unbind(){let{gl:e}=this;e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(e,t){let{gl:r,renderer:i}=this;t&&i.shader.bind(t),r.beginTransformFeedback(e)}endTransformFeedback(){let{gl:e}=this;e.endTransformFeedback()}createGLTransformFeedback(e){let{gl:t,renderer:r,CONTEXT_UID:i}=this,s=t.createTransformFeedback();e._glTransformFeedbacks[i]=s,t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,s);for(let s=0;s<e.buffers.length;s++){let n=e.buffers[s];n&&(r.buffer.update(n),n._glBuffers[i].refCount++,t.bindBufferBase(t.TRANSFORM_FEEDBACK_BUFFER,s,n._glBuffers[i].buffer||null))}return t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null),e.disposeRunner.add(this),s}disposeTransformFeedback(e,t){let r=e._glTransformFeedbacks[this.CONTEXT_UID],i=this.gl;e.disposeRunner.remove(this);let s=this.renderer.buffer;if(s)for(let r=0;r<e.buffers.length;r++){let i=e.buffers[r];if(!i)continue;let n=i._glBuffers[this.CONTEXT_UID];n&&(n.refCount--,0!==n.refCount||t||s.dispose(i,t))}r&&(t||i.deleteTransformFeedback(r),delete e._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}s1.extension={type:rV.RendererSystem,name:"transformFeedback"},r$.add(s1);class s2{constructor(e){this.renderer=e}init(e){this.screen=new id(0,0,e.width,e.height),this.element=e.view||eJ.ADAPTER.createCanvas(),this.resolution=e.resolution||eJ.RESOLUTION,this.autoDensity=!!e.autoDensity}resizeView(e,t){this.element.width=Math.round(e*this.resolution),this.element.height=Math.round(t*this.resolution);let r=this.element.width/this.resolution,i=this.element.height/this.resolution;this.screen.width=r,this.screen.height=i,this.autoDensity&&(this.element.style.width=`${r}px`,this.element.style.height=`${i}px`),this.renderer.emit("resize",r,i),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(e){e&&this.element.parentNode?.removeChild(this.element),this.renderer=null,this.element=null,this.screen=null}}s2.defaultOptions={width:800,height:600,resolution:void 0,autoDensity:!1},s2.extension={type:[rV.RendererSystem,rV.CanvasRendererSystem],name:"_view"},r$.add(s2),eJ.PREFER_ENV=eM.WEBGL2,eJ.STRICT_TEXTURE_CACHE=!1,eJ.RENDER_OPTIONS={...se.defaultOptions,...i8.defaultOptions,...s2.defaultOptions,...sq.defaultOptions},Object.defineProperties(eJ,{WRAP_MODE:{get:()=>r4.defaultOptions.wrapMode,set(e){tB("7.1.0","settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode"),r4.defaultOptions.wrapMode=e}},SCALE_MODE:{get:()=>r4.defaultOptions.scaleMode,set(e){tB("7.1.0","settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode"),r4.defaultOptions.scaleMode=e}},MIPMAP_TEXTURES:{get:()=>r4.defaultOptions.mipmap,set(e){tB("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap"),r4.defaultOptions.mipmap=e}},ANISOTROPIC_LEVEL:{get:()=>r4.defaultOptions.anisotropicLevel,set(e){tB("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel"),r4.defaultOptions.anisotropicLevel=e}},FILTER_RESOLUTION:{get:()=>(tB("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),i5.defaultResolution),set(e){i5.defaultResolution=e}},FILTER_MULTISAMPLE:{get:()=>(tB("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),i5.defaultMultisample),set(e){i5.defaultMultisample=e}},SPRITE_MAX_TEXTURES:{get:()=>i2.defaultMaxTextures,set(e){tB("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),i2.defaultMaxTextures=e}},SPRITE_BATCH_SIZE:{get:()=>i2.defaultBatchSize,set(e){tB("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),i2.defaultBatchSize=e}},CAN_UPLOAD_SAME_BUFFER:{get:()=>i2.canUploadSameBuffer,set(e){tB("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),i2.canUploadSameBuffer=e}},GC_MODE:{get:()=>sZ.defaultMode,set(e){tB("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),sZ.defaultMode=e}},GC_MAX_IDLE:{get:()=>sZ.defaultMaxIdle,set(e){tB("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),sZ.defaultMaxIdle=e}},GC_MAX_CHECK_COUNT:{get:()=>sZ.defaultCheckCountMax,set(e){tB("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),sZ.defaultCheckCountMax=e}},PRECISION_VERTEX:{get:()=>i$.defaultVertexPrecision,set(e){tB("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),i$.defaultVertexPrecision=e}},PRECISION_FRAGMENT:{get:()=>i$.defaultFragmentPrecision,set(e){tB("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),i$.defaultFragmentPrecision=e}}});var s3=((X=s3||{})[X.INTERACTION=50]="INTERACTION",X[X.HIGH=25]="HIGH",X[X.NORMAL=0]="NORMAL",X[X.LOW=-25]="LOW",X[X.UTILITY=-50]="UTILITY",X);class s4{constructor(e,t=null,r=0,i=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=e,this.context=t,this.priority=r,this.once=i}match(e,t=null){return this.fn===e&&this.context===t}emit(e){this.fn&&(this.context?this.fn.call(this.context,e):this.fn(e));let t=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),t}connect(e){this.previous=e,e.next&&(e.next.previous=this),this.next=e.next,e.next=this}destroy(e=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);let t=this.next;return this.next=e?null:t,this.previous=null,t}}const s6=class e{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new s4(null,null,1/0),this.deltaMS=1/e.targetFPMS,this.elapsedMS=1/e.targetFPMS,this._tick=e=>{this._requestId=null,this.started&&(this.update(e),this.started&&null===this._requestId&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){null===this._requestId&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){null!==this._requestId&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(e,t,r=s3.NORMAL){return this._addListener(new s4(e,t,r))}addOnce(e,t,r=s3.NORMAL){return this._addListener(new s4(e,t,r,!0))}_addListener(e){let t=this._head.next,r=this._head;if(t){for(;t;){if(e.priority>t.priority){e.connect(r);break}r=t,t=t.next}e.previous||e.connect(r)}else e.connect(r);return this._startIfPossible(),this}remove(e,t){let r=this._head.next;for(;r;)r=r.match(e,t)?r.destroy():r.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let e=0,t=this._head;for(;t=t.next;)e++;return e}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let e=this._head.next;for(;e;)e=e.destroy(!0);this._head.destroy(),this._head=null}}update(t=performance.now()){let r;if(t>this.lastTime){if((r=this.elapsedMS=t-this.lastTime)>this._maxElapsedMS&&(r=this._maxElapsedMS),r*=this.speed,this._minElapsedMS){let e=t-this._lastFrame|0;if(e<this._minElapsedMS)return;this._lastFrame=t-e%this._minElapsedMS}this.deltaMS=r,this.deltaTime=this.deltaMS*e.targetFPMS;let i=this._head,s=i.next;for(;s;)s=s.emit(this.deltaTime);i.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(t){let r=Math.min(Math.max(0,Math.min(this.maxFPS,t))/1e3,e.targetFPMS);this._maxElapsedMS=1/r}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(e){if(0===e)this._minElapsedMS=0;else{let t=Math.max(this.minFPS,e);this._minElapsedMS=1/(t/1e3)}}static get shared(){if(!e._shared){let t=e._shared=new e;t.autoStart=!0,t._protected=!0}return e._shared}static get system(){if(!e._system){let t=e._system=new e;t.autoStart=!0,t._protected=!0}return e._system}};s6.targetFPMS=.06,Object.defineProperties(eJ,{TARGET_FPMS:{get:()=>s6.targetFPMS,set(e){tB("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),s6.targetFPMS=e}}});class s5{static init(e){e=Object.assign({autoStart:!0,sharedTicker:!1},e),Object.defineProperty(this,"ticker",{set(e){this._ticker&&this._ticker.remove(this.render,this),this._ticker=e,e&&e.add(this.render,this,s3.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=e.sharedTicker?s6.shared:new s6,e.autoStart&&this.start()}static destroy(){if(this._ticker){let e=this._ticker;this.ticker=null,e.destroy()}}}s5.extension=rV.Application,r$.add(s5);const s8=[];r$.handleByList(rV.Renderer,s8);var s9=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,s7=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;class ne{constructor(e){this.renderer=e}contextChange(e){let t;if(1===this.renderer.context.webGLVersion){let r=e.getParameter(e.FRAMEBUFFER_BINDING);e.bindFramebuffer(e.FRAMEBUFFER,null),t=e.getParameter(e.SAMPLES),e.bindFramebuffer(e.FRAMEBUFFER,r)}else{let r=e.getParameter(e.DRAW_FRAMEBUFFER_BINDING);e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),t=e.getParameter(e.SAMPLES),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,r)}t>=eq.HIGH?this.multisample=eq.HIGH:t>=eq.MEDIUM?this.multisample=eq.MEDIUM:t>=eq.LOW?this.multisample=eq.LOW:this.multisample=eq.NONE}destroy(){}}ne.extension={type:rV.RendererSystem,name:"_multisample"},r$.add(ne);class nt{constructor(e){this.buffer=e||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class nr{constructor(e){this.renderer=e,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(e){let{gl:t,CONTEXT_UID:r}=this,i=e._glBuffers[r]||this.createGLBuffer(e);t.bindBuffer(e.type,i.buffer)}unbind(e){let{gl:t}=this;t.bindBuffer(e,null)}bindBufferBase(e,t){let{gl:r,CONTEXT_UID:i}=this;if(this.boundBufferBases[t]!==e){let s=e._glBuffers[i]||this.createGLBuffer(e);this.boundBufferBases[t]=e,r.bindBufferBase(r.UNIFORM_BUFFER,t,s.buffer)}}bindBufferRange(e,t,r){let{gl:i,CONTEXT_UID:s}=this;r=r||0;let n=e._glBuffers[s]||this.createGLBuffer(e);i.bindBufferRange(i.UNIFORM_BUFFER,t||0,n.buffer,256*r,256)}update(e){let{gl:t,CONTEXT_UID:r}=this,i=e._glBuffers[r]||this.createGLBuffer(e);if(e._updateID!==i.updateID){if(i.updateID=e._updateID,t.bindBuffer(e.type,i.buffer),i.byteLength>=e.data.byteLength)t.bufferSubData(e.type,0,e.data);else{let r=e.static?t.STATIC_DRAW:t.DYNAMIC_DRAW;i.byteLength=e.data.byteLength,t.bufferData(e.type,e.data,r)}}}dispose(e,t){if(!this.managedBuffers[e.id])return;delete this.managedBuffers[e.id];let r=e._glBuffers[this.CONTEXT_UID],i=this.gl;e.disposeRunner.remove(this),r&&(t||i.deleteBuffer(r.buffer),delete e._glBuffers[this.CONTEXT_UID])}disposeAll(e){let t=Object.keys(this.managedBuffers);for(let r=0;r<t.length;r++)this.dispose(this.managedBuffers[t[r]],e)}createGLBuffer(e){let{CONTEXT_UID:t,gl:r}=this;return e._glBuffers[t]=new nt(r.createBuffer()),this.managedBuffers[e.id]=e,e.disposeRunner.add(this),e._glBuffers[t]}}nr.extension={type:rV.RendererSystem,name:"buffer"},r$.add(nr);class ni{constructor(e){this.renderer=e}render(e,t){let r,i,s,n;let o=this.renderer;if(t&&(r=t.renderTexture,i=t.clear,s=t.transform,n=t.skipUpdateTransform),this.renderingToScreen=!r,o.runners.prerender.emit(),o.emit("prerender"),o.projection.transform=s,!o.context.isLost){if(r||(this.lastObjectRendered=e),!n){let t=e.enableTempParent();e.updateTransform(),e.disableTempParent(t)}o.renderTexture.bind(r),o.batch.currentRenderer.start(),(i??o.background.clearBeforeRender)&&o.renderTexture.clear(),e.render(o),o.batch.currentRenderer.flush(),r&&(t.blit&&o.framebuffer.blit(),r.baseTexture.update()),o.runners.postrender.emit(),o.projection.transform=null,o.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}}ni.extension={type:rV.RendererSystem,name:"objectRenderer"},r$.add(ni);const ns=class e extends sJ{constructor(t){super(),this.type=eD.WEBGL,t=Object.assign({},eJ.RENDER_OPTIONS,t),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new iq({projectionMatrix:new i_},!0);let r={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:e.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(r),"useContextAlpha"in t&&(tB("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),t.premultipliedAlpha=t.useContextAlpha&&"notMultiplied"!==t.useContextAlpha,t.backgroundAlpha=!1===t.useContextAlpha?1:t.backgroundAlpha),this._plugin.rendererPlugins=e.__plugins,this.options=t,this.startup.run(this.options)}static test(e){return!e?.forceCanvas&&tz()}render(e,t){this.objectRenderer.render(e,t)}resize(e,t){this._view.resizeView(e,t)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(e=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:e}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(e){this._view.resolution=e,this.runners.resolutionChange.emit(e)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return tB("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return tB("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return tB("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return tB("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(e){tB("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=e}get backgroundAlpha(){return tB("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha}set backgroundAlpha(e){tB("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=e}get powerPreference(){return tB("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(e,t){return this.textureGenerator.generateTexture(e,t)}};ns.extension={type:rV.Renderer,priority:1},ns.__plugins={},ns.__systems={},r$.handleByMap(rV.RendererPlugin,ns.__plugins),r$.handleByMap(rV.RendererSystem,ns.__systems),r$.add(ns);class nn extends r0{constructor(e,t){let{width:r,height:i}=t||{};super(r,i),this.items=[],this.itemDirtyIds=[];for(let t=0;t<e;t++){let e=new r4;this.items.push(e),this.itemDirtyIds.push(-2)}this.length=e,this._load=null,this.baseTexture=null}initFromArray(e,t){for(let r=0;r<this.length;r++)e[r]&&(e[r].castToBaseTexture?this.addBaseTextureAt(e[r].castToBaseTexture(),r):e[r]instanceof r0?this.addResourceAt(e[r],r):this.addResourceAt(rZ(e[r],t),r))}dispose(){for(let e=0,t=this.length;e<t;e++)this.items[e].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(e,t){if(!this.items[t])throw Error(`Index ${t} is out of bounds`);return e.valid&&!this.valid&&this.resize(e.width,e.height),this.items[t].setResource(e),this}bind(e){if(null!==this.baseTexture)throw Error("Only one base texture per TextureArray is allowed");super.bind(e);for(let t=0;t<this.length;t++)this.items[t].parentTextureArray=e,this.items[t].on("update",e.update,e)}unbind(e){super.unbind(e);for(let t=0;t<this.length;t++)this.items[t].parentTextureArray=null,this.items[t].off("update",e.update,e)}load(){if(this._load)return this._load;let e=this.items.map(e=>e.resource).filter(e=>e).map(e=>e.load());return this._load=Promise.all(e).then(()=>{let{realWidth:e,realHeight:t}=this.items[0];return this.resize(e,t),this.update(),Promise.resolve(this)}),this._load}}const no=class e extends nn{constructor(t,r){let{width:i,height:s,autoLoad:n,linkBaseTexture:o}=r||{};if(t&&t.length!==e.SIDES)throw Error(`Invalid length. Got ${t.length}, expected 6`);super(6,{width:i,height:s});for(let t=0;t<e.SIDES;t++)this.items[t].target=eF.TEXTURE_CUBE_MAP_POSITIVE_X+t;this.linkBaseTexture=!1!==o,t&&this.initFromArray(t,r),!1!==n&&this.load()}bind(e){super.bind(e),e.target=eF.TEXTURE_CUBE_MAP}addBaseTextureAt(e,t,r){if(void 0===r&&(r=this.linkBaseTexture),!this.items[t])throw Error(`Index ${t} is out of bounds`);if(!this.linkBaseTexture||e.parentTextureArray||Object.keys(e._glTextures).length>0){if(e.resource)this.addResourceAt(e.resource,t);else throw Error("CubeResource does not support copying of renderTexture.")}else e.target=eF.TEXTURE_CUBE_MAP_POSITIVE_X+t,e.parentTextureArray=this.baseTexture,this.items[t]=e;return e.valid&&!this.valid&&this.resize(e.realWidth,e.realHeight),this.items[t]=e,this}upload(t,r,i){let s=this.itemDirtyIds;for(let n=0;n<e.SIDES;n++){let e=this.items[n];(s[n]<e.dirtyId||i.dirtyId<r.dirtyId)&&(e.valid&&e.resource?(e.resource.upload(t,e,i),s[n]=e.dirtyId):s[n]<-1&&(t.gl.texImage2D(e.target,0,i.internalFormat,r.realWidth,r.realHeight,0,r.format,i.type,null),s[n]=-1))}return!0}static test(t){return Array.isArray(t)&&t.length===e.SIDES}};no.SIDES=6;class na extends si{constructor(e,t){let r,i,s;t=t||{},"string"==typeof e?(r=na.EMPTY,i=e,s=!0):(r=e,i=null,s=!1),super(r),this.url=i,this.crossOrigin=t.crossOrigin??!0,this.alphaMode="number"==typeof t.alphaMode?t.alphaMode:null,this.ownsImageBitmap=t.ownsImageBitmap??s,this._load=null,!1!==t.autoLoad&&this.load()}load(){return this._load||(this._load=new Promise(async(e,t)=>{if(null===this.url){e(this);return}try{let t=await eJ.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;let r=await t.blob();if(this.destroyed)return;let i=await createImageBitmap(r,{premultiplyAlpha:null===this.alphaMode||this.alphaMode===ez.UNPACK?"premultiply":"none"});if(this.destroyed){i.close();return}this.source=i,this.update(),e(this)}catch(e){if(this.destroyed)return;t(e),this.onError.emit(e)}})),this._load}upload(e,t,r){return this.source instanceof ImageBitmap?("number"==typeof this.alphaMode&&(t.alphaMode=this.alphaMode),super.upload(e,t,r)):(this.load(),!1)}dispose(){this.ownsImageBitmap&&this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(e){return!!globalThis.createImageBitmap&&"u">typeof ImageBitmap&&("string"==typeof e||e instanceof ImageBitmap)}static get EMPTY(){return na._EMPTY=na._EMPTY??eJ.ADAPTER.createCanvas(0,0),na._EMPTY}}const nh=class e extends si{constructor(e,t){t=t||{},super(eJ.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=e,this.scale=t.scale||1,this._overrideWidth=t.width,this._overrideHeight=t.height,this._resolve=null,this._crossorigin=t.crossorigin,this._load=null,!1!==t.autoLoad&&this.load()}load(){return this._load||(this._load=new Promise(t=>{if(this._resolve=()=>{this.update(),t(this)},e.SVG_XML.test(this.svg.trim())){if(!btoa)throw Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()})),this._load}_loadSvg(){let e=new Image;si.crossOrigin(e,this.svg,this._crossorigin),e.src=this.svg,e.onerror=t=>{this._resolve&&(e.onerror=null,this.onError.emit(t))},e.onload=()=>{if(!this._resolve)return;let t=e.width,r=e.height;if(!t||!r)throw Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let i=t*this.scale,s=r*this.scale;(this._overrideWidth||this._overrideHeight)&&(i=this._overrideWidth||this._overrideHeight/r*t,s=this._overrideHeight||this._overrideWidth/t*r),i=Math.round(i),s=Math.round(s);let n=this.source;n.width=i,n.height=s,n._pixiId=`canvas_${rR()}`,n.getContext("2d").drawImage(e,0,0,t,r,0,0,i,s),this._resolve(),this._resolve=null}}static getSize(t){let r=e.SVG_SIZE.exec(t),i={};return r&&(i[r[1]]=Math.round(parseFloat(r[3])),i[r[5]]=Math.round(parseFloat(r[7]))),i}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(t,r){return"svg"===r||"string"==typeof t&&t.startsWith("data:image/svg+xml")||"string"==typeof t&&e.SVG_XML.test(t)}};nh.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,nh.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;const nl=class e extends si{constructor(t,r){if(r=r||{},!(t instanceof HTMLVideoElement)){let i=document.createElement("video");!1!==r.autoLoad&&i.setAttribute("preload","auto"),!1!==r.playsinline&&(i.setAttribute("webkit-playsinline",""),i.setAttribute("playsinline","")),!0===r.muted&&(i.setAttribute("muted",""),i.muted=!0),!0===r.loop&&i.setAttribute("loop",""),!1!==r.autoPlay&&i.setAttribute("autoplay",""),"string"==typeof t&&(t=[t]);let s=t[0].src||t[0];si.crossOrigin(i,s,r.crossorigin);for(let r=0;r<t.length;++r){let s=document.createElement("source"),{src:n,mime:o}=t[r];if((n=n||t[r]).startsWith("data:"))o=n.slice(5,n.indexOf(";"));else if(!n.startsWith("blob:")){let t=n.split("?").shift().toLowerCase(),r=t.slice(t.lastIndexOf(".")+1);o=o||e.MIME_TYPES[r]||`video/${r}`}s.src=n,o&&(s.type=o),i.appendChild(s)}t=i}super(t),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=r.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=!1!==r.autoPlay,this._videoFrameRequestCallback=this._videoFrameRequestCallback.bind(this),this._videoFrameRequestCallbackHandle=null,this._load=null,this._resolve=null,this._reject=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),this._onPlayStart=this._onPlayStart.bind(this),this._onPlayStop=this._onPlayStop.bind(this),this._onSeeked=this._onSeeked.bind(this),!1!==r.autoLoad&&this.load()}update(e=0){if(!this.destroyed){if(this._updateFPS){let e=s6.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-e)}(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}_videoFrameRequestCallback(){this.update(),this.destroyed?this._videoFrameRequestCallbackHandle=null:this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback)}load(){if(this._load)return this._load;let e=this.source;return(e.readyState===e.HAVE_ENOUGH_DATA||e.readyState===e.HAVE_FUTURE_DATA)&&e.width&&e.height&&(e.complete=!0),e.addEventListener("play",this._onPlayStart),e.addEventListener("pause",this._onPlayStop),e.addEventListener("seeked",this._onSeeked),this._isSourceReady()?this._onCanPlay():(e.addEventListener("canplay",this._onCanPlay),e.addEventListener("canplaythrough",this._onCanPlay),e.addEventListener("error",this._onError,!0)),this._load=new Promise((t,r)=>{this.valid?t(this):(this._resolve=t,this._reject=r,e.load())}),this._load}_onError(e){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(e),this._reject&&(this._reject(e),this._reject=null,this._resolve=null)}_isSourcePlaying(){let e=this.source;return!e.paused&&!e.ended}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this._configureAutoUpdate()}_onPlayStop(){this._configureAutoUpdate()}_onSeeked(){this._autoUpdate&&!this._isSourcePlaying()&&(this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0)}_onCanPlay(){let e=this.source;e.removeEventListener("canplay",this._onCanPlay),e.removeEventListener("canplaythrough",this._onCanPlay);let t=this.valid;this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0,!t&&this._resolve&&(this._resolve(this),this._resolve=null,this._reject=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&e.play()}dispose(){this._configureAutoUpdate();let e=this.source;e&&(e.removeEventListener("play",this._onPlayStart),e.removeEventListener("pause",this._onPlayStop),e.removeEventListener("seeked",this._onSeeked),e.removeEventListener("canplay",this._onCanPlay),e.removeEventListener("canplaythrough",this._onCanPlay),e.removeEventListener("error",this._onError,!0),e.pause(),e.src="",e.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(e){e!==this._autoUpdate&&(this._autoUpdate=e,this._configureAutoUpdate())}get updateFPS(){return this._updateFPS}set updateFPS(e){e!==this._updateFPS&&(this._updateFPS=e,this._configureAutoUpdate())}_configureAutoUpdate(){this._autoUpdate&&this._isSourcePlaying()?!this._updateFPS&&this.source.requestVideoFrameCallback?(this._isConnectedToTicker&&(s6.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0),null===this._videoFrameRequestCallbackHandle&&(this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback))):(null!==this._videoFrameRequestCallbackHandle&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker||(s6.shared.add(this.update,this),this._isConnectedToTicker=!0,this._msToNextUpdate=0)):(null!==this._videoFrameRequestCallbackHandle&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker&&(s6.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0))}static test(t,r){return globalThis.HTMLVideoElement&&t instanceof HTMLVideoElement||e.TYPES.includes(r)}};nl.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],nl.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"},rJ.push(na,ss,class extends si{constructor(e){super(e)}static test(e){let{OffscreenCanvas:t}=globalThis;return!!t&&e instanceof t||globalThis.HTMLCanvasElement&&e instanceof HTMLCanvasElement}},nl,class extends si{constructor(e){super(e)}static test(e){return!!globalThis.VideoFrame&&e instanceof globalThis.VideoFrame}},nh,r1,no,class extends nn{constructor(e,t){let r,i;let{width:s,height:n}=t||{};Array.isArray(e)?(r=e,i=e.length):i=e,super(i,{width:s,height:n}),r&&this.initFromArray(r,t)}addBaseTextureAt(e,t){if(e.resource)this.addResourceAt(e.resource,t);else throw Error("ArrayResource does not support RenderTexture");return this}bind(e){super.bind(e),e.target=eF.TEXTURE_2D_ARRAY}upload(e,t,r){let{length:i,itemDirtyIds:s,items:n}=this,{gl:o}=e;r.dirtyId<0&&o.texImage3D(o.TEXTURE_2D_ARRAY,0,r.internalFormat,this._width,this._height,i,0,t.format,r.type,null);for(let e=0;e<i;e++){let i=n[e];s[e]<i.dirtyId&&(s[e]=i.dirtyId,i.valid&&o.texSubImage3D(o.TEXTURE_2D_ARRAY,0,0,0,e,i.resource.width,i.resource.height,1,t.format,r.type,i.resource.source))}return!0}});class nu{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(e){return this.minX>this.maxX||this.minY>this.maxY?id.EMPTY:((e=e||new id(0,0,1,1)).x=this.minX,e.y=this.minY,e.width=this.maxX-this.minX,e.height=this.maxY-this.minY,e)}addPoint(e){this.minX=Math.min(this.minX,e.x),this.maxX=Math.max(this.maxX,e.x),this.minY=Math.min(this.minY,e.y),this.maxY=Math.max(this.maxY,e.y)}addPointMatrix(e,t){let{a:r,b:i,c:s,d:n,tx:o,ty:a}=e,h=r*t.x+s*t.y+o,l=i*t.x+n*t.y+a;this.minX=Math.min(this.minX,h),this.maxX=Math.max(this.maxX,h),this.minY=Math.min(this.minY,l),this.maxY=Math.max(this.maxY,l)}addQuad(e){let t=this.minX,r=this.minY,i=this.maxX,s=this.maxY,n=e[0],o=e[1];t=n<t?n:t,r=o<r?o:r,i=n>i?n:i,s=o>s?o:s,n=e[2],o=e[3],t=n<t?n:t,r=o<r?o:r,i=n>i?n:i,s=o>s?o:s,n=e[4],o=e[5],t=n<t?n:t,r=o<r?o:r,i=n>i?n:i,s=o>s?o:s,n=e[6],o=e[7],t=n<t?n:t,r=o<r?o:r,i=n>i?n:i,s=o>s?o:s,this.minX=t,this.minY=r,this.maxX=i,this.maxY=s}addFrame(e,t,r,i,s){this.addFrameMatrix(e.worldTransform,t,r,i,s)}addFrameMatrix(e,t,r,i,s){let n=e.a,o=e.b,a=e.c,h=e.d,l=e.tx,u=e.ty,c=this.minX,d=this.minY,p=this.maxX,f=this.maxY,m=n*t+a*r+l,g=o*t+h*r+u;c=m<c?m:c,d=g<d?g:d,p=m>p?m:p,f=g>f?g:f,m=n*i+a*r+l,g=o*i+h*r+u,c=m<c?m:c,d=g<d?g:d,p=m>p?m:p,f=g>f?g:f,m=n*t+a*s+l,g=o*t+h*s+u,c=m<c?m:c,d=g<d?g:d,p=m>p?m:p,f=g>f?g:f,m=n*i+a*s+l,g=o*i+h*s+u,c=m<c?m:c,d=g<d?g:d,p=m>p?m:p,f=g>f?g:f,this.minX=c,this.minY=d,this.maxX=p,this.maxY=f}addVertexData(e,t,r){let i=this.minX,s=this.minY,n=this.maxX,o=this.maxY;for(let a=t;a<r;a+=2){let t=e[a],r=e[a+1];i=t<i?t:i,s=r<s?r:s,n=t>n?t:n,o=r>o?r:o}this.minX=i,this.minY=s,this.maxX=n,this.maxY=o}addVertices(e,t,r,i){this.addVerticesMatrix(e.worldTransform,t,r,i)}addVerticesMatrix(e,t,r,i,s=0,n=s){let o=e.a,a=e.b,h=e.c,l=e.d,u=e.tx,c=e.ty,d=this.minX,p=this.minY,f=this.maxX,m=this.maxY;for(let e=r;e<i;e+=2){let r=t[e],i=t[e+1],g=o*r+h*i+u,y=l*i+a*r+c;d=Math.min(d,g-s),f=Math.max(f,g+s),p=Math.min(p,y-n),m=Math.max(m,y+n)}this.minX=d,this.minY=p,this.maxX=f,this.maxY=m}addBounds(e){let t=this.minX,r=this.minY,i=this.maxX,s=this.maxY;this.minX=e.minX<t?e.minX:t,this.minY=e.minY<r?e.minY:r,this.maxX=e.maxX>i?e.maxX:i,this.maxY=e.maxY>s?e.maxY:s}addBoundsMask(e,t){let r=e.minX>t.minX?e.minX:t.minX,i=e.minY>t.minY?e.minY:t.minY,s=e.maxX<t.maxX?e.maxX:t.maxX,n=e.maxY<t.maxY?e.maxY:t.maxY;if(r<=s&&i<=n){let e=this.minX,t=this.minY,o=this.maxX,a=this.maxY;this.minX=r<e?r:e,this.minY=i<t?i:t,this.maxX=s>o?s:o,this.maxY=n>a?n:a}}addBoundsMatrix(e,t){this.addFrameMatrix(t,e.minX,e.minY,e.maxX,e.maxY)}addBoundsArea(e,t){let r=e.minX>t.x?e.minX:t.x,i=e.minY>t.y?e.minY:t.y,s=e.maxX<t.x+t.width?e.maxX:t.x+t.width,n=e.maxY<t.y+t.height?e.maxY:t.y+t.height;if(r<=s&&i<=n){let e=this.minX,t=this.minY,o=this.maxX,a=this.maxY;this.minX=r<e?r:e,this.minY=i<t?i:t,this.maxX=s>o?s:o,this.maxY=n>a?n:a}}pad(e=0,t=e){this.isEmpty()||(this.minX-=e,this.maxX+=e,this.minY-=t,this.maxY+=t)}addFramePad(e,t,r,i,s,n){e-=s,t-=n,r+=s,i+=n,this.minX=this.minX<e?this.minX:e,this.maxX=this.maxX>r?this.maxX:r,this.minY=this.minY<t?this.minY:t,this.maxY=this.maxY>i?this.maxY:i}}class nc extends to.EventEmitter{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new iR,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new nu,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(e){let t=Object.keys(e);for(let r=0;r<t.length;++r){let i=t[r];Object.defineProperty(nc.prototype,i,Object.getOwnPropertyDescriptor(e,i))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(e,t){return e||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),t||(this._boundsRect||(this._boundsRect=new id),t=this._boundsRect),this._bounds.getRectangle(t)}getLocalBounds(e){e||(this._localBoundsRect||(this._localBoundsRect=new id),e=this._localBoundsRect),this._localBounds||(this._localBounds=new nu);let t=this.transform,r=this.parent;this.parent=null,this._tempDisplayObjectParent.worldAlpha=r?.worldAlpha??1,this.transform=this._tempDisplayObjectParent.transform;let i=this._bounds,s=this._boundsID;this._bounds=this._localBounds;let n=this.getBounds(!1,e);return this.parent=r,this.transform=t,this._bounds=i,this._bounds.updateID+=this._boundsID-s,n}toGlobal(e,t,r=!1){return r||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(e,t)}toLocal(e,t,r,i){return t&&(e=t.toGlobal(e,r,i)),i||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(e,r)}setParent(e){if(!e||!e.addChild)throw Error("setParent: Argument must be a Container");return e.addChild(this),e}removeFromParent(){this.parent?.removeChild(this)}setTransform(e=0,t=0,r=1,i=1,s=0,n=0,o=0,a=0,h=0){return this.position.x=e,this.position.y=t,this.scale.x=r||1,this.scale.y=i||1,this.rotation=s,this.skew.x=n,this.skew.y=o,this.pivot.x=a,this.pivot.y=h,this}destroy(e){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.eventMode="auto",this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return null===this.tempDisplayObjectParent&&(this.tempDisplayObjectParent=new nd),this.tempDisplayObjectParent}enableTempParent(){let e=this.parent;return this.parent=this._tempDisplayObjectParent,e}disableTempParent(e){this.parent=e}get x(){return this.position.x}set x(e){this.transform.position.x=e}get y(){return this.position.y}set y(e){this.transform.position.y=e}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(e){this.transform.position.copyFrom(e)}get scale(){return this.transform.scale}set scale(e){this.transform.scale.copyFrom(e)}get pivot(){return this.transform.pivot}set pivot(e){this.transform.pivot.copyFrom(e)}get skew(){return this.transform.skew}set skew(e){this.transform.skew.copyFrom(e)}get rotation(){return this.transform.rotation}set rotation(e){this.transform.rotation=e}get angle(){return this.transform.rotation*ia}set angle(e){this.transform.rotation=e*ih}get zIndex(){return this._zIndex}set zIndex(e){this._zIndex!==e&&(this._zIndex=e,this.parent&&(this.parent.sortDirty=!0))}get worldVisible(){let e=this;do{if(!e.visible)return!1;e=e.parent}while(e)return!0}get mask(){return this._mask}set mask(e){if(this._mask!==e){if(this._mask){let e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(e._maskRefCount--,0===e._maskRefCount&&(e.renderable=!0,e.isMask=!1))}if(this._mask=e,this._mask){let e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(0===e._maskRefCount&&(e.renderable=!1,e.isMask=!0),e._maskRefCount++)}}}}class nd extends nc{constructor(){super(...arguments),this.sortDirty=null}}nc.prototype.displayObjectUpdateTransform=nc.prototype.updateTransform;const np=new i_;function nf(e,t){return e.zIndex===t.zIndex?e._lastSortedIndex-t._lastSortedIndex:e.zIndex-t.zIndex}const nm=class e extends nc{constructor(){super(),this.children=[],this.sortableChildren=e.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(e){}addChild(...e){if(e.length>1)for(let t=0;t<e.length;t++)this.addChild(e[t]);else{let t=e[0];t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.push(t),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",t,this,this.children.length-1),t.emit("added",this)}return e[0]}addChildAt(e,t){if(t<0||t>this.children.length)throw Error(`${e}addChildAt: The index ${t} supplied is out of bounds ${this.children.length}`);return e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.splice(t,0,e),this._boundsID++,this.onChildrenChange(t),e.emit("added",this),this.emit("childAdded",e,this,t),e}swapChildren(e,t){if(e===t)return;let r=this.getChildIndex(e),i=this.getChildIndex(t);this.children[r]=t,this.children[i]=e,this.onChildrenChange(r<i?r:i)}getChildIndex(e){let t=this.children.indexOf(e);if(-1===t)throw Error("The supplied DisplayObject must be a child of the caller");return t}setChildIndex(e,t){if(t<0||t>=this.children.length)throw Error(`The index ${t} supplied is out of bounds ${this.children.length}`);let r=this.getChildIndex(e);to.removeItems(this.children,r,1),this.children.splice(t,0,e),this.onChildrenChange(t)}getChildAt(e){if(e<0||e>=this.children.length)throw Error(`getChildAt: Index (${e}) does not exist.`);return this.children[e]}removeChild(...e){if(e.length>1)for(let t=0;t<e.length;t++)this.removeChild(e[t]);else{let t=e[0],r=this.children.indexOf(t);if(-1===r)return null;t.parent=null,t.transform._parentID=-1,to.removeItems(this.children,r,1),this._boundsID++,this.onChildrenChange(r),t.emit("removed",this),this.emit("childRemoved",t,this,r)}return e[0]}removeChildAt(e){let t=this.getChildAt(e);return t.parent=null,t.transform._parentID=-1,to.removeItems(this.children,e,1),this._boundsID++,this.onChildrenChange(e),t.emit("removed",this),this.emit("childRemoved",t,this,e),t}removeChildren(e=0,t=this.children.length){let r;let i=t-e;if(i>0&&i<=t){r=this.children.splice(e,i);for(let e=0;e<r.length;++e)r[e].parent=null,r[e].transform&&(r[e].transform._parentID=-1);this._boundsID++,this.onChildrenChange(e);for(let e=0;e<r.length;++e)r[e].emit("removed",this),this.emit("childRemoved",r[e],this,e);return r}if(0===i&&0===this.children.length)return[];throw RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let e=!1;for(let t=0,r=this.children.length;t<r;++t){let r=this.children[t];r._lastSortedIndex=t,e||0===r.zIndex||(e=!0)}e&&this.children.length>1&&this.children.sort(nf),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let e=0,t=this.children.length;e<t;++e){let t=this.children[e];t.visible&&t.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let e=0;e<this.children.length;e++){let t=this.children[e];if(!(!t.visible||!t.renderable)){if(t.calculateBounds(),t._mask){let e=t._mask.isMaskData?t._mask.maskObject:t._mask;e?(e.calculateBounds(),this._bounds.addBoundsMask(t._bounds,e._bounds)):this._bounds.addBounds(t._bounds)}else t.filterArea?this._bounds.addBoundsArea(t._bounds,t.filterArea):this._bounds.addBounds(t._bounds)}}this._bounds.updateID=this._boundsID}getLocalBounds(e,t=!1){let r=super.getLocalBounds(e);if(!t)for(let e=0,t=this.children.length;e<t;++e){let t=this.children[e];t.visible&&t.updateTransform()}return r}_calculateBounds(){}_renderWithCulling(t){let r,i;let s=t.renderTexture.sourceFrame;if(!(s.width>0&&s.height>0))return;this.cullArea?(r=this.cullArea,i=this.worldTransform):this._render!==e.prototype._render&&(r=this.getBounds(!0));let n=t.projection.transform;if(n&&(i?(i=np.copyFrom(i)).prepend(n):i=n),r&&s.intersects(r,i))this._render(t);else if(this.cullArea)return;for(let e=0,r=this.children.length;e<r;++e){let r=this.children[e],i=r.cullable;r.cullable=i||!this.cullArea,r.render(t),r.cullable=i}}render(e){if(!(!this.visible||this.worldAlpha<=0||!this.renderable)){if(this._mask||this.filters?.length)this.renderAdvanced(e);else if(this.cullable)this._renderWithCulling(e);else{this._render(e);for(let t=0,r=this.children.length;t<r;++t)this.children[t].render(e)}}}renderAdvanced(e){let t=this.filters,r=this._mask;if(t){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let e=0;e<t.length;e++)t[e].enabled&&this._enabledFilters.push(t[e])}let i=t&&this._enabledFilters?.length||r&&(!r.isMaskData||r.enabled&&(r.autoDetect||r.type!==e$.NONE));if(i&&e.batch.flush(),t&&this._enabledFilters?.length&&e.filter.push(this,this._enabledFilters),r&&e.mask.push(this,this._mask),this.cullable)this._renderWithCulling(e);else{this._render(e);for(let t=0,r=this.children.length;t<r;++t)this.children[t].render(e)}i&&e.batch.flush(),r&&e.mask.pop(this),t&&this._enabledFilters?.length&&e.filter.pop()}_render(e){}destroy(e){super.destroy(),this.sortDirty=!1;let t="boolean"==typeof e?e:e?.children,r=this.removeChildren(0,this.children.length);if(t)for(let t=0;t<r.length;++t)r[t].destroy(e)}get width(){return this.scale.x*this.getLocalBounds().width}set width(e){let t=this.getLocalBounds().width;0!==t?this.scale.x=e/t:this.scale.x=1,this._width=e}get height(){return this.scale.y*this.getLocalBounds().height}set height(e){let t=this.getLocalBounds().height;0!==t?this.scale.y=e/t:this.scale.y=1,this._height=e}};nm.defaultSortableChildren=!1;let ng=nm;ng.prototype.containerUpdateTransform=ng.prototype.updateTransform,Object.defineProperties(eJ,{SORTABLE_CHILDREN:{get:()=>ng.defaultSortableChildren,set(e){to.deprecation("7.1.0","settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),ng.defaultSortableChildren=e}}});const ny=new iu,n_=new Uint16Array([0,1,2,0,2,3]);class nv extends ng{constructor(e){super(),this._anchor=new iC(this._onAnchorUpdate,this,e?e.defaultAnchor.x:0,e?e.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tintColor=new ra(16777215),this._tintRGB=null,this.tint=16777215,this.blendMode=eO.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=e||sh.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=n_,this.pluginName="batch",this.isSprite=!0,this._roundPixels=eJ.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=to.sign(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=to.sign(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){let e=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===e._updateID)return;this._textureID!==e._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=e._updateID;let t=this.transform.worldTransform,r=t.a,i=t.b,s=t.c,n=t.d,o=t.tx,a=t.ty,h=this.vertexData,l=e.trim,u=e.orig,c=this._anchor,d=0,p=0,f=0,m=0;if(l?(d=(p=l.x-c._x*u.width)+l.width,f=(m=l.y-c._y*u.height)+l.height):(d=(p=-c._x*u.width)+u.width,f=(m=-c._y*u.height)+u.height),h[0]=r*p+s*m+o,h[1]=n*m+i*p+a,h[2]=r*d+s*m+o,h[3]=n*m+i*d+a,h[4]=r*d+s*f+o,h[5]=n*f+i*d+a,h[6]=r*p+s*f+o,h[7]=n*f+i*p+a,this._roundPixels){let e=eJ.RESOLUTION;for(let t=0;t<h.length;++t)h[t]=Math.round(h[t]*e)/e}}calculateTrimmedVertices(){if(this.vertexTrimmedData){if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return}else this.vertexTrimmedData=new Float32Array(8);this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;let e=this._texture,t=this.vertexTrimmedData,r=e.orig,i=this._anchor,s=this.transform.worldTransform,n=s.a,o=s.b,a=s.c,h=s.d,l=s.tx,u=s.ty,c=-i._x*r.width,d=c+r.width,p=-i._y*r.height,f=p+r.height;if(t[0]=n*c+a*p+l,t[1]=h*p+o*c+u,t[2]=n*d+a*p+l,t[3]=h*p+o*d+u,t[4]=n*d+a*f+l,t[5]=h*f+o*d+u,t[6]=n*c+a*f+l,t[7]=h*f+o*c+u,this._roundPixels){let e=eJ.RESOLUTION;for(let r=0;r<t.length;++r)t[r]=Math.round(t[r]*e)/e}}_render(e){this.calculateVertices(),e.batch.setObjectRenderer(e.plugins[this.pluginName]),e.plugins[this.pluginName].render(this)}_calculateBounds(){let e=this._texture.trim,t=this._texture.orig;e&&(e.width!==t.width||e.height!==t.height)?(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData)):(this.calculateVertices(),this._bounds.addQuad(this.vertexData))}getLocalBounds(e){return 0===this.children.length?(this._localBounds||(this._localBounds=new nu),this._localBounds.minX=-(this._texture.orig.width*this._anchor._x),this._localBounds.minY=-(this._texture.orig.height*this._anchor._y),this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),e||(this._localBoundsRect||(this._localBoundsRect=new id),e=this._localBoundsRect),this._localBounds.getRectangle(e)):super.getLocalBounds.call(this,e)}containsPoint(e){this.worldTransform.applyInverse(e,ny);let t=this._texture.orig.width,r=this._texture.orig.height,i=-t*this.anchor.x,s=0;return ny.x>=i&&ny.x<i+t&&(s=-r*this.anchor.y,ny.y>=s&&ny.y<s+r)}destroy(e){if(super.destroy(e),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,"boolean"==typeof e?e:e?.texture){let t="boolean"==typeof e?e:e?.baseTexture;this._texture.destroy(!!t)}this._texture=null}static from(e,t){return new nv(e instanceof sh?e:sh.from(e,t))}set roundPixels(e){this._roundPixels!==e&&(this._transformID=-1,this._transformTrimmedID=-1),this._roundPixels=e}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(e){let t=to.sign(this.scale.x)||1;this.scale.x=t*e/this._texture.orig.width,this._width=e}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(e){let t=to.sign(this.scale.y)||1;this.scale.y=t*e/this._texture.orig.height,this._height=e}get anchor(){return this._anchor}set anchor(e){this._anchor.copyFrom(e)}get tint(){return this._tintColor.value}set tint(e){this._tintColor.setValue(e),this._tintRGB=this._tintColor.toLittleEndianNumber()}get tintValue(){return this._tintColor.toNumber()}get texture(){return this._texture}set texture(e){this._texture!==e&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=e||sh.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,e&&(e.baseTexture.valid?this._onTextureUpdate():e.once("update",this._onTextureUpdate,this)))}}const nb=new i_;nc.prototype._cacheAsBitmap=!1,nc.prototype._cacheData=null,nc.prototype._cacheAsBitmapResolution=null,nc.prototype._cacheAsBitmapMultisample=null;class nx{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}}Object.defineProperties(nc.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(e){e!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=e,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(e){e!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=e,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(e){let t;this._cacheAsBitmap!==e&&(this._cacheAsBitmap=e,e?(this._cacheData||(this._cacheData=new nx),(t=this._cacheData).originalRender=this.render,t.originalRenderCanvas=this.renderCanvas,t.originalUpdateTransform=this.updateTransform,t.originalCalculateBounds=this.calculateBounds,t.originalGetLocalBounds=this.getLocalBounds,t.originalDestroy=this.destroy,t.originalContainsPoint=this.containsPoint,t.originalMask=this._mask,t.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):((t=this._cacheData).sprite&&this._destroyCachedDisplayObject(),this.render=t.originalRender,this.renderCanvas=t.originalRenderCanvas,this.calculateBounds=t.originalCalculateBounds,this.getLocalBounds=t.originalGetLocalBounds,this.destroy=t.originalDestroy,this.updateTransform=t.originalUpdateTransform,this.containsPoint=t.originalContainsPoint,this._mask=t.originalMask,this.filterArea=t.originalFilterArea))}}}),nc.prototype._renderCached=function(e){this.visible&&!(this.worldAlpha<=0)&&this.renderable&&(this._initCachedDisplayObject(e),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(e))},nc.prototype._initCachedDisplayObject=function(e){if(this._cacheData?.sprite)return;let t=this.alpha;this.alpha=1,e.batch.flush();let r=this.getLocalBounds(new id,!0);if(this.filters?.length){let e=this.filters[0].padding;r.pad(e)}let i=this.cacheAsBitmapResolution||e.resolution;r.ceil(i),r.width=Math.max(r.width,1/i),r.height=Math.max(r.height,1/i);let s=e.renderTexture.current,n=e.renderTexture.sourceFrame.clone(),o=e.renderTexture.destinationFrame.clone(),a=e.projection.transform,h=sl.create({width:r.width,height:r.height,resolution:i,multisample:this.cacheAsBitmapMultisample??e.multisample}),l=`cacheAsBitmap_${to.uid()}`;this._cacheData.textureCacheId=l,r4.addToCache(h.baseTexture,l),sh.addToCache(h,l);let u=this.transform.localTransform.copyTo(nb).invert().translate(-r.x,-r.y);this.render=this._cacheData.originalRender,e.render(this,{renderTexture:h,clear:!0,transform:u,skipUpdateTransform:!1}),e.framebuffer.blit(),e.projection.transform=a,e.renderTexture.bind(s,n,o),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=t;let c=new nv(h);c.transform.worldTransform=this.transform.worldTransform,c.anchor.x=-(r.x/r.width),c.anchor.y=-(r.y/r.height),c.alpha=t,c._bounds=this._bounds,this._cacheData.sprite=c,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=c.containsPoint.bind(c)},nc.prototype._renderCachedCanvas=function(e){this.visible&&!(this.worldAlpha<=0)&&this.renderable&&(this._initCachedDisplayObjectCanvas(e),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(e))},nc.prototype._initCachedDisplayObjectCanvas=function(e){if(this._cacheData?.sprite)return;let t=this.getLocalBounds(new id,!0),r=this.alpha;this.alpha=1;let i=e.canvasContext.activeContext,s=e._projTransform,n=this.cacheAsBitmapResolution||e.resolution;t.ceil(n),t.width=Math.max(t.width,1/n),t.height=Math.max(t.height,1/n);let o=sl.create({width:t.width,height:t.height,resolution:n}),a=`cacheAsBitmap_${to.uid()}`;this._cacheData.textureCacheId=a,r4.addToCache(o.baseTexture,a),sh.addToCache(o,a),this.transform.localTransform.copyTo(nb),nb.invert(),nb.tx-=t.x,nb.ty-=t.y,this.renderCanvas=this._cacheData.originalRenderCanvas,e.render(this,{renderTexture:o,clear:!0,transform:nb,skipUpdateTransform:!1}),e.canvasContext.activeContext=i,e._projTransform=s,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=r;let h=new nv(o);h.transform.worldTransform=this.transform.worldTransform,h.anchor.x=-(t.x/t.width),h.anchor.y=-(t.y/t.height),h.alpha=r,h._bounds=this._bounds,this._cacheData.sprite=h,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=e._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=h.containsPoint.bind(h)},nc.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID},nc.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)},nc.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,r4.removeFromCache(this._cacheData.textureCacheId),sh.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null},nc.prototype._cacheAsBitmapDestroy=function(e){this.cacheAsBitmap=!1,this.destroy(e)},nc.prototype.name=null,ng.prototype.getChildByName=function(e,t){for(let t=0,r=this.children.length;t<r;t++)if(this.children[t].name===e)return this.children[t];if(t)for(let t=0,r=this.children.length;t<r;t++){let r=this.children[t];if(!r.getChildByName)continue;let i=r.getChildByName(e,!0);if(i)return i}return null},nc.prototype.getGlobalPosition=function(e=new iu,t=!1){return this.parent?this.parent.toGlobal(this.position,e,t):(e.x=this.position.x,e.y=this.position.y),e};var nT=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform float uAlpha;

void main(void)
{
   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;
}
`;const nE={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},nw=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join(`
`),nA=`
    attribute vec2 aVertexPosition;

    uniform mat3 projectionMatrix;

    uniform float strength;

    varying vec2 vBlurTexCoords[%size%];

    uniform vec4 inputSize;
    uniform vec4 outputFrame;

    vec4 filterVertexPosition( void )
    {
        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
    }

    vec2 filterTextureCoord( void )
    {
        return aVertexPosition * (outputFrame.zw * inputSize.zw);
    }

    void main(void)
    {
        gl_Position = filterVertexPosition();

        vec2 textureCoord = filterTextureCoord();
        %blur%
    }`;class nS extends i5{constructor(e,t=8,r=4,i=i5.defaultResolution,s=5){super(function(e,t){let r=Math.ceil(e/2),i=nA,s="",n;n=t?"vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":"vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(let t=0;t<e;t++){let e=n.replace("%index%",t.toString());s+=(e=e.replace("%sampleIndex%",`${t-(r-1)}.0`))+`
`}return(i=i.replace("%blur%",s)).replace("%size%",e.toString())}(s,e),function(e){let t;let r=nE[e],i=r.length,s=nw,n="";for(let s=0;s<e;s++){let o="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;".replace("%index%",s.toString());t=s,s>=i&&(t=e-s-1),n+=(o=o.replace("%value%",r[t].toString()))+`
`}return(s=s.replace("%blur%",n)).replace("%size%",e.toString())}(s)),this.horizontal=e,this.resolution=i,this._quality=0,this.quality=r,this.blur=t}apply(e,t,r,i){if(r?this.horizontal?this.uniforms.strength=1/r.width*(r.width/t.width):this.uniforms.strength=1/r.height*(r.height/t.height):this.horizontal?this.uniforms.strength=1/e.renderer.width*(e.renderer.width/t.width):this.uniforms.strength=1/e.renderer.height*(e.renderer.height/t.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,1===this.passes)e.applyFilter(this,t,r,i);else{let s=e.getFilterTexture(),n=e.renderer,o=t,a=s;this.state.blend=!1,e.applyFilter(this,o,a,eV.CLEAR);for(let t=1;t<this.passes-1;t++){e.bindAndClear(o,eV.BLIT),this.uniforms.uSampler=a;let t=a;a=o,o=t,n.shader.bind(this),n.geometry.draw(5)}this.state.blend=!0,e.applyFilter(this,a,r,i),e.returnFilterTexture(s)}}get blur(){return this.strength}set blur(e){this.padding=1+2*Math.abs(e),this.strength=e}get quality(){return this._quality}set quality(e){this._quality=e,this.passes=e}}var nC=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform float m[20];
uniform float uAlpha;

void main(void)
{
    vec4 c = texture2D(uSampler, vTextureCoord);

    if (uAlpha == 0.0) {
        gl_FragColor = c;
        return;
    }

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (c.a > 0.0) {
      c.rgb /= c.a;
    }

    vec4 result;

    result.r = (m[0] * c.r);
        result.r += (m[1] * c.g);
        result.r += (m[2] * c.b);
        result.r += (m[3] * c.a);
        result.r += m[4];

    result.g = (m[5] * c.r);
        result.g += (m[6] * c.g);
        result.g += (m[7] * c.b);
        result.g += (m[8] * c.a);
        result.g += m[9];

    result.b = (m[10] * c.r);
       result.b += (m[11] * c.g);
       result.b += (m[12] * c.b);
       result.b += (m[13] * c.a);
       result.b += m[14];

    result.a = (m[15] * c.r);
       result.a += (m[16] * c.g);
       result.a += (m[17] * c.b);
       result.a += (m[18] * c.a);
       result.a += m[19];

    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);

    // Premultiply alpha again.
    rgb *= result.a;

    gl_FragColor = vec4(rgb, result.a);
}
`;class nR extends i5{constructor(){super(s7,nC,{m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1}),this.alpha=1}_loadMatrix(e,t=!1){let r=e;t&&(this._multiply(r,this.uniforms.m,e),r=this._colorMatrix(r)),this.uniforms.m=r}_multiply(e,t,r){return e[0]=t[0]*r[0]+t[1]*r[5]+t[2]*r[10]+t[3]*r[15],e[1]=t[0]*r[1]+t[1]*r[6]+t[2]*r[11]+t[3]*r[16],e[2]=t[0]*r[2]+t[1]*r[7]+t[2]*r[12]+t[3]*r[17],e[3]=t[0]*r[3]+t[1]*r[8]+t[2]*r[13]+t[3]*r[18],e[4]=t[0]*r[4]+t[1]*r[9]+t[2]*r[14]+t[3]*r[19]+t[4],e[5]=t[5]*r[0]+t[6]*r[5]+t[7]*r[10]+t[8]*r[15],e[6]=t[5]*r[1]+t[6]*r[6]+t[7]*r[11]+t[8]*r[16],e[7]=t[5]*r[2]+t[6]*r[7]+t[7]*r[12]+t[8]*r[17],e[8]=t[5]*r[3]+t[6]*r[8]+t[7]*r[13]+t[8]*r[18],e[9]=t[5]*r[4]+t[6]*r[9]+t[7]*r[14]+t[8]*r[19]+t[9],e[10]=t[10]*r[0]+t[11]*r[5]+t[12]*r[10]+t[13]*r[15],e[11]=t[10]*r[1]+t[11]*r[6]+t[12]*r[11]+t[13]*r[16],e[12]=t[10]*r[2]+t[11]*r[7]+t[12]*r[12]+t[13]*r[17],e[13]=t[10]*r[3]+t[11]*r[8]+t[12]*r[13]+t[13]*r[18],e[14]=t[10]*r[4]+t[11]*r[9]+t[12]*r[14]+t[13]*r[19]+t[14],e[15]=t[15]*r[0]+t[16]*r[5]+t[17]*r[10]+t[18]*r[15],e[16]=t[15]*r[1]+t[16]*r[6]+t[17]*r[11]+t[18]*r[16],e[17]=t[15]*r[2]+t[16]*r[7]+t[17]*r[12]+t[18]*r[17],e[18]=t[15]*r[3]+t[16]*r[8]+t[17]*r[13]+t[18]*r[18],e[19]=t[15]*r[4]+t[16]*r[9]+t[17]*r[14]+t[18]*r[19]+t[19],e}_colorMatrix(e){let t=new Float32Array(e);return t[4]/=255,t[9]/=255,t[14]/=255,t[19]/=255,t}brightness(e,t){this._loadMatrix([e,0,0,0,0,0,e,0,0,0,0,0,e,0,0,0,0,0,1,0],t)}tint(e,t){let[r,i,s]=ra.shared.setValue(e).toArray();this._loadMatrix([r,0,0,0,0,0,i,0,0,0,0,0,s,0,0,0,0,0,1,0],t)}greyscale(e,t){this._loadMatrix([e,e,e,0,0,e,e,e,0,0,e,e,e,0,0,0,0,0,1,0],t)}blackAndWhite(e){this._loadMatrix([.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0],e)}hue(e,t){let r=Math.cos(e=(e||0)/180*Math.PI),i=Math.sin(e),s=1/3,n=(0,Math.sqrt)(1/3);this._loadMatrix([r+(1-r)*s,s*(1-r)-n*i,s*(1-r)+n*i,0,0,s*(1-r)+n*i,r+s*(1-r),s*(1-r)-n*i,0,0,s*(1-r)-n*i,s*(1-r)+n*i,r+s*(1-r),0,0,0,0,0,1,0],t)}contrast(e,t){let r=(e||0)+1,i=-.5*(r-1);this._loadMatrix([r,0,0,0,i,0,r,0,0,i,0,0,r,0,i,0,0,0,1,0],t)}saturate(e=0,t){let r=2*e/3+1,i=-((r-1)*.5);this._loadMatrix([r,i,i,0,0,i,r,i,0,0,i,i,r,0,0,0,0,0,1,0],t)}desaturate(){this.saturate(-1)}negative(e){this._loadMatrix([-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0],e)}sepia(e){this._loadMatrix([.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0],e)}technicolor(e){this._loadMatrix([1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0],e)}polaroid(e){this._loadMatrix([1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],e)}toBGR(e){this._loadMatrix([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0],e)}kodachrome(e){this._loadMatrix([1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0],e)}browni(e){this._loadMatrix([.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0],e)}vintage(e){this._loadMatrix([.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0],e)}colorTone(e,t,r,i,s){e=e||.2,t=t||.15,r=r||16770432,i=i||3375104;let n=ra.shared,[o,a,h]=n.setValue(r).toArray(),[l,u,c]=n.setValue(i).toArray(),d=[.3,.59,.11,0,0,o,a,h,e,0,l,u,c,t,0,o-l,a-u,h-c,0,0];this._loadMatrix(d,s)}night(e,t){let r=[-2*(e=e||.1),-e,0,0,0,-e,0,e,0,0,0,e,2*e,0,0,0,0,0,1,0];this._loadMatrix(r,t)}predator(e,t){this._loadMatrix([11.224130630493164*e,-4.794486999511719*e,-2.8746118545532227*e,0*e,.40342438220977783*e,-3.6330697536468506*e,9.193157196044922*e,-2.951810836791992*e,0*e,-1.316135048866272*e,-3.2184197902679443*e,-4.2375030517578125*e,7.476448059082031*e,0*e,.8044459223747253*e,0,0,0,1,0],t)}lsd(e){this._loadMatrix([2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0],e)}reset(){this._loadMatrix([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],!1)}get matrix(){return this.uniforms.m}set matrix(e){this.uniforms.m=e}get alpha(){return this.uniforms.uAlpha}set alpha(e){this.uniforms.uAlpha=e}}nR.prototype.grayscale=nR.prototype.greyscale;var nI=`varying vec2 vFilterCoord;
varying vec2 vTextureCoord;

uniform vec2 scale;
uniform mat2 rotation;
uniform sampler2D uSampler;
uniform sampler2D mapSampler;

uniform highp vec4 inputSize;
uniform vec4 inputClamp;

void main(void)
{
  vec4 map =  texture2D(mapSampler, vFilterCoord);

  map -= 0.5;
  map.xy = scale * inputSize.zw * (rotation * map.xy);

  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));
}
`,nP=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;
uniform mat3 filterMatrix;

varying vec2 vTextureCoord;
varying vec2 vFilterCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
	gl_Position = filterVertexPosition();
	vTextureCoord = filterTextureCoord();
	vFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;
}
`,nM=`varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;
uniform sampler2D uSampler;
uniform highp vec4 inputSize;


/**
 Basic FXAA implementation based on the code on geeks3d.com with the
 modification that the texture2DLod stuff was removed since it's
 unsupported by WebGL.

 --

 From:
 https://github.com/mitsuhiko/webgl-meincraft

 Copyright (c) 2011 by Armin Ronacher.

 Some rights reserved.

 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions are
 met:

 * Redistributions of source code must retain the above copyright
 notice, this list of conditions and the following disclaimer.

 * Redistributions in binary form must reproduce the above
 copyright notice, this list of conditions and the following
 disclaimer in the documentation and/or other materials provided
 with the distribution.

 * The names of the contributors may not be used to endorse or
 promote products derived from this software without specific
 prior written permission.

 THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

#ifndef FXAA_REDUCE_MIN
#define FXAA_REDUCE_MIN   (1.0/ 128.0)
#endif
#ifndef FXAA_REDUCE_MUL
#define FXAA_REDUCE_MUL   (1.0 / 8.0)
#endif
#ifndef FXAA_SPAN_MAX
#define FXAA_SPAN_MAX     8.0
#endif

//optimized version for mobile, where dependent
//texture reads can be a bottleneck
vec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,
          vec2 v_rgbNW, vec2 v_rgbNE,
          vec2 v_rgbSW, vec2 v_rgbSE,
          vec2 v_rgbM) {
    vec4 color;
    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;
    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;
    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;
    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;
    vec4 texColor = texture2D(tex, v_rgbM);
    vec3 rgbM  = texColor.xyz;
    vec3 luma = vec3(0.299, 0.587, 0.114);
    float lumaNW = dot(rgbNW, luma);
    float lumaNE = dot(rgbNE, luma);
    float lumaSW = dot(rgbSW, luma);
    float lumaSE = dot(rgbSE, luma);
    float lumaM  = dot(rgbM,  luma);
    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));

    mediump vec2 dir;
    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));

    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *
                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);

    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);
    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),
              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),
                  dir * rcpDirMin)) * inverseVP;

    vec3 rgbA = 0.5 * (
                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +
                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);
    vec3 rgbB = rgbA * 0.5 + 0.25 * (
                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +
                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);

    float lumaB = dot(rgbB, luma);
    if ((lumaB < lumaMin) || (lumaB > lumaMax))
        color = vec4(rgbA, texColor.a);
    else
        color = vec4(rgbB, texColor.a);
    return color;
}

void main() {

      vec4 color;

      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);

      gl_FragColor = color;
}
`,nD=`
attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

void texcoords(vec2 fragCoord, vec2 inverseVP,
               out vec2 v_rgbNW, out vec2 v_rgbNE,
               out vec2 v_rgbSW, out vec2 v_rgbSE,
               out vec2 v_rgbM) {
    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;
    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;
    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;
    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;
    v_rgbM = vec2(fragCoord * inverseVP);
}

void main(void) {

   gl_Position = filterVertexPosition();

   vFragCoord = aVertexPosition * outputFrame.zw;

   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);
}
`,nk=`precision highp float;

varying vec2 vTextureCoord;
varying vec4 vColor;

uniform float uNoise;
uniform float uSeed;
uniform sampler2D uSampler;

float rand(vec2 co)
{
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

void main()
{
    vec4 color = texture2D(uSampler, vTextureCoord);
    float randomValue = rand(gl_FragCoord.xy * uSeed);
    float diff = (randomValue - 0.5) * uNoise;

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (color.a > 0.0) {
        color.rgb /= color.a;
    }

    color.r += diff;
    color.g += diff;
    color.b += diff;

    // Premultiply alpha again.
    color.rgb *= color.a;

    gl_FragColor = color;
}
`;const nO={AlphaFilter:class extends i5{constructor(e=1){super(s9,nT,{uAlpha:1}),this.alpha=e}get alpha(){return this.uniforms.uAlpha}set alpha(e){this.uniforms.uAlpha=e}},BlurFilter:class extends i5{constructor(e=8,t=4,r=i5.defaultResolution,i=5){super(),this._repeatEdgePixels=!1,this.blurXFilter=new nS(!0,e,t,r,i),this.blurYFilter=new nS(!1,e,t,r,i),this.resolution=r,this.quality=t,this.blur=e,this.repeatEdgePixels=!1}apply(e,t,r,i){let s=Math.abs(this.blurXFilter.strength),n=Math.abs(this.blurYFilter.strength);if(s&&n){let s=e.getFilterTexture();this.blurXFilter.apply(e,t,s,eV.CLEAR),this.blurYFilter.apply(e,s,r,i),e.returnFilterTexture(s)}else n?this.blurYFilter.apply(e,t,r,i):this.blurXFilter.apply(e,t,r,i)}updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=2*Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))}get blur(){return this.blurXFilter.blur}set blur(e){this.blurXFilter.blur=this.blurYFilter.blur=e,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(e){this.blurXFilter.quality=this.blurYFilter.quality=e}get blurX(){return this.blurXFilter.blur}set blurX(e){this.blurXFilter.blur=e,this.updatePadding()}get blurY(){return this.blurYFilter.blur}set blurY(e){this.blurYFilter.blur=e,this.updatePadding()}get blendMode(){return this.blurYFilter.blendMode}set blendMode(e){this.blurYFilter.blendMode=e}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(e){this._repeatEdgePixels=e,this.updatePadding()}},BlurFilterPass:nS,ColorMatrixFilter:nR,DisplacementFilter:class extends i5{constructor(e,t){let r=new i_;e.renderable=!1,super(nP,nI,{mapSampler:e._texture,filterMatrix:r,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])}),this.maskSprite=e,this.maskMatrix=r,null==t&&(t=20),this.scale=new iu(t,t)}apply(e,t,r,i){this.uniforms.filterMatrix=e.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;let s=this.maskSprite.worldTransform,n=Math.sqrt(s.a*s.a+s.b*s.b),o=Math.sqrt(s.c*s.c+s.d*s.d);0!==n&&0!==o&&(this.uniforms.rotation[0]=s.a/n,this.uniforms.rotation[1]=s.b/n,this.uniforms.rotation[2]=s.c/o,this.uniforms.rotation[3]=s.d/o),e.applyFilter(this,t,r,i)}get map(){return this.uniforms.mapSampler}set map(e){this.uniforms.mapSampler=e}},FXAAFilter:class extends i5{constructor(){super(nD,nM)}},NoiseFilter:class extends i5{constructor(e=.5,t=Math.random()){super(s7,nk,{uNoise:0,uSeed:0}),this.noise=e,this.seed=t}get noise(){return this.uniforms.uNoise}set noise(e){this.uniforms.uNoise=e}get seed(){return this.uniforms.uSeed}set seed(e){this.uniforms.uSeed=e}}};Object.entries(nO).forEach(([e,t])=>{Object.defineProperty(nO,e,{get:()=>(to.deprecation("7.1.0",`filters.${e} has moved to ${e}`),t)})});const nB=new class{constructor(){this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}init(e){this.removeTickerListener(),this.events=e,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}get pauseUpdate(){return this._pauseUpdate}set pauseUpdate(e){this._pauseUpdate=e}addTickerListener(){this.tickerAdded||!this.domElement||(s6.system.add(this.tickerUpdate,this,s3.INTERACTION),this.tickerAdded=!0)}removeTickerListener(){this.tickerAdded&&(s6.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)}pointerMoved(){this._didMove=!0}update(){if(!this.domElement||this._pauseUpdate)return;if(this._didMove){this._didMove=!1;return}let e=this.events.rootPointerEvent;this.events.supportsTouchEvents&&"touch"===e.pointerType||globalThis.document.dispatchEvent(new PointerEvent("pointermove",{clientX:e.clientX,clientY:e.clientY}))}tickerUpdate(e){this._deltaTime+=e,this._deltaTime<this.interactionFrequency||(this._deltaTime=0,this.update())}};class nL{constructor(e){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=nL.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new iu,this.page=new iu,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=e}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(e,t,r){throw Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(e,t,r,i,s){throw Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}class nF extends nL{constructor(){super(...arguments),this.client=new iu,this.movement=new iu,this.offset=new iu,this.global=new iu,this.screen=new iu}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getLocalPosition(e,t,r){return e.worldTransform.applyInverse(r||this.global,t)}getModifierState(e){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(e)}initMouseEvent(e,t,r,i,s,n,o,a,h,l,u,c,d,p,f){throw Error("Method not implemented.")}}class nN extends nF{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return"pointermove"===this.type||"mousemove"===this.type||"touchmove"===this.type?[this]:[]}getPredictedEvents(){throw Error("getPredictedEvents is not supported!")}}class nU extends nF{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}}nU.DOM_DELTA_PIXEL=0,nU.DOM_DELTA_LINE=1,nU.DOM_DELTA_PAGE=2;const nG=new iu,nj=new iu;class nH{constructor(e){this.dispatch=new to.EventEmitter,this.moveOnAll=!1,this.enableGlobalMoveEvents=!0,this.mappingState={trackingData:{}},this.eventPool=new Map,this._allInteractiveElements=[],this._hitElements=[],this._isPointerMoveEvent=!1,this.rootTarget=e,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(e,t){this.mappingTable[e]||(this.mappingTable[e]=[]),this.mappingTable[e].push({fn:t,priority:0}),this.mappingTable[e].sort((e,t)=>e.priority-t.priority)}dispatchEvent(e,t){e.propagationStopped=!1,e.propagationImmediatelyStopped=!1,this.propagate(e,t),this.dispatch.emit(t||e.type,e)}mapEvent(e){if(!this.rootTarget)return;let t=this.mappingTable[e.type];if(t)for(let r=0,i=t.length;r<i;r++)t[r].fn(e);else console.warn(`[EventBoundary]: Event mapping not defined for ${e.type}`)}hitTest(e,t){nB.pauseUpdate=!0;let r=this[this._isPointerMoveEvent&&this.enableGlobalMoveEvents?"hitTestMoveRecursive":"hitTestRecursive"](this.rootTarget,this.rootTarget.eventMode,nG.set(e,t),this.hitTestFn,this.hitPruneFn);return r&&r[0]}propagate(e,t){if(!e.target)return;let r=e.composedPath();e.eventPhase=e.CAPTURING_PHASE;for(let i=0,s=r.length-1;i<s;i++)if(e.currentTarget=r[i],this.notifyTarget(e,t),e.propagationStopped||e.propagationImmediatelyStopped)return;if(e.eventPhase=e.AT_TARGET,e.currentTarget=e.target,this.notifyTarget(e,t),!(e.propagationStopped||e.propagationImmediatelyStopped)){e.eventPhase=e.BUBBLING_PHASE;for(let i=r.length-2;i>=0;i--)if(e.currentTarget=r[i],this.notifyTarget(e,t),e.propagationStopped||e.propagationImmediatelyStopped)return}}all(e,t,r=this._allInteractiveElements){if(0===r.length)return;e.eventPhase=e.BUBBLING_PHASE;let i=Array.isArray(t)?t:[t];for(let t=r.length-1;t>=0;t--)i.forEach(i=>{e.currentTarget=r[t],this.notifyTarget(e,i)})}propagationPath(e){let t=[e];for(let r=0;r<2048&&e!==this.rootTarget;r++){if(!e.parent)throw Error("Cannot find propagation path to disconnected target");t.push(e.parent),e=e.parent}return t.reverse(),t}hitTestMoveRecursive(e,t,r,i,s,n=!1){let o=!1;if(this._interactivePrune(e))return null;if(("dynamic"===e.eventMode||"dynamic"===t)&&(nB.pauseUpdate=!1),e.interactiveChildren&&e.children){let a=e.children;for(let h=a.length-1;h>=0;h--){let l=a[h],u=this.hitTestMoveRecursive(l,this._isInteractive(t)?t:l.eventMode,r,i,s,n||s(e,r));if(u){if(u.length>0&&!u[u.length-1].parent)continue;let t=e.isInteractive();(u.length>0||t)&&(t&&this._allInteractiveElements.push(e),u.push(e)),0===this._hitElements.length&&(this._hitElements=u),o=!0}}}let a=this._isInteractive(t),h=e.isInteractive();return a&&h&&this._allInteractiveElements.push(e),n||this._hitElements.length>0?null:o?this._hitElements:a&&!s(e,r)&&i(e,r)?h?[e]:[]:null}hitTestRecursive(e,t,r,i,s){if(this._interactivePrune(e)||s(e,r))return null;if(("dynamic"===e.eventMode||"dynamic"===t)&&(nB.pauseUpdate=!1),e.interactiveChildren&&e.children){let n=e.children;for(let o=n.length-1;o>=0;o--){let a=n[o],h=this.hitTestRecursive(a,this._isInteractive(t)?t:a.eventMode,r,i,s);if(h){if(h.length>0&&!h[h.length-1].parent)continue;let t=e.isInteractive();return(h.length>0||t)&&h.push(e),h}}}let n=this._isInteractive(t),o=e.isInteractive();return n&&i(e,r)?o?[e]:[]:null}_isInteractive(e){return"static"===e||"dynamic"===e}_interactivePrune(e){return!!(!e||e.isMask||!e.visible||!e.renderable||"none"===e.eventMode||"passive"===e.eventMode&&!e.interactiveChildren||e.isMask)}hitPruneFn(e,t){if(e.hitArea&&(e.worldTransform.applyInverse(t,nj),!e.hitArea.contains(nj.x,nj.y)))return!0;if(e._mask){let r=e._mask.isMaskData?e._mask.maskObject:e._mask;if(r&&!r.containsPoint?.(t))return!0}return!1}hitTestFn(e,t){return"passive"!==e.eventMode&&(!!e.hitArea||!!e.containsPoint&&e.containsPoint(t))}notifyTarget(e,t){t=t??e.type;let r=`on${t}`;e.currentTarget[r]?.(e);let i=e.eventPhase===e.CAPTURING_PHASE||e.eventPhase===e.AT_TARGET?`${t}capture`:t;this.notifyListeners(e,i),e.eventPhase===e.AT_TARGET&&this.notifyListeners(e,t)}mapPointerDown(e){if(!(e instanceof nN)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}let t=this.createPointerEvent(e);if(this.dispatchEvent(t,"pointerdown"),"touch"===t.pointerType)this.dispatchEvent(t,"touchstart");else if("mouse"===t.pointerType||"pen"===t.pointerType){let e=2===t.button;this.dispatchEvent(t,e?"rightdown":"mousedown")}this.trackingData(e.pointerId).pressTargetsByButton[e.button]=t.composedPath(),this.freeEvent(t)}mapPointerMove(e){if(!(e instanceof nN)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}this._allInteractiveElements.length=0,this._hitElements.length=0,this._isPointerMoveEvent=!0;let t=this.createPointerEvent(e);this._isPointerMoveEvent=!1;let r="mouse"===t.pointerType||"pen"===t.pointerType,i=this.trackingData(e.pointerId),s=this.findMountedTarget(i.overTargets);if(i.overTargets?.length>0&&s!==t.target){let i="mousemove"===e.type?"mouseout":"pointerout",n=this.createPointerEvent(e,i,s);if(this.dispatchEvent(n,"pointerout"),r&&this.dispatchEvent(n,"mouseout"),!t.composedPath().includes(s)){let i=this.createPointerEvent(e,"pointerleave",s);for(i.eventPhase=i.AT_TARGET;i.target&&!t.composedPath().includes(i.target);)i.currentTarget=i.target,this.notifyTarget(i),r&&this.notifyTarget(i,"mouseleave"),i.target=i.target.parent;this.freeEvent(i)}this.freeEvent(n)}if(s!==t.target){let i="mousemove"===e.type?"mouseover":"pointerover",n=this.clonePointerEvent(t,i);this.dispatchEvent(n,"pointerover"),r&&this.dispatchEvent(n,"mouseover");let o=s?.parent;for(;o&&o!==this.rootTarget.parent&&o!==t.target;)o=o.parent;if(!o||o===this.rootTarget.parent){let e=this.clonePointerEvent(t,"pointerenter");for(e.eventPhase=e.AT_TARGET;e.target&&e.target!==s&&e.target!==this.rootTarget.parent;)e.currentTarget=e.target,this.notifyTarget(e),r&&this.notifyTarget(e,"mouseenter"),e.target=e.target.parent;this.freeEvent(e)}this.freeEvent(n)}let n=[],o=this.enableGlobalMoveEvents??!0;this.moveOnAll?n.push("pointermove"):this.dispatchEvent(t,"pointermove"),o&&n.push("globalpointermove"),"touch"===t.pointerType&&(this.moveOnAll?n.splice(1,0,"touchmove"):this.dispatchEvent(t,"touchmove"),o&&n.push("globaltouchmove")),r&&(this.moveOnAll?n.splice(1,0,"mousemove"):this.dispatchEvent(t,"mousemove"),o&&n.push("globalmousemove"),this.cursor=t.target?.cursor),n.length>0&&this.all(t,n),this._allInteractiveElements.length=0,this._hitElements.length=0,i.overTargets=t.composedPath(),this.freeEvent(t)}mapPointerOver(e){if(!(e instanceof nN)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}let t=this.trackingData(e.pointerId),r=this.createPointerEvent(e),i="mouse"===r.pointerType||"pen"===r.pointerType;this.dispatchEvent(r,"pointerover"),i&&this.dispatchEvent(r,"mouseover"),"mouse"===r.pointerType&&(this.cursor=r.target?.cursor);let s=this.clonePointerEvent(r,"pointerenter");for(s.eventPhase=s.AT_TARGET;s.target&&s.target!==this.rootTarget.parent;)s.currentTarget=s.target,this.notifyTarget(s),i&&this.notifyTarget(s,"mouseenter"),s.target=s.target.parent;t.overTargets=r.composedPath(),this.freeEvent(r),this.freeEvent(s)}mapPointerOut(e){if(!(e instanceof nN)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}let t=this.trackingData(e.pointerId);if(t.overTargets){let r="mouse"===e.pointerType||"pen"===e.pointerType,i=this.findMountedTarget(t.overTargets),s=this.createPointerEvent(e,"pointerout",i);this.dispatchEvent(s),r&&this.dispatchEvent(s,"mouseout");let n=this.createPointerEvent(e,"pointerleave",i);for(n.eventPhase=n.AT_TARGET;n.target&&n.target!==this.rootTarget.parent;)n.currentTarget=n.target,this.notifyTarget(n),r&&this.notifyTarget(n,"mouseleave"),n.target=n.target.parent;t.overTargets=null,this.freeEvent(s),this.freeEvent(n)}this.cursor=null}mapPointerUp(e){if(!(e instanceof nN)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}let t=performance.now(),r=this.createPointerEvent(e);if(this.dispatchEvent(r,"pointerup"),"touch"===r.pointerType)this.dispatchEvent(r,"touchend");else if("mouse"===r.pointerType||"pen"===r.pointerType){let e=2===r.button;this.dispatchEvent(r,e?"rightup":"mouseup")}let i=this.trackingData(e.pointerId),s=this.findMountedTarget(i.pressTargetsByButton[e.button]),n=s;if(s&&!r.composedPath().includes(s)){let t=s;for(;t&&!r.composedPath().includes(t);){if(r.currentTarget=t,this.notifyTarget(r,"pointerupoutside"),"touch"===r.pointerType)this.notifyTarget(r,"touchendoutside");else if("mouse"===r.pointerType||"pen"===r.pointerType){let e=2===r.button;this.notifyTarget(r,e?"rightupoutside":"mouseupoutside")}t=t.parent}delete i.pressTargetsByButton[e.button],n=t}if(n){let s=this.clonePointerEvent(r,"click");s.target=n,s.path=null,i.clicksByButton[e.button]||(i.clicksByButton[e.button]={clickCount:0,target:s.target,timeStamp:t});let o=i.clicksByButton[e.button];if(o.target===s.target&&t-o.timeStamp<200?++o.clickCount:o.clickCount=1,o.target=s.target,o.timeStamp=t,s.detail=o.clickCount,"mouse"===s.pointerType){let e=2===s.button;this.dispatchEvent(s,e?"rightclick":"click")}else"touch"===s.pointerType&&this.dispatchEvent(s,"tap");this.dispatchEvent(s,"pointertap"),this.freeEvent(s)}this.freeEvent(r)}mapPointerUpOutside(e){if(!(e instanceof nN)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}let t=this.trackingData(e.pointerId),r=this.findMountedTarget(t.pressTargetsByButton[e.button]),i=this.createPointerEvent(e);if(r){let s=r;for(;s;)i.currentTarget=s,this.notifyTarget(i,"pointerupoutside"),"touch"===i.pointerType?this.notifyTarget(i,"touchendoutside"):("mouse"===i.pointerType||"pen"===i.pointerType)&&this.notifyTarget(i,2===i.button?"rightupoutside":"mouseupoutside"),s=s.parent;delete t.pressTargetsByButton[e.button]}this.freeEvent(i)}mapWheel(e){if(!(e instanceof nU)){console.warn("EventBoundary cannot map a non-wheel event as a wheel event");return}let t=this.createWheelEvent(e);this.dispatchEvent(t),this.freeEvent(t)}findMountedTarget(e){if(!e)return null;let t=e[0];for(let r=1;r<e.length&&e[r].parent===t;r++)t=e[r];return t}createPointerEvent(e,t,r){let i=this.allocateEvent(nN);return this.copyPointerData(e,i),this.copyMouseData(e,i),this.copyData(e,i),i.nativeEvent=e.nativeEvent,i.originalEvent=e,i.target=r??this.hitTest(i.global.x,i.global.y)??this._hitElements[0],"string"==typeof t&&(i.type=t),i}createWheelEvent(e){let t=this.allocateEvent(nU);return this.copyWheelData(e,t),this.copyMouseData(e,t),this.copyData(e,t),t.nativeEvent=e.nativeEvent,t.originalEvent=e,t.target=this.hitTest(t.global.x,t.global.y),t}clonePointerEvent(e,t){let r=this.allocateEvent(nN);return r.nativeEvent=e.nativeEvent,r.originalEvent=e.originalEvent,this.copyPointerData(e,r),this.copyMouseData(e,r),this.copyData(e,r),r.target=e.target,r.path=e.composedPath().slice(),r.type=t??r.type,r}copyWheelData(e,t){t.deltaMode=e.deltaMode,t.deltaX=e.deltaX,t.deltaY=e.deltaY,t.deltaZ=e.deltaZ}copyPointerData(e,t){e instanceof nN&&t instanceof nN&&(t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist)}copyMouseData(e,t){e instanceof nF&&t instanceof nF&&(t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.copyFrom(e.client),t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.movement.copyFrom(e.movement),t.screen.copyFrom(e.screen),t.shiftKey=e.shiftKey,t.global.copyFrom(e.global))}copyData(e,t){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.detail=e.detail,t.view=e.view,t.which=e.which,t.layer.copyFrom(e.layer),t.page.copyFrom(e.page)}trackingData(e){return this.mappingState.trackingData[e]||(this.mappingState.trackingData[e]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[e]}allocateEvent(e){this.eventPool.has(e)||this.eventPool.set(e,[]);let t=this.eventPool.get(e).pop()||new e(this);return t.eventPhase=t.NONE,t.currentTarget=null,t.path=null,t.target=null,t}freeEvent(e){if(e.manager!==this)throw Error("It is illegal to free an event not managed by this EventBoundary!");let t=e.constructor;this.eventPool.has(t)||this.eventPool.set(t,[]),this.eventPool.get(t).push(e)}notifyListeners(e,t){let r=e.currentTarget._events[t];if(r&&e.currentTarget.isInteractive()){if("fn"in r)r.once&&e.currentTarget.removeListener(t,r.fn,void 0,!0),r.fn.call(r.context,e);else for(let i=0,s=r.length;i<s&&!e.propagationImmediatelyStopped;i++)r[i].once&&e.currentTarget.removeListener(t,r[i].fn,void 0,!0),r[i].fn.call(r[i].context,e)}}}const nz={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},nV=class e{constructor(t){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=t,this.rootBoundary=new nH(null),nB.init(this),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new nN(null),this.rootWheelEvent=new nU(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.features=new Proxy({...e.defaultEventFeatures},{set:(e,t,r)=>("globalMove"===t&&(this.rootBoundary.enableGlobalMoveEvents=r),e[t]=r,!0)}),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this._defaultEventMode}init(t){let{view:r,resolution:i}=this.renderer;this.setTargetElement(r),this.resolution=i,e._defaultEventMode=t.eventMode??"auto",Object.assign(this.features,t.eventFeatures??{}),this.rootBoundary.enableGlobalMoveEvents=this.features.globalMove}resolutionChange(e){this.resolution=e}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(e){e=e||"default";let t=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(t=!1),this.currentCursor===e)return;this.currentCursor=e;let r=this.cursorStyles[e];if(r)switch(typeof r){case"string":t&&(this.domElement.style.cursor=r);break;case"function":r(e);break;case"object":t&&Object.assign(this.domElement.style,r)}else t&&"string"==typeof e&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,e)&&(this.domElement.style.cursor=e)}get pointer(){return this.rootPointerEvent}onPointerDown(e){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;let t=this.normalizeToPointerData(e);this.autoPreventDefault&&t[0].isNormalized&&(e.cancelable||!("cancelable"in e))&&e.preventDefault();for(let e=0,r=t.length;e<r;e++){let r=t[e],i=this.bootstrapEvent(this.rootPointerEvent,r);this.rootBoundary.mapEvent(i)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(e){if(!this.features.move)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,nB.pointerMoved();let t=this.normalizeToPointerData(e);for(let e=0,r=t.length;e<r;e++){let r=this.bootstrapEvent(this.rootPointerEvent,t[e]);this.rootBoundary.mapEvent(r)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(e){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;let t=e.target;e.composedPath&&e.composedPath().length>0&&(t=e.composedPath()[0]);let r=t!==this.domElement?"outside":"",i=this.normalizeToPointerData(e);for(let e=0,t=i.length;e<t;e++){let t=this.bootstrapEvent(this.rootPointerEvent,i[e]);t.type+=r,this.rootBoundary.mapEvent(t)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(e){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;let t=this.normalizeToPointerData(e);for(let e=0,r=t.length;e<r;e++){let r=this.bootstrapEvent(this.rootPointerEvent,t[e]);this.rootBoundary.mapEvent(r)}this.setCursor(this.rootBoundary.cursor)}onWheel(e){if(!this.features.wheel)return;let t=this.normalizeWheelEvent(e);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(t)}setTargetElement(e){this.removeEvents(),this.domElement=e,nB.domElement=e,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;nB.addTickerListener();let e=this.domElement.style;e&&(globalThis.navigator.msPointerEnabled?(e.msContentZooming="none",e.msTouchAction="none"):this.supportsPointerEvents&&(e.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0))),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;nB.removeTickerListener();let e=this.domElement.style;globalThis.navigator.msPointerEnabled?(e.msContentZooming="",e.msTouchAction=""):this.supportsPointerEvents&&(e.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0))),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(e,t,r){let i=this.domElement.isConnected?this.domElement.getBoundingClientRect():{x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0},s=1/this.resolution;e.x=(t-i.left)*(this.domElement.width/i.width)*s,e.y=(r-i.top)*(this.domElement.height/i.height)*s}normalizeToPointerData(e){let t=[];if(this.supportsTouchEvents&&e instanceof TouchEvent)for(let r=0,i=e.changedTouches.length;r<i;r++){let i=e.changedTouches[r];typeof i.button>"u"&&(i.button=0),typeof i.buttons>"u"&&(i.buttons=1),typeof i.isPrimary>"u"&&(i.isPrimary=1===e.touches.length&&"touchstart"===e.type),typeof i.width>"u"&&(i.width=i.radiusX||1),typeof i.height>"u"&&(i.height=i.radiusY||1),typeof i.tiltX>"u"&&(i.tiltX=0),typeof i.tiltY>"u"&&(i.tiltY=0),typeof i.pointerType>"u"&&(i.pointerType="touch"),typeof i.pointerId>"u"&&(i.pointerId=i.identifier||0),typeof i.pressure>"u"&&(i.pressure=i.force||.5),typeof i.twist>"u"&&(i.twist=0),typeof i.tangentialPressure>"u"&&(i.tangentialPressure=0),typeof i.layerX>"u"&&(i.layerX=i.offsetX=i.clientX),typeof i.layerY>"u"&&(i.layerY=i.offsetY=i.clientY),i.isNormalized=!0,i.type=e.type,t.push(i)}else(!globalThis.MouseEvent||e instanceof MouseEvent&&(!this.supportsPointerEvents||!(e instanceof globalThis.PointerEvent)))&&(typeof e.isPrimary>"u"&&(e.isPrimary=!0),typeof e.width>"u"&&(e.width=1),typeof e.height>"u"&&(e.height=1),typeof e.tiltX>"u"&&(e.tiltX=0),typeof e.tiltY>"u"&&(e.tiltY=0),typeof e.pointerType>"u"&&(e.pointerType="mouse"),typeof e.pointerId>"u"&&(e.pointerId=1),typeof e.pressure>"u"&&(e.pressure=.5),typeof e.twist>"u"&&(e.twist=0),typeof e.tangentialPressure>"u"&&(e.tangentialPressure=0),e.isNormalized=!0),t.push(e);return t}normalizeWheelEvent(e){let t=this.rootWheelEvent;return this.transferMouseData(t,e),t.deltaX=e.deltaX,t.deltaY=e.deltaY,t.deltaZ=e.deltaZ,t.deltaMode=e.deltaMode,this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.nativeEvent=e,t.type=e.type,t}bootstrapEvent(e,t){return e.originalEvent=null,e.nativeEvent=t,e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist,this.transferMouseData(e,t),this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.isTrusted=t.isTrusted,"pointerleave"===e.type&&(e.type="pointerout"),e.type.startsWith("mouse")&&(e.type=e.type.replace("mouse","pointer")),e.type.startsWith("touch")&&(e.type=nz[e.type]||e.type),e}transferMouseData(e,t){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.x=t.clientX,e.client.y=t.clientY,e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.x=t.movementX,e.movement.y=t.movementY,e.page.x=t.pageX,e.page.y=t.pageY,e.relatedTarget=null,e.shiftKey=t.shiftKey}};function nX(e){return"dynamic"===e||"static"===e}nV.extension={name:"events",type:[rV.RendererSystem,rV.CanvasRendererSystem]},nV.defaultEventFeatures={move:!0,globalMove:!0,click:!0,wheel:!0},r$.add(nV),nc.mixin({onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,_internalInteractive:void 0,get interactive(){return this._internalInteractive??nX(nV.defaultEventMode)},set interactive(value){to.deprecation("7.2.0","Setting interactive is deprecated, use eventMode = 'none'/'passive'/'auto'/'static'/'dynamic' instead."),this._internalInteractive=value,this.eventMode=value?"static":"auto"},_internalEventMode:void 0,get eventMode(){return this._internalEventMode??nV.defaultEventMode},set eventMode(value){this._internalInteractive=nX(value),this._internalEventMode=value},isInteractive(){return"static"===this.eventMode||"dynamic"===this.eventMode},interactiveChildren:!0,hitArea:null,addEventListener(e,t,r){let i="boolean"==typeof r&&r||"object"==typeof r&&r.capture,s="object"==typeof r?r.signal:void 0,n="object"==typeof r&&!0===r.once,o="function"==typeof t?void 0:t;e=i?`${e}capture`:e;let a="function"==typeof t?t:t.handleEvent,h=this;s&&s.addEventListener("abort",()=>{h.off(e,a,o)}),n?h.once(e,a,o):h.on(e,a,o)},removeEventListener(e,t,r){let i="boolean"==typeof r&&r||"object"==typeof r&&r.capture,s="function"==typeof t?void 0:t;e=i?`${e}capture`:e,t="function"==typeof t?t:t.handleEvent,this.off(e,t,s)},dispatchEvent(e){if(!(e instanceof nL))throw Error("DisplayObject cannot propagate events outside of the Federated Events API");return e.defaultPrevented=!1,e.path=null,e.target=this,e.manager.dispatchEvent(e),!e.defaultPrevented}}),nc.mixin({accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1});class nW{constructor(e){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(to.isMobile.tablet||to.isMobile.phone)&&this.createTouchHook();let t=document.createElement("div");t.style.width="100px",t.style.height="100px",t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.zIndex="2",this.div=t,this.renderer=e,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){let e=document.createElement("button");e.style.width="1px",e.style.height="1px",e.style.position="absolute",e.style.top="-1000px",e.style.left="-1000px",e.style.zIndex="2",e.style.backgroundColor="#FF0000",e.title="select to enable accessibility for this content",e.addEventListener("focus",()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()}),document.body.appendChild(e),this._hookDiv=e}destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),this.renderer.view.parentNode?.appendChild(this.div))}deactivate(){!this._isActive||this._isMobileAccessibility||(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),this.div.parentNode?.removeChild(this.div))}updateAccessibleObjects(e){if(!e.visible||!e.accessibleChildren)return;e.accessible&&e.isInteractive()&&(e._accessibleActive||this.addChild(e),e.renderId=this.renderId);let t=e.children;if(t)for(let e=0;e<t.length;e++)this.updateAccessibleObjects(t[e])}update(){let e=performance.now();if(to.isMobile.android.device&&e<this.androidUpdateCount||(this.androidUpdateCount=e+this.androidUpdateFrequency,!this.renderer.renderingToScreen))return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);let{x:t,y:r,width:i,height:s}=this.renderer.view.getBoundingClientRect(),{width:n,height:o,resolution:a}=this.renderer,h=i/n*a,l=s/o*a,u=this.div;u.style.left=`${t}px`,u.style.top=`${r}px`,u.style.width=`${n}px`,u.style.height=`${o}px`;for(let e=0;e<this.children.length;e++){let t=this.children[e];if(t.renderId!==this.renderId)t._accessibleActive=!1,to.removeItems(this.children,e,1),this.div.removeChild(t._accessibleDiv),this.pool.push(t._accessibleDiv),t._accessibleDiv=null,e--;else{u=t._accessibleDiv;let e=t.hitArea,r=t.worldTransform;t.hitArea?(u.style.left=`${(r.tx+e.x*r.a)*h}px`,u.style.top=`${(r.ty+e.y*r.d)*l}px`,u.style.width=`${e.width*r.a*h}px`,u.style.height=`${e.height*r.d*l}px`):(e=t.getBounds(),this.capHitArea(e),u.style.left=`${e.x*h}px`,u.style.top=`${e.y*l}px`,u.style.width=`${e.width*h}px`,u.style.height=`${e.height*l}px`,u.title!==t.accessibleTitle&&null!==t.accessibleTitle&&(u.title=t.accessibleTitle),u.getAttribute("aria-label")!==t.accessibleHint&&null!==t.accessibleHint&&u.setAttribute("aria-label",t.accessibleHint)),(t.accessibleTitle!==u.title||t.tabIndex!==u.tabIndex)&&(u.title=t.accessibleTitle,u.tabIndex=t.tabIndex,this.debug&&this.updateDebugHTML(u))}}this.renderId++}updateDebugHTML(e){e.innerHTML=`type: ${e.type}</br> title : ${e.title}</br> tabIndex: ${e.tabIndex}`}capHitArea(e){e.x<0&&(e.width+=e.x,e.x=0),e.y<0&&(e.height+=e.y,e.y=0);let{width:t,height:r}=this.renderer;e.x+e.width>t&&(e.width=t-e.x),e.y+e.height>r&&(e.height=r-e.y)}addChild(e){let t=this.pool.pop();t||((t=document.createElement("button")).style.width="100px",t.style.height="100px",t.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",t.style.position="absolute",t.style.zIndex="2",t.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?t.setAttribute("aria-live","off"):t.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?t.setAttribute("aria-relevant","additions"):t.setAttribute("aria-relevant","text"),t.addEventListener("click",this._onClick.bind(this)),t.addEventListener("focus",this._onFocus.bind(this)),t.addEventListener("focusout",this._onFocusOut.bind(this))),t.style.pointerEvents=e.accessiblePointerEvents,t.type=e.accessibleType,e.accessibleTitle&&null!==e.accessibleTitle?t.title=e.accessibleTitle:e.accessibleHint&&null!==e.accessibleHint||(t.title=`displayObject ${e.tabIndex}`),e.accessibleHint&&null!==e.accessibleHint&&t.setAttribute("aria-label",e.accessibleHint),this.debug&&this.updateDebugHTML(t),e._accessibleActive=!0,e._accessibleDiv=t,t.displayObject=e,this.children.push(e),this.div.appendChild(e._accessibleDiv),e._accessibleDiv.tabIndex=e.tabIndex}_dispatchEvent(e,t){let{displayObject:r}=e.target,i=this.renderer.events.rootBoundary,s=Object.assign(new nL(i),{target:r});i.rootTarget=this.renderer.lastObjectRendered,t.forEach(e=>i.dispatchEvent(s,e))}_onClick(e){this._dispatchEvent(e,["click","pointertap","tap"])}_onFocus(e){e.target.getAttribute("aria-live")||e.target.setAttribute("aria-live","assertive"),this._dispatchEvent(e,["mouseover"])}_onFocusOut(e){e.target.getAttribute("aria-live")||e.target.setAttribute("aria-live","polite"),this._dispatchEvent(e,["mouseout"])}_onKeyDown(e){9===e.keyCode&&this.activate()}_onMouseMove(e){0===e.movementX&&0===e.movementY||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}}nW.extension={name:"accessibility",type:[rV.RendererPlugin,rV.CanvasRendererPlugin]},r$.add(nW);const n$=class e{constructor(t){this.stage=new ng,t=Object.assign({forceCanvas:!1},t),this.renderer=function(e){for(let t of s8)if(t.test(e))return new t(e);throw Error("Unable to auto-detect a suitable renderer.")}(t),e._plugins.forEach(e=>{e.init.call(this,t)})}render(){this.renderer.render(this.stage)}get view(){return this.renderer?.view}get screen(){return this.renderer?.screen}destroy(t,r){let i=e._plugins.slice(0);i.reverse(),i.forEach(e=>{e.destroy.call(this)}),this.stage.destroy(r),this.stage=null,this.renderer.destroy(t),this.renderer=null}};n$._plugins=[],r$.handleByList(rV.Application,n$._plugins);class nY{static init(e){Object.defineProperty(this,"resizeTo",{set(e){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=e,e&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{let e,t;if(this._resizeTo){if(this.cancelResize(),this._resizeTo===globalThis.window)e=globalThis.innerWidth,t=globalThis.innerHeight;else{let{clientWidth:r,clientHeight:i}=this._resizeTo;e=r,t=i}this.renderer.resize(e,t),this.render()}},this._resizeId=null,this._resizeTo=null,this.resizeTo=e.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}nY.extension=rV.Application,r$.add(nY);const nq={loader:rV.LoadParser,resolver:rV.ResolveParser,cache:rV.CacheParser,detection:rV.DetectionParser};r$.handle(rV.Asset,e=>{let t=e.ref;Object.entries(nq).filter(([e])=>!!t[e]).forEach(([e,r])=>r$.add(Object.assign(t[e],{extension:t[e].extension??r})))},e=>{let t=e.ref;Object.keys(nq).filter(e=>!!t[e]).forEach(e=>r$.remove(t[e]))});class nK{constructor(e,t=!1){this._loader=e,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=t}add(e){e.forEach(e=>{this._assetList.push(e)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;let e=[],t=Math.min(this._assetList.length,this._maxConcurrent);for(let r=0;r<t;r++)e.push(this._assetList.pop());await this._loader.load(e),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(e){this._isActive!==e&&(this._isActive=e,e&&!this._isLoading&&this._next())}}function nJ(e,t){if(Array.isArray(t)){for(let r of t)if(e.startsWith(`data:${r}`))return!0;return!1}return e.startsWith(`data:${t}`)}function nZ(e,t){let r=e.split("?")[0],i=to.path.extname(r).toLowerCase();return Array.isArray(t)?t.includes(i):i===t}const nQ=(e,t,r=!1)=>(Array.isArray(e)||(e=[e]),t?e.map(e=>"string"==typeof e||r?t(e):e):e),n0=(e,t)=>{let r=t.split("?")[1];return r&&(e+=`?${r}`),e},n1=e=>!Array.isArray(e),n2=new class{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(e){return this._cache.has(e)}get(e){let t=this._cache.get(e);return t||console.warn(`[Assets] Asset id ${e} was not found in the Cache`),t}set(e,t){let r;let i=nQ(e);for(let e=0;e<this.parsers.length;e++){let s=this.parsers[e];if(s.test(t)){r=s.getCacheableAssets(i,t);break}}r||(r={},i.forEach(e=>{r[e]=t}));let s=Object.keys(r),n={cacheKeys:s,keys:i};i.forEach(e=>{this._cacheMap.set(e,n)}),s.forEach(e=>{this._cache.has(e)&&this._cache.get(e)!==t&&console.warn("[Cache] already has key:",e),this._cache.set(e,r[e])}),t instanceof sh&&i.forEach(e=>{t.baseTexture!==sh.EMPTY.baseTexture&&r4.addToCache(t.baseTexture,e),sh.addToCache(t,e)})}remove(e){if(!this._cacheMap.has(e)){console.warn(`[Assets] Asset id ${e} was not found in the Cache`);return}let t=this._cacheMap.get(e);t.cacheKeys.forEach(e=>{this._cache.delete(e)}),t.keys.forEach(e=>{this._cacheMap.delete(e)})}get parsers(){return this._parsers}};class n3{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(e,t,r)=>(this._parsersValidated=!1,e[t]=r,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(e,t){let r={promise:null,parser:null};return r.promise=(async()=>{let i=null,s=null;if(t.loadParser&&((s=this._parserHash[t.loadParser])||console.warn(`[Assets] specified load parser "${t.loadParser}" not found while loading ${e}`)),!s){for(let r=0;r<this.parsers.length;r++){let i=this.parsers[r];if(i.load&&i.test?.(e,t,this)){s=i;break}}if(!s)return console.warn(`[Assets] ${e} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}i=await s.load(e,t,this),r.parser=s;for(let e=0;e<this.parsers.length;e++){let s=this.parsers[e];s.parse&&s.parse&&await s.testParse?.(i,t,this)&&(i=await s.parse(i,t,this)||i,r.parser=s)}return i})(),r}async load(e,t){this._parsersValidated||this._validateParsers();let r=0,i={},s=n1(e),n=nQ(e,e=>({alias:[e],src:e})),o=n.length,a=n.map(async e=>{let s=to.path.toAbsolute(e.src);if(!i[e.src])try{this.promiseCache[s]||(this.promiseCache[s]=this._getLoadPromiseAndParser(s,e)),i[e.src]=await this.promiseCache[s].promise,t&&t(++r/o)}catch(t){throw delete this.promiseCache[s],delete i[e.src],Error(`[Loader.load] Failed to load ${s}.
${t}`)}});return await Promise.all(a),s?i[n[0].src]:i}async unload(e){let t=nQ(e,e=>({alias:[e],src:e})).map(async e=>{let t=to.path.toAbsolute(e.src),r=this.promiseCache[t];if(r){let i=await r.promise;delete this.promiseCache[t],r.parser?.unload?.(i,e,this)}});await Promise.all(t)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter(e=>e.name).reduce((e,t)=>(e[t.name]&&console.warn(`[Assets] loadParser name conflict "${t.name}"`),{...e,[t.name]:t}),{})}}var n4=((W=n4||{})[W.Low=0]="Low",W[W.Normal=1]="Normal",W[W.High=2]="High",W);const n6={extension:{type:rV.LoadParser,priority:n4.Low},name:"loadJson",test:e=>nJ(e,"application/json")||nZ(e,".json"),load:async e=>await (await eJ.ADAPTER.fetch(e)).json()};r$.add(n6);const n5={name:"loadTxt",extension:{type:rV.LoadParser,priority:n4.Low},test:e=>nJ(e,"text/plain")||nZ(e,".txt"),load:async e=>await (await eJ.ADAPTER.fetch(e)).text()};r$.add(n5);const n8=["normal","bold","100","200","300","400","500","600","700","800","900"],n9=[".ttf",".otf",".woff",".woff2"],n7=["font/ttf","font/otf","font/woff","font/woff2"],oe=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i,ot=/^[0-9A-Za-z%:/?#\[\]@!\$&'()\*\+,;=\-._~]*$/,or={extension:{type:rV.LoadParser,priority:n4.Low},name:"loadWebFont",test:e=>nJ(e,n7)||nZ(e,n9),async load(e,t){let r=eJ.ADAPTER.getFontFaceSet();if(r){let i=[],s=t.data?.family??function(e){let t=to.path.extname(e),r=to.path.basename(e,t).replace(/(-|_)/g," ").toLowerCase().split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1)),i=r.length>0;for(let e of r)if(!e.match(oe)){i=!1;break}let s=r.join(" ");return i||(s=`"${s.replace(/[\\"]/g,"\\$&")}"`),s}(e),n=t.data?.weights?.filter(e=>n8.includes(e))??["normal"],o=t.data??{};for(let t=0;t<n.length;t++){let a=n[t],h=new FontFace(s,`url(${ot.test(e)?e:encodeURI(e)})`,{...o,weight:a});await h.load(),r.add(h),i.push(h)}return 1===i.length?i[0]:i}return console.warn("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(e){(Array.isArray(e)?e:[e]).forEach(e=>eJ.ADAPTER.getFontFaceSet().delete(e))}};r$.add(or);const oi=`(function() {
  "use strict";
  const WHITE_PNG = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=";
  async function checkImageBitmap() {
    try {
      if (typeof createImageBitmap != "function")
        return !1;
      const imageBlob = await (await fetch(WHITE_PNG)).blob(), imageBitmap = await createImageBitmap(imageBlob);
      return imageBitmap.width === 1 && imageBitmap.height === 1;
    } catch {
      return !1;
    }
  }
  checkImageBitmap().then((result) => {
    self.postMessage(result);
  });
})();
`;let os=null;class on extends Worker{constructor(){os||(os=URL.createObjectURL(new Blob([oi],{type:"application/javascript"}))),super(os)}}on.revokeObjectURL=function(){os&&(URL.revokeObjectURL(os),os=null)};const oo=`(function() {
  "use strict";
  async function loadImageBitmap(url) {
    const response = await fetch(url);
    if (!response.ok)
      throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \${response.status} \${response.statusText}\`);
    const imageBlob = await response.blob();
    return await createImageBitmap(imageBlob);
  }
  self.onmessage = async (event) => {
    try {
      const imageBitmap = await loadImageBitmap(event.data.data[0]);
      self.postMessage({
        data: imageBitmap,
        uuid: event.data.uuid,
        id: event.data.id
      }, [imageBitmap]);
    } catch (e) {
      self.postMessage({
        error: e,
        uuid: event.data.uuid,
        id: event.data.id
      });
    }
  };
})();
`;let oa=null;class oh extends Worker{constructor(){oa||(oa=URL.createObjectURL(new Blob([oo],{type:"application/javascript"}))),super(oa)}}oh.revokeObjectURL=function(){oa&&(URL.revokeObjectURL(oa),oa=null)};let ol=0,ou;const oc=new class{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return void 0!==this._isImageBitmapSupported||(this._isImageBitmapSupported=new Promise(e=>{let t=new on;t.addEventListener("message",r=>{t.terminate(),on.revokeObjectURL(),e(r.data)})})),this._isImageBitmapSupported}loadImageBitmap(e){return this._run("loadImageBitmap",[e])}async _initWorkers(){this._initialized||(this._initialized=!0)}getWorker(){void 0===ou&&(ou=navigator.hardwareConcurrency||4);let e=this.workerPool.pop();return!e&&this._createdWorkers<ou&&(this._createdWorkers++,(e=new oh).addEventListener("message",e=>{this.complete(e.data),this.returnWorker(e.target),this.next()})),e}returnWorker(e){this.workerPool.push(e)}complete(e){void 0!==e.error?this.resolveHash[e.uuid].reject(e.error):this.resolveHash[e.uuid].resolve(e.data),this.resolveHash[e.uuid]=null}async _run(e,t){await this._initWorkers();let r=new Promise((r,i)=>{this.queue.push({id:e,arguments:t,resolve:r,reject:i})});return this.next(),r}next(){if(!this.queue.length)return;let e=this.getWorker();if(!e)return;let t=this.queue.pop(),r=t.id;this.resolveHash[ol]={resolve:t.resolve,reject:t.reject},e.postMessage({data:t.arguments,uuid:ol++,id:r})}};function od(e,t,r){e.resource.internal=!0;let i=new sh(e),s=()=>{delete t.promiseCache[r],n2.has(r)&&n2.remove(r)};return i.baseTexture.once("destroyed",()=>{r in t.promiseCache&&(console.warn("[Assets] A BaseTexture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the BaseTexture."),s())}),i.once("destroyed",()=>{e.destroyed||(console.warn("[Assets] A Texture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the Texture."),s())}),i}const op=[".jpeg",".jpg",".png",".webp",".avif"],of=["image/jpeg","image/png","image/webp","image/avif"];async function om(e){let t=await eJ.ADAPTER.fetch(e);if(!t.ok)throw Error(`[loadImageBitmap] Failed to fetch ${e}: ${t.status} ${t.statusText}`);let r=await t.blob();return await createImageBitmap(r)}const og={name:"loadTextures",extension:{type:rV.LoadParser,priority:n4.High},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test:e=>nJ(e,of)||nZ(e,op),async load(e,t,r){let i;let s=globalThis.createImageBitmap&&this.config.preferCreateImageBitmap;i=s?this.config.preferWorkers&&await oc.isImageBitmapSupported()?await oc.loadImageBitmap(e):await om(e):await new Promise((t,r)=>{let i=new Image;i.crossOrigin=this.config.crossOrigin,i.src=e,i.complete?t(i):(i.onload=()=>t(i),i.onerror=e=>r(e))});let n={...t.data};n.resolution??(n.resolution=to.getResolutionOfUrl(e)),s&&n.resourceOptions?.ownsImageBitmap===void 0&&(n.resourceOptions={...n.resourceOptions},n.resourceOptions.ownsImageBitmap=!0);let o=new r4(i,n);return o.resource.src=e,od(o,r,e)},unload(e){e.destroy(!0)}};r$.add(og);const oy={extension:{type:rV.LoadParser,priority:n4.High},name:"loadSVG",test:e=>nJ(e,"image/svg+xml")||nZ(e,".svg"),testParse:async e=>nh.test(e),async parse(e,t,r){let i=new nh(e,t?.data?.resourceOptions);await i.load();let s=new r4(i,{resolution:to.getResolutionOfUrl(e),...t?.data});return s.resource.src=t.src,od(s,r,t.src)},load:async(e,t)=>(await eJ.ADAPTER.fetch(e)).text(),unload:og.unload};r$.add(oy);const o_=[".mp4",".m4v",".webm",".ogv"],ov=["video/mp4","video/webm","video/ogg"],ob={name:"loadVideo",extension:{type:rV.LoadParser,priority:n4.High},config:{defaultAutoPlay:!0,defaultUpdateFPS:0,defaultLoop:!1,defaultMuted:!1,defaultPlaysinline:!0},test:e=>nJ(e,ov)||nZ(e,o_),async load(e,t,r){let i;let s=await (await eJ.ADAPTER.fetch(e)).blob(),n=URL.createObjectURL(s);try{let s={autoPlay:this.config.defaultAutoPlay,updateFPS:this.config.defaultUpdateFPS,loop:this.config.defaultLoop,muted:this.config.defaultMuted,playsinline:this.config.defaultPlaysinline,...t?.data?.resourceOptions,autoLoad:!0},o=new nl(n,s);await o.load();let a=new r4(o,{alphaMode:await to.detectVideoAlphaMode(),resolution:to.getResolutionOfUrl(e),...t?.data});a.resource.src=e,(i=od(a,r,e)).baseTexture.once("destroyed",()=>{URL.revokeObjectURL(n)})}catch(e){throw URL.revokeObjectURL(n),e}return i},unload(e){e.destroy(!0)}};r$.add(ob);class ox{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(e,t)=>`${e}${this._bundleIdConnector}${t}`,extractAssetIdFromBundle:(e,t)=>t.replace(`${e}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(e){if(this._bundleIdConnector=e.connector??this._bundleIdConnector,this._createBundleAssetId=e.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=e.extractAssetIdFromBundle??this._extractAssetIdFromBundle,"bar"!==this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar")))throw Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...e){e.forEach(e=>{this._preferredOrder.push(e),e.priority||(e.priority=Object.keys(e.params))}),this._resolverHash={}}set basePath(e){this._basePath=e}get basePath(){return this._basePath}set rootPath(e){this._rootPath=e}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(e){"string"==typeof e?this._defaultSearchParams=e:this._defaultSearchParams=Object.keys(e).map(t=>`${encodeURIComponent(t)}=${encodeURIComponent(e[t])}`).join("&")}getAlias(e){let{alias:t,name:r,src:i,srcs:s}=e;return nQ(t||r||i||s,e=>"string"==typeof e?e:Array.isArray(e)?e.map(e=>e?.src??e?.srcs??e):e?.src||e?.srcs?e.src??e.srcs:e,!0)}addManifest(e){this._manifest&&console.warn("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=e,e.bundles.forEach(e=>{this.addBundle(e.name,e.assets)})}addBundle(e,t){let r=[];Array.isArray(t)?t.forEach(t=>{let i;let s=t.src??t.srcs,n=t.alias??t.name;if("string"==typeof n){let t=this._createBundleAssetId(e,n);r.push(t),i=[n,t]}else{let t=n.map(t=>this._createBundleAssetId(e,t));r.push(...t),i=[...n,...t]}this.add({...t,alias:i,src:s})}):Object.keys(t).forEach(i=>{let s=[i,this._createBundleAssetId(e,i)];if("string"==typeof t[i])this.add({alias:s,src:t[i]});else if(Array.isArray(t[i]))this.add({alias:s,src:t[i]});else{let e=t[i],r=e.src??e.srcs;this.add({...e,alias:s,src:Array.isArray(r)?r:[r]})}r.push(...s)}),this._bundles[e]=r}add(e,t,r,i,s){let n;let o=[];"string"==typeof e||Array.isArray(e)&&"string"==typeof e[0]?(to.deprecation("7.2.0",`Assets.add now uses an object instead of individual parameters.
Please use Assets.add({ alias, src, data, format, loadParser }) instead.`),o.push({alias:e,src:t,data:r,format:i,loadParser:s})):Array.isArray(e)?o.push(...e):o.push(e),n=e=>{this.hasKey(e)&&console.warn(`[Resolver] already has key: ${e} overwriting`)},nQ(o).forEach(e=>{let{src:t,srcs:r}=e,{data:i,format:s,loadParser:o}=e,a=nQ(t||r).map(e=>"string"==typeof e?function(e){let t=e.match(/\{(.*?)\}/g),r=[];if(t){let i=[];t.forEach(e=>{let t=e.substring(1,e.length-1).split(",");i.push(t)}),function e(t,r,i,s,n){let o=r[i];for(let a=0;a<o.length;a++){let h=o[a];i<r.length-1?e(t.replace(s[i],h),r,i+1,s,n):n.push(t.replace(s[i],h))}}(e,i,0,t,r)}else r.push(e);return r}(e):Array.isArray(e)?e:[e]),h=this.getAlias(e);Array.isArray(h)?h.forEach(n):n(h);let l=[];a.forEach(e=>{e.forEach(e=>{let t={};if("object"!=typeof e){t.src=e;for(let r=0;r<this._parsers.length;r++){let i=this._parsers[r];if(i.test(e)){t=i.parse(e);break}}}else i=e.data??i,s=e.format??s,o=e.loadParser??o,t={...t,...e};if(!h)throw Error(`[Resolver] alias is undefined for this asset: ${t.src}`);t=this.buildResolvedAsset(t,{aliases:h,data:i,format:s,loadParser:o}),l.push(t)})}),h.forEach(e=>{this._assetMap[e]=l})})}resolveBundle(e){let t=n1(e);e=nQ(e);let r={};return e.forEach(e=>{let t=this._bundles[e];if(t){let i=this.resolve(t),s={};for(let t in i){let r=i[t];s[this._extractAssetIdFromBundle(e,t)]=r}r[e]=s}}),t?r[e[0]]:r}resolveUrl(e){let t=this.resolve(e);if("string"!=typeof e){let e={};for(let r in t)e[r]=t[r].src;return e}return t.src}resolve(e){let t=n1(e);e=nQ(e);let r={};return e.forEach(e=>{if(!this._resolverHash[e]){if(this._assetMap[e]){let t=this._assetMap[e],r=t[0],i=this._getPreferredOrder(t);i?.priority.forEach(e=>{i.params[e].forEach(r=>{let i=t.filter(t=>!!t[e]&&t[e]===r);i.length&&(t=i)})}),this._resolverHash[e]=t[0]??r}else this._resolverHash[e]=this.buildResolvedAsset({alias:[e],src:e},{})}r[e]=this._resolverHash[e]}),t?r[e[0]]:r}hasKey(e){return!!this._assetMap[e]}hasBundle(e){return!!this._bundles[e]}_getPreferredOrder(e){for(let t=0;t<e.length;t++){let t=e[0],r=this._preferredOrder.find(e=>e.params.format.includes(t.format));if(r)return r}return this._preferredOrder[0]}_appendDefaultSearchParams(e){if(!this._defaultSearchParams)return e;let t=/\?/.test(e)?"&":"?";return`${e}${t}${this._defaultSearchParams}`}buildResolvedAsset(e,t){let{aliases:r,data:i,loadParser:s,format:n}=t;return(this._basePath||this._rootPath)&&(e.src=to.path.toAbsolute(e.src,this._basePath,this._rootPath)),e.alias=r??e.alias??[e.src],e.src=this._appendDefaultSearchParams(e.src),e.data={...i||{},...e.data},e.loadParser=s??e.loadParser,e.format=n??to.path.extname(e.src).slice(1),e.srcs=e.src,e.name=e.alias,e}}const oT=new class{constructor(){this._detections=[],this._initialized=!1,this.resolver=new ox,this.loader=new n3,this.cache=n2,this._backgroundLoader=new nK(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(e={}){if(this._initialized){console.warn("[Assets]AssetManager already initialized, did you load before calling this Assets.init()?");return}if(this._initialized=!0,e.defaultSearchParams&&this.resolver.setDefaultSearchParams(e.defaultSearchParams),e.basePath&&(this.resolver.basePath=e.basePath),e.bundleIdentifier&&this.resolver.setBundleIdentifier(e.bundleIdentifier),e.manifest){let t=e.manifest;"string"==typeof t&&(t=await this.load(t)),this.resolver.addManifest(t)}let t=e.texturePreference?.resolution??1,r=await this._detectFormats({preferredFormats:e.texturePreference?.format,skipDetections:e.skipDetections,detections:this._detections});this.resolver.prefer({params:{format:r,resolution:"number"==typeof t?[t]:t}}),e.preferences&&this.setPreferences(e.preferences)}add(e,t,r,i,s){this.resolver.add(e,t,r,i,s)}async load(e,t){this._initialized||await this.init();let r=n1(e),i=nQ(e).map(e=>{if("string"!=typeof e){let t=this.resolver.getAlias(e);return t.some(e=>!this.resolver.hasKey(e))&&this.add(e),Array.isArray(t)?t[0]:t}return this.resolver.hasKey(e)||this.add({alias:e,src:e}),e}),s=this.resolver.resolve(i),n=await this._mapLoadToResolve(s,t);return r?n[i[0]]:n}addBundle(e,t){this.resolver.addBundle(e,t)}async loadBundle(e,t){this._initialized||await this.init();let r=!1;"string"==typeof e&&(r=!0,e=[e]);let i=this.resolver.resolveBundle(e),s={},n=Object.keys(i),o=0,a=0,h=()=>{t?.(++o/a)},l=n.map(e=>{let t=i[e];return a+=Object.keys(t).length,this._mapLoadToResolve(t,h).then(t=>{s[e]=t})});return await Promise.all(l),r?s[e[0]]:s}async backgroundLoad(e){this._initialized||await this.init(),"string"==typeof e&&(e=[e]);let t=this.resolver.resolve(e);this._backgroundLoader.add(Object.values(t))}async backgroundLoadBundle(e){this._initialized||await this.init(),"string"==typeof e&&(e=[e]),Object.values(this.resolver.resolveBundle(e)).forEach(e=>{this._backgroundLoader.add(Object.values(e))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(e){if("string"==typeof e)return n2.get(e);let t={};for(let r=0;r<e.length;r++)t[r]=n2.get(e[r]);return t}async _mapLoadToResolve(e,t){let r=Object.values(e),i=Object.keys(e);this._backgroundLoader.active=!1;let s=await this.loader.load(r,t);this._backgroundLoader.active=!0;let n={};return r.forEach((e,t)=>{let r=s[e.src],o=[e.src];e.alias&&o.push(...e.alias),n[i[t]]=r,n2.set(o,r)}),n}async unload(e){this._initialized||await this.init();let t=nQ(e).map(e=>"string"!=typeof e?e.src:e),r=this.resolver.resolve(t);await this._unloadFromResolved(r)}async unloadBundle(e){this._initialized||await this.init(),e=nQ(e);let t=this.resolver.resolveBundle(e),r=Object.keys(t).map(e=>this._unloadFromResolved(t[e]));await Promise.all(r)}async _unloadFromResolved(e){let t=Object.values(e);t.forEach(e=>{n2.remove(e.src)}),await this.loader.unload(t)}async _detectFormats(e){let t=[];for(let r of(e.preferredFormats&&(t=Array.isArray(e.preferredFormats)?e.preferredFormats:[e.preferredFormats]),e.detections))e.skipDetections||await r.test()?t=await r.add(t):e.skipDetections||(t=await r.remove(t));return t=t.filter((e,r)=>t.indexOf(e)===r)}get detections(){return this._detections}get preferWorkers(){return og.config.preferWorkers}set preferWorkers(e){to.deprecation("7.2.0","Assets.prefersWorkers is deprecated, use Assets.setPreferences({ preferWorkers: true }) instead."),this.setPreferences({preferWorkers:e})}setPreferences(e){this.loader.parsers.forEach(t=>{t.config&&Object.keys(t.config).filter(t=>t in e).forEach(r=>{t.config[r]=e[r]})})}};r$.handleByList(rV.LoadParser,oT.loader.parsers).handleByList(rV.ResolveParser,oT.resolver.parsers).handleByList(rV.CacheParser,oT.cache.parsers).handleByList(rV.DetectionParser,oT.detections);const oE={extension:rV.CacheParser,test:e=>Array.isArray(e)&&e.every(e=>e instanceof sh),getCacheableAssets:(e,t)=>{let r={};return e.forEach(e=>{t.forEach((t,i)=>{r[e+(0===i?"":i+1)]=t})}),r}};async function ow(e){if("Image"in globalThis)return new Promise(t=>{let r=new Image;r.onload=()=>{t(!0)},r.onerror=()=>{t(!1)},r.src=e});if("createImageBitmap"in globalThis&&"fetch"in globalThis){try{let t=await (await fetch(e)).blob();await createImageBitmap(t)}catch{return!1}return!0}return!1}r$.add(oE);const oA={extension:{type:rV.DetectionParser,priority:1},test:async()=>ow("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="),add:async e=>[...e,"avif"],remove:async e=>e.filter(e=>"avif"!==e)};r$.add(oA);const oS={extension:{type:rV.DetectionParser,priority:0},test:async()=>ow("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA="),add:async e=>[...e,"webp"],remove:async e=>e.filter(e=>"webp"!==e)};r$.add(oS);const oC=["png","jpg","jpeg"],oR={extension:{type:rV.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async e=>[...e,...oC],remove:async e=>e.filter(e=>!oC.includes(e))};r$.add(oR);const oI="WorkerGlobalScope"in globalThis&&globalThis instanceof globalThis.WorkerGlobalScope;function oP(e){return!oI&&""!==document.createElement("video").canPlayType(e)}const oM={extension:{type:rV.DetectionParser,priority:0},test:async()=>oP("video/webm"),add:async e=>[...e,"webm"],remove:async e=>e.filter(e=>"webm"!==e)};r$.add(oM);const oD={extension:{type:rV.DetectionParser,priority:0},test:async()=>oP("video/mp4"),add:async e=>[...e,"mp4","m4v"],remove:async e=>e.filter(e=>"mp4"!==e&&"m4v"!==e)};r$.add(oD);const ok={extension:{type:rV.DetectionParser,priority:0},test:async()=>oP("video/ogg"),add:async e=>[...e,"ogv"],remove:async e=>e.filter(e=>"ogv"!==e)};r$.add(ok);const oO={extension:rV.ResolveParser,test:og.test,parse:e=>({resolution:parseFloat(eJ.RETINA_PREFIX.exec(e)?.[1]??"1"),format:to.path.extname(e).slice(1),src:e})};r$.add(oO);var oB=(($=oB||{})[$.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",$[$.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",$[$.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",$[$.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",$[$.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",$[$.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",$[$.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",$[$.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",$[$.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",$[$.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",$[$.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",$[$.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",$[$.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",$[$.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",$[$.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",$[$.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",$[$.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",$[$.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",$[$.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",$[$.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",$[$.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",$[$.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",$[$.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",$[$.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",$[$.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35987]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",$[$.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",$[$.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",$[$.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",$[$.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",$[$.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",$[$.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",$);const oL={33776:.5,33777:.5,33778:1,33779:1,35916:.5,35917:.5,35918:1,35919:1,37488:.5,37489:.5,37490:1,37491:1,37492:.5,37496:1,37493:.5,37497:1,37494:.5,37495:.5,35840:.5,35842:.5,35841:.25,35843:.25,36196:.5,35986:.5,35987:1,34798:1,37808:1,36492:1,36493:1,36494:1,36495:1};function oF(){n={s3tc:s.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:s.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:s.getExtension("WEBGL_compressed_texture_etc"),etc1:s.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:s.getExtension("WEBGL_compressed_texture_pvrtc")||s.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:s.getExtension("WEBGL_compressed_texture_atc"),astc:s.getExtension("WEBGL_compressed_texture_astc"),bptc:s.getExtension("EXT_texture_compression_bptc")}}const oN={extension:{type:rV.DetectionParser,priority:2},test:async()=>{let e=eJ.ADAPTER.createCanvas().getContext("webgl");return e?(s=e,!0):(console.warn("WebGL not available for compressed textures."),!1)},add:async e=>{n||oF();let t=[];for(let e in n)n[e]&&t.push(e);return[...t,...e]},remove:async e=>(n||oF(),e.filter(e=>!(e in n)))};r$.add(oN);class oU extends r1{constructor(e,t={width:1,height:1,autoLoad:!0}){let r,i;"string"==typeof e?(r=e,i=new Uint8Array):(r=null,i=e),super(i,t),this.origin=r,this.buffer=i?new rY(i):null,this._load=null,this.loaded=!1,null!==this.origin&&!1!==t.autoLoad&&this.load(),null===this.origin&&this.buffer&&(this._load=Promise.resolve(this),this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(e){}load(){return this._load||(this._load=fetch(this.origin).then(e=>e.blob()).then(e=>e.arrayBuffer()).then(e=>(this.data=new Uint32Array(e),this.buffer=new rY(e),this.loaded=!0,this.onBlobLoaded(e),this.update(),this))),this._load}}class oG extends oU{constructor(e,t){super(e,t),this.format=t.format,this.levels=t.levels||1,this._width=t.width,this._height=t.height,this._extension=oG._formatToExtension(this.format),(t.levelBuffers||this.buffer)&&(this._levelBuffers=t.levelBuffers||oG._createLevelBuffers(e instanceof Uint8Array?e:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(e,t,r){let i=e.gl;if(!e.context.extensions[this._extension])throw Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;i.pixelStorei(i.UNPACK_ALIGNMENT,4);for(let e=0,t=this.levels;e<t;e++){let{levelID:t,levelWidth:r,levelHeight:s,levelBuffer:n}=this._levelBuffers[e];i.compressedTexImage2D(i.TEXTURE_2D,t,this.format,r,s,0,n)}return!0}onBlobLoaded(){this._levelBuffers=oG._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(e){if(e>=33776&&e<=33779)return"s3tc";if(e>=35916&&e<=35919)return"s3tc_sRGB";if(e>=37488&&e<=37497)return"etc";if(e>=35840&&e<=35843)return"pvrtc";if(36196===e)return"etc1";if(35986===e||35987===e||34798===e)return"atc";if(e>=36492&&e<=36495)return"bptc";if(37808===e)return"astc";throw Error(`Invalid (compressed) texture format given: ${e}`)}static _createLevelBuffers(e,t,r,i,s,n,o){let a=Array(r),h=e.byteOffset,l=n,u=o,c=l+i-1&~(i-1),d=u+s-1&~(s-1),p=c*d*oL[t];for(let n=0;n<r;n++)a[n]={levelID:n,levelWidth:r>1?l:c,levelHeight:r>1?u:d,levelBuffer:new Uint8Array(e.buffer,h,p)},h+=p,u=u>>1||1,p=(c=(l=l>>1||1)+i-1&~(i-1))*(d=u+s-1&~(s-1))*oL[t];return a}}const oj={FOURCC:2},oH={DXGI_FORMAT:0,RESOURCE_DIMENSION:1,MISC_FLAG:2,ARRAY_SIZE:3},oz={827611204:oB.COMPRESSED_RGBA_S3TC_DXT1_EXT,861165636:oB.COMPRESSED_RGBA_S3TC_DXT3_EXT,894720068:oB.COMPRESSED_RGBA_S3TC_DXT5_EXT},oV={70:oB.COMPRESSED_RGBA_S3TC_DXT1_EXT,71:oB.COMPRESSED_RGBA_S3TC_DXT1_EXT,73:oB.COMPRESSED_RGBA_S3TC_DXT3_EXT,74:oB.COMPRESSED_RGBA_S3TC_DXT3_EXT,76:oB.COMPRESSED_RGBA_S3TC_DXT5_EXT,77:oB.COMPRESSED_RGBA_S3TC_DXT5_EXT,72:oB.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,75:oB.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,78:oB.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT,96:oB.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT,95:oB.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT,98:oB.COMPRESSED_RGBA_BPTC_UNORM_EXT,99:oB.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT},oX=[171,75,84,88,32,49,49,187,13,10,26,10],oW={ENDIANNESS:12,GL_TYPE:16,GL_FORMAT:24,GL_INTERNAL_FORMAT:28,PIXEL_WIDTH:36,PIXEL_HEIGHT:40,PIXEL_DEPTH:44,NUMBER_OF_ARRAY_ELEMENTS:48,NUMBER_OF_FACES:52,NUMBER_OF_MIPMAP_LEVELS:56,BYTES_OF_KEY_VALUE_DATA:60},o$={[eN.UNSIGNED_BYTE]:1,[eN.UNSIGNED_SHORT]:2,[eN.INT]:4,[eN.UNSIGNED_INT]:4,[eN.FLOAT]:4,[eN.HALF_FLOAT]:8},oY={[eL.RGBA]:4,[eL.RGB]:3,[eL.RG]:2,[eL.RED]:1,[eL.LUMINANCE]:1,[eL.LUMINANCE_ALPHA]:2,[eL.ALPHA]:1},oq={[eN.UNSIGNED_SHORT_4_4_4_4]:2,[eN.UNSIGNED_SHORT_5_5_5_1]:2,[eN.UNSIGNED_SHORT_5_6_5]:2},oK={extension:{type:rV.LoadParser,priority:n4.High},name:"loadDDS",test:e=>nZ(e,".dds"),async load(e,t,r){let i=(function(e){let t=new Uint32Array(e);if(542327876!==t[0])throw Error("Invalid DDS file magic word");let r=new Uint32Array(e,0,124/Uint32Array.BYTES_PER_ELEMENT),i=r[3],s=r[4],n=r[7],o=new Uint32Array(e,19*Uint32Array.BYTES_PER_ELEMENT,32/Uint32Array.BYTES_PER_ELEMENT),a=o[1];if(4&a){let r=o[oj.FOURCC];if(808540228!==r){let t=oz[r];return[new oG(new Uint8Array(e,128),{format:t,width:s,height:i,levels:n})]}let a=new Uint32Array(t.buffer,128,20/Uint32Array.BYTES_PER_ELEMENT),h=a[oH.DXGI_FORMAT],l=a[oH.RESOURCE_DIMENSION],u=a[oH.MISC_FLAG],c=a[oH.ARRAY_SIZE],d=oV[h];if(void 0===d)throw Error(`DDSParser cannot parse texture data with DXGI format ${h}`);if(4===u)throw Error("DDSParser does not support cubemap textures");if(6===l)throw Error("DDSParser does not supported 3D texture data");let p=[];if(1===c)p.push(new Uint8Array(e,148));else{let t=oL[d],r=0,o=s,a=i;for(let e=0;e<n;e++)r+=Math.max(1,o+3&-4)*Math.max(1,a+3&-4)*t,o>>>=1,a>>>=1;let h=148;for(let t=0;t<c;t++)p.push(new Uint8Array(e,h,r)),h+=r}return p.map(e=>new oG(e,{format:d,width:s,height:i,levels:n}))}throw 64&a?Error("DDSParser does not support uncompressed texture data."):512&a?Error("DDSParser does not supported YUV uncompressed texture data."):131072&a?Error("DDSParser does not support single-channel (lumninance) texture data!"):2&a?Error("DDSParser does not support single-channel (alpha) texture data!"):Error("DDSParser failed to load a texture file due to an unknown reason!")})(await (await eJ.ADAPTER.fetch(e)).arrayBuffer()).map(i=>od(new r4(i,{mipmap:eH.OFF,alphaMode:ez.NO_PREMULTIPLIED_ALPHA,resolution:to.getResolutionOfUrl(e),...t.data}),r,e));return 1===i.length?i[0]:i},unload(e){Array.isArray(e)?e.forEach(e=>e.destroy(!0)):e.destroy(!0)}};r$.add(oK);const oJ={extension:{type:rV.LoadParser,priority:n4.High},name:"loadKTX",test:e=>nZ(e,".ktx"),async load(e,t,r){let i=await (await eJ.ADAPTER.fetch(e)).arrayBuffer(),{compressed:s,uncompressed:n,kvData:o}=function(e,t,r=!1){let i;let s=new DataView(t);if(!function(e,t){for(let r=0;r<oX.length;r++)if(t.getUint8(r)!==oX[r])return console.error(`${e} is not a valid *.ktx file!`),!1;return!0}(e,s))return null;let n=67305985===s.getUint32(oW.ENDIANNESS,!0),o=s.getUint32(oW.GL_TYPE,n),a=s.getUint32(oW.GL_FORMAT,n),h=s.getUint32(oW.GL_INTERNAL_FORMAT,n),l=s.getUint32(oW.PIXEL_WIDTH,n),u=s.getUint32(oW.PIXEL_HEIGHT,n)||1,c=s.getUint32(oW.PIXEL_DEPTH,n)||1,d=s.getUint32(oW.NUMBER_OF_ARRAY_ELEMENTS,n)||1,p=s.getUint32(oW.NUMBER_OF_FACES,n),f=s.getUint32(oW.NUMBER_OF_MIPMAP_LEVELS,n),m=s.getUint32(oW.BYTES_OF_KEY_VALUE_DATA,n);if(0===u||1!==c)throw Error("Only 2D textures are supported");if(1!==p)throw Error("CubeTextures are not supported by KTXLoader yet!");if(1!==d)throw Error("WebGL does not support array textures");let g=l+3&-4,y=u+3&-4,_=Array(d),v=l*u;if(0===o&&(v=g*y),void 0===(i=0!==o?o$[o]?o$[o]*oY[a]:oq[o]:oL[h]))throw Error("Unable to resolve the pixel format stored in the *.ktx file!");let b=r?function(e,t,r){let i=new Map,s=0;for(;s<t;){let n=e.getUint32(64+s,r),o=64+s+4,a=3-(n+3)%4;if(0===n||n>t-s){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}let h=0;for(;h<n&&0!==e.getUint8(o+h);h++);if(-1===h){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}let l=new TextDecoder().decode(new Uint8Array(e.buffer,o,h)),u=new DataView(e.buffer,o+h+1,n-h-1);i.set(l,u),s+=4+n+a}return i}(s,m,n):null,x=v*i,T=l,E=u,w=g,A=y,S=64+m;for(let e=0;e<f;e++){let r=s.getUint32(S,n),a=S+4;for(let r=0;r<d;r++){let i=_[r];i||(i=_[r]=Array(f)),i[e]={levelID:e,levelWidth:f>1||0!==o?T:w,levelHeight:f>1||0!==o?E:A,levelBuffer:new Uint8Array(t,a,x)},a+=x}S+=r+4,S=S%4!=0?S+4-S%4:S,E=E>>1||1,x=(w=(T=T>>1||1)+4-1&-4)*(A=E+4-1&-4)*i}return 0!==o?{uncompressed:_.map(e=>{let t=e[0].levelBuffer,r=!1;return o===eN.FLOAT?t=new Float32Array(e[0].levelBuffer.buffer,e[0].levelBuffer.byteOffset,e[0].levelBuffer.byteLength/4):o===eN.UNSIGNED_INT?(r=!0,t=new Uint32Array(e[0].levelBuffer.buffer,e[0].levelBuffer.byteOffset,e[0].levelBuffer.byteLength/4)):o===eN.INT&&(r=!0,t=new Int32Array(e[0].levelBuffer.buffer,e[0].levelBuffer.byteOffset,e[0].levelBuffer.byteLength/4)),{resource:new r1(t,{width:e[0].levelWidth,height:e[0].levelHeight}),type:o,format:r?function(e){switch(e){case eL.RGBA:return eL.RGBA_INTEGER;case eL.RGB:return eL.RGB_INTEGER;case eL.RG:return eL.RG_INTEGER;case eL.RED:return eL.RED_INTEGER;default:return e}}(a):a}}),kvData:b}:{compressed:_.map(e=>new oG(null,{format:h,width:l,height:u,levels:f,levelBuffers:e})),kvData:b}}(e,i),a=s??n,h={mipmap:eH.OFF,alphaMode:ez.NO_PREMULTIPLIED_ALPHA,resolution:to.getResolutionOfUrl(e),...t.data},l=a.map(t=>{a===n&&Object.assign(h,{type:t.type,format:t.format});let i=new r4(t.resource??t,h);return i.ktxKeyValueData=o,od(i,r,e)});return 1===l.length?l[0]:l},unload(e){Array.isArray(e)?e.forEach(e=>e.destroy(!0)):e.destroy(!0)}};r$.add(oJ);const oZ={extension:rV.ResolveParser,test:e=>["basis","ktx","dds"].includes(to.path.extname(e).slice(1)),parse:e=>{let t=to.path.extname(e).slice(1);if("ktx"===t){let t=[".s3tc.ktx",".s3tc_sRGB.ktx",".etc.ktx",".etc1.ktx",".pvrt.ktx",".atc.ktx",".astc.ktx",".bptc.ktx"];if(t.some(t=>e.endsWith(t)))return{resolution:parseFloat(eJ.RETINA_PREFIX.exec(e)?.[1]??"1"),format:t.find(t=>e.endsWith(t)),src:e}}return{resolution:parseFloat(eJ.RETINA_PREFIX.exec(e)?.[1]??"1"),format:t,src:e}}};r$.add(oZ);const oQ=new id,o0=class e{constructor(e){this.renderer=e,this._rendererPremultipliedAlpha=!1}contextChange(){let e=this.renderer?.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(e&&e.alpha&&e.premultipliedAlpha)}async image(e,t,r,i){let s=new Image;return s.src=await this.base64(e,t,r,i),s}async base64(e,t,r,i){let s=this.canvas(e,i);if(void 0!==s.toBlob)return new Promise((e,i)=>{s.toBlob(t=>{if(!t){i(Error("ICanvas.toBlob failed!"));return}let r=new FileReader;r.onload=()=>e(r.result),r.onerror=i,r.readAsDataURL(t)},t,r)});if(void 0!==s.toDataURL)return s.toDataURL(t,r);if(void 0!==s.convertToBlob){let e=await s.convertToBlob({type:t,quality:r});return new Promise((t,r)=>{let i=new FileReader;i.onload=()=>t(i.result),i.onerror=r,i.readAsDataURL(e)})}throw Error("Extract.base64() requires ICanvas.toDataURL, ICanvas.toBlob, or ICanvas.convertToBlob to be implemented")}canvas(t,r){let{pixels:i,width:s,height:n,flipY:o,premultipliedAlpha:a}=this._rawPixels(t,r);o&&e._flipY(i,s,n),a&&e._unpremultiplyAlpha(i);let h=new to.CanvasRenderTarget(s,n,1),l=new ImageData(new Uint8ClampedArray(i.buffer),s,n);return h.context.putImageData(l,0,0),h.canvas}pixels(t,r){let{pixels:i,width:s,height:n,flipY:o,premultipliedAlpha:a}=this._rawPixels(t,r);return o&&e._flipY(i,s,n),a&&e._unpremultiplyAlpha(i),i}_rawPixels(e,t){let r=this.renderer;if(!r)throw Error("The Extract has already been destroyed");let i,s=!1,n=!1,o,a=!1;e&&(e instanceof sl?o=e:(o=r.generateTexture(e,{region:t,resolution:r.resolution,multisample:r.multisample}),a=!0,t&&(oQ.width=t.width,oQ.height=t.height,t=oQ)));let h=r.gl;if(o){if(i=o.baseTexture.resolution,t=t??o.frame,s=!1,n=o.baseTexture.alphaMode>0&&o.baseTexture.format===eL.RGBA,!a){r.renderTexture.bind(o);let e=o.framebuffer.glFramebuffers[r.CONTEXT_UID];e.blitFramebuffer&&r.framebuffer.bind(e.blitFramebuffer)}}else i=r.resolution,t||((t=oQ).width=r.width/i,t.height=r.height/i),s=!0,n=this._rendererPremultipliedAlpha,r.renderTexture.bind();let l=Math.max(Math.round(t.width*i),1),u=Math.max(Math.round(t.height*i),1),c=new Uint8Array(4*l*u);return h.readPixels(Math.round(t.x*i),Math.round(t.y*i),l,u,h.RGBA,h.UNSIGNED_BYTE,c),a&&o?.destroy(!0),{pixels:c,width:l,height:u,flipY:s,premultipliedAlpha:n}}destroy(){this.renderer=null}static _flipY(e,t,r){let i=t<<2,s=r>>1,n=new Uint8Array(i);for(let t=0;t<s;t++){let s=t*i,o=(r-t-1)*i;n.set(e.subarray(s,s+i)),e.copyWithin(s,o,o+i),e.set(n,o)}}static _unpremultiplyAlpha(e){e instanceof Uint8ClampedArray&&(e=new Uint8Array(e.buffer));let t=e.length;for(let r=0;r<t;r+=4){let t=e[r+3];if(0!==t){let i=255.001/t;e[r]=e[r]*i+.5,e[r+1]=e[r+1]*i+.5,e[r+2]=e[r+2]*i+.5}}}};o0.extension={name:"extract",type:rV.RendererSystem},r$.add(o0);const o1={build(e){let t,r,i,s,n,o;let a=e.points;if(e.type===il.CIRC){let a=e.shape;t=a.x,r=a.y,n=o=a.radius,i=s=0}else if(e.type===il.ELIP){let a=e.shape;t=a.x,r=a.y,n=a.width,o=a.height,i=s=0}else{let a=e.shape,h=a.width/2,l=a.height/2;t=a.x+h,r=a.y+l,n=o=Math.max(0,Math.min(a.radius,Math.min(h,l))),i=h-n,s=l-o}if(!(n>=0&&o>=0&&i>=0&&s>=0)){a.length=0;return}let h=Math.ceil(2.3*Math.sqrt(n+o)),l=8*h+(i?4:0)+(s?4:0);if(a.length=l,0===l)return;if(0===h){a.length=8,a[0]=a[6]=t+i,a[1]=a[3]=r+s,a[2]=a[4]=t-i,a[5]=a[7]=r-s;return}let u=0,c=4*h+(i?2:0)+2,d=c,p=l;{let e=i+n,o=s,h=t+e,l=t-e,f=r+o;if(a[u++]=h,a[u++]=f,a[--c]=f,a[--c]=l,s){let e=r-o;a[d++]=l,a[d++]=e,a[--p]=e,a[--p]=h}}for(let e=1;e<h;e++){let l=Math.PI/2*(e/h),f=i+Math.cos(l)*n,m=s+Math.sin(l)*o,g=t+f,y=t-f,_=r+m,v=r-m;a[u++]=g,a[u++]=_,a[--c]=_,a[--c]=y,a[d++]=y,a[d++]=v,a[--p]=v,a[--p]=g}{let e=i,n=s+o,h=t+e,l=t-e,c=r+n,d=r-n;a[u++]=h,a[u++]=c,a[--p]=d,a[--p]=h,i&&(a[u++]=l,a[u++]=c,a[--p]=d,a[--p]=l)}},triangulate(e,t){let r,i;let s=e.points,n=t.points,o=t.indices;if(0===s.length)return;let a=n.length/2,h=a;if(e.type!==il.RREC){let t=e.shape;r=t.x,i=t.y}else{let t=e.shape;r=t.x+t.width/2,i=t.y+t.height/2}let l=e.matrix;n.push(e.matrix?l.a*r+l.c*i+l.tx:r,e.matrix?l.b*r+l.d*i+l.ty:i),a++,n.push(s[0],s[1]);for(let e=2;e<s.length;e+=2)n.push(s[e],s[e+1]),o.push(a++,h,a);o.push(h+1,h,a)}};function o2(e,t=!1){let r=e.length;if(r<6)return;let i=0;for(let t=0,s=e[r-2],n=e[r-1];t<r;t+=2){let r=e[t],o=e[t+1];i+=(r-s)*(o+n),s=r,n=o}if(!t&&i>0||t&&i<=0){let t=r/2;for(let i=t+t%2;i<r;i+=2){let t=r-i-2,s=r-i-1,n=i,o=i+1;[e[t],e[n]]=[e[n],e[t]],[e[s],e[o]]=[e[o],e[s]]}}}const o3={build(e){e.points=e.shape.points.slice()},triangulate(e,t){let r=e.points,i=e.holes,s=t.points,n=t.indices;if(r.length>=6){o2(r,!1);let e=[];for(let t=0;t<i.length;t++){let s=i[t];o2(s.points,!0),e.push(r.length/2),r=r.concat(s.points)}let t=to.earcut(r,e,2);if(!t)return;let o=s.length/2;for(let e=0;e<t.length;e+=3)n.push(t[e]+o),n.push(t[e+1]+o),n.push(t[e+2]+o);for(let e=0;e<r.length;e++)s.push(r[e])}}};var o4=((Y=o4||{}).MITER="miter",Y.BEVEL="bevel",Y.ROUND="round",Y),o6=((q=o6||{}).BUTT="butt",q.ROUND="round",q.SQUARE="square",q);const o5={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(e,t=20){if(!this.adaptive||!e||isNaN(e))return t;let r=Math.ceil(e/this.maxLength);return r<this.minSegments?r=this.minSegments:r>this.maxSegments&&(r=this.maxSegments),r}};class o8{static curveTo(e,t,r,i,s,n){let o=n[n.length-2],a=n[n.length-1]-t,h=o-e,l=i-t,u=r-e,c=Math.abs(a*u-h*l);if(c<1e-8||0===s)return(n[n.length-2]!==e||n[n.length-1]!==t)&&n.push(e,t),null;let d=a*a+h*h,p=l*l+u*u,f=a*l+h*u,m=s*Math.sqrt(d)/c,g=s*Math.sqrt(p)/c,y=m*f/d,_=g*f/p,v=m*u+g*h,b=m*l+g*a;return{cx:v+e,cy:b+t,radius:s,startAngle:Math.atan2(a*(g+y)-b,h*(g+y)-v),endAngle:Math.atan2(l*(m+_)-b,u*(m+_)-v),anticlockwise:h*l>u*a}}static arc(e,t,r,i,s,n,o,a,h){let l=o-n,u=o5._segmentsCount(Math.abs(l)*s,40*Math.ceil(Math.abs(l)/io)),c=l/(2*u),d=2*c,p=Math.cos(c),f=Math.sin(c),m=u-1,g=m%1/m;for(let e=0;e<=m;++e){let t=c+n+d*(e+g*e),o=Math.cos(t),a=-Math.sin(t);h.push((p*o+f*a)*s+r,(-(p*a)+f*o)*s+i)}}}class o9{constructor(){this.reset()}begin(e,t,r){this.reset(),this.style=e,this.start=t,this.attribStart=r}end(e,t){this.attribSize=t-this.attribStart,this.size=e-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}}class o7{static curveLength(e,t,r,i,s,n,o,a){let h=0,l=0,u=0,c=0,d=0,p=0,f=0,m=0,g=0,y=0,_=0,v=e,b=t;for(let x=1;x<=10;++x)c=(u=(l=x/10)*l)*l,m=(f=(p=(d=1-l)*d)*d)*e+3*p*l*r+3*d*u*s+c*o,g=f*t+3*p*l*i+3*d*u*n+c*a,y=v-m,_=b-g,v=m,b=g,h+=Math.sqrt(y*y+_*_);return h}static curveTo(e,t,r,i,s,n,o){let a=o[o.length-2],h=o[o.length-1];o.length-=2;let l=o5._segmentsCount(o7.curveLength(a,h,e,t,r,i,s,n)),u=0,c=0,d=0,p=0,f=0;o.push(a,h);for(let m=1,g=0;m<=l;++m)d=(c=(u=1-(g=m/l))*u)*u,f=(p=g*g)*g,o.push(d*a+3*c*g*e+3*u*p*r+f*s,d*h+3*c*g*t+3*u*p*i+f*n)}}function ae(e,t,r,i,s,n,o,a){let h,l;o?(h=i,l=-r):(h=-i,l=r);let u=e-r*s+h,c=t-i*s+l,d=e+r*n+h,p=t+i*n+l;return a.push(u,c,d,p),2}function at(e,t,r,i,s,n,o,a){let h=r-e,l=i-t,u=Math.atan2(h,l),c=Math.atan2(s-e,n-t);a&&u<c?u+=2*Math.PI:!a&&u>c&&(c+=2*Math.PI);let d=u,p=c-u,f=Math.sqrt(h*h+l*l),m=(15*Math.abs(p)*Math.sqrt(f)/Math.PI>>0)+1,g=p/m;if(d+=g,a){o.push(e,t,r,i);for(let r=1,i=d;r<m;r++,i+=g)o.push(e,t,e+Math.sin(i)*f,t+Math.cos(i)*f);o.push(e,t,s,n)}else{o.push(r,i,e,t);for(let r=1,i=d;r<m;r++,i+=g)o.push(e+Math.sin(i)*f,t+Math.cos(i)*f,e,t);o.push(s,n,e,t)}return 2*m}function ar(e,t){e.lineStyle.native?function(e,t){let r=0,i=e.shape,s=e.points||i.points,n=i.type!==il.POLY||i.closeStroke;if(0===s.length)return;let o=t.points,a=t.indices,h=s.length/2,l=o.length/2,u=l;for(o.push(s[0],s[1]),r=1;r<h;r++)o.push(s[2*r],s[2*r+1]),a.push(u,u+1),u++;n&&a.push(u,l)}(e,t):function(e,t){let r=e.shape,i=e.points||r.points.slice(),s=t.closePointEps;if(0===i.length)return;let n=e.lineStyle,o=new iu(i[0],i[1]),a=new iu(i[i.length-2],i[i.length-1]),h=r.type!==il.POLY||r.closeStroke,l=Math.abs(o.x-a.x)<s&&Math.abs(o.y-a.y)<s;if(h){i=i.slice(),l&&(i.pop(),i.pop(),a.set(i[i.length-2],i[i.length-1]));let e=(o.x+a.x)*.5,t=(a.y+o.y)*.5;i.unshift(e,t),i.push(e,t)}let u=t.points,c=i.length/2,d=i.length,p=u.length/2,f=n.width/2,m=f*f,g=n.miterLimit*n.miterLimit,y=i[0],_=i[1],v=i[2],b=i[3],x=0,T=0,E=-(_-b),w=y-v,A=0,S=0,C=Math.sqrt(E*E+w*w);E/=C,w/=C,E*=f,w*=f;let R=n.alignment,I=(1-R)*2,P=2*R;h||(n.cap===o6.ROUND?d+=at(y-E*(I-P)*.5,_-w*(I-P)*.5,y-E*I,_-w*I,y+E*P,_+w*P,u,!0)+2:n.cap===o6.SQUARE&&(d+=ae(y,_,E,w,I,P,!0,u))),u.push(y-E*I,_-w*I,y+E*P,_+w*P);for(let e=1;e<c-1;++e){y=i[(e-1)*2],_=i[(e-1)*2+1],v=i[2*e],b=i[2*e+1],x=i[(e+1)*2],T=i[(e+1)*2+1],C=Math.sqrt((E=-(_-b))*E+(w=y-v)*w),E/=C,w/=C,E*=f,w*=f,C=Math.sqrt((A=-(b-T))*A+(S=v-x)*S),A/=C,S/=C,A*=f,S*=f;let t=v-y,r=_-b,s=v-x,o=T-b,a=t*s+r*o,h=r*s-o*t,l=h<0;if(Math.abs(h)<.001*Math.abs(a)){u.push(v-E*I,b-w*I,v+E*P,b+w*P),a>=0&&(n.join===o4.ROUND?d+=at(v,b,v-E*I,b-w*I,v-A*I,b-S*I,u,!1)+4:d+=2,u.push(v-A*P,b-S*P,v+A*I,b+S*I));continue}let c=(-E+y)*(-w+b)-(-E+v)*(-w+_),p=(-A+x)*(-S+b)-(-A+v)*(-S+T),R=(t*p-s*c)/h,M=(o*c-r*p)/h,D=(R-v)*(R-v)+(M-b)*(M-b),k=v+(R-v)*I,O=b+(M-b)*I,B=v-(R-v)*P,L=b-(M-b)*P,F=l?I:P,N=D<=Math.min(t*t+r*r,s*s+o*o)+F*F*m,U=n.join;if(U===o4.MITER&&D/m>g&&(U=o4.BEVEL),N)switch(U){case o4.MITER:u.push(k,O,B,L);break;case o4.BEVEL:l?u.push(k,O,v+E*P,b+w*P,k,O,v+A*P,b+S*P):u.push(v-E*I,b-w*I,B,L,v-A*I,b-S*I,B,L),d+=2;break;case o4.ROUND:l?(u.push(k,O,v+E*P,b+w*P),d+=at(v,b,v+E*P,b+w*P,v+A*P,b+S*P,u,!0)+4,u.push(k,O,v+A*P,b+S*P)):(u.push(v-E*I,b-w*I,B,L),d+=at(v,b,v-E*I,b-w*I,v-A*I,b-S*I,u,!1)+4,u.push(v-A*I,b-S*I,B,L))}else{switch(u.push(v-E*I,b-w*I,v+E*P,b+w*P),U){case o4.MITER:l?u.push(B,L,B,L):u.push(k,O,k,O),d+=2;break;case o4.ROUND:l?d+=at(v,b,v+E*P,b+w*P,v+A*P,b+S*P,u,!0)+2:d+=at(v,b,v-E*I,b-w*I,v-A*I,b-S*I,u,!1)+2}u.push(v-A*I,b-S*I,v+A*P,b+S*P),d+=2}}y=i[(c-2)*2],_=i[(c-2)*2+1],v=i[(c-1)*2],C=Math.sqrt((E=-(_-(b=i[(c-1)*2+1])))*E+(w=y-v)*w),E/=C,w/=C,E*=f,w*=f,u.push(v-E*I,b-w*I,v+E*P,b+w*P),h||(n.cap===o6.ROUND?d+=at(v-E*(I-P)*.5,b-w*(I-P)*.5,v-E*I,b-w*I,v+E*P,b+w*P,u,!1)+2:n.cap===o6.SQUARE&&(d+=ae(v,b,E,w,I,P,!1,u)));let M=t.indices,D=o5.epsilon*o5.epsilon;for(let e=p;e<d+p-2;++e)y=u[2*e],_=u[2*e+1],v=u[(e+1)*2],b=u[(e+1)*2+1],x=u[(e+2)*2],Math.abs(y*(b-(T=u[(e+2)*2+1]))+v*(T-_)+x*(_-b))<D||M.push(e,e+1,e+2)}(e,t)}class ai{static curveLength(e,t,r,i,s,n){let o=e-2*r+s,a=t-2*i+n,h=2*r-2*e,l=2*i-2*t,u=4*(o*o+a*a),c=4*(o*h+a*l),d=h*h+l*l,p=2*Math.sqrt(u+c+d),f=Math.sqrt(u),m=2*u*f,g=2*Math.sqrt(d),y=c/f;return(m*p+f*c*(p-g)+(4*d*u-c*c)*Math.log((2*f+y+p)/(y+g)))/(4*m)}static curveTo(e,t,r,i,s){let n=s[s.length-2],o=s[s.length-1],a=o5._segmentsCount(ai.curveLength(n,o,e,t,r,i)),h=0,l=0;for(let u=1;u<=a;++u){let c=u/a;h=n+(e-n)*c,l=o+(t-o)*c,s.push(h+(e+(r-e)*c-h)*c,l+(t+(i-t)*c-l)*c)}}}const as={[il.POLY]:o3,[il.CIRC]:o1,[il.ELIP]:o1,[il.RECT]:{build(e){let t=e.shape,r=t.x,i=t.y,s=t.width,n=t.height,o=e.points;o.length=0,s>=0&&n>=0&&o.push(r,i,r+s,i,r+s,i+n,r,i+n)},triangulate(e,t){let r=e.points,i=t.points;if(0===r.length)return;let s=i.length/2;i.push(r[0],r[1],r[2],r[3],r[6],r[7],r[4],r[5]),t.indices.push(s,s+1,s+2,s+1,s+2,s+3)}},[il.RREC]:{build(e){o1.build(e)},triangulate(e,t){o1.triangulate(e,t)}}},an=[],ao=[];class aa{constructor(e,t=null,r=null,i=null){this.points=[],this.holes=[],this.shape=e,this.lineStyle=r,this.fillStyle=t,this.matrix=i,this.type=e.type}clone(){return new aa(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}}const ah=new iu,al=class e extends is{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new nu,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let e=0;e<this.drawCalls.length;e++)this.drawCalls[e].texArray.clear(),ao.push(this.drawCalls[e]);this.drawCalls.length=0;for(let e=0;e<this.batches.length;e++){let t=this.batches[e];t.reset(),an.push(t)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(e,t=null,r=null,i=null){let s=new aa(e,t,r,i);return this.graphicsData.push(s),this.dirty++,this}drawHole(e,t=null){if(!this.graphicsData.length)return null;let r=new aa(e,null,null,t),i=this.graphicsData[this.graphicsData.length-1];return r.lineStyle=i.lineStyle,i.holes.push(r),this.dirty++,this}destroy(){super.destroy();for(let e=0;e<this.graphicsData.length;++e)this.graphicsData[e].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(e){let t=this.graphicsData;for(let r=0;r<t.length;++r){let i=t[r];if(i.fillStyle.visible&&i.shape&&(i.matrix?i.matrix.applyInverse(e,ah):ah.copyFrom(e),i.shape.contains(ah.x,ah.y))){let e=!1;if(i.holes){for(let t=0;t<i.holes.length;t++)if(i.holes[t].shape.contains(ah.x,ah.y)){e=!0;break}}if(!e)return!0}}return!1}updateBatches(){if(!this.graphicsData.length){this.batchable=!0;return}if(!this.validateBatching())return;this.cacheDirty=this.dirty;let e=this.uvs,t=this.graphicsData,r=null,i=null;this.batches.length>0&&(i=(r=this.batches[this.batches.length-1]).style);for(let s=this.shapeIndex;s<t.length;s++){this.shapeIndex++;let n=t[s],o=n.fillStyle,a=n.lineStyle;as[n.type].build(n),n.matrix&&this.transformPoints(n.points,n.matrix),(o.visible||a.visible)&&this.processHoles(n.holes);for(let t=0;t<2;t++){let s=0===t?o:a;if(!s.visible)continue;let h=s.texture.baseTexture,l=this.indices.length,u=this.points.length/2;h.wrapMode=ej.REPEAT,0===t?this.processFill(n):this.processLine(n);let c=this.points.length/2-u;0!==c&&(r&&!this._compareStyles(i,s)&&(r.end(l,u),r=null),r||((r=an.pop()||new o9).begin(s,l,u),this.batches.push(r),i=s),this.addUvs(this.points,e,s.texture,u,c,s.matrix))}}let s=this.indices.length,n=this.points.length/2;if(r&&r.end(s,n),0===this.batches.length){this.batchable=!0;return}let o=n>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&o===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=o?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(e,t){return!(!e||!t||e.texture.baseTexture!==t.texture.baseTexture||e.color+e.alpha!==t.color+t.alpha||!!e.native!=!!t.native)}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let e=0,t=this.graphicsData.length;e<t;e++){let t=this.graphicsData[e],r=t.fillStyle,i=t.lineStyle;if(r&&!r.texture.baseTexture.valid||i&&!i.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);let e=this.batches;for(let t=0,r=e.length;t<r;t++){let r=e[t];for(let e=0;e<r.size;e++){let t=r.start+e;this.indicesUint16[t]=this.indicesUint16[t]-r.attribStart}}}isBatchable(){if(this.points.length>131070)return!1;let t=this.batches;for(let e=0;e<t.length;e++)if(t[e].style.native)return!1;return this.points.length<2*e.BATCHABLE_SIZE}buildDrawCalls(){let e=++r4._globalBatch;for(let e=0;e<this.drawCalls.length;e++)this.drawCalls[e].texArray.clear(),ao.push(this.drawCalls[e]);this.drawCalls.length=0;let t=this.colors,r=this.textureIds,i=ao.pop();i||((i=new r6).texArray=new iZ),i.texArray.count=0,i.start=0,i.size=0,i.type=eB.TRIANGLES;let s=0,n=null,o=0,a=!1,h=eB.TRIANGLES,l=0;this.drawCalls.push(i);for(let u=0;u<this.batches.length;u++){let c=this.batches[u],d=c.style,p=d.texture.baseTexture;!!d.native!==a&&(h=(a=!!d.native)?eB.LINES:eB.TRIANGLES,n=null,s=8,e++),n!==p&&(n=p,p._batchEnabled!==e&&(8===s&&(e++,s=0,i.size>0&&((i=ao.pop())||((i=new r6).texArray=new iZ),this.drawCalls.push(i)),i.start=l,i.size=0,i.texArray.count=0,i.type=h),p.touched=1,p._batchEnabled=e,p._batchLocation=s,p.wrapMode=ej.REPEAT,i.texArray.elements[i.texArray.count++]=p,s++)),i.size+=c.size,l+=c.size,o=p._batchLocation,this.addColors(t,d.color,d.alpha,c.attribSize,c.attribStart),this.addTextureIds(r,o,c.attribSize,c.attribStart)}r4._globalBatch=e,this.packAttributes()}packAttributes(){let e=this.points,t=this.uvs,r=this.colors,i=this.textureIds,s=new ArrayBuffer(12*e.length),n=new Float32Array(s),o=new Uint32Array(s),a=0;for(let s=0;s<e.length/2;s++)n[a++]=e[2*s],n[a++]=e[2*s+1],n[a++]=t[2*s],n[a++]=t[2*s+1],o[a++]=r[s],n[a++]=i[s];this._buffer.update(s),this._indexBuffer.update(this.indicesUint16)}processFill(e){e.holes.length?o3.triangulate(e,this):as[e.type].triangulate(e,this)}processLine(e){ar(e,this);for(let t=0;t<e.holes.length;t++)ar(e.holes[t],this)}processHoles(e){for(let t=0;t<e.length;t++){let r=e[t];as[r.type].build(r),r.matrix&&this.transformPoints(r.points,r.matrix)}}calculateBounds(){let e=this._bounds;e.clear(),e.addVertexData(this.points,0,this.points.length),e.pad(this.boundsPadding,this.boundsPadding)}transformPoints(e,t){for(let r=0;r<e.length/2;r++){let i=e[2*r],s=e[2*r+1];e[2*r]=t.a*i+t.c*s+t.tx,e[2*r+1]=t.b*i+t.d*s+t.ty}}addColors(e,t,r,i,s=0){let n=ra.shared.setValue(t).toLittleEndianNumber(),o=ra.shared.setValue(n).toPremultiplied(r);e.length=Math.max(e.length,s+i);for(let t=0;t<i;t++)e[s+t]=o}addTextureIds(e,t,r,i=0){e.length=Math.max(e.length,i+r);for(let s=0;s<r;s++)e[i+s]=t}addUvs(e,t,r,i,s,n=null){let o=0,a=t.length,h=r.frame;for(;o<s;){let r=e[(i+o)*2],s=e[(i+o)*2+1];if(n){let e=n.a*r+n.c*s+n.tx;s=n.b*r+n.d*s+n.ty,r=e}o++,t.push(r/h.width,s/h.height)}let l=r.baseTexture;(h.width<l.width||h.height<l.height)&&this.adjustUvs(t,r,a,s)}adjustUvs(e,t,r,i){let s=t.baseTexture,n=r+2*i,o=t.frame,a=o.width/s.width,h=o.height/s.height,l=o.x/o.width,u=o.y/o.height,c=Math.floor(e[r]+1e-6),d=Math.floor(e[r+1]+1e-6);for(let t=r+2;t<n;t+=2)c=Math.min(c,Math.floor(e[t]+1e-6)),d=Math.min(d,Math.floor(e[t+1]+1e-6));l-=c,u-=d;for(let t=r;t<n;t+=2)e[t]=(e[t]+l)*a,e[t+1]=(e[t+1]+u)*h}};al.BATCHABLE_SIZE=100;class au{constructor(){this.color=16777215,this.alpha=1,this.texture=sh.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){let e=new au;return e.color=this.color,e.alpha=this.alpha,e.texture=this.texture,e.matrix=this.matrix,e.visible=this.visible,e}reset(){this.color=16777215,this.alpha=1,this.texture=sh.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}}class ac extends au{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=o6.BUTT,this.join=o4.MITER,this.miterLimit=10}clone(){let e=new ac;return e.color=this.color,e.alpha=this.alpha,e.texture=this.texture,e.matrix=this.matrix,e.visible=this.visible,e.width=this.width,e.alignment=this.alignment,e.native=this.native,e.cap=this.cap,e.join=this.join,e.miterLimit=this.miterLimit,e}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1,this.cap=o6.BUTT,this.join=o4.MITER,this.miterLimit=10}}const ad={},ap=class e extends ng{constructor(e=null){super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new au,this._lineStyle=new ac,this._matrix=null,this._holeMode=!1,this.state=rK.for2d(),this._geometry=e||new al,this._geometry.refCount++,this._transformID=-1,this._tintColor=new ra(16777215),this.blendMode=eO.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new e(this._geometry)}set blendMode(e){this.state.blendMode=e}get blendMode(){return this.state.blendMode}get tint(){return this._tintColor.value}set tint(e){this._tintColor.setValue(e)}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(e=null,t=0,r,i=.5,s=!1){return"number"==typeof e&&(e={width:e,color:t,alpha:r,alignment:i,native:s}),this.lineTextureStyle(e)}lineTextureStyle(e){e=Object.assign({width:0,texture:sh.WHITE,color:e?.texture?16777215:0,matrix:null,alignment:.5,native:!1,cap:o6.BUTT,join:o4.MITER,miterLimit:10},e),this.normalizeColor(e),this.currentPath&&this.startPoly();let t=e.width>0&&e.alpha>0;return t?(e.matrix&&(e.matrix=e.matrix.clone(),e.matrix.invert()),Object.assign(this._lineStyle,{visible:t},e)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){let e=this.currentPath.points,t=this.currentPath.points.length;t>2&&(this.drawShape(this.currentPath),this.currentPath=new ig,this.currentPath.closeStroke=!1,this.currentPath.points.push(e[t-2],e[t-1]))}else this.currentPath=new ig,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(e,t){return this.startPoly(),this.currentPath.points[0]=e,this.currentPath.points[1]=t,this}lineTo(e,t){this.currentPath||this.moveTo(0,0);let r=this.currentPath.points,i=r[r.length-2],s=r[r.length-1];return(i!==e||s!==t)&&r.push(e,t),this}_initCurve(e=0,t=0){this.currentPath?0===this.currentPath.points.length&&(this.currentPath.points=[e,t]):this.moveTo(e,t)}quadraticCurveTo(e,t,r,i){this._initCurve();let s=this.currentPath.points;return 0===s.length&&this.moveTo(0,0),ai.curveTo(e,t,r,i,s),this}bezierCurveTo(e,t,r,i,s,n){return this._initCurve(),o7.curveTo(e,t,r,i,s,n,this.currentPath.points),this}arcTo(e,t,r,i,s){this._initCurve(e,t);let n=this.currentPath.points,o=o8.curveTo(e,t,r,i,s,n);if(o){let{cx:e,cy:t,radius:r,startAngle:i,endAngle:s,anticlockwise:n}=o;this.arc(e,t,r,i,s,n)}return this}arc(e,t,r,i,s,n=!1){if(i===s||(!n&&s<=i?s+=io:n&&i<=s&&(i+=io),s-i==0))return this;let o=e+Math.cos(i)*r,a=t+Math.sin(i)*r,h=this._geometry.closePointEps,l=this.currentPath?this.currentPath.points:null;if(l){let e=Math.abs(l[l.length-2]-o),t=Math.abs(l[l.length-1]-a);e<h&&t<h||l.push(o,a)}else this.moveTo(o,a),l=this.currentPath.points;return o8.arc(o,a,e,t,r,i,s,n,l),this}beginFill(e=0,t){return this.beginTextureFill({texture:sh.WHITE,color:e,alpha:t})}normalizeColor(e){let t=ra.shared.setValue(e.color??0);e.color=t.toNumber(),e.alpha??(e.alpha=t.alpha)}beginTextureFill(e){e=Object.assign({texture:sh.WHITE,color:16777215,matrix:null},e),this.normalizeColor(e),this.currentPath&&this.startPoly();let t=e.alpha>0;return t?(e.matrix&&(e.matrix=e.matrix.clone(),e.matrix.invert()),Object.assign(this._fillStyle,{visible:t},e)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(e,t,r,i){return this.drawShape(new id(e,t,r,i))}drawRoundedRect(e,t,r,i,s){return this.drawShape(new iy(e,t,r,i,s))}drawCircle(e,t,r){return this.drawShape(new ip(e,t,r))}drawEllipse(e,t,r,i){return this.drawShape(new im(e,t,r,i))}drawPolygon(...e){let t,r=!0,i=e[0];i.points?(r=i.closeStroke,t=i.points):t=Array.isArray(e[0])?e[0]:e;let s=new ig(t);return s.closeStroke=r,this.drawShape(s),this}drawShape(e){return this._holeMode?this._geometry.drawHole(e,this._matrix):this._geometry.drawShape(e,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){let e=this._geometry.graphicsData;return 1===e.length&&e[0].shape.type===il.RECT&&!e[0].matrix&&!e[0].holes.length&&!(e[0].lineStyle.visible&&e[0].lineStyle.width)}_render(e){this.finishPoly();let t=this._geometry;t.updateBatches(),t.batchable?(this.batchDirty!==t.batchDirty&&this._populateBatches(),this._renderBatched(e)):(e.batch.flush(),this._renderDirect(e))}_populateBatches(){let e=this._geometry,t=this.blendMode,r=e.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=e.batchDirty,this.batches.length=r,this.vertexData=new Float32Array(e.points);for(let i=0;i<r;i++){let r=e.batches[i],s=r.style.color,n=new Float32Array(this.vertexData.buffer,8*r.attribStart,2*r.attribSize),o=new Float32Array(e.uvsFloat32.buffer,8*r.attribStart,2*r.attribSize),a={vertexData:n,blendMode:t,indices:new Uint16Array(e.indicesUint16.buffer,2*r.start,r.size),uvs:o,_batchRGB:ra.shared.setValue(s).toRgbArray(),_tintRGB:s,_texture:r.style.texture,alpha:r.style.alpha,worldAlpha:1};this.batches[i]=a}}_renderBatched(e){if(this.batches.length){e.batch.setObjectRenderer(e.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let t=0,r=this.batches.length;t<r;t++){let r=this.batches[t];r.worldAlpha=this.worldAlpha*r.alpha,e.plugins[this.pluginName].render(r)}}}_renderDirect(e){let t=this._resolveDirectShader(e),r=this._geometry,i=this.worldAlpha,s=t.uniforms,n=r.drawCalls;s.translationMatrix=this.transform.worldTransform,ra.shared.setValue(this._tintColor).premultiply(i).toArray(s.tint),e.shader.bind(t),e.geometry.bind(r,t),e.state.set(this.state);for(let t=0,i=n.length;t<i;t++)this._renderDrawCallDirect(e,r.drawCalls[t])}_renderDrawCallDirect(e,t){let{texArray:r,type:i,size:s,start:n}=t,o=r.count;for(let t=0;t<o;t++)e.texture.bind(r.elements[t],t);e.geometry.draw(i,s,n)}_resolveDirectShader(e){let t=this.shader,r=this.pluginName;if(!t){if(!ad[r]){let{maxTextures:t}=e.plugins[r],i=new Int32Array(t);for(let e=0;e<t;e++)i[e]=e;let s={tint:new Float32Array([1,1,1,1]),translationMatrix:new i_,default:iq.from({uSamplers:i},!0)},n=e.plugins[r]._shader.program;ad[r]=new iK(n,s)}t=ad[r]}return t}_calculateBounds(){this.finishPoly();let e=this._geometry;if(!e.graphicsData.length)return;let{minX:t,minY:r,maxX:i,maxY:s}=e.bounds;this._bounds.addFrame(this.transform,t,r,i,s)}containsPoint(t){return this.worldTransform.applyInverse(t,e._TEMP_POINT),this._geometry.containsPoint(e._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this._tintColor.toNumber();for(let e=0;e<this.batches.length;e++){let t=this.batches[e];t._tintRGB=ra.shared.setValue(this._tintColor).multiply(t._batchRGB).toLittleEndianNumber()}}}calculateVertices(){let e=this.transform._worldID;if(this._transformID===e)return;this._transformID=e;let t=this.transform.worldTransform,r=t.a,i=t.b,s=t.c,n=t.d,o=t.tx,a=t.ty,h=this._geometry.points,l=this.vertexData,u=0;for(let e=0;e<h.length;e+=2){let t=h[e],c=h[e+1];l[u++]=r*t+s*c+o,l[u++]=n*c+i*t+a}}closePath(){let e=this.currentPath;return e&&(e.closeStroke=!0,this.finishPoly()),this}setMatrix(e){return this._matrix=e,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(e){this._geometry.refCount--,0===this._geometry.refCount&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(e)}};ap.curves=o5,ap._TEMP_POINT=new iu;class af{constructor(e,t){this.uvBuffer=e,this.uvMatrix=t,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(e){if(!e&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;let t=this.uvBuffer.data;this.data&&this.data.length===t.length||(this.data=new Float32Array(t.length)),this.uvMatrix.multiplyUvs(t,this.data),this._updateID++}}const am=new iu,ag=new ig;(class e extends ng{constructor(e,t,r,i=eB.TRIANGLES){super(),this.geometry=e,this.shader=t,this.state=r||rK.for2d(),this.drawMode=i,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=eJ.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(e){this._geometry!==e&&(this._geometry&&(this._geometry.refCount--,0===this._geometry.refCount&&this._geometry.dispose()),this._geometry=e,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(e){this.shader=e}get material(){return this.shader}set blendMode(e){this.state.blendMode=e}get blendMode(){return this.state.blendMode}set roundPixels(e){this._roundPixels!==e&&(this._transformID=-1),this._roundPixels=e}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint(e){this.shader.tint=e}get tintValue(){return this.shader.tintValue}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture(e){this.shader.texture=e}_render(t){let r=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===eB.TRIANGLES&&r.length<2*e.BATCHABLE_SIZE?this._renderToBatch(t):this._renderDefault(t)}_renderDefault(e){let t=this.shader;t.alpha=this.worldAlpha,t.update&&t.update(),e.batch.flush(),t.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),e.shader.bind(t),e.state.set(this.state),e.geometry.bind(this.geometry,t),e.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(e){let t=this.geometry,r=this.shader;r.uvMatrix&&(r.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=t.indexBuffer.data,this._tintRGB=r._tintRGB,this._texture=r.texture;let i=this.material.pluginName;e.batch.setObjectRenderer(e.plugins[i]),e.plugins[i].render(this)}calculateVertices(){let e=this.geometry.buffers[0],t=e.data,r=e._updateID;if(r===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==t.length&&(this.vertexData=new Float32Array(t.length));let i=this.transform.worldTransform,s=i.a,n=i.b,o=i.c,a=i.d,h=i.tx,l=i.ty,u=this.vertexData;for(let e=0;e<u.length/2;e++){let r=t[2*e],i=t[2*e+1];u[2*e]=s*r+o*i+h,u[2*e+1]=n*r+a*i+l}if(this._roundPixels){let e=eJ.RESOLUTION;for(let t=0;t<u.length;++t)u[t]=Math.round(u[t]*e)/e}this.vertexDirty=r}calculateUvs(){let e=this.geometry.buffers[1],t=this.shader;t.uvMatrix.isSimple?this.uvs=e.data:(this.batchUvs||(this.batchUvs=new af(e,t.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(e){if(!this.getBounds().contains(e.x,e.y))return!1;this.worldTransform.applyInverse(e,am);let t=this.geometry.getBuffer("aVertexPosition").data,r=ag.points,i=this.geometry.getIndex().data,s=i.length,n=4===this.drawMode?3:1;for(let e=0;e+2<s;e+=n){let s=2*i[e],n=2*i[e+1],o=2*i[e+2];if(r[0]=t[s],r[1]=t[s+1],r[2]=t[n],r[3]=t[n+1],r[4]=t[o],r[5]=t[o+1],ag.contains(am.x,am.y))return!0}return!1}destroy(e){super.destroy(e),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}}).BATCHABLE_SIZE=100;var ay=`varying vec2 vTextureCoord;
uniform vec4 uColor;

uniform sampler2D uSampler;

void main(void)
{
    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;
}
`,a_=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTextureMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;
}
`;class av{constructor(e,t,r){this.geometry=new ii,this.indexBuffer=null,this.size=r,this.dynamicProperties=[],this.staticProperties=[];for(let r=0;r<e.length;++r){let i=e[r];i={attributeName:i.attributeName,size:i.size,uploadFunction:i.uploadFunction,type:i.type||eN.FLOAT,offset:i.offset},t[r]?this.dynamicProperties.push(i):this.staticProperties.push(i)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){let e=this.geometry,t=0;this.indexBuffer=new r8(to.createIndicesForQuads(this.size),!0,!0),e.addIndex(this.indexBuffer),this.dynamicStride=0;for(let e=0;e<this.dynamicProperties.length;++e){let r=this.dynamicProperties[e];r.offset=t,t+=r.size,this.dynamicStride+=r.size}let r=new ArrayBuffer(this.size*this.dynamicStride*16);this.dynamicData=new Float32Array(r),this.dynamicDataUint32=new Uint32Array(r),this.dynamicBuffer=new r8(this.dynamicData,!1,!1);let i=0;this.staticStride=0;for(let e=0;e<this.staticProperties.length;++e){let t=this.staticProperties[e];t.offset=i,i+=t.size,this.staticStride+=t.size}let s=new ArrayBuffer(this.size*this.staticStride*16);this.staticData=new Float32Array(s),this.staticDataUint32=new Uint32Array(s),this.staticBuffer=new r8(this.staticData,!0,!1);for(let t=0;t<this.dynamicProperties.length;++t){let r=this.dynamicProperties[t];e.addAttribute(r.attributeName,this.dynamicBuffer,0,r.type===eN.UNSIGNED_BYTE,r.type,4*this.dynamicStride,4*r.offset)}for(let t=0;t<this.staticProperties.length;++t){let r=this.staticProperties[t];e.addAttribute(r.attributeName,this.staticBuffer,0,r.type===eN.UNSIGNED_BYTE,r.type,4*this.staticStride,4*r.offset)}}uploadDynamic(e,t,r){for(let i=0;i<this.dynamicProperties.length;i++){let s=this.dynamicProperties[i];s.uploadFunction(e,t,r,s.type===eN.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,s.offset)}this.dynamicBuffer._updateID++}uploadStatic(e,t,r){for(let i=0;i<this.staticProperties.length;i++){let s=this.staticProperties[i];s.uploadFunction(e,t,r,s.type===eN.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,s.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}}var ab=`varying vec2 vTextureCoord;
varying vec4 vColor;

uniform sampler2D uSampler;

void main(void){
    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;
    gl_FragColor = color;
}`,ax=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;

attribute vec2 aPositionCoord;
attribute float aRotation;

uniform mat3 translationMatrix;
uniform vec4 uColor;

varying vec2 vTextureCoord;
varying vec4 vColor;

void main(void){
    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);
    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);

    vec2 v = vec2(x, y);
    v = v + aPositionCoord;

    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vColor = aColor * uColor;
}
`;class aT extends iQ{constructor(e){super(e),this.shader=null,this.properties=null,this.tempMatrix=new i_,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:eN.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=iK.from(ax,ab,{}),this.state=rK.for2d()}render(e){let t=e.children,r=e._maxSize,i=e._batchSize,s=this.renderer,n=t.length;if(0===n)return;n>r&&!e.autoResize&&(n=r);let o=e._buffers;o||(o=e._buffers=this.generateBuffers(e));let a=t[0]._texture.baseTexture,h=a.alphaMode>0;this.state.blendMode=to.correctBlendMode(e.blendMode,h),s.state.set(this.state);let l=s.gl,u=e.worldTransform.copyTo(this.tempMatrix);u.prepend(s.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=u.toArray(!0),this.shader.uniforms.uColor=ra.shared.setValue(e.tintRgb).premultiply(e.worldAlpha,h).toArray(this.shader.uniforms.uColor),this.shader.uniforms.uSampler=a,this.renderer.shader.bind(this.shader);let c=!1;for(let r=0,a=0;r<n;r+=i,a+=1){let h=n-r;h>i&&(h=i),a>=o.length&&o.push(this._generateOneMoreBuffer(e));let u=o[a];u.uploadDynamic(t,r,h);let d=e._bufferUpdateIDs[a]||0;(c=c||u._updateID<d)&&(u._updateID=e._updateID,u.uploadStatic(t,r,h)),s.geometry.bind(u.geometry),l.drawElements(l.TRIANGLES,6*h,l.UNSIGNED_SHORT,0)}}generateBuffers(e){let t=[],r=e._maxSize,i=e._batchSize,s=e._properties;for(let e=0;e<r;e+=i)t.push(new av(this.properties,s,i));return t}_generateOneMoreBuffer(e){let t=e._batchSize,r=e._properties;return new av(this.properties,r,t)}uploadVertices(e,t,r,i,s,n){let o=0,a=0,h=0,l=0;for(let u=0;u<r;++u){let r=e[t+u],c=r._texture,d=r.scale.x,p=r.scale.y,f=c.trim,m=c.orig;f?(o=(a=f.x-r.anchor.x*m.width)+f.width,h=(l=f.y-r.anchor.y*m.height)+f.height):(o=m.width*(1-r.anchor.x),a=-(m.width*r.anchor.x),h=m.height*(1-r.anchor.y),l=-(m.height*r.anchor.y)),i[n]=a*d,i[n+1]=l*p,i[n+s]=o*d,i[n+s+1]=l*p,i[n+2*s]=o*d,i[n+2*s+1]=h*p,i[n+3*s]=a*d,i[n+3*s+1]=h*p,n+=4*s}}uploadPosition(e,t,r,i,s,n){for(let o=0;o<r;o++){let r=e[t+o].position;i[n]=r.x,i[n+1]=r.y,i[n+s]=r.x,i[n+s+1]=r.y,i[n+2*s]=r.x,i[n+2*s+1]=r.y,i[n+3*s]=r.x,i[n+3*s+1]=r.y,n+=4*s}}uploadRotation(e,t,r,i,s,n){for(let o=0;o<r;o++){let r=e[t+o].rotation;i[n]=r,i[n+s]=r,i[n+2*s]=r,i[n+3*s]=r,n+=4*s}}uploadUvs(e,t,r,i,s,n){for(let o=0;o<r;++o){let r=e[t+o]._texture._uvs;r?(i[n]=r.x0,i[n+1]=r.y0,i[n+s]=r.x1,i[n+s+1]=r.y1,i[n+2*s]=r.x2,i[n+2*s+1]=r.y2,i[n+3*s]=r.x3,i[n+3*s+1]=r.y3):(i[n]=0,i[n+1]=0,i[n+s]=0,i[n+s+1]=0,i[n+2*s]=0,i[n+2*s+1]=0,i[n+3*s]=0,i[n+3*s+1]=0),n+=4*s}}uploadTint(e,t,r,i,s,n){for(let o=0;o<r;++o){let r=e[t+o],a=ra.shared.setValue(r._tintRGB).toPremultiplied(r.alpha,r.texture.baseTexture.alphaMode>0);i[n]=a,i[n+s]=a,i[n+2*s]=a,i[n+3*s]=a,n+=4*s}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}}aT.extension={name:"particle",type:rV.RendererPlugin},r$.add(aT);var aE=((K=aE||{})[K.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",K[K.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",K);const aw={willReadFrequently:!0},aA=class e{static get experimentalLetterSpacingSupported(){let t=e._experimentalLetterSpacingSupported;if(void 0!==t){let r=eJ.ADAPTER.getCanvasRenderingContext2D().prototype;t=e._experimentalLetterSpacingSupported="letterSpacing"in r||"textLetterSpacing"in r}return t}constructor(e,t,r,i,s,n,o,a,h){this.text=e,this.style=t,this.width=r,this.height=i,this.lines=s,this.lineWidths=n,this.lineHeight=o,this.maxLineWidth=a,this.fontProperties=h}static measureText(t,r,i,s=e._canvas){i=i??r.wordWrap;let n=r.toFontString(),o=e.measureFont(n);0===o.fontSize&&(o.fontSize=r.fontSize,o.ascent=r.fontSize);let a=s.getContext("2d",aw);a.font=n;let h=(i?e.wordWrap(t,r,s):t).split(/(?:\r\n|\r|\n)/),l=Array(h.length),u=0;for(let t=0;t<h.length;t++){let i=e._measureText(h[t],r.letterSpacing,a);l[t]=i,u=Math.max(u,i)}let c=u+r.strokeThickness;r.dropShadow&&(c+=r.dropShadowDistance);let d=r.lineHeight||o.fontSize+r.strokeThickness,p=Math.max(d,o.fontSize+2*r.strokeThickness)+r.leading+(h.length-1)*(d+r.leading);return r.dropShadow&&(p+=r.dropShadowDistance),new e(t,r,c,p,h,l,d+r.leading,u,o)}static _measureText(t,r,i){let s=!1;e.experimentalLetterSpacingSupported&&(e.experimentalLetterSpacing?(i.letterSpacing=`${r}px`,i.textLetterSpacing=`${r}px`,s=!0):(i.letterSpacing="0px",i.textLetterSpacing="0px"));let n=i.measureText(t).width;return n>0&&(s?n-=r:n+=(e.graphemeSegmenter(t).length-1)*r),n}static wordWrap(t,r,i=e._canvas){let s=i.getContext("2d",aw),n=0,o="",a="",h=Object.create(null),{letterSpacing:l,whiteSpace:u}=r,c=e.collapseSpaces(u),d=e.collapseNewlines(u),p=!c,f=r.wordWrapWidth+l,m=e.tokenize(t);for(let t=0;t<m.length;t++){let i=m[t];if(e.isNewline(i)){if(!d){a+=e.addLine(o),p=!c,o="",n=0;continue}i=" "}if(c){let t=e.isBreakingSpace(i),r=e.isBreakingSpace(o[o.length-1]);if(t&&r)continue}let u=e.getFromCache(i,l,h,s);if(u>f){if(""!==o&&(a+=e.addLine(o),o="",n=0),e.canBreakWords(i,r.breakWords)){let t=e.wordWrapSplit(i);for(let u=0;u<t.length;u++){let c=t[u],d=c,m=1;for(;t[u+m];){let s=t[u+m];if(e.canBreakChars(d,s,i,u,r.breakWords))break;c+=s,d=s,m++}u+=m-1;let g=e.getFromCache(c,l,h,s);g+n>f&&(a+=e.addLine(o),p=!1,o="",n=0),o+=c,n+=g}}else{o.length>0&&(a+=e.addLine(o),o="",n=0);let r=t===m.length-1;a+=e.addLine(i,!r),p=!1,o="",n=0}}else u+n>f&&(p=!1,a+=e.addLine(o),o="",n=0),(o.length>0||!e.isBreakingSpace(i)||p)&&(o+=i,n+=u)}return a+e.addLine(o,!1)}static addLine(t,r=!0){return t=e.trimRight(t),t=r?`${t}
`:t}static getFromCache(t,r,i,s){let n=i[t];return"number"!=typeof n&&(n=e._measureText(t,r,s)+r,i[t]=n),n}static collapseSpaces(e){return"normal"===e||"pre-line"===e}static collapseNewlines(e){return"normal"===e}static trimRight(t){if("string"!=typeof t)return"";for(let r=t.length-1;r>=0;r--){let i=t[r];if(!e.isBreakingSpace(i))break;t=t.slice(0,-1)}return t}static isNewline(t){return"string"==typeof t&&e._newlines.includes(t.charCodeAt(0))}static isBreakingSpace(t,r){return"string"==typeof t&&e._breakingSpaces.includes(t.charCodeAt(0))}static tokenize(t){let r=[],i="";if("string"!=typeof t)return r;for(let s=0;s<t.length;s++){let n=t[s],o=t[s+1];if(e.isBreakingSpace(n,o)||e.isNewline(n)){""!==i&&(r.push(i),i=""),r.push(n);continue}i+=n}return""!==i&&r.push(i),r}static canBreakWords(e,t){return t}static canBreakChars(e,t,r,i,s){return!0}static wordWrapSplit(t){return e.graphemeSegmenter(t)}static measureFont(t){if(e._fonts[t])return e._fonts[t];let r={ascent:0,descent:0,fontSize:0},i=e._canvas,s=e._context;s.font=t;let n=e.METRICS_STRING+e.BASELINE_SYMBOL,o=Math.ceil(s.measureText(n).width),a=Math.ceil(s.measureText(e.BASELINE_SYMBOL).width),h=Math.ceil(e.HEIGHT_MULTIPLIER*a);if(a=a*e.BASELINE_MULTIPLIER|0,0===o||0===h)return e._fonts[t]=r,r;i.width=o,i.height=h,s.fillStyle="#f00",s.fillRect(0,0,o,h),s.font=t,s.textBaseline="alphabetic",s.fillStyle="#000",s.fillText(n,0,a);let l=s.getImageData(0,0,o,h).data,u=l.length,c=4*o,d=0,p=0,f=!1;for(d=0;d<a;++d){for(let e=0;e<c;e+=4)if(255!==l[p+e]){f=!0;break}if(f)break;p+=c}for(r.ascent=a-d,p=u-c,f=!1,d=h;d>a;--d){for(let e=0;e<c;e+=4)if(255!==l[p+e]){f=!0;break}if(f)break;p-=c}return r.descent=d-a,r.fontSize=r.ascent+r.descent,e._fonts[t]=r,r}static clearMetrics(t=""){t?delete e._fonts[t]:e._fonts={}}static get _canvas(){if(!e.__canvas){let t;try{let r=new OffscreenCanvas(0,0);if(r.getContext("2d",aw)?.measureText)return e.__canvas=r,r;t=eJ.ADAPTER.createCanvas()}catch{t=eJ.ADAPTER.createCanvas()}t.width=t.height=10,e.__canvas=t}return e.__canvas}static get _context(){return e.__context||(e.__context=e._canvas.getContext("2d",aw)),e.__context}};aA.METRICS_STRING="|q",aA.BASELINE_SYMBOL="M",aA.BASELINE_MULTIPLIER=1.4,aA.HEIGHT_MULTIPLIER=2,aA.graphemeSegmenter=(()=>{if("function"==typeof Intl?.Segmenter){let e=new Intl.Segmenter;return t=>[...e.segment(t)].map(e=>e.segment)}return e=>[...e]})(),aA.experimentalLetterSpacing=!1,aA._fonts={},aA._newlines=[10,13],aA._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];const aS=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],aC=class e{constructor(e){this.styleID=0,this.reset(),aP(this,e,e)}clone(){let t={};return aP(t,this,e.defaultStyle),new e(t)}reset(){aP(this,e.defaultStyle,e.defaultStyle)}get align(){return this._align}set align(e){this._align!==e&&(this._align=e,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(e){this._breakWords!==e&&(this._breakWords=e,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(e){this._dropShadow!==e&&(this._dropShadow=e,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(e){this._dropShadowAlpha!==e&&(this._dropShadowAlpha=e,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(e){this._dropShadowAngle!==e&&(this._dropShadowAngle=e,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(e){this._dropShadowBlur!==e&&(this._dropShadowBlur=e,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(e){let t=aI(e);this._dropShadowColor!==t&&(this._dropShadowColor=t,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(e){this._dropShadowDistance!==e&&(this._dropShadowDistance=e,this.styleID++)}get fill(){return this._fill}set fill(e){let t=aI(e);this._fill!==t&&(this._fill=t,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(e){this._fillGradientType!==e&&(this._fillGradientType=e,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(e){(function(e,t){if(!Array.isArray(e)||!Array.isArray(t)||e.length!==t.length)return!1;for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0})(this._fillGradientStops,e)||(this._fillGradientStops=e,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(e){this.fontFamily!==e&&(this._fontFamily=e,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(e){this._fontSize!==e&&(this._fontSize=e,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(e){this._fontStyle!==e&&(this._fontStyle=e,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(e){this._fontVariant!==e&&(this._fontVariant=e,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(e){this._fontWeight!==e&&(this._fontWeight=e,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(e){this._letterSpacing!==e&&(this._letterSpacing=e,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(e){this._lineHeight!==e&&(this._lineHeight=e,this.styleID++)}get leading(){return this._leading}set leading(e){this._leading!==e&&(this._leading=e,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(e){this._lineJoin!==e&&(this._lineJoin=e,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(e){this._miterLimit!==e&&(this._miterLimit=e,this.styleID++)}get padding(){return this._padding}set padding(e){this._padding!==e&&(this._padding=e,this.styleID++)}get stroke(){return this._stroke}set stroke(e){let t=aI(e);this._stroke!==t&&(this._stroke=t,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(e){this._strokeThickness!==e&&(this._strokeThickness=e,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(e){this._textBaseline!==e&&(this._textBaseline=e,this.styleID++)}get trim(){return this._trim}set trim(e){this._trim!==e&&(this._trim=e,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(e){this._whiteSpace!==e&&(this._whiteSpace=e,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(e){this._wordWrap!==e&&(this._wordWrap=e,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(e){this._wordWrapWidth!==e&&(this._wordWrapWidth=e,this.styleID++)}toFontString(){let e="number"==typeof this.fontSize?`${this.fontSize}px`:this.fontSize,t=this.fontFamily;Array.isArray(this.fontFamily)||(t=this.fontFamily.split(","));for(let e=t.length-1;e>=0;e--){let r=t[e].trim();/([\"\'])[^\'\"]+\1/.test(r)||aS.includes(r)||(r=`"${r}"`),t[e]=r}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${e} ${t.join(",")}`}};aC.defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:aE.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};let aR=aC;function aI(e){let t=ra.shared,r=e=>{let r=t.setValue(e);return 1===r.alpha?r.toHex():r.toRgbaString()};return Array.isArray(e)?e.map(r):r(e)}function aP(e,t,r){for(let i in r)Array.isArray(t[i])?e[i]=t[i].slice():e[i]=t[i]}const aM={texture:!0,children:!1,baseTexture:!0},aD=class e extends nv{constructor(t,r,i){let s=!1;i||(i=eJ.ADAPTER.createCanvas(),s=!0),i.width=3,i.height=3;let n=sh.from(i);n.orig=new id,n.trim=new id,super(n),this._ownCanvas=s,this.canvas=i,this.context=i.getContext("2d",{willReadFrequently:!0}),this._resolution=e.defaultResolution??eJ.RESOLUTION,this._autoResolution=e.defaultAutoResolution,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=t,this.style=r,this.localStyleID=-1}static get experimentalLetterSpacing(){return aA.experimentalLetterSpacing}static set experimentalLetterSpacing(e){to.deprecation("7.1.0","Text.experimentalLetterSpacing is deprecated, use TextMetrics.experimentalLetterSpacing"),aA.experimentalLetterSpacing=e}updateText(e){let t,r;let i=this._style;if(this.localStyleID!==i.styleID&&(this.dirty=!0,this.localStyleID=i.styleID),!this.dirty&&e)return;this._font=this._style.toFontString();let s=this.context,n=aA.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),o=n.width,a=n.height,h=n.lines,l=n.lineHeight,u=n.lineWidths,c=n.maxLineWidth,d=n.fontProperties;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,o)+2*i.padding)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,a)+2*i.padding)*this._resolution),s.scale(this._resolution,this._resolution),s.clearRect(0,0,this.canvas.width,this.canvas.height),s.font=this._font,s.lineWidth=i.strokeThickness,s.textBaseline=i.textBaseline,s.lineJoin=i.lineJoin,s.miterLimit=i.miterLimit;let p=i.dropShadow?2:1;for(let e=0;e<p;++e){let o=i.dropShadow&&0===e,p=o?Math.ceil(Math.max(1,a)+2*i.padding):0,f=p*this._resolution;if(o){s.fillStyle="black",s.strokeStyle="black";let e=i.dropShadowColor,t=i.dropShadowBlur*this._resolution,r=i.dropShadowDistance*this._resolution;s.shadowColor=ra.shared.setValue(e).setAlpha(i.dropShadowAlpha).toRgbaString(),s.shadowBlur=t,s.shadowOffsetX=Math.cos(i.dropShadowAngle)*r,s.shadowOffsetY=Math.sin(i.dropShadowAngle)*r+f}else s.fillStyle=this._generateFillStyle(i,h,n),s.strokeStyle=i.stroke,s.shadowColor="black",s.shadowBlur=0,s.shadowOffsetX=0,s.shadowOffsetY=0;let m=(l-d.fontSize)/2;l-d.fontSize<0&&(m=0);for(let e=0;e<h.length;e++)t=i.strokeThickness/2,r=i.strokeThickness/2+e*l+d.ascent+m,"right"===i.align?t+=c-u[e]:"center"===i.align&&(t+=(c-u[e])/2),i.stroke&&i.strokeThickness&&this.drawLetterSpacing(h[e],t+i.padding,r+i.padding-p,!0),i.fill&&this.drawLetterSpacing(h[e],t+i.padding,r+i.padding-p)}this.updateTexture()}drawLetterSpacing(e,t,r,i=!1){let s=this._style.letterSpacing,n=!1;if(aA.experimentalLetterSpacingSupported&&(aA.experimentalLetterSpacing?(this.context.letterSpacing=`${s}px`,this.context.textLetterSpacing=`${s}px`,n=!0):(this.context.letterSpacing="0px",this.context.textLetterSpacing="0px")),0===s||n){i?this.context.strokeText(e,t,r):this.context.fillText(e,t,r);return}let o=t,a=aA.graphemeSegmenter(e),h=this.context.measureText(e).width,l=0;for(let e=0;e<a.length;++e){let t=a[e];i?this.context.strokeText(t,o,r):this.context.fillText(t,o,r);let n="";for(let t=e+1;t<a.length;++t)n+=a[t];o+=h-(l=this.context.measureText(n).width)+s,h=l}}updateTexture(){let e=this.canvas;if(this._style.trim){let t=to.trimCanvas(e);t.data&&(e.width=t.width,e.height=t.height,this.context.putImageData(t.data,0,0))}let t=this._texture,r=this._style,i=r.trim?0:r.padding,s=t.baseTexture;t.trim.width=t._frame.width=e.width/this._resolution,t.trim.height=t._frame.height=e.height/this._resolution,t.trim.x=-i,t.trim.y=-i,t.orig.width=t._frame.width-2*i,t.orig.height=t._frame.height-2*i,this._onTextureUpdate(),s.setRealSize(e.width,e.height,this._resolution),t.updateUvs(),this.dirty=!1}_render(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),super._render(e)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(e,t){return this.updateText(!0),-1===this._textureID&&(e=!1),super.getBounds(e,t)}getLocalBounds(e){return this.updateText(!0),super.getLocalBounds.call(this,e)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(e,t,r){let i;let s=e.fill;if(!Array.isArray(s))return s;if(1===s.length)return s[0];let n=e.dropShadow?e.dropShadowDistance:0,o=e.padding||0,a=this.canvas.width/this._resolution-n-2*o,h=this.canvas.height/this._resolution-n-2*o,l=s.slice(),u=e.fillGradientStops.slice();if(!u.length){let e=l.length+1;for(let t=1;t<e;++t)u.push(t/e)}if(l.unshift(s[0]),u.unshift(0),l.push(s[s.length-1]),u.push(1),e.fillGradientType===aE.LINEAR_VERTICAL){i=this.context.createLinearGradient(a/2,o,a/2,h+o);let s=r.fontProperties.fontSize+e.strokeThickness;for(let e=0;e<t.length;e++){let n=r.lineHeight*(e-1)+s,o=r.lineHeight*e,a=o;e>0&&n>o&&(a=(o+n)/2);let c=o+s,d=r.lineHeight*(e+1),p=c;e+1<t.length&&d<c&&(p=(c+d)/2);let f=(p-a)/h;for(let e=0;e<l.length;e++){let t=Math.min(1,Math.max(0,a/h+("number"==typeof u[e]?u[e]:e/l.length)*f));t=Number(t.toFixed(5)),i.addColorStop(t,l[e])}}}else{i=this.context.createLinearGradient(o,h/2,a+o,h/2);let e=l.length+1,t=1;for(let r=0;r<l.length;r++){let s;s="number"==typeof u[r]?u[r]:t/e,i.addColorStop(s,l[r]),t++}}return i}destroy(e){"boolean"==typeof e&&(e={children:e}),e=Object.assign({},aM,e),super.destroy(e),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(e){this.updateText(!0);let t=to.sign(this.scale.x)||1;this.scale.x=t*e/this._texture.orig.width,this._width=e}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(e){this.updateText(!0);let t=to.sign(this.scale.y)||1;this.scale.y=t*e/this._texture.orig.height,this._height=e}get style(){return this._style}set style(e){(e=e||{})instanceof aR?this._style=e:this._style=new aR(e),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(e){e=String(e??""),this._text!==e&&(this._text=e,this.dirty=!0)}get resolution(){return this._resolution}set resolution(e){this._autoResolution=!1,this._resolution!==e&&(this._resolution=e,this.dirty=!0)}};aD.defaultAutoResolution=!0;class ak{constructor(e){this.maxItemsPerFrame=e,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}}function aO(e,t){let r=!1;if(e?._textures?.length){for(let i=0;i<e._textures.length;i++)if(e._textures[i]instanceof sh){let s=e._textures[i].baseTexture;t.includes(s)||(t.push(s),r=!0)}}return r}function aB(e,t){if(e.baseTexture instanceof r4){let r=e.baseTexture;return t.includes(r)||t.push(r),!0}return!1}function aL(e,t){if(e._texture&&e._texture instanceof sh){let r=e._texture.baseTexture;return t.includes(r)||t.push(r),!0}return!1}function aF(e,t){return t instanceof aD&&(t.updateText(!0),!0)}function aN(e,t){if(t instanceof aR){let e=t.toFontString();return aA.measureFont(e),!0}return!1}function aU(e,t){if(e instanceof aD){t.includes(e.style)||t.push(e.style),t.includes(e)||t.push(e);let r=e._texture.baseTexture;return t.includes(r)||t.push(r),!0}return!1}function aG(e,t){return e instanceof aR&&(t.includes(e)||t.push(e),!0)}const aj=class e{constructor(t){this.limiter=new ak(e.uploadsPerFrame),this.renderer=t,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{this.queue&&this.prepareItems()},this.registerFindHook(aU),this.registerFindHook(aG),this.registerFindHook(aO),this.registerFindHook(aB),this.registerFindHook(aL),this.registerUploadHook(aF),this.registerUploadHook(aN)}upload(e){return new Promise(t=>{e&&this.add(e),this.queue.length?(this.completes.push(t),this.ticking||(this.ticking=!0,s6.system.addOnce(this.tick,this,s3.UTILITY))):t()})}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){let e=this.queue[0],t=!1;if(e&&!e._destroyed){for(let r=0,i=this.uploadHooks.length;r<i;r++)if(this.uploadHooks[r](this.uploadHookHelper,e)){this.queue.shift(),t=!0;break}}t||this.queue.shift()}if(this.queue.length)s6.system.addOnce(this.tick,this,s3.UTILITY);else{this.ticking=!1;let e=this.completes.slice(0);this.completes.length=0;for(let t=0,r=e.length;t<r;t++)e[t]()}}registerFindHook(e){return e&&this.addHooks.push(e),this}registerUploadHook(e){return e&&this.uploadHooks.push(e),this}add(e){for(let t=0,r=this.addHooks.length;t<r&&!this.addHooks[t](e,this.queue);t++);if(e instanceof ng)for(let t=e.children.length-1;t>=0;t--)this.add(e.children[t]);return this}destroy(){this.ticking&&s6.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}};aj.uploadsPerFrame=4;let aH=aj;function az(e,t){return t instanceof r4&&(t._glTextures[e.CONTEXT_UID]||e.texture.bind(t),!0)}function aV(e,t){if(!(t instanceof ap))return!1;let{geometry:r}=t;t.finishPoly(),r.updateBatches();let{batches:i}=r;for(let t=0;t<i.length;t++){let{texture:r}=i[t].style;r&&az(e,r.baseTexture)}return r.batchable||e.geometry.bind(r,t._resolveDirectShader(e)),!0}function aX(e,t){return e instanceof ap&&(t.push(e),!0)}Object.defineProperties(eJ,{UPLOADS_PER_FRAME:{get:()=>aH.uploadsPerFrame,set(e){to.deprecation("7.1.0","settings.UPLOADS_PER_FRAME is deprecated, use prepare.BasePrepare.uploadsPerFrame"),aH.uploadsPerFrame=e}}});class aW extends aH{constructor(e){super(e),this.uploadHookHelper=this.renderer,this.registerFindHook(aX),this.registerUploadHook(az),this.registerUploadHook(aV)}}aW.extension={name:"prepare",type:rV.RendererSystem},r$.add(aW);class a$ extends nv{constructor(e,t=!0){super(e[0]instanceof sh?e[0]:e[0].texture),this._textures=null,this._durations=null,this._autoUpdate=t,this._isConnectedToTicker=!1,this.animationSpeed=1,this.loop=!0,this.updateAnchor=!1,this.onComplete=null,this.onFrameChange=null,this.onLoop=null,this._currentTime=0,this._playing=!1,this._previousFrame=null,this.textures=e}stop(){this._playing&&(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(s6.shared.remove(this.update,this),this._isConnectedToTicker=!1))}play(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(s6.shared.add(this.update,this,s3.HIGH),this._isConnectedToTicker=!0))}gotoAndStop(e){this.stop(),this.currentFrame=e}gotoAndPlay(e){this.currentFrame=e,this.play()}update(e){if(!this._playing)return;let t=this.animationSpeed*e,r=this.currentFrame;if(null!==this._durations){let r=this._currentTime%1*this._durations[this.currentFrame];for(r+=t/60*1e3;r<0;)this._currentTime--,r+=this._durations[this.currentFrame];let i=Math.sign(this.animationSpeed*e);for(this._currentTime=Math.floor(this._currentTime);r>=this._durations[this.currentFrame];)r-=this._durations[this.currentFrame]*i,this._currentTime+=i;this._currentTime+=r/this._durations[this.currentFrame]}else this._currentTime+=t;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):r!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<r||this.animationSpeed<0&&this.currentFrame>r)&&this.onLoop(),this.updateTexture())}updateTexture(){let e=this.currentFrame;this._previousFrame!==e&&(this._previousFrame=e,this._texture=this._textures[e],this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this.uvs=this._texture._uvs.uvsFloat32,this.updateAnchor&&this._anchor.copyFrom(this._texture.defaultAnchor),this.onFrameChange&&this.onFrameChange(this.currentFrame))}destroy(e){this.stop(),super.destroy(e),this.onComplete=null,this.onFrameChange=null,this.onLoop=null}static fromFrames(e){let t=[];for(let r=0;r<e.length;++r)t.push(sh.from(e[r]));return new a$(t)}static fromImages(e){let t=[];for(let r=0;r<e.length;++r)t.push(sh.from(e[r]));return new a$(t)}get totalFrames(){return this._textures.length}get textures(){return this._textures}set textures(e){if(e[0]instanceof sh)this._textures=e,this._durations=null;else{this._textures=[],this._durations=[];for(let t=0;t<e.length;t++)this._textures.push(e[t].texture),this._durations.push(e[t].time)}this._previousFrame=null,this.gotoAndStop(0),this.updateTexture()}get currentFrame(){let e=Math.floor(this._currentTime)%this._textures.length;return e<0&&(e+=this._textures.length),e}set currentFrame(e){if(e<0||e>this.totalFrames-1)throw Error(`[AnimatedSprite]: Invalid frame index value ${e}, expected to be between 0 and totalFrames ${this.totalFrames}.`);let t=this.currentFrame;this._currentTime=e,t!==this.currentFrame&&this.updateTexture()}get playing(){return this._playing}get autoUpdate(){return this._autoUpdate}set autoUpdate(e){e!==this._autoUpdate&&(this._autoUpdate=e,!this._autoUpdate&&this._isConnectedToTicker?(s6.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(s6.shared.add(this.update,this),this._isConnectedToTicker=!0))}}const aY=new iu;class aq extends nv{constructor(e,t=100,r=100){super(e),this.tileTransform=new iR,this._width=t,this._height=r,this.uvMatrix=this.texture.uvMatrix||new sE(e),this.pluginName="tilingSprite",this.uvRespectAnchor=!1}get clampMargin(){return this.uvMatrix.clampMargin}set clampMargin(e){this.uvMatrix.clampMargin=e,this.uvMatrix.update(!0)}get tileScale(){return this.tileTransform.scale}set tileScale(e){this.tileTransform.scale.copyFrom(e)}get tilePosition(){return this.tileTransform.position}set tilePosition(e){this.tileTransform.position.copyFrom(e)}_onTextureUpdate(){this.uvMatrix&&(this.uvMatrix.texture=this._texture),this._cachedTint=16777215}_render(e){let t=this._texture;t&&t.valid&&(this.tileTransform.updateLocalTransform(),this.uvMatrix.update(),e.batch.setObjectRenderer(e.plugins[this.pluginName]),e.plugins[this.pluginName].render(this))}_calculateBounds(){let e=-(this._width*this._anchor._x),t=-(this._height*this._anchor._y),r=this._width*(1-this._anchor._x),i=this._height*(1-this._anchor._y);this._bounds.addFrame(this.transform,e,t,r,i)}getLocalBounds(e){return 0===this.children.length?(this._bounds.minX=-(this._width*this._anchor._x),this._bounds.minY=-(this._height*this._anchor._y),this._bounds.maxX=this._width*(1-this._anchor._x),this._bounds.maxY=this._height*(1-this._anchor._y),e||(this._localBoundsRect||(this._localBoundsRect=new id),e=this._localBoundsRect),this._bounds.getRectangle(e)):super.getLocalBounds.call(this,e)}containsPoint(e){this.worldTransform.applyInverse(e,aY);let t=this._width,r=this._height,i=-t*this.anchor._x;if(aY.x>=i&&aY.x<i+t){let e=-r*this.anchor._y;if(aY.y>=e&&aY.y<e+r)return!0}return!1}destroy(e){super.destroy(e),this.tileTransform=null,this.uvMatrix=null}static from(e,t){return new aq(e instanceof sh?e:sh.from(e,t),t.width,t.height)}get width(){return this._width}set width(e){this._width=e}get height(){return this._height}set height(e){this._height=e}}var aK=`#version 300 es
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

in vec2 vTextureCoord;

out vec4 fragmentColor;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0

    fragmentColor = texSample * uColor;
}
`,aJ=`#version 300 es
#define SHADER_NAME Tiling-Sprite-300

precision lowp float;

in vec2 aVertexPosition;
in vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

out vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,aZ=`#version 100
#ifdef GL_EXT_shader_texture_lod
    #extension GL_EXT_shader_texture_lod : enable
#endif
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    #ifdef GL_EXT_shader_texture_lod
        vec4 texSample = unclamped == coord
            ? texture2D(uSampler, coord) 
            : texture2DLodEXT(uSampler, coord, 0);
    #else
        vec4 texSample = texture2D(uSampler, coord);
    #endif

    gl_FragColor = texSample * uColor;
}
`,aQ=`#version 100
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,a0=`#version 100
#define SHADER_NAME Tiling-Sprite-Simple-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;

void main(void)
{
    vec4 texSample = texture2D(uSampler, vTextureCoord);
    gl_FragColor = texSample * uColor;
}
`;const a1=new i_;class a2 extends iQ{constructor(e){super(e),e.runners.contextChange.add(this),this.quad=new sd,this.state=rK.for2d()}contextChange(){let e=this.renderer,t={globals:e.globalUniforms};this.simpleShader=iK.from(aQ,a0,t),this.shader=e.context.webGLVersion>1?iK.from(aJ,aK,t):iK.from(aQ,aZ,t)}render(e){let t=this.renderer,r=this.quad,i=r.vertices;i[0]=i[6]=-(e._width*e.anchor.x),i[1]=i[3]=-(e._height*e.anchor.y),i[2]=i[4]=e._width*(1-e.anchor.x),i[5]=i[7]=e._height*(1-e.anchor.y);let s=e.uvRespectAnchor?e.anchor.x:0,n=e.uvRespectAnchor?e.anchor.y:0;(i=r.uvs)[0]=i[6]=-s,i[1]=i[3]=-n,i[2]=i[4]=1-s,i[5]=i[7]=1-n,r.invalidate();let o=e._texture,a=o.baseTexture,h=a.alphaMode>0,l=e.tileTransform.localTransform,u=e.uvMatrix,c=a.isPowerOfTwo&&o.frame.width===a.width&&o.frame.height===a.height;c&&(a._glTextures[t.CONTEXT_UID]?c=a.wrapMode!==ej.CLAMP:a.wrapMode===ej.CLAMP&&(a.wrapMode=ej.REPEAT));let d=c?this.simpleShader:this.shader,p=o.width,f=o.height,m=e._width,g=e._height;a1.set(l.a*p/m,l.b*p/g,l.c*f/m,l.d*f/g,l.tx/m,l.ty/g),a1.invert(),c?a1.prepend(u.mapCoord):(d.uniforms.uMapCoord=u.mapCoord.toArray(!0),d.uniforms.uClampFrame=u.uClampFrame,d.uniforms.uClampOffset=u.uClampOffset),d.uniforms.uTransform=a1.toArray(!0),d.uniforms.uColor=ra.shared.setValue(e.tint).premultiply(e.worldAlpha,h).toArray(d.uniforms.uColor),d.uniforms.translationMatrix=e.transform.worldTransform.toArray(!0),d.uniforms.uSampler=o,t.shader.bind(d),t.geometry.bind(r),this.state.blendMode=to.correctBlendMode(e.blendMode,h),t.state.set(this.state),t.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}}a2.extension={name:"tilingSprite",type:rV.RendererPlugin},r$.add(a2);const a3=class e{constructor(e,t,r){this.linkedSheets=[],(e instanceof r4||e instanceof sh)&&(e={texture:e,data:t,resolutionFilename:r});let{texture:i,data:s,resolutionFilename:n=null,cachePrefix:o=""}=e;this.cachePrefix=o,this._texture=i instanceof sh?i:null,this.baseTexture=i instanceof r4?i:this._texture.baseTexture,this.textures={},this.animations={},this.data=s;let a=this.baseTexture.resource;this.resolution=this._updateResolution(n||(a?a.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(e=null){let{scale:t}=this.data.meta,r=to.getResolutionOfUrl(e,null);return null===r&&(r="number"==typeof t?t:parseFloat(t??"1")),1!==r&&this.baseTexture.setResolution(r),r}parse(){return new Promise(t=>{this._callback=t,this._batchIndex=0,this._frameKeys.length<=e.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(t){let r=t,i=e.BATCH_SIZE;for(;r-t<i&&r<this._frameKeys.length;){let e=this._frameKeys[r],t=this._frames[e],i=t.frame;if(i){let r=null,s=null,n=!1!==t.trimmed&&t.sourceSize?t.sourceSize:t.frame,o=new id(0,0,Math.floor(n.w)/this.resolution,Math.floor(n.h)/this.resolution);r=t.rotated?new id(Math.floor(i.x)/this.resolution,Math.floor(i.y)/this.resolution,Math.floor(i.h)/this.resolution,Math.floor(i.w)/this.resolution):new id(Math.floor(i.x)/this.resolution,Math.floor(i.y)/this.resolution,Math.floor(i.w)/this.resolution,Math.floor(i.h)/this.resolution),!1!==t.trimmed&&t.spriteSourceSize&&(s=new id(Math.floor(t.spriteSourceSize.x)/this.resolution,Math.floor(t.spriteSourceSize.y)/this.resolution,Math.floor(i.w)/this.resolution,Math.floor(i.h)/this.resolution)),this.textures[e]=new sh(this.baseTexture,r,o,s,t.rotated?2:0,t.anchor,t.borders),sh.addToCache(this.textures[e],this.cachePrefix+e.toString())}r++}}_processAnimations(){let e=this.data.animations||{};for(let t in e){this.animations[t]=[];for(let r=0;r<e[t].length;r++){let i=e[t][r];this.animations[t].push(this.textures[i])}}}_parseComplete(){let e=this._callback;this._callback=null,this._batchIndex=0,e.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*e.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*e.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(e=!1){for(let e in this.textures)this.textures[e].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,e&&(this._texture?.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}};a3.BATCH_SIZE=1e3;const a4=["jpg","png","jpeg","avif","webp"],a6={extension:rV.Asset,cache:{test:e=>e instanceof a3,getCacheableAssets:(e,t)=>(function e(t,r,i){let s={};if(t.forEach(e=>{s[e]=r}),Object.keys(r.textures).forEach(e=>{s[`${r.cachePrefix}${e}`]=r.textures[e]}),!i){let i=to.path.dirname(t[0]);r.linkedSheets.forEach((t,n)=>{Object.assign(s,e([`${i}/${r.data.meta.related_multi_packs[n]}`],t,!0))})}return s})(e,t,!1)},resolver:{test:e=>{let t=e.split("?")[0].split("."),r=t.pop(),i=t.pop();return"json"===r&&a4.includes(i)},parse:e=>{let t=e.split(".");return{resolution:parseFloat(eJ.RETINA_PREFIX.exec(e)?.[1]??"1"),format:t[t.length-2],src:e}}},loader:{name:"spritesheetLoader",extension:{type:rV.LoadParser,priority:n4.Normal},testParse:async(e,t)=>".json"===to.path.extname(t.src).toLowerCase()&&!!e.frames,async parse(e,t,r){let i;let{texture:s,imageFilename:n,cachePrefix:o}=t?.data??{},a=to.path.dirname(t.src);if(a&&a.lastIndexOf("/")!==a.length-1&&(a+="/"),s&&s.baseTexture)i=s;else{let s=n0(a+(n??e.meta.image),t.src);i=(await r.load([s]))[s]}let h=new a3({texture:i.baseTexture,data:e,resolutionFilename:t.src,cachePrefix:o});await h.parse();let l=e?.meta?.related_multi_packs;if(Array.isArray(l)){let e=[];for(let i of l){if("string"!=typeof i)continue;let s=a+i;t.data?.ignoreMultiPack||(s=n0(s,t.src),e.push(r.load({src:s,data:{ignoreMultiPack:!0}})))}let i=await Promise.all(e);h.linkedSheets=i,i.forEach(e=>{e.linkedSheets=[h].concat(h.linkedSheets.filter(t=>t!==e))})}return h},unload(e){e.destroy(!0)}}};r$.add(a6);class a5{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}}class a8{static test(e){return"string"==typeof e&&e.startsWith("info face=")}static parse(e){let t=e.match(/^[a-z]+\s+.+$/gm),r={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(let e in t){let i=t[e].match(/^[a-z]+/gm)[0],s=t[e].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),n={};for(let e in s){let t=s[e].split("="),r=t[0],i=t[1].replace(/"/gm,""),o=parseFloat(i),a=isNaN(o)?i:o;n[r]=a}r[i].push(n)}let i=new a5;return r.info.forEach(e=>i.info.push({face:e.face,size:parseInt(e.size,10)})),r.common.forEach(e=>i.common.push({lineHeight:parseInt(e.lineHeight,10)})),r.page.forEach(e=>i.page.push({id:parseInt(e.id,10),file:e.file})),r.char.forEach(e=>i.char.push({id:parseInt(e.id,10),page:parseInt(e.page,10),x:parseInt(e.x,10),y:parseInt(e.y,10),width:parseInt(e.width,10),height:parseInt(e.height,10),xoffset:parseInt(e.xoffset,10),yoffset:parseInt(e.yoffset,10),xadvance:parseInt(e.xadvance,10)})),r.kerning.forEach(e=>i.kerning.push({first:parseInt(e.first,10),second:parseInt(e.second,10),amount:parseInt(e.amount,10)})),r.distanceField.forEach(e=>i.distanceField.push({distanceRange:parseInt(e.distanceRange,10),fieldType:e.fieldType})),i}}class a9{static test(e){return"string"!=typeof e&&"getElementsByTagName"in e&&e.getElementsByTagName("page").length&&null!==e.getElementsByTagName("info")[0].getAttribute("face")}static parse(e){let t=new a5,r=e.getElementsByTagName("info"),i=e.getElementsByTagName("common"),s=e.getElementsByTagName("page"),n=e.getElementsByTagName("char"),o=e.getElementsByTagName("kerning"),a=e.getElementsByTagName("distanceField");for(let e=0;e<r.length;e++)t.info.push({face:r[e].getAttribute("face"),size:parseInt(r[e].getAttribute("size"),10)});for(let e=0;e<i.length;e++)t.common.push({lineHeight:parseInt(i[e].getAttribute("lineHeight"),10)});for(let e=0;e<s.length;e++)t.page.push({id:parseInt(s[e].getAttribute("id"),10)||0,file:s[e].getAttribute("file")});for(let e=0;e<n.length;e++){let r=n[e];t.char.push({id:parseInt(r.getAttribute("id"),10),page:parseInt(r.getAttribute("page"),10)||0,x:parseInt(r.getAttribute("x"),10),y:parseInt(r.getAttribute("y"),10),width:parseInt(r.getAttribute("width"),10),height:parseInt(r.getAttribute("height"),10),xoffset:parseInt(r.getAttribute("xoffset"),10),yoffset:parseInt(r.getAttribute("yoffset"),10),xadvance:parseInt(r.getAttribute("xadvance"),10)})}for(let e=0;e<o.length;e++)t.kerning.push({first:parseInt(o[e].getAttribute("first"),10),second:parseInt(o[e].getAttribute("second"),10),amount:parseInt(o[e].getAttribute("amount"),10)});for(let e=0;e<a.length;e++)t.distanceField.push({fieldType:a[e].getAttribute("fieldType"),distanceRange:parseInt(a[e].getAttribute("distanceRange"),10)});return t}}class a7{static test(e){return!!("string"==typeof e&&e.includes("<font>"))&&a9.test(eJ.ADAPTER.parseXML(e))}static parse(e){return a9.parse(eJ.ADAPTER.parseXML(e))}}const he=[a8,a9,a7];function ht(e){return e.codePointAt?e.codePointAt(0):e.charCodeAt(0)}const hr=class e{constructor(e,t,r){let[i]=e.info,[s]=e.common,[n]=e.page,[o]=e.distanceField,a=to.getResolutionOfUrl(n.file),h={};this._ownsTextures=r,this.font=i.face,this.size=i.size,this.lineHeight=s.lineHeight/a,this.chars={},this.pageTextures=h;for(let r=0;r<e.page.length;r++){let{id:i,file:s}=e.page[r];h[i]=t instanceof Array?t[r]:t[s],o?.fieldType&&"none"!==o.fieldType&&(h[i].baseTexture.alphaMode=ez.NO_PREMULTIPLIED_ALPHA,h[i].baseTexture.mipmap=eH.OFF)}for(let t=0;t<e.char.length;t++){let{id:r,page:i}=e.char[t],{x:s,y:n,width:o,height:l,xoffset:u,yoffset:c,xadvance:d}=e.char[t];s/=a,n/=a,o/=a,l/=a,u/=a,c/=a,d/=a;let p=new id(s+h[i].frame.x/a,n+h[i].frame.y/a,o,l);this.chars[r]={xOffset:u,yOffset:c,xAdvance:d,kerning:{},texture:new sh(h[i].baseTexture,p),page:i}}for(let t=0;t<e.kerning.length;t++){let{first:r,second:i,amount:s}=e.kerning[t];r/=a,i/=a,s/=a,this.chars[i]&&(this.chars[i].kerning[r]=s)}this.distanceFieldRange=o?.distanceRange,this.distanceFieldType=o?.fieldType?.toLowerCase()??"none"}destroy(){for(let e in this.chars)this.chars[e].texture.destroy(),this.chars[e].texture=null;for(let e in this.pageTextures)this._ownsTextures&&this.pageTextures[e].destroy(!0),this.pageTextures[e]=null;this.chars=null,this.pageTextures=null}static install(t,r,i){let s;if(t instanceof a5)s=t;else{let e=function(e){for(let t=0;t<he.length;t++)if(he[t].test(e))return he[t];return null}(t);if(!e)throw Error("Unrecognized data format for font.");s=e.parse(t)}r instanceof sh&&(r=[r]);let n=new e(s,r,i);return e.available[n.font]=n,n}static uninstall(t){let r=e.available[t];if(!r)throw Error(`No font found named '${t}'`);r.destroy(),delete e.available[t]}static from(t,r,i){if(!t)throw Error("[BitmapFont] Property `name` is required.");let{chars:s,padding:n,resolution:o,textureWidth:a,textureHeight:h,...l}=Object.assign({},e.defaultOptions,i),u=function(e){"string"==typeof e&&(e=[e]);let t=[];for(let i=0,s=e.length;i<s;i++){let s=e[i];if(Array.isArray(s)){if(2!==s.length)throw Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${s.length}.`);let e=s[0].charCodeAt(0),r=s[1].charCodeAt(0);if(r<e)throw Error("[BitmapFont]: Invalid character range.");for(let i=e;i<=r;i++)t.push(String.fromCharCode(i))}else{var r;t.push(...(r=s,Array.from?Array.from(r):r.split("")))}}if(0===t.length)throw Error("[BitmapFont]: Empty set when resolving characters.");return t}(s),c=r instanceof aR?r:new aR(r),d=new a5;d.info[0]={face:c.fontFamily,size:c.fontSize},d.common[0]={lineHeight:c.fontSize};let p=0,f=0,m,g,y,_=0,v=[],b=[];for(let e=0;e<u.length;e++){m||((m=eJ.ADAPTER.createCanvas()).width=a,m.height=h,g=m.getContext("2d"),y=new r4(m,{resolution:o,...l}),v.push(y),b.push(new sh(y)),d.page.push({id:b.length-1,file:""}));let t=u[e],r=aA.measureText(t,c,!1,m),i=r.width,s=Math.ceil(r.height),x=Math.ceil(("italic"===c.fontStyle?2:1)*i);if(f>=h-s*o){if(0===f)throw Error(`[BitmapFont] textureHeight ${h}px is too small (fontFamily: '${c.fontFamily}', fontSize: ${c.fontSize}px, char: '${t}')`);--e,m=null,g=null,y=null,f=0,p=0,_=0;continue}if(_=Math.max(s+r.fontProperties.descent,_),x*o+p>=a){if(0===p)throw Error(`[BitmapFont] textureWidth ${a}px is too small (fontFamily: '${c.fontFamily}', fontSize: ${c.fontSize}px, char: '${t}')`);--e,f+=_*o,f=Math.ceil(f),p=0,_=0;continue}!function(e,t,r,i,s,n,o){let a=r.text,h=r.fontProperties;t.translate(i,s),t.scale(n,n);let l=o.strokeThickness/2,u=-(o.strokeThickness/2);if(t.font=o.toFontString(),t.lineWidth=o.strokeThickness,t.textBaseline=o.textBaseline,t.lineJoin=o.lineJoin,t.miterLimit=o.miterLimit,t.fillStyle=function(e,t,r,i,s,n){let o;let a=r.fill;if(!Array.isArray(a))return a;if(1===a.length)return a[0];let h=r.dropShadow?r.dropShadowDistance:0,l=r.padding||0,u=e.width/i-h-2*l,c=e.height/i-h-2*l,d=a.slice(),p=r.fillGradientStops.slice();if(!p.length){let e=d.length+1;for(let t=1;t<e;++t)p.push(t/e)}if(d.unshift(a[0]),p.unshift(0),d.push(a[a.length-1]),p.push(1),r.fillGradientType===aE.LINEAR_VERTICAL){o=t.createLinearGradient(u/2,l,u/2,c+l);let e=0,i=(n.fontProperties.fontSize+r.strokeThickness)/c;for(let t=0;t<s.length;t++){let r=n.lineHeight*t;for(let t=0;t<d.length;t++){let s=Math.max(e,r/c+("number"==typeof p[t]?p[t]:t/d.length)*i);s=Math.min(s,1),o.addColorStop(s,d[t]),e=s}}}else{o=t.createLinearGradient(l,c/2,u+l,c/2);let e=d.length+1,r=1;for(let t=0;t<d.length;t++){let i;i="number"==typeof p[t]?p[t]:r/e,o.addColorStop(i,d[t]),r++}}return o}(e,t,o,n,[a],r),t.strokeStyle=o.stroke,o.dropShadow){let e=o.dropShadowColor,r=o.dropShadowBlur*n,i=o.dropShadowDistance*n;t.shadowColor=ra.shared.setValue(e).setAlpha(o.dropShadowAlpha).toRgbaString(),t.shadowBlur=r,t.shadowOffsetX=Math.cos(o.dropShadowAngle)*i,t.shadowOffsetY=Math.sin(o.dropShadowAngle)*i}else t.shadowColor="black",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0;o.stroke&&o.strokeThickness&&t.strokeText(a,l,u+r.lineHeight-h.descent),o.fill&&t.fillText(a,l,u+r.lineHeight-h.descent),t.setTransform(1,0,0,1,0,0),t.fillStyle="rgba(0, 0, 0, 0)"}(m,g,r,p,f,o,c);let T=ht(r.text);d.char.push({id:T,page:b.length-1,x:p/o,y:f/o,width:x,height:s,xoffset:0,yoffset:0,xadvance:i-(c.dropShadow?c.dropShadowDistance:0)-(c.stroke?c.strokeThickness:0)}),p+=(x+2*n)*o,p=Math.ceil(p)}if(!i?.skipKerning)for(let e=0,t=u.length;e<t;e++){let r=u[e];for(let e=0;e<t;e++){let t=u[e],i=g.measureText(r).width,s=g.measureText(t).width,n=g.measureText(r+t).width-(i+s);n&&d.kerning.push({first:ht(r),second:ht(t),amount:n})}}let x=new e(d,b,!0);return void 0!==e.available[t]&&e.uninstall(t),e.available[t]=x,x}};hr.ALPHA=[["a","z"],["A","Z"]," "],hr.NUMERIC=[["0","9"]],hr.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],hr.ASCII=[[" ","~"]],hr.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:hr.ALPHANUMERIC},hr.available={};const hi=[".xml",".fnt"],hs={extension:{type:rV.LoadParser,priority:n4.Normal},name:"loadBitmapFont",test:e=>hi.includes(to.path.extname(e).toLowerCase()),testParse:async e=>a8.test(e)||a7.test(e),async parse(e,t,r){let i=a8.test(e)?a8.parse(e):a7.parse(e),{src:s}=t,{page:n}=i,o=[];for(let e=0;e<n.length;++e){let t=n[e].file,r=to.path.join(to.path.dirname(s),t);r=n0(r,s),o.push(r)}let a=await r.load(o),h=o.map(e=>a[e]);return hr.install(i,h,!0)},load:async(e,t)=>(await eJ.ADAPTER.fetch(e)).text(),unload(e){e.destroy()}};r$.add(hs);const hn=class e extends aR{constructor(){super(...arguments),this._fonts=[],this._overrides=[],this._stylesheet="",this.fontsDirty=!1}static from(t){return new e(Object.keys(e.defaultOptions).reduce((e,r)=>({...e,[r]:t[r]}),{}))}cleanFonts(){this._fonts.length>0&&(this._fonts.forEach(t=>{URL.revokeObjectURL(t.src),t.refs--,0===t.refs&&(t.fontFace&&document.fonts.delete(t.fontFace),delete e.availableFonts[t.originalUrl])}),this.fontFamily="Arial",this._fonts.length=0,this.styleID++,this.fontsDirty=!0)}loadFont(t,r={}){let{availableFonts:i}=e;if(i[t]){let e=i[t];return this._fonts.push(e),e.refs++,this.styleID++,this.fontsDirty=!0,Promise.resolve()}return eJ.ADAPTER.fetch(t).then(e=>e.blob()).then(async e=>new Promise((t,r)=>{let i=URL.createObjectURL(e),s=new FileReader;s.onload=()=>t([i,s.result]),s.onerror=r,s.readAsDataURL(e)})).then(async([e,s])=>{let n=Object.assign({family:to.path.basename(t,to.path.extname(t)),weight:"normal",style:"normal",display:"auto",src:e,dataSrc:s,refs:1,originalUrl:t,fontFace:null},r);i[t]=n,this._fonts.push(n),this.styleID++;let o=new FontFace(n.family,`url(${n.src})`,{weight:n.weight,style:n.style,display:n.display});n.fontFace=o,await o.load(),document.fonts.add(o),await document.fonts.ready,this.styleID++,this.fontsDirty=!0})}addOverride(...e){let t=e.filter(e=>!this._overrides.includes(e));t.length>0&&(this._overrides.push(...t),this.styleID++)}removeOverride(...e){let t=e.filter(e=>this._overrides.includes(e));t.length>0&&(this._overrides=this._overrides.filter(e=>!t.includes(e)),this.styleID++)}toCSS(e){return[`transform: scale(${e})`,"transform-origin: top left","display: inline-block",`color: ${this.normalizeColor(this.fill)}`,`font-size: ${this.fontSize}px`,`font-family: ${this.fontFamily}`,`font-weight: ${this.fontWeight}`,`font-style: ${this.fontStyle}`,`font-variant: ${this.fontVariant}`,`letter-spacing: ${this.letterSpacing}px`,`text-align: ${this.align}`,`padding: ${this.padding}px`,`white-space: ${this.whiteSpace}`,...this.lineHeight?[`line-height: ${this.lineHeight}px`]:[],...this.wordWrap?[`word-wrap: ${this.breakWords?"break-all":"break-word"}`,`max-width: ${this.wordWrapWidth}px`]:[],...this.strokeThickness?[`-webkit-text-stroke-width: ${this.strokeThickness}px`,`-webkit-text-stroke-color: ${this.normalizeColor(this.stroke)}`,`text-stroke-width: ${this.strokeThickness}px`,`text-stroke-color: ${this.normalizeColor(this.stroke)}`,"paint-order: stroke"]:[],...this.dropShadow?[this.dropShadowToCSS()]:[],...this._overrides].join(";")}toGlobalCSS(){return this._fonts.reduce((e,t)=>`${e}
            @font-face {
                font-family: "${t.family}";
                src: url('${t.dataSrc}');
                font-weight: ${t.weight};
                font-style: ${t.style};
                font-display: ${t.display};
            }`,this._stylesheet)}get stylesheet(){return this._stylesheet}set stylesheet(e){this._stylesheet!==e&&(this._stylesheet=e,this.styleID++)}normalizeColor(e){return Array.isArray(e)&&(e=to.rgb2hex(e)),"number"==typeof e?to.hex2string(e):e}dropShadowToCSS(){let e=this.normalizeColor(this.dropShadowColor),t=this.dropShadowAlpha,r=Math.round(Math.cos(this.dropShadowAngle)*this.dropShadowDistance),i=Math.round(Math.sin(this.dropShadowAngle)*this.dropShadowDistance);e.startsWith("#")&&t<1&&(e+=(255*t|0).toString(16).padStart(2,"0"));let s=`${r}px ${i}px`;return this.dropShadowBlur>0?`text-shadow: ${s} ${this.dropShadowBlur}px ${e}`:`text-shadow: ${s} ${e}`}reset(){Object.assign(this,e.defaultOptions)}onBeforeDraw(){let{fontsDirty:e}=this;return this.fontsDirty=!1,this.isSafari&&this._fonts.length>0&&e?new Promise(e=>setTimeout(e,100)):Promise.resolve()}get isSafari(){let{userAgent:e}=eJ.ADAPTER.getNavigator();return/^((?!chrome|android).)*safari/i.test(e)}set fillGradientStops(e){console.warn("[HTMLTextStyle] fillGradientStops is not supported by HTMLText")}get fillGradientStops(){return super.fillGradientStops}set fillGradientType(e){console.warn("[HTMLTextStyle] fillGradientType is not supported by HTMLText")}get fillGradientType(){return super.fillGradientType}set miterLimit(e){console.warn("[HTMLTextStyle] miterLimit is not supported by HTMLText")}get miterLimit(){return super.miterLimit}set trim(e){console.warn("[HTMLTextStyle] trim is not supported by HTMLText")}get trim(){return super.trim}set textBaseline(e){console.warn("[HTMLTextStyle] textBaseline is not supported by HTMLText")}get textBaseline(){return super.textBaseline}set leading(e){console.warn("[HTMLTextStyle] leading is not supported by HTMLText")}get leading(){return super.leading}set lineJoin(e){console.warn("[HTMLTextStyle] lineJoin is not supported by HTMLText")}get lineJoin(){return super.lineJoin}};hn.availableFonts={},hn.defaultOptions={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,padding:0,stroke:"black",strokeThickness:0,whiteSpace:"normal",wordWrap:!1,wordWrapWidth:100};const ho=class e extends nv{constructor(t="",r={}){super(sh.EMPTY),this._text=null,this._style=null,this._autoResolution=!0,this.localStyleID=-1,this.dirty=!1,this._updateID=0,this.ownsStyle=!1;let i=new Image,s=sh.from(i,{scaleMode:eJ.SCALE_MODE,resourceOptions:{autoLoad:!1}});s.orig=new id,s.trim=new id,this.texture=s;let n="http://www.w3.org/2000/svg",o="http://www.w3.org/1999/xhtml",a=document.createElementNS(n,"svg"),h=document.createElementNS(n,"foreignObject"),l=document.createElementNS(o,"div"),u=document.createElementNS(o,"style");h.setAttribute("width","10000"),h.setAttribute("height","10000"),h.style.overflow="hidden",a.appendChild(h),this.maxWidth=e.defaultMaxWidth,this.maxHeight=e.defaultMaxHeight,this._domElement=l,this._styleElement=u,this._svgRoot=a,this._foreignObject=h,this._foreignObject.appendChild(u),this._foreignObject.appendChild(l),this._image=i,this._loadImage=new Image,this._autoResolution=e.defaultAutoResolution,this._resolution=e.defaultResolution??eJ.RESOLUTION,this.text=t,this.style=r}measureText(e){let{text:t,style:r,resolution:i}=Object.assign({text:this._text,style:this._style,resolution:this._resolution},e);Object.assign(this._domElement,{innerHTML:t,style:r.toCSS(i)}),this._styleElement.textContent=r.toGlobalCSS(),document.body.appendChild(this._svgRoot);let s=this._domElement.getBoundingClientRect();this._svgRoot.remove();let{width:n,height:o}=s;(n>this.maxWidth||o>this.maxHeight)&&console.warn("[HTMLText] Large expanse of text, increase HTMLText.maxWidth or HTMLText.maxHeight property.");let a=Math.min(this.maxWidth,Math.ceil(n)),h=Math.min(this.maxHeight,Math.ceil(o));return this._svgRoot.setAttribute("width",a.toString()),this._svgRoot.setAttribute("height",h.toString()),t!==this._text&&(this._domElement.innerHTML=this._text),r!==this._style&&(Object.assign(this._domElement,{style:this._style?.toCSS(i)}),this._styleElement.textContent=this._style?.toGlobalCSS()),{width:a+2*r.padding,height:h+2*r.padding}}async updateText(e=!0){let{style:t,_image:r,_loadImage:i}=this;if(this.localStyleID!==t.styleID&&(this.dirty=!0,this.localStyleID=t.styleID),!this.dirty&&e)return;let{width:s,height:n}=this.measureText();r.width=i.width=Math.ceil(Math.max(1,s)),r.height=i.height=Math.ceil(Math.max(1,n)),this._updateID++;let o=this._updateID;await new Promise(e=>{i.onload=async()=>{if(o<this._updateID){e();return}await t.onBeforeDraw(),r.src=i.src,i.onload=null,i.src="",this.updateTexture(),e()};let s=new XMLSerializer().serializeToString(this._svgRoot);i.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(s)}`})}get source(){return this._image}updateTexture(){let{style:e,texture:t,_image:r,resolution:i}=this,{padding:s}=e,{baseTexture:n}=t;t.trim.width=t._frame.width=r.width/i,t.trim.height=t._frame.height=r.height/i,t.trim.x=-s,t.trim.y=-s,t.orig.width=t._frame.width-2*s,t.orig.height=t._frame.height-2*s,this._onTextureUpdate(),n.setRealSize(r.width,r.height,i),this.dirty=!1}_render(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),super._render(e)}_renderCanvas(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),super._renderCanvas(e)}getLocalBounds(e){return this.updateText(!0),super.getLocalBounds(e)}_calculateBounds(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_onStyleChange(){this.dirty=!0}destroy(t){"boolean"==typeof t&&(t={children:t}),t=Object.assign({},e.defaultDestroyOptions,t),super.destroy(t),this.ownsStyle&&this._style?.cleanFonts(),this._style=null,this._svgRoot?.remove(),this._svgRoot=null,this._domElement?.remove(),this._domElement=null,this._foreignObject?.remove(),this._foreignObject=null,this._styleElement?.remove(),this._styleElement=null,this._loadImage.src="",this._loadImage.onload=null,this._loadImage=null,this._image.src="",this._image=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._image.width/this.resolution}set width(e){this.updateText(!0);let t=to.sign(this.scale.x)||1;this.scale.x=t*e/this._image.width/this.resolution,this._width=e}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._image.height/this.resolution}set height(e){this.updateText(!0);let t=to.sign(this.scale.y)||1;this.scale.y=t*e/this._image.height/this.resolution,this._height=e}get style(){return this._style}set style(e){this._style!==e&&((e=e||{})instanceof hn?(this.ownsStyle=!1,this._style=e):e instanceof aR?(console.warn("[HTMLText] Cloning TextStyle, if this is not what you want, use HTMLTextStyle"),this.ownsStyle=!0,this._style=hn.from(e)):(this.ownsStyle=!0,this._style=new hn(e)),this.localStyleID=-1,this.dirty=!0)}get text(){return this._text}set text(e){e=String(""===e||null==e?" ":e),e=this.sanitiseText(e),this._text!==e&&(this._text=e,this.dirty=!0)}get resolution(){return this._resolution}set resolution(e){this._autoResolution=!1,this._resolution!==e&&(this._resolution=e,this.dirty=!0)}sanitiseText(e){return e.replace(/<br>/gi,"<br/>").replace(/<hr>/gi,"<hr/>").replace(/&nbsp;/gi,"&#160;")}};ho.defaultDestroyOptions={texture:!0,children:!1,baseTexture:!0},ho.defaultMaxWidth=2024,ho.defaultMaxHeight=2024,ho.defaultAutoResolution=!0;class ha{constructor(){this.encoder=new TextEncoder,this._pieces=[],this._parts=[]}append_buffer(e){this.flush(),this._parts.push(e)}append(e){this._pieces.push(e)}flush(){if(this._pieces.length>0){let e=new Uint8Array(this._pieces);this._parts.push(e),this._pieces=[]}}toArrayBuffer(){let e=[];for(let t of this._parts)e.push(t);return function(e){let t=0;for(let r of e)t+=r.byteLength;let r=new Uint8Array(t),i=0;for(let t of e){let e=new Uint8Array(t.buffer,t.byteOffset,t.byteLength);r.set(e,i),i+=t.byteLength}return r}(e).buffer}}function hh(e){return new hu(e).unpack()}function hl(e){let t=new hc,r=t.pack(e);return r instanceof Promise?r.then(()=>t.getBuffer()):t.getBuffer()}class hu{constructor(e){this.index=0,this.dataBuffer=e,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}unpack(){let e;let t=this.unpack_uint8();if(t<128)return t;if((224^t)<32)return(224^t)-32;if((e=160^t)<=15)return this.unpack_raw(e);if((e=176^t)<=15)return this.unpack_string(e);if((e=144^t)<=15)return this.unpack_array(e);if((e=128^t)<=15)return this.unpack_map(e);switch(t){case 192:return null;case 193:case 212:case 213:case 214:case 215:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 216:return e=this.unpack_uint16(),this.unpack_string(e);case 217:return e=this.unpack_uint32(),this.unpack_string(e);case 218:return e=this.unpack_uint16(),this.unpack_raw(e);case 219:return e=this.unpack_uint32(),this.unpack_raw(e);case 220:return e=this.unpack_uint16(),this.unpack_array(e);case 221:return e=this.unpack_uint32(),this.unpack_array(e);case 222:return e=this.unpack_uint16(),this.unpack_map(e);case 223:return e=this.unpack_uint32(),this.unpack_map(e)}}unpack_uint8(){let e=255&this.dataView[this.index];return this.index++,e}unpack_uint16(){let e=this.read(2),t=(255&e[0])*256+(255&e[1]);return this.index+=2,t}unpack_uint32(){let e=this.read(4),t=((256*e[0]+e[1])*256+e[2])*256+e[3];return this.index+=4,t}unpack_uint64(){let e=this.read(8),t=((((((256*e[0]+e[1])*256+e[2])*256+e[3])*256+e[4])*256+e[5])*256+e[6])*256+e[7];return this.index+=8,t}unpack_int8(){let e=this.unpack_uint8();return e<128?e:e-256}unpack_int16(){let e=this.unpack_uint16();return e<32768?e:e-65536}unpack_int32(){let e=this.unpack_uint32();return e<2147483648?e:e-4294967296}unpack_int64(){let e=this.unpack_uint64();return e<0x7fffffffffffffff?e:e-18446744073709552e3}unpack_raw(e){if(this.length<this.index+e)throw Error(`BinaryPackFailure: index is out of range ${this.index} ${e} ${this.length}`);let t=this.dataBuffer.slice(this.index,this.index+e);return this.index+=e,t}unpack_string(e){let t,r;let i=this.read(e),s=0,n="";for(;s<e;)(t=i[s])<160?(r=t,s++):(192^t)<32?(r=(31&t)<<6|63&i[s+1],s+=2):(224^t)<16?(r=(15&t)<<12|(63&i[s+1])<<6|63&i[s+2],s+=3):(r=(7&t)<<18|(63&i[s+1])<<12|(63&i[s+2])<<6|63&i[s+3],s+=4),n+=String.fromCodePoint(r);return this.index+=e,n}unpack_array(e){let t=Array(e);for(let r=0;r<e;r++)t[r]=this.unpack();return t}unpack_map(e){let t={};for(let r=0;r<e;r++)t[this.unpack()]=this.unpack();return t}unpack_float(){let e=this.unpack_uint32();return(0==e>>31?1:-1)*(8388607&e|8388608)*2**((e>>23&255)-127-23)}unpack_double(){let e=this.unpack_uint32(),t=this.unpack_uint32(),r=(e>>20&2047)-1023;return(0==e>>31?1:-1)*((1048575&e|1048576)*2**(r-20)+t*2**(r-52))}read(e){let t=this.index;if(t+e<=this.length)return this.dataView.subarray(t,t+e);throw Error("BinaryPackFailure: read index out of range")}}class hc{getBuffer(){return this._bufferBuilder.toArrayBuffer()}pack(e){if("string"==typeof e)this.pack_string(e);else if("number"==typeof e)Math.floor(e)===e?this.pack_integer(e):this.pack_double(e);else if("boolean"==typeof e)!0===e?this._bufferBuilder.append(195):!1===e&&this._bufferBuilder.append(194);else if(void 0===e)this._bufferBuilder.append(192);else if("object"==typeof e){if(null===e)this._bufferBuilder.append(192);else{let t=e.constructor;if(e instanceof Array){let t=this.pack_array(e);if(t instanceof Promise)return t.then(()=>this._bufferBuilder.flush())}else if(e instanceof ArrayBuffer)this.pack_bin(new Uint8Array(e));else if("BYTES_PER_ELEMENT"in e)this.pack_bin(new Uint8Array(e.buffer,e.byteOffset,e.byteLength));else if(e instanceof Date)this.pack_string(e.toString());else if(e instanceof Blob)return e.arrayBuffer().then(e=>{this.pack_bin(new Uint8Array(e)),this._bufferBuilder.flush()});else if(t==Object||t.toString().startsWith("class")){let t=this.pack_object(e);if(t instanceof Promise)return t.then(()=>this._bufferBuilder.flush())}else throw Error(`Type "${t.toString()}" not yet supported`)}}else throw Error(`Type "${typeof e}" not yet supported`);this._bufferBuilder.flush()}pack_bin(e){let t=e.length;if(t<=15)this.pack_uint8(160+t);else if(t<=65535)this._bufferBuilder.append(218),this.pack_uint16(t);else if(t<=4294967295)this._bufferBuilder.append(219),this.pack_uint32(t);else throw Error("Invalid length");this._bufferBuilder.append_buffer(e)}pack_string(e){let t=this._textEncoder.encode(e),r=t.length;if(r<=15)this.pack_uint8(176+r);else if(r<=65535)this._bufferBuilder.append(216),this.pack_uint16(r);else if(r<=4294967295)this._bufferBuilder.append(217),this.pack_uint32(r);else throw Error("Invalid length");this._bufferBuilder.append_buffer(t)}pack_array(e){let t=e.length;if(t<=15)this.pack_uint8(144+t);else if(t<=65535)this._bufferBuilder.append(220),this.pack_uint16(t);else if(t<=4294967295)this._bufferBuilder.append(221),this.pack_uint32(t);else throw Error("Invalid length");let r=i=>{if(i<t){let t=this.pack(e[i]);return t instanceof Promise?t.then(()=>r(i+1)):r(i+1)}};return r(0)}pack_integer(e){if(e>=-32&&e<=127)this._bufferBuilder.append(255&e);else if(e>=0&&e<=255)this._bufferBuilder.append(204),this.pack_uint8(e);else if(e>=-128&&e<=127)this._bufferBuilder.append(208),this.pack_int8(e);else if(e>=0&&e<=65535)this._bufferBuilder.append(205),this.pack_uint16(e);else if(e>=-32768&&e<=32767)this._bufferBuilder.append(209),this.pack_int16(e);else if(e>=0&&e<=4294967295)this._bufferBuilder.append(206),this.pack_uint32(e);else if(e>=-2147483648&&e<=2147483647)this._bufferBuilder.append(210),this.pack_int32(e);else if(e>=-0x8000000000000000&&e<=0x7fffffffffffffff)this._bufferBuilder.append(211),this.pack_int64(e);else if(e>=0&&e<=18446744073709552e3)this._bufferBuilder.append(207),this.pack_uint64(e);else throw Error("Invalid integer")}pack_double(e){let t=0;e<0&&(t=1,e=-e);let r=Math.floor(Math.log(e)/Math.LN2),i=Math.floor((e/2**r-1)*4503599627370496),s=t<<31|r+1023<<20|i/4294967296&1048575;this._bufferBuilder.append(203),this.pack_int32(s),this.pack_int32(i%4294967296)}pack_object(e){let t=Object.keys(e),r=t.length;if(r<=15)this.pack_uint8(128+r);else if(r<=65535)this._bufferBuilder.append(222),this.pack_uint16(r);else if(r<=4294967295)this._bufferBuilder.append(223),this.pack_uint32(r);else throw Error("Invalid length");let i=r=>{if(r<t.length){let s=t[r];if(e.hasOwnProperty(s)){this.pack(s);let t=this.pack(e[s]);if(t instanceof Promise)return t.then(()=>i(r+1))}return i(r+1)}};return i(0)}pack_uint8(e){this._bufferBuilder.append(e)}pack_uint16(e){this._bufferBuilder.append(e>>8),this._bufferBuilder.append(255&e)}pack_uint32(e){let t=4294967295&e;this._bufferBuilder.append((4278190080&t)>>>24),this._bufferBuilder.append((16711680&t)>>>16),this._bufferBuilder.append((65280&t)>>>8),this._bufferBuilder.append(255&t)}pack_uint64(e){let t=e/4294967296,r=e%4294967296;this._bufferBuilder.append((4278190080&t)>>>24),this._bufferBuilder.append((16711680&t)>>>16),this._bufferBuilder.append((65280&t)>>>8),this._bufferBuilder.append(255&t),this._bufferBuilder.append((4278190080&r)>>>24),this._bufferBuilder.append((16711680&r)>>>16),this._bufferBuilder.append((65280&r)>>>8),this._bufferBuilder.append(255&r)}pack_int8(e){this._bufferBuilder.append(255&e)}pack_int16(e){this._bufferBuilder.append((65280&e)>>8),this._bufferBuilder.append(255&e)}pack_int32(e){this._bufferBuilder.append(e>>>24&255),this._bufferBuilder.append((16711680&e)>>>16),this._bufferBuilder.append((65280&e)>>>8),this._bufferBuilder.append(255&e)}pack_int64(e){let t=Math.floor(e/4294967296),r=e%4294967296;this._bufferBuilder.append((4278190080&t)>>>24),this._bufferBuilder.append((16711680&t)>>>16),this._bufferBuilder.append((65280&t)>>>8),this._bufferBuilder.append(255&t),this._bufferBuilder.append((4278190080&r)>>>24),this._bufferBuilder.append((16711680&r)>>>16),this._bufferBuilder.append((65280&r)>>>8),this._bufferBuilder.append(255&r)}constructor(){this._bufferBuilder=new ha,this._textEncoder=new TextEncoder}}let hd=!0,hp=!0;function hf(e,t,r){let i=e.match(t);return i&&i.length>=r&&parseInt(i[r],10)}function hm(e,t,r){if(!e.RTCPeerConnection)return;let i=e.RTCPeerConnection.prototype,s=i.addEventListener;i.addEventListener=function(e,i){if(e!==t)return s.apply(this,arguments);let n=e=>{let t=r(e);t&&(i.handleEvent?i.handleEvent(t):i(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(i,n),s.apply(this,[e,n])};let n=i.removeEventListener;i.removeEventListener=function(e,r){if(e!==t||!this._eventMap||!this._eventMap[t]||!this._eventMap[t].has(r))return n.apply(this,arguments);let i=this._eventMap[t].get(r);return this._eventMap[t].delete(r),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,n.apply(this,[e,i])},Object.defineProperty(i,"on"+t,{get(){return this["_on"+t]},set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}function hg(e){return"boolean"!=typeof e?Error("Argument type: "+typeof e+". Please use a boolean."):(hd=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function hy(e){return"boolean"!=typeof e?Error("Argument type: "+typeof e+". Please use a boolean."):(hp=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function h_(){"object"!=typeof window||hd||"undefined"==typeof console||"function"!=typeof console.log||console.log.apply(console,arguments)}function hv(e,t){hp&&console.warn(e+" is deprecated, please use "+t+" instead.")}function hb(e){return"[object Object]"===Object.prototype.toString.call(e)}function hx(e,t,r){let i=r?"outbound-rtp":"inbound-rtp",s=new Map;if(null===t)return s;let n=[];return e.forEach(e=>{"track"===e.type&&e.trackIdentifier===t.id&&n.push(e)}),n.forEach(t=>{e.forEach(r=>{r.type===i&&r.trackId===t.id&&function e(t,r,i){!r||i.has(r.id)||(i.set(r.id,r),Object.keys(r).forEach(s=>{s.endsWith("Id")?e(t,t.get(r[s]),i):s.endsWith("Ids")&&r[s].forEach(r=>{e(t,t.get(r),i)})}))}(e,r,s)})}),s}var hT={};function hE(e,t){let r=e&&e.navigator;if(!r.mediaDevices)return;let i=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;let t={};return Object.keys(e).forEach(r=>{if("require"===r||"advanced"===r||"mediaSource"===r)return;let i="object"==typeof e[r]?e[r]:{ideal:e[r]};void 0!==i.exact&&"number"==typeof i.exact&&(i.min=i.max=i.exact);let s=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==i.ideal){t.optional=t.optional||[];let e={};"number"==typeof i.ideal?(e[s("min",r)]=i.ideal,t.optional.push(e),(e={})[s("max",r)]=i.ideal):e[s("",r)]=i.ideal,t.optional.push(e)}void 0!==i.exact&&"number"!=typeof i.exact?(t.mandatory=t.mandatory||{},t.mandatory[s("",r)]=i.exact):["min","max"].forEach(e=>{void 0!==i[e]&&(t.mandatory=t.mandatory||{},t.mandatory[s(e,r)]=i[e])})}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},s=function(e,s){if(t.version>=61)return s(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){let t=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])};t((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),t(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=i(e.audio)}if(e&&"object"==typeof e.video){let n=e.video.facingMode;n=n&&("object"==typeof n?n:{ideal:n});let o=t.version<66;if(n&&("user"===n.exact||"environment"===n.exact||"user"===n.ideal||"environment"===n.ideal)&&!(r.mediaDevices.getSupportedConstraints&&r.mediaDevices.getSupportedConstraints().facingMode&&!o)){let t;if(delete e.video.facingMode,"environment"===n.exact||"environment"===n.ideal?t=["back","rear"]:("user"===n.exact||"user"===n.ideal)&&(t=["front"]),t)return r.mediaDevices.enumerateDevices().then(r=>{let o=(r=r.filter(e=>"videoinput"===e.kind)).find(e=>t.some(t=>e.label.toLowerCase().includes(t)));return!o&&r.length&&t.includes("back")&&(o=r[r.length-1]),o&&(e.video.deviceId=n.exact?{exact:o.deviceId}:{ideal:o.deviceId}),e.video=i(e.video),h_("chrome: "+JSON.stringify(e)),s(e)})}e.video=i(e.video)}return h_("chrome: "+JSON.stringify(e)),s(e)},n=function(e){return t.version>=64?e:{name:({PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"})[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(r.getUserMedia=(function(e,t,i){s(e,e=>{r.webkitGetUserMedia(e,t,e=>{i&&i(n(e))})})}).bind(r),r.mediaDevices.getUserMedia){let e=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(t){return s(t,t=>e(t).then(e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach(e=>{e.stop()}),new DOMException("","NotFoundError");return e},e=>Promise.reject(n(e))))}}}function hw(e,t){if((!e.navigator.mediaDevices||!("getDisplayMedia"in e.navigator.mediaDevices))&&e.navigator.mediaDevices){if("function"!=typeof t){console.error("shimGetDisplayMedia: getSourceId argument is not a function");return}e.navigator.mediaDevices.getDisplayMedia=function(r){return t(r).then(t=>{let i=r.video&&r.video.width,s=r.video&&r.video.height,n=r.video&&r.video.frameRate;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:n||3}},i&&(r.video.mandatory.maxWidth=i),s&&(r.video.mandatory.maxHeight=s),e.navigator.mediaDevices.getUserMedia(r)})}}}function hA(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function hS(e){if("object"!=typeof e||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype)hm(e,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e));else{Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});let t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",r=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(e=>e.track&&e.track.id===r.track.id):{track:r.track};let s=new Event("track");s.track=r.track,s.receiver=i,s.transceiver={receiver:i},s.streams=[t.stream],this.dispatchEvent(s)}),t.stream.getTracks().forEach(r=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(e=>e.track&&e.track.id===r.id):{track:r};let s=new Event("track");s.track=r,s.receiver=i,s.transceiver={receiver:i},s.streams=[t.stream],this.dispatchEvent(s)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}}function hC(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){let t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};let r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,i){let s=r.apply(this,arguments);return s||(s=t(this,e),this._senders.push(s)),s};let i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){i.apply(this,arguments);let t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}let r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],r.apply(this,[e]),e.getTracks().forEach(e=>{this._senders.push(t(this,e))})};let i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],i.apply(this,[e]),e.getTracks().forEach(e=>{let t=this._senders.find(t=>t.track===e);t&&this._senders.splice(this._senders.indexOf(t),1)})}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){let t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){let e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function hR(e){if(!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){let[e,r,i]=arguments;if(arguments.length>0&&"function"==typeof e)return t.apply(this,arguments);if(0===t.length&&(0==arguments.length||"function"!=typeof e))return t.apply(this,[]);let s=function(e){let t={};return e.result().forEach(e=>{let r={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(t=>{r[t]=e.stat(t)}),t[r.id]=r}),t},n=function(e){return new Map(Object.keys(e).map(t=>[t,e[t]]))};return arguments.length>=2?t.apply(this,[function(e){r(n(s(e)))},e]):new Promise((e,r)=>{t.apply(this,[function(t){e(n(s(t)))},r])}).then(r,i)}}function hI(e){if(!("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){let t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){let e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e});let r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){let e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){let e=this;return this._pc.getStats().then(t=>hx(t,e.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){let t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){let e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e}),hm(e,"track",e=>(e.receiver._pc=e.srcElement,e)),e.RTCRtpReceiver.prototype.getStats=function(){let e=this;return this._pc.getStats().then(t=>hx(t,e.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype))return;let t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){let e,t,r;let i=arguments[0];return(this.getSenders().forEach(t=>{t.track===i&&(e?r=!0:e=t)}),this.getReceivers().forEach(e=>(e.track===i&&(t?r=!0:t=e),e.track===i)),r||e&&t)?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):e?e.getStats():t?t.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function hP(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(e=>this._shimmedLocalStreams[e][0])};let t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){if(!r)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};let i=t.apply(this,arguments);return this._shimmedLocalStreams[r.id]?-1===this._shimmedLocalStreams[r.id].indexOf(i)&&this._shimmedLocalStreams[r.id].push(i):this._shimmedLocalStreams[r.id]=[r,i],i};let r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(e=>{if(this.getSenders().find(t=>t.track===e))throw new DOMException("Track already exists.","InvalidAccessError")});let t=this.getSenders();r.apply(this,arguments);let i=this.getSenders().filter(e=>-1===t.indexOf(e));this._shimmedLocalStreams[e.id]=[e].concat(i)};let i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],i.apply(this,arguments)};let s=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach(t=>{let r=this._shimmedLocalStreams[t].indexOf(e);-1!==r&&this._shimmedLocalStreams[t].splice(r,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]}),s.apply(this,arguments)}}function hM(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return hP(e);let r=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){let e=r.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map(e=>this._reverseStreams[e.id])};let i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach(e=>{if(this.getSenders().find(t=>t.track===e))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[t.id]){let r=new e.MediaStream(t.getTracks());this._streams[t.id]=r,this._reverseStreams[r.id]=t,t=r}i.apply(this,[t])};let s=e.RTCPeerConnection.prototype.removeStream;function n(e,t){let r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(t=>{let i=e._reverseStreams[t],s=e._streams[i.id];r=r.replace(RegExp(s.id,"g"),i.id)}),new RTCSessionDescription({type:t.type,sdp:r})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},s.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,r){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");let i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find(e=>e===t))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(e=>e.track===t))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};let s=this._streams[r.id];if(s)s.addTrack(t),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{let i=new e.MediaStream([t]);this._streams[r.id]=i,this._reverseStreams[i.id]=r,this.addStream(i)}return this.getSenders().find(e=>e.track===t)},["createOffer","createAnswer"].forEach(function(t){let r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=({[t](){let e=arguments,t=arguments.length&&"function"==typeof arguments[0];return t?r.apply(this,[t=>{let r=n(this,t);e[0].apply(null,[r])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):r.apply(this,arguments).then(e=>n(this,e))}})[t]});let o=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){var e,t;let r;return arguments.length&&arguments[0].type&&(arguments[0]=(e=this,t=arguments[0],r=t.sdp,Object.keys(e._reverseStreams||[]).forEach(t=>{let i=e._reverseStreams[t],s=e._streams[i.id];r=r.replace(RegExp(i.id,"g"),s.id)}),new RTCSessionDescription({type:t.type,sdp:r}))),o.apply(this,arguments)};let a=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){let e=a.get.apply(this);return""===e.type?e:n(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){let t;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{},Object.keys(this._streams).forEach(r=>{this._streams[r].getTracks().find(t=>e.track===t)&&(t=this._streams[r])}),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function hD(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){let r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=({[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}})[t]})}function hk(e,t){hm(e,"negotiationneeded",e=>{let r=e.target;if(!(t.version<72)&&(!r.getConfiguration||"plan-b"!==r.getConfiguration().sdpSemantics)||"stable"===r.signalingState)return e})}eS(hT,"shimMediaStream",()=>hA),eS(hT,"shimOnTrack",()=>hS),eS(hT,"shimGetSendersWithDtmf",()=>hC),eS(hT,"shimGetStats",()=>hR),eS(hT,"shimSenderReceiverGetStats",()=>hI),eS(hT,"shimAddTrackRemoveTrackWithNative",()=>hP),eS(hT,"shimAddTrackRemoveTrack",()=>hM),eS(hT,"shimPeerConnection",()=>hD),eS(hT,"fixNegotiationNeeded",()=>hk),eS(hT,"shimGetUserMedia",()=>hE),eS(hT,"shimGetDisplayMedia",()=>hw);var hO={};function hB(e,t){let r=e&&e.navigator,i=e&&e.MediaStreamTrack;if(r.getUserMedia=function(e,t,i){hv("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(e).then(t,i)},!(t.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){let e=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])},t=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(r){return"object"==typeof r&&"object"==typeof r.audio&&(e((r=JSON.parse(JSON.stringify(r))).audio,"autoGainControl","mozAutoGainControl"),e(r.audio,"noiseSuppression","mozNoiseSuppression")),t(r)},i&&i.prototype.getSettings){let t=i.prototype.getSettings;i.prototype.getSettings=function(){let r=t.apply(this,arguments);return e(r,"mozAutoGainControl","autoGainControl"),e(r,"mozNoiseSuppression","noiseSuppression"),r}}if(i&&i.prototype.applyConstraints){let t=i.prototype.applyConstraints;i.prototype.applyConstraints=function(r){return"audio"===this.kind&&"object"==typeof r&&(e(r=JSON.parse(JSON.stringify(r)),"autoGainControl","mozAutoGainControl"),e(r,"noiseSuppression","mozNoiseSuppression")),t.apply(this,[r])}}}}function hL(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||!e.navigator.mediaDevices||(e.navigator.mediaDevices.getDisplayMedia=function(r){if(!(r&&r.video)){let e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,Promise.reject(e)}return!0===r.video?r.video={mediaSource:t}:r.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(r)})}function hF(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function hN(e,t){if("object"!=typeof e||!(e.RTCPeerConnection||e.mozRTCPeerConnection))return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){let r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=({[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}})[t]});let r={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){let[e,s,n]=arguments;return i.apply(this,[e||null]).then(e=>{if(t.version<53&&!s)try{e.forEach(e=>{e.type=r[e.type]||e.type})}catch(t){if("TypeError"!==t.name)throw t;e.forEach((t,i)=>{e.set(i,Object.assign({},t,{type:r[t.type]||t.type}))})}return e}).then(s,n)}}function hU(e){if(!("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender)||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;let t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){let e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e});let r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){let e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function hG(e){if(!("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender)||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;let t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){let e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e}),hm(e,"track",e=>(e.receiver._pc=e.srcElement,e)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function hj(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){hv("removeStream","removeTrack"),this.getSenders().forEach(t=>{t.track&&e.getTracks().includes(t.track)&&this.removeTrack(t)})})}function hH(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function hz(e){if(!("object"==typeof e&&e.RTCPeerConnection))return;let t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let e=arguments[1]&&arguments[1].sendEncodings;void 0===e&&(e=[]);let r=(e=[...e]).length>0;r&&e.forEach(e=>{if("rid"in e&&!/^[a-z0-9]{0,16}$/i.test(e.rid))throw TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw RangeError("max_framerate must be >= 0.0")});let i=t.apply(this,arguments);if(r){let{sender:t}=i,r=t.getParameters();"encodings"in r&&(1!==r.encodings.length||0!==Object.keys(r.encodings[0]).length)||(r.encodings=e,t.sendEncodings=e,this.setParametersPromises.push(t.setParameters(r).then(()=>{delete t.sendEncodings}).catch(()=>{delete t.sendEncodings})))}return i})}function hV(e){if(!("object"==typeof e&&e.RTCRtpSender))return;let t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){let e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function hX(e){if(!("object"==typeof e&&e.RTCPeerConnection))return;let t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function hW(e){if(!("object"==typeof e&&e.RTCPeerConnection))return;let t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}eS(hO,"shimOnTrack",()=>hF),eS(hO,"shimPeerConnection",()=>hN),eS(hO,"shimSenderGetStats",()=>hU),eS(hO,"shimReceiverGetStats",()=>hG),eS(hO,"shimRemoveStream",()=>hj),eS(hO,"shimRTCDataChannel",()=>hH),eS(hO,"shimAddTransceiver",()=>hz),eS(hO,"shimGetParameters",()=>hV),eS(hO,"shimCreateOffer",()=>hX),eS(hO,"shimCreateAnswer",()=>hW),eS(hO,"shimGetUserMedia",()=>hB),eS(hO,"shimGetDisplayMedia",()=>hL);var h$={};function hY(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){let t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach(r=>t.call(this,r,e)),e.getVideoTracks().forEach(r=>t.call(this,r,e))},e.RTCPeerConnection.prototype.addTrack=function(e,...r){return r&&r.forEach(e=>{this._localStreams?this._localStreams.includes(e)||this._localStreams.push(e):this._localStreams=[e]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);let t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);let r=e.getTracks();this.getSenders().forEach(e=>{r.includes(e.track)&&this.removeTrack(e)})})}}function hq(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach(e=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(e))return;this._remoteStreams.push(e);let t=new Event("addstream");t.stream=e,this.dispatchEvent(t)})})}});let t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){let e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach(t=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);let r=new Event("addstream");r.stream=t,e.dispatchEvent(r)})}),t.apply(e,arguments)}}}function hK(e){if("object"!=typeof e||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype,r=t.createOffer,i=t.createAnswer,s=t.setLocalDescription,n=t.setRemoteDescription,o=t.addIceCandidate;t.createOffer=function(e,t){let i=arguments.length>=2?arguments[2]:arguments[0],s=r.apply(this,[i]);return t?(s.then(e,t),Promise.resolve()):s},t.createAnswer=function(e,t){let r=arguments.length>=2?arguments[2]:arguments[0],s=i.apply(this,[r]);return t?(s.then(e,t),Promise.resolve()):s};let a=function(e,t,r){let i=s.apply(this,[e]);return r?(i.then(t,r),Promise.resolve()):i};t.setLocalDescription=a,a=function(e,t,r){let i=n.apply(this,[e]);return r?(i.then(t,r),Promise.resolve()):i},t.setRemoteDescription=a,a=function(e,t,r){let i=o.apply(this,[e]);return r?(i.then(t,r),Promise.resolve()):i},t.addIceCandidate=a}function hJ(e){let t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){let e=t.mediaDevices,r=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=e=>r(hZ(e))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(e,r,i){t.mediaDevices.getUserMedia(e).then(r,i)}).bind(t))}function hZ(e){return e&&void 0!==e.video?Object.assign({},e,{video:function e(t){return hb(t)?Object.keys(t).reduce(function(r,i){let s=hb(t[i]),n=s?e(t[i]):t[i],o=s&&!Object.keys(n).length;return void 0===n||o?r:Object.assign(r,{[i]:n})},{}):t}(e.video)}):e}function hQ(e){if(!e.RTCPeerConnection)return;let t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,r){if(e&&e.iceServers){let t=[];for(let r=0;r<e.iceServers.length;r++){let i=e.iceServers[r];void 0===i.urls&&i.url?(hv("RTCIceServer.url","RTCIceServer.urls"),(i=JSON.parse(JSON.stringify(i))).urls=i.url,delete i.url,t.push(i)):t.push(e.iceServers[r])}e.iceServers=t}return new t(e,r)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function h0(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function h1(e){let t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);let t=this.getTransceivers().find(e=>"audio"===e.receiver.track.kind);!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);let r=this.getTransceivers().find(e=>"video"===e.receiver.track.kind);!1===e.offerToReceiveVideo&&r?"sendrecv"===r.direction?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":"recvonly"===r.direction&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):!0!==e.offerToReceiveVideo||r||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function h2(e){"object"!=typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}eS(h$,"shimLocalStreamsAPI",()=>hY),eS(h$,"shimRemoteStreamsAPI",()=>hq),eS(h$,"shimCallbacksAPI",()=>hK),eS(h$,"shimGetUserMedia",()=>hJ),eS(h$,"shimConstraints",()=>hZ),eS(h$,"shimRTCIceServerUrls",()=>hQ),eS(h$,"shimTrackEventTransceiver",()=>h0),eS(h$,"shimCreateOfferLegacy",()=>h1),eS(h$,"shimAudioContext",()=>h2);var h3={};eS(h3,"shimRTCIceCandidate",()=>h5),eS(h3,"shimRTCIceCandidateRelayProtocol",()=>h8),eS(h3,"shimMaxMessageSize",()=>h9),eS(h3,"shimSendThrowTypeError",()=>h7),eS(h3,"shimConnectionState",()=>le),eS(h3,"removeExtmapAllowMixed",()=>lt),eS(h3,"shimAddIceCandidateNullOrEmpty",()=>lr),eS(h3,"shimParameterlessSetLocalDescription",()=>li);var h4={};const h6={};function h5(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;let t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substring(2)),e.candidate&&e.candidate.length){let r=new t(e),i=eA(h4).parseCandidate(e.candidate);for(let e in i)e in r||Object.defineProperty(r,e,{value:i[e]});return r.toJSON=function(){return{candidate:r.candidate,sdpMid:r.sdpMid,sdpMLineIndex:r.sdpMLineIndex,usernameFragment:r.usernameFragment}},r}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,hm(e,"icecandidate",t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t))}function h8(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||hm(e,"icecandidate",e=>{if(e.candidate){let t=eA(h4).parseCandidate(e.candidate.candidate);"relay"===t.type&&(e.candidate.relayProtocol=({0:"tls",1:"tcp",2:"udp"})[t.priority>>24])}return e})}function h9(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});let r=function(e){if(!e||!e.sdp)return!1;let t=eA(h4).splitSections(e.sdp);return t.shift(),t.some(e=>{let t=eA(h4).parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")})},i=function(e){let t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return -1;let r=parseInt(t[1],10);return r!=r?-1:r},s=function(e){let r=65536;return"firefox"===t.browser&&(r=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),r},n=function(e,r){let i=65536;"firefox"===t.browser&&57===t.version&&(i=65535);let s=eA(h4).matchPrefix(e.sdp,"a=max-message-size:");return s.length>0?i=parseInt(s[0].substring(19),10):"firefox"===t.browser&&-1!==r&&(i=2147483637),i},o=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){let{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(r(arguments[0])){let e;let t=i(arguments[0]),r=s(t),o=n(arguments[0],t);e=0===r&&0===o?Number.POSITIVE_INFINITY:0===r||0===o?Math.max(r,o):Math.min(r,o);let a={};Object.defineProperty(a,"maxMessageSize",{get:()=>e}),this._sctp=a}return o.apply(this,arguments)}}function h7(e){if(!(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype))return;function t(e,t){let r=e.send;e.send=function(){let i=arguments[0],s=i.length||i.size||i.byteLength;if("open"===e.readyState&&t.sctp&&s>t.sctp.maxMessageSize)throw TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return r.apply(e,arguments)}}let r=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){let e=r.apply(this,arguments);return t(e,this),e},hm(e,"datachannel",e=>(t(e.channel,e.target),e))}function le(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;let t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return({completed:"connected",checking:"connecting"})[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(e=>{let r=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{let t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;let r=new Event("connectionstatechange",e);t.dispatchEvent(r)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function lt(e,t){if(!e.RTCPeerConnection||"chrome"===t.browser&&t.version>=71||"safari"===t.browser&&t.version>=605)return;let r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){let r=t.sdp.split("\n").filter(e=>"a=extmap-allow-mixed"!==e.trim()).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:r}):t.sdp=r}return r.apply(this,arguments)}}function lr(e,t){if(!(e.RTCPeerConnection&&e.RTCPeerConnection.prototype))return;let r=e.RTCPeerConnection.prototype.addIceCandidate;r&&0!==r.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function li(e,t){if(!(e.RTCPeerConnection&&e.RTCPeerConnection.prototype))return;let r=e.RTCPeerConnection.prototype.setLocalDescription;r&&0!==r.length&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let e=arguments[0]||{};if("object"!=typeof e||e.type&&e.sdp)return r.apply(this,arguments);if(!(e={type:e.type,sdp:e.sdp}).type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":e.type="offer";break;default:e.type="answer"}return e.sdp||"offer"!==e.type&&"answer"!==e.type?r.apply(this,[e]):("offer"===e.type?this.createOffer:this.createAnswer).apply(this).then(e=>r.apply(this,[e]))})}h6.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},h6.localCName=h6.generateIdentifier(),h6.splitLines=function(e){return e.trim().split("\n").map(e=>e.trim())},h6.splitSections=function(e){return e.split("\nm=").map((e,t)=>(t>0?"m="+e:e).trim()+"\r\n")},h6.getDescription=function(e){let t=h6.splitSections(e);return t&&t[0]},h6.getMediaSections=function(e){let t=h6.splitSections(e);return t.shift(),t},h6.matchPrefix=function(e,t){return h6.splitLines(e).filter(e=>0===e.indexOf(t))},h6.parseCandidate=function(e){let t;let r={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]};for(let e=8;e<t.length;e+=2)switch(t[e]){case"raddr":r.relatedAddress=t[e+1];break;case"rport":r.relatedPort=parseInt(t[e+1],10);break;case"tcptype":r.tcpType=t[e+1];break;case"ufrag":r.ufrag=t[e+1],r.usernameFragment=t[e+1];break;default:void 0===r[t[e]]&&(r[t[e]]=t[e+1])}return r},h6.writeCandidate=function(e){let t=[];t.push(e.foundation);let r=e.component;"rtp"===r?t.push(1):"rtcp"===r?t.push(2):t.push(r),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);let i=e.type;return t.push("typ"),t.push(i),"host"!==i&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},h6.parseIceOptions=function(e){return e.substring(14).split(" ")},h6.parseRtpMap=function(e){let t=e.substring(9).split(" "),r={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),r.name=t[0],r.clockRate=parseInt(t[1],10),r.channels=3===t.length?parseInt(t[2],10):1,r.numChannels=r.channels,r},h6.writeRtpMap=function(e){let t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);let r=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==r?"/"+r:"")+"\r\n"},h6.parseExtmap=function(e){let t=e.substring(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1],attributes:t.slice(2).join(" ")}},h6.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+(e.attributes?" "+e.attributes:"")+"\r\n"},h6.parseFmtp=function(e){let t;let r={},i=e.substring(e.indexOf(" ")+1).split(";");for(let e=0;e<i.length;e++)r[(t=i[e].trim().split("="))[0].trim()]=t[1];return r},h6.writeFmtp=function(e){let t="",r=e.payloadType;if(void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){let i=[];Object.keys(e.parameters).forEach(t=>{void 0!==e.parameters[t]?i.push(t+"="+e.parameters[t]):i.push(t)}),t+="a=fmtp:"+r+" "+i.join(";")+"\r\n"}return t},h6.parseRtcpFb=function(e){let t=e.substring(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},h6.writeRtcpFb=function(e){let t="",r=e.payloadType;return void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(e=>{t+="a=rtcp-fb:"+r+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},h6.parseSsrcMedia=function(e){let t=e.indexOf(" "),r={ssrc:parseInt(e.substring(7,t),10)},i=e.indexOf(":",t);return i>-1?(r.attribute=e.substring(t+1,i),r.value=e.substring(i+1)):r.attribute=e.substring(t+1),r},h6.parseSsrcGroup=function(e){let t=e.substring(13).split(" ");return{semantics:t.shift(),ssrcs:t.map(e=>parseInt(e,10))}},h6.getMid=function(e){let t=h6.matchPrefix(e,"a=mid:")[0];if(t)return t.substring(6)},h6.parseFingerprint=function(e){let t=e.substring(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},h6.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:h6.matchPrefix(e+t,"a=fingerprint:").map(h6.parseFingerprint)}},h6.writeDtlsParameters=function(e,t){let r="a=setup:"+t+"\r\n";return e.fingerprints.forEach(e=>{r+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),r},h6.parseCryptoLine=function(e){let t=e.substring(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},h6.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?h6.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},h6.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;let t=e.substring(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},h6.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},h6.getCryptoParameters=function(e,t){return h6.matchPrefix(e+t,"a=crypto:").map(h6.parseCryptoLine)},h6.getIceParameters=function(e,t){let r=h6.matchPrefix(e+t,"a=ice-ufrag:")[0],i=h6.matchPrefix(e+t,"a=ice-pwd:")[0];return r&&i?{usernameFragment:r.substring(12),password:i.substring(10)}:null},h6.writeIceParameters=function(e){let t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},h6.parseRtpParameters=function(e){let t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=h6.splitLines(e)[0].split(" ");t.profile=r[2];for(let i=3;i<r.length;i++){let s=r[i],n=h6.matchPrefix(e,"a=rtpmap:"+s+" ")[0];if(n){let r=h6.parseRtpMap(n),i=h6.matchPrefix(e,"a=fmtp:"+s+" ");switch(r.parameters=i.length?h6.parseFmtp(i[0]):{},r.rtcpFeedback=h6.matchPrefix(e,"a=rtcp-fb:"+s+" ").map(h6.parseRtcpFb),t.codecs.push(r),r.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(r.name.toUpperCase())}}}h6.matchPrefix(e,"a=extmap:").forEach(e=>{t.headerExtensions.push(h6.parseExtmap(e))});let i=h6.matchPrefix(e,"a=rtcp-fb:* ").map(h6.parseRtcpFb);return t.codecs.forEach(e=>{i.forEach(t=>{e.rtcpFeedback.find(e=>e.type===t.type&&e.parameter===t.parameter)||e.rtcpFeedback.push(t)})}),t},h6.writeRtpDescription=function(e,t){let r="";r+="m="+e+" "+(t.codecs.length>0?"9":"0")+" "+(t.profile||"UDP/TLS/RTP/SAVPF")+" "+t.codecs.map(e=>void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType).join(" ")+"\r\nc=IN IP4 0.0.0.0\r\na=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(e=>{r+=h6.writeRtpMap(e)+h6.writeFmtp(e)+h6.writeRtcpFb(e)});let i=0;return t.codecs.forEach(e=>{e.maxptime>i&&(i=e.maxptime)}),i>0&&(r+="a=maxptime:"+i+"\r\n"),t.headerExtensions&&t.headerExtensions.forEach(e=>{r+=h6.writeExtmap(e)}),r},h6.parseRtpEncodingParameters=function(e){let t;let r=[],i=h6.parseRtpParameters(e),s=-1!==i.fecMechanisms.indexOf("RED"),n=-1!==i.fecMechanisms.indexOf("ULPFEC"),o=h6.matchPrefix(e,"a=ssrc:").map(e=>h6.parseSsrcMedia(e)).filter(e=>"cname"===e.attribute),a=o.length>0&&o[0].ssrc,h=h6.matchPrefix(e,"a=ssrc-group:FID").map(e=>e.substring(17).split(" ").map(e=>parseInt(e,10)));h.length>0&&h[0].length>1&&h[0][0]===a&&(t=h[0][1]),i.codecs.forEach(e=>{if("RTX"===e.name.toUpperCase()&&e.parameters.apt){let i={ssrc:a,codecPayloadType:parseInt(e.parameters.apt,10)};a&&t&&(i.rtx={ssrc:t}),r.push(i),s&&((i=JSON.parse(JSON.stringify(i))).fec={ssrc:a,mechanism:n?"red+ulpfec":"red"},r.push(i))}}),0===r.length&&a&&r.push({ssrc:a});let l=h6.matchPrefix(e,"b=");return l.length&&(l=0===l[0].indexOf("b=TIAS:")?parseInt(l[0].substring(7),10):0===l[0].indexOf("b=AS:")?950*parseInt(l[0].substring(5),10)-16e3:void 0,r.forEach(e=>{e.maxBitrate=l})),r},h6.parseRtcpParameters=function(e){let t={},r=h6.matchPrefix(e,"a=ssrc:").map(e=>h6.parseSsrcMedia(e)).filter(e=>"cname"===e.attribute)[0];r&&(t.cname=r.value,t.ssrc=r.ssrc);let i=h6.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=i.length>0,t.compound=0===i.length;let s=h6.matchPrefix(e,"a=rtcp-mux");return t.mux=s.length>0,t},h6.writeRtcpParameters=function(e){let t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},h6.parseMsid=function(e){let t;let r=h6.matchPrefix(e,"a=msid:");if(1===r.length)return{stream:(t=r[0].substring(7).split(" "))[0],track:t[1]};let i=h6.matchPrefix(e,"a=ssrc:").map(e=>h6.parseSsrcMedia(e)).filter(e=>"msid"===e.attribute);if(i.length>0)return{stream:(t=i[0].value.split(" "))[0],track:t[1]}},h6.parseSctpDescription=function(e){let t;let r=h6.parseMLine(e),i=h6.matchPrefix(e,"a=max-message-size:");i.length>0&&(t=parseInt(i[0].substring(19),10)),isNaN(t)&&(t=65536);let s=h6.matchPrefix(e,"a=sctp-port:");if(s.length>0)return{port:parseInt(s[0].substring(12),10),protocol:r.fmt,maxMessageSize:t};let n=h6.matchPrefix(e,"a=sctpmap:");if(n.length>0){let e=n[0].substring(10).split(" ");return{port:parseInt(e[0],10),protocol:e[1],maxMessageSize:t}}},h6.writeSctpDescription=function(e,t){let r=[];return r="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&r.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),r.join("")},h6.generateSessionId=function(){return Math.random().toString().substr(2,22)},h6.writeSessionBoilerplate=function(e,t,r){return"v=0\r\no="+(r||"thisisadapterortc")+" "+(e||h6.generateSessionId())+" "+(void 0!==t?t:2)+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},h6.getDirection=function(e,t){let r=h6.splitLines(e);for(let e=0;e<r.length;e++)switch(r[e]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[e].substring(2)}return t?h6.getDirection(t):"sendrecv"},h6.getKind=function(e){return h6.splitLines(e)[0].split(" ")[0].substring(2)},h6.isRejected=function(e){return"0"===e.split(" ",2)[1]},h6.parseMLine=function(e){let t=h6.splitLines(e)[0].substring(2).split(" ");return{kind:t[0],port:parseInt(t[1],10),protocol:t[2],fmt:t.slice(3).join(" ")}},h6.parseOLine=function(e){let t=h6.matchPrefix(e,"o=")[0].substring(2).split(" ");return{username:t[0],sessionId:t[1],sessionVersion:parseInt(t[2],10),netType:t[3],addressType:t[4],address:t[5]}},h6.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;let t=h6.splitLines(e);for(let e=0;e<t.length;e++)if(t[e].length<2||"="!==t[e].charAt(1))return!1;return!0},h4=h6;const ls=function({window:e}={},t={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){let r=function(e){let t={browser:null,version:null};if(void 0===e||!e.navigator||!e.navigator.userAgent)return t.browser="Not a browser.",t;let{navigator:r}=e;return r.mozGetUserMedia?(t.browser="firefox",t.version=hf(r.userAgent,/Firefox\/(\d+)\./,1)):r.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection?(t.browser="chrome",t.version=hf(r.userAgent,/Chrom(e|ium)\/(\d+)\./,2)):e.RTCPeerConnection&&r.userAgent.match(/AppleWebKit\/(\d+)\./)?(t.browser="safari",t.version=hf(r.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype):t.browser="Not a supported browser.",t}(e),i={browserDetails:r,commonShim:h3,extractVersion:hf,disableLog:hg,disableWarnings:hy,sdp:h4};switch(r.browser){case"chrome":if(!hT||!hT.shimPeerConnection||!t.shimChrome){h_("Chrome shim is not included in this adapter release.");break}if(null===r.version){h_("Chrome shim can not determine version, not shimming.");break}h_("adapter.js shimming chrome."),i.browserShim=hT,lr(e,r),li(e,r),hT.shimGetUserMedia(e,r),hT.shimMediaStream(e,r),hT.shimPeerConnection(e,r),hT.shimOnTrack(e,r),hT.shimAddTrackRemoveTrack(e,r),hT.shimGetSendersWithDtmf(e,r),hT.shimGetStats(e,r),hT.shimSenderReceiverGetStats(e,r),hT.fixNegotiationNeeded(e,r),h5(e,r),h8(e,r),le(e,r),h9(e,r),h7(e,r),lt(e,r);break;case"firefox":if(!hO||!hO.shimPeerConnection||!t.shimFirefox){h_("Firefox shim is not included in this adapter release.");break}h_("adapter.js shimming firefox."),i.browserShim=hO,lr(e,r),li(e,r),hO.shimGetUserMedia(e,r),hO.shimPeerConnection(e,r),hO.shimOnTrack(e,r),hO.shimRemoveStream(e,r),hO.shimSenderGetStats(e,r),hO.shimReceiverGetStats(e,r),hO.shimRTCDataChannel(e,r),hO.shimAddTransceiver(e,r),hO.shimGetParameters(e,r),hO.shimCreateOffer(e,r),hO.shimCreateAnswer(e,r),h5(e,r),le(e,r),h9(e,r),h7(e,r);break;case"safari":if(!h$||!t.shimSafari){h_("Safari shim is not included in this adapter release.");break}h_("adapter.js shimming safari."),i.browserShim=h$,lr(e,r),li(e,r),h$.shimRTCIceServerUrls(e,r),h$.shimCreateOfferLegacy(e,r),h$.shimCallbacksAPI(e,r),h$.shimLocalStreamsAPI(e,r),h$.shimRemoteStreamsAPI(e,r),h$.shimTrackEventTransceiver(e,r),h$.shimGetUserMedia(e,r),h$.shimAudioContext(e,r),h5(e,r),h8(e,r),h9(e,r),h7(e,r),lt(e,r);break;default:h_("Unsupported browser!")}return i}({window:"undefined"==typeof window?void 0:window});var ln=eI("ippNs"),lo=ln.Buffer;try{o=new TextDecoder}catch(e){}let la=0;const lh=[],ll={};let lu=lh,lc=0,ld={},lp=0,lf=0,lm=[],lg=[],ly={useRecords:!1,mapsAsObjects:!0},l_=!1,lv=2;try{Function("")}catch(e){lv=1/0}class lb{constructor(e){if(e&&((e.keyMap||e._keyMap)&&!e.useRecords&&(e.useRecords=!1,e.mapsAsObjects=!0),!1===e.useRecords&&void 0===e.mapsAsObjects&&(e.mapsAsObjects=!0),e.getStructures&&(e.getShared=e.getStructures),e.getShared&&!e.structures&&((e.structures=[]).uninitialized=!0),e.keyMap))for(let[t,r]of(this.mapKey=new Map,Object.entries(e.keyMap)))this.mapKey.set(r,t);Object.assign(this,e)}decodeKey(e){return this.keyMap&&this.mapKey.get(e)||e}encodeKey(e){return this.keyMap&&this.keyMap.hasOwnProperty(e)?this.keyMap[e]:e}encodeKeys(e){if(!this._keyMap)return e;let t=new Map;for(let[r,i]of Object.entries(e))t.set(this._keyMap.hasOwnProperty(r)?this._keyMap[r]:r,i);return t}decodeKeys(e){if(!this._keyMap||"Map"!=e.constructor.name)return e;if(!this._mapKey)for(let[e,t]of(this._mapKey=new Map,Object.entries(this._keyMap)))this._mapKey.set(t,e);let t={};return e.forEach((e,r)=>t[lA(this._mapKey.has(r)?this._mapKey.get(r):r)]=e),t}mapDecode(e,t){let r=this.decode(e);return this._keyMap&&"Array"===r.constructor.name?r.map(e=>this.decodeKeys(e)):r}decode(e,t){if(a)return lz(()=>(lV(),this?this.decode(e,t):lb.prototype.decode.call(ly,e,t)));h=t>-1?t:e.length,la=0,lc=0,lf=0,u=null,lu=lh,c=null,a=e;try{f=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))}catch(t){if(a=null,e instanceof Uint8Array)throw t;throw Error("Source must be a Uint8Array or Buffer but was a "+(e&&"object"==typeof e?e.constructor.name:typeof e))}return this instanceof lb?(ld=this,p=this.sharedValues&&(this.pack?Array(this.maxPrivatePackedValues||16).concat(this.sharedValues):this.sharedValues),this.structures?l=this.structures:(!l||l.length>0)&&(l=[])):(ld=ly,(!l||l.length>0)&&(l=[]),p=null),lx()}decodeMultiple(e,t){let r,i=0;try{let s=e.length;l_=!0;let n=this?this.decode(e,s):lW.decode(e,s);if(t){if(!1===t(n))return;for(;la<s;)if(i=la,!1===t(lx()))return}else{for(r=[n];la<s;)i=la,r.push(lx());return r}}catch(e){throw e.lastPosition=i,e.values=r,e}finally{l_=!1,lV()}}}function lx(){try{let e=lT();if(c){if(la>=c.postBundlePosition){let e=Error("Unexpected bundle position");throw e.incomplete=!0,e}la=c.postBundlePosition,c=null}if(la==h)l=null,a=null,d&&(d=null);else if(la>h){let e=Error("Unexpected end of CBOR data");throw e.incomplete=!0,e}else if(!l_)throw Error("Data read, but end of buffer not reached");return e}catch(e){throw lV(),(e instanceof RangeError||e.message.startsWith("Unexpected end of buffer"))&&(e.incomplete=!0),e}}function lT(){let e=a[la++],t=e>>5;if((e&=31)>23)switch(e){case 24:e=a[la++];break;case 25:if(7==t)return function(){let e=a[la++],t=a[la++],r=(127&e)>>2;if(31===r)return t||3&e?NaN:128&e?-1/0:1/0;if(0===r){let r=((3&e)<<8|t)/16777216;return 128&e?-r:r}return lM[3]=128&e|(r>>1)+56,lM[2]=(7&e)<<5|t>>3,lM[1]=t<<5,lM[0]=0,lP[0]}();e=f.getUint16(la),la+=2;break;case 26:if(7==t){let e=f.getFloat32(la);if(ld.useFloat32>2){let t=lX[(127&a[la])<<1|a[la+1]>>7];return la+=4,(t*e+(e>0?.5:-.5)>>0)/t}return la+=4,e}e=f.getUint32(la),la+=4;break;case 27:if(7==t){let e=f.getFloat64(la);return la+=8,e}if(t>1){if(f.getUint32(la)>0)throw Error("JavaScript does not support arrays, maps, or strings with length over 4294967295");e=f.getUint32(la+4)}else e=ld.int64AsNumber?4294967296*f.getUint32(la)+f.getUint32(la+4):f.getBigUint64(la);la+=8;break;case 31:switch(t){case 2:case 3:throw Error("Indefinite length not supported for byte or text strings");case 4:let r=[],i,s=0;for(;(i=lT())!=ll;)r[s++]=i;return 4==t?r:3==t?r.join(""):lo.concat(r);case 5:let n;if(ld.mapsAsObjects){let e={};if(ld.keyMap)for(;(n=lT())!=ll;)e[lA(ld.decodeKey(n))]=lT();else for(;(n=lT())!=ll;)e[lA(n)]=lT();return e}{m&&(ld.mapsAsObjects=!0,m=!1);let e=new Map;if(ld.keyMap)for(;(n=lT())!=ll;)e.set(ld.decodeKey(n),lT());else for(;(n=lT())!=ll;)e.set(n,lT());return e}case 7:return ll;default:throw Error("Invalid major type for indefinite length "+t)}default:throw Error("Unknown token "+e)}switch(t){case 0:return e;case 1:return~e;case 2:var o;return o=e,ld.copyBuffers?Uint8Array.prototype.slice.call(a,la,la+=o):a.subarray(la,la+=o);case 3:if(lf>=la)return u.slice(la-lp,(la+=e)-lp);if(0==lf&&h<140&&e<32){let t=e<16?lI(e):function(e){let t=la,r=Array(e);for(let i=0;i<e;i++){let e=a[la++];if((128&e)>0){la=t;return}r[i]=e}return lR.apply(String,r)}(e);if(null!=t)return t}return lS(e);case 4:let d=Array(e);for(let t=0;t<e;t++)d[t]=lT();return d;case 5:if(ld.mapsAsObjects){let t={};if(ld.keyMap)for(let r=0;r<e;r++)t[lA(ld.decodeKey(lT()))]=lT();else for(let r=0;r<e;r++)t[lA(lT())]=lT();return t}{m&&(ld.mapsAsObjects=!0,m=!1);let t=new Map;if(ld.keyMap)for(let r=0;r<e;r++)t.set(ld.decodeKey(lT()),lT());else for(let r=0;r<e;r++)t.set(lT(),lT());return t}case 6:if(e>=57337){let t=l[8191&e];if(t)return t.read||(t.read=lw(t)),t.read();if(e<65536){if(57343==e){let e=lj(),t=lT(),r=lT();lk(t,r);let i={};if(ld.keyMap)for(let t=2;t<e;t++)i[lA(ld.decodeKey(r[t-2]))]=lT();else for(let t=2;t<e;t++)i[lA(r[t-2])]=lT();return i}if(57342==e){let e=lj(),t=lT();for(let r=2;r<e;r++)lk(t++,lT());return lT()}if(57337==e)return function(){let e=lj(),t=la+lT();for(let t=2;t<e;t++){let e=lj();la+=e}let r=la;return la=t,(c=[lC(lj()),lC(lj())]).position0=0,c.position1=0,c.postBundlePosition=la,la=r,lT()}();if(ld.getShared&&(lH(),t=l[8191&e]))return t.read||(t.read=lw(t)),t.read()}}let g=lm[e];if(g){if(g.handlesRead)return g(lT);return g(lT())}{let t=lT();for(let r=0;r<lg.length;r++){let i=lg[r](e,t);if(void 0!==i)return i}return new lD(t,e)}case 7:switch(e){case 20:return!1;case 21:return!0;case 22:return null;case 23:return;default:let y=(p||lF())[e];if(void 0!==y)return y;throw Error("Unknown token "+e)}default:if(isNaN(e)){let e=Error("Unexpected end of CBOR data");throw e.incomplete=!0,e}throw Error("Unknown CBOR token "+e)}}const lE=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function lw(e){return e.slowReads=0,function(){let e=a[la++];if((e&=31)>23)switch(e){case 24:e=a[la++];break;case 25:e=f.getUint16(la),la+=2;break;case 26:e=f.getUint32(la),la+=4;break;default:throw Error("Expected array header, but got "+a[la-1])}let t=this.compiledReader;for(;t;){if(t.propertyCount===e)return t(lT);t=t.next}if(this.slowReads++>=lv){let r=this.length==e?this:this.slice(0,e);return t=ld.keyMap?Function("r","return {"+r.map(e=>ld.decodeKey(e)).map(e=>lE.test(e)?lA(e)+":r()":"["+JSON.stringify(e)+"]:r()").join(",")+"}"):Function("r","return {"+r.map(e=>lE.test(e)?lA(e)+":r()":"["+JSON.stringify(e)+"]:r()").join(",")+"}"),this.compiledReader&&(t.next=this.compiledReader),t.propertyCount=e,this.compiledReader=t,t(lT)}let r={};if(ld.keyMap)for(let t=0;t<e;t++)r[lA(ld.decodeKey(this[t]))]=lT();else for(let t=0;t<e;t++)r[lA(this[t])]=lT();return r}}function lA(e){return"__proto__"===e?"__proto_":e}let lS=lC;function lC(e){let t;if(e<16&&(t=lI(e)))return t;if(e>64&&o)return o.decode(a.subarray(la,la+=e));let r=la+e,i=[];for(t="";la<r;){let e=a[la++];if((128&e)==0)i.push(e);else if((224&e)==192){let t=63&a[la++];i.push((31&e)<<6|t)}else if((240&e)==224){let t=63&a[la++],r=63&a[la++];i.push((31&e)<<12|t<<6|r)}else if((248&e)==240){let t=(7&e)<<18|(63&a[la++])<<12|(63&a[la++])<<6|63&a[la++];t>65535&&(t-=65536,i.push(t>>>10&1023|55296),t=56320|1023&t),i.push(t)}else i.push(e);i.length>=4096&&(t+=lR.apply(String,i),i.length=0)}return i.length>0&&(t+=lR.apply(String,i)),t}let lR=String.fromCharCode;function lI(e){if(e<4){if(e<2){if(0===e)return"";{let e=a[la++];if((128&e)>1){la-=1;return}return lR(e)}}{let t=a[la++],r=a[la++];if((128&t)>0||(128&r)>0){la-=2;return}if(e<3)return lR(t,r);let i=a[la++];if((128&i)>0){la-=3;return}return lR(t,r,i)}}{let t=a[la++],r=a[la++],i=a[la++],s=a[la++];if((128&t)>0||(128&r)>0||(128&i)>0||(128&s)>0){la-=4;return}if(e<6){if(4===e)return lR(t,r,i,s);{let e=a[la++];if((128&e)>0){la-=5;return}return lR(t,r,i,s,e)}}if(e<8){let n=a[la++],o=a[la++];if((128&n)>0||(128&o)>0){la-=6;return}if(e<7)return lR(t,r,i,s,n,o);let h=a[la++];if((128&h)>0){la-=7;return}return lR(t,r,i,s,n,o,h)}{let n=a[la++],o=a[la++],h=a[la++],l=a[la++];if((128&n)>0||(128&o)>0||(128&h)>0||(128&l)>0){la-=8;return}if(e<10){if(8===e)return lR(t,r,i,s,n,o,h,l);{let e=a[la++];if((128&e)>0){la-=9;return}return lR(t,r,i,s,n,o,h,l,e)}}if(e<12){let u=a[la++],c=a[la++];if((128&u)>0||(128&c)>0){la-=10;return}if(e<11)return lR(t,r,i,s,n,o,h,l,u,c);let d=a[la++];if((128&d)>0){la-=11;return}return lR(t,r,i,s,n,o,h,l,u,c,d)}{let u=a[la++],c=a[la++],d=a[la++],p=a[la++];if((128&u)>0||(128&c)>0||(128&d)>0||(128&p)>0){la-=12;return}if(e<14){if(12===e)return lR(t,r,i,s,n,o,h,l,u,c,d,p);{let e=a[la++];if((128&e)>0){la-=13;return}return lR(t,r,i,s,n,o,h,l,u,c,d,p,e)}}{let f=a[la++],m=a[la++];if((128&f)>0||(128&m)>0){la-=14;return}if(e<15)return lR(t,r,i,s,n,o,h,l,u,c,d,p,f,m);let g=a[la++];if((128&g)>0){la-=15;return}return lR(t,r,i,s,n,o,h,l,u,c,d,p,f,m,g)}}}}}let lP=new Float32Array(1),lM=new Uint8Array(lP.buffer,0,4);class lD{constructor(e,t){this.value=e,this.tag=t}}lm[0]=e=>new Date(e),lm[1]=e=>new Date(Math.round(1e3*e)),lm[2]=e=>{let t=BigInt(0);for(let r=0,i=e.byteLength;r<i;r++)t=BigInt(e[r])+t<<BigInt(8);return t},lm[3]=e=>BigInt(-1)-lm[2](e),lm[4]=e=>+(e[1]+"e"+e[0]),lm[5]=e=>e[1]*Math.exp(e[0]*Math.log(2));const lk=(e,t)=>{let r=l[e-=57344];r&&r.isShared&&((l.restoreStructures||(l.restoreStructures=[]))[e]=r),l[e]=t,t.read=lw(t)};lm[105]=e=>{let t=e.length,r=e[1];lk(e[0],r);let i={};for(let s=2;s<t;s++)i[lA(r[s-2])]=e[s];return i},lm[14]=e=>c?c[0].slice(c.position0,c.position0+=e):new lD(e,14),lm[15]=e=>c?c[1].slice(c.position1,c.position1+=e):new lD(e,15);let lO={Error:Error,RegExp:RegExp};lm[27]=e=>(lO[e[0]]||Error)(e[1],e[2]);const lB=e=>{if(132!=a[la++])throw Error("Packed values structure must be followed by a 4 element array");let t=e();return(p=p?t.concat(p.slice(t.length)):t).prefixes=e(),p.suffixes=e(),e()};function lL(e,t){return"string"==typeof e?e+t:e instanceof Array?e.concat(t):Object.assign({},e,t)}function lF(){if(!p){if(ld.getShared)lH();else throw Error("No packed values available")}return p}lB.handlesRead=!0,lm[51]=lB,lm[6]=e=>{if(!p){if(!ld.getShared)return new lD(e,6);lH()}if("number"==typeof e)return p[16+(e>=0?2*e:-2*e-1)];throw Error("No support for non-integer packed references yet")},lm[28]=e=>{let t;d||((d=new Map).id=0);let r=d.id++,i={target:t=a[la]>>5==4?[]:{}};d.set(r,i);let s=e();return i.used?Object.assign(t,s):(i.target=s,s)},lm[28].handlesRead=!0,lm[29]=e=>{let t=d.get(e);return t.used=!0,t.target},lm[258]=e=>new Set(e),(lm[259]=e=>(ld.mapsAsObjects&&(ld.mapsAsObjects=!1,m=!0),e())).handlesRead=!0,lg.push((e,t)=>e>=225&&e<=255?lL(lF().prefixes[e-224],t):e>=28704&&e<=32767?lL(lF().prefixes[e-28672],t):e>=1879052288&&e<=2147483647?lL(lF().prefixes[e-1879048192],t):e>=216&&e<=223?lL(t,lF().suffixes[e-216]):e>=27647&&e<=28671?lL(t,lF().suffixes[e-27639]):e>=1811940352&&e<=1879048191?lL(t,lF().suffixes[e-1811939328]):1399353956==e?{packedValues:p,structures:l.slice(0),version:t}:55799==e?t:void 0);const lN=1==new Uint8Array(new Uint16Array([1]).buffer)[0],lU=[Uint8Array,Uint8ClampedArray,Uint16Array,Uint32Array,"undefined"==typeof BigUint64Array?{name:"BigUint64Array"}:BigUint64Array,Int8Array,Int16Array,Int32Array,"undefined"==typeof BigInt64Array?{name:"BigInt64Array"}:BigInt64Array,Float32Array,Float64Array],lG=[64,68,69,70,71,72,77,78,79,85,86];for(let e=0;e<lU.length;e++)!function(e,t){let r,i="get"+e.name.slice(0,-5);"function"==typeof e?r=e.BYTES_PER_ELEMENT:e=null;for(let s=0;s<2;s++){if(!s&&1==r)continue;let n=2==r?1:4==r?2:3;lm[s?t:t-4]=1==r||s==lN?r=>{if(!e)throw Error("Could not find typed array for code "+t);return new e(Uint8Array.prototype.slice.call(r,0).buffer)}:r=>{if(!e)throw Error("Could not find typed array for code "+t);let o=new DataView(r.buffer,r.byteOffset,r.byteLength),a=r.length>>n,h=new e(a),l=o[i];for(let e=0;e<a;e++)h[e]=l.call(o,e<<n,s);return h}}}(lU[e],lG[e]);function lj(){let e=31&a[la++];if(e>23)switch(e){case 24:e=a[la++];break;case 25:e=f.getUint16(la),la+=2;break;case 26:e=f.getUint32(la),la+=4}return e}function lH(){if(ld.getShared){let e=lz(()=>(a=null,ld.getShared()))||{},t=e.structures||[];ld.sharedVersion=e.version,p=ld.sharedValues=e.packedValues,!0===l?ld.structures=l=t:l.splice.apply(l,[0,t.length].concat(t))}}function lz(e){let t=h,r=la,i=lc,s=lp,n=lf,o=u,p=lu,m=d,g=c,y=new Uint8Array(a.slice(0,h)),_=l,v=ld,b=l_,x=e();return h=t,la=r,lc=i,lp=s,lf=n,u=o,lu=p,d=m,c=g,a=y,l_=b,l=_,ld=v,f=new DataView(a.buffer,a.byteOffset,a.byteLength),x}function lV(){a=null,d=null,l=null}const lX=Array(147);for(let e=0;e<256;e++)lX[e]=+("1e"+Math.floor(45.15-.30103*e));let lW=new lb({useRecords:!1});lW.decode,lW.decodeMultiple;try{g=new TextEncoder}catch(e){}const l$="object"==typeof globalThis&&globalThis.Buffer,lY=void 0!==l$,lq=lY?l$.allocUnsafeSlow:Uint8Array,lK=lY?l$:Uint8Array,lJ=lY?4294967296:2144337920;let lZ=0,lQ=null;const l0=/[\u0080-\uFFFF]/,l1=Symbol("record-id");function l2(e,t){e<24?b[lZ++]=t|e:e<256?(b[lZ++]=24|t,b[lZ++]=e):e<65536?(b[lZ++]=25|t,b[lZ++]=e>>8,b[lZ++]=255&e):(b[lZ++]=26|t,x.setUint32(lZ,e),lZ+=4)}class l3{constructor(e,t,r){this.structures=e,this.packedValues=t,this.version=r}}function l4(e){e<24?b[lZ++]=128|e:e<256?(b[lZ++]=152,b[lZ++]=e):e<65536?(b[lZ++]=153,b[lZ++]=e>>8,b[lZ++]=255&e):(b[lZ++]=154,x.setUint32(lZ,e),lZ+=4)}const l6="undefined"==typeof Blob?function(){}:Blob;function l5(e){if(e instanceof l6)return!0;let t=e[Symbol.toStringTag];return"Blob"===t||"File"===t}const l8=1==new Uint8Array(new Uint16Array([1]).buffer)[0];function l9(e,t){return!l8&&t>1&&(e-=4),{tag:e,encode:function(e,t){let r=e.byteLength,i=e.byteOffset||0,s=e.buffer||e;t(lY?l$.from(s,i,r):new Uint8Array(s,i,r))}}}function l7(e,t){let r=e.byteLength;r<24?b[lZ++]=64+r:r<256?(b[lZ++]=88,b[lZ++]=r):r<65536?(b[lZ++]=89,b[lZ++]=r>>8,b[lZ++]=255&r):(b[lZ++]=90,x.setUint32(lZ,r),lZ+=4),lZ+r>=b.length&&t(lZ+r),b.set(e.buffer?e:new Uint8Array(e),lZ),lZ+=r}function ue(e,t){x.setUint32(lQ.position+e,lZ-lQ.position-e+1);let r=lQ;lQ=null,t(r[0]),t(r[1])}_=[Date,Set,Error,RegExp,lD,ArrayBuffer,Uint8Array,Uint8ClampedArray,Uint16Array,Uint32Array,"undefined"==typeof BigUint64Array?function(){}:BigUint64Array,Int8Array,Int16Array,Int32Array,"undefined"==typeof BigInt64Array?function(){}:BigInt64Array,Float32Array,Float64Array,l3],y=[{tag:1,encode(e,t){let r=e.getTime()/1e3;(this.useTimestamp32||0===e.getMilliseconds())&&r>=0&&r<4294967296?(b[lZ++]=26,x.setUint32(lZ,r),lZ+=4):(b[lZ++]=251,x.setFloat64(lZ,r),lZ+=8)}},{tag:258,encode(e,t){t(Array.from(e))}},{tag:27,encode(e,t){t([e.name,e.message])}},{tag:27,encode(e,t){t(["RegExp",e.source,e.flags])}},{getTag:e=>e.tag,encode(e,t){t(e.value)}},{encode(e,t,r){l7(e,r)}},{getTag(e){if(e.constructor===Uint8Array&&(this.tagUint8Array||lY&&!1!==this.tagUint8Array))return 64},encode(e,t,r){l7(e,r)}},l9(68,1),l9(69,2),l9(70,4),l9(71,8),l9(72,1),l9(77,2),l9(78,4),l9(79,8),l9(85,4),l9(86,8),{encode(e,t){let r=e.packedValues||[],i=e.structures||[];if(r.values.length>0){b[lZ++]=216,b[lZ++]=51,l4(4);let e=r.values;t(e),l4(0),l4(0),packedObjectMap=Object.create(sharedPackedObjectMap||null);for(let t=0,r=e.length;t<r;t++)packedObjectMap[e[t]]=t}if(i){x.setUint32(lZ,3655335424),lZ+=3;let r=i.slice(0);r.unshift(57344),r.push(new lD(e.version,1399353956)),t(r)}else t(new lD(e.version,1399353956))}}];let ut=new class extends lb{constructor(e){let t,r,i,s,n,o;super(e),this.offset=0,e=e||{};let a=lK.prototype.utf8Write?function(e,t,r){return b.utf8Write(e,t,r)}:!!g&&!!g.encodeInto&&function(e,t){return g.encodeInto(e,b.subarray(t)).written},h=this,l=e.structures||e.saveStructures,u=e.maxSharedStructures;if(null==u&&(u=l?128:0),u>8190)throw Error("Maximum maxSharedStructure is 8190");let c=e.sequential;c&&(u=0),this.structures||(this.structures=[]),this.saveStructures&&(this.saveShared=this.saveStructures);let d,p,f=e.sharedValues;if(f){o=Object.create(null);for(let e=0,t=f.length;e<t;e++)o[f[e]]=e}let m=[],E=0,w=0;this.mapEncode=function(e,t){return this._keyMap&&!this._mapped&&"Array"===e.constructor.name&&(e=e.map(e=>this.encodeKeys(e))),this.encode(e,t)},this.encode=function(a,l){if(b||(x=new DataView((b=new lq(8192)).buffer,0,8192),lZ=0),(T=b.length-10)-lZ<2048?(x=new DataView((b=new lq(b.length)).buffer,0,b.length),T=b.length-10,lZ=0):l===uo&&(lZ=lZ+7&2147483640),t=lZ,h.useSelfDescribedHeader&&(x.setUint32(lZ,3654940416),lZ+=3),n=h.structuredClone?new Map:null,h.bundleStrings&&"string"!=typeof a?(lQ=[]).size=1/0:lQ=null,r=h.structures){if(r.uninitialized){let e=h.getShared()||{};h.structures=r=e.structures||[],h.sharedVersion=e.version;let t=h.sharedValues=e.packedValues;if(t){o={};for(let e=0,r=t.length;e<r;e++)o[t[e]]=e}}let e=r.length;if(e>u&&!c&&(e=u),!r.transitions){r.transitions=Object.create(null);for(let t=0;t<e;t++){let e=r[t];if(!e)continue;let i,s=r.transitions;for(let r=0,n=e.length;r<n;r++){void 0===s[l1]&&(s[l1]=t);let n=e[r];(i=s[n])||(i=s[n]=Object.create(null)),s=i}s[l1]=1048576|t}}c||(r.nextId=e)}if(i&&(i=!1),s=r||[],p=o,e.pack){let t=new Map;if(t.values=[],t.encoder=h,t.maxValues=e.maxPrivatePackedValues||(o?16:1/0),t.objectMap=o||!1,t.samplingPackedValues=d,function e(t,r){switch(typeof t){case"string":if(t.length>3){if(r.objectMap[t]>-1||r.values.length>=r.maxValues)return;let e=r.get(t);if(e)2==++e.count&&r.values.push(t);else if(r.set(t,{count:1}),r.samplingPackedValues){let e=r.samplingPackedValues.get(t);e?e.count++:r.samplingPackedValues.set(t,{count:1})}}break;case"object":if(t){if(t instanceof Array)for(let i=0,s=t.length;i<s;i++)e(t[i],r);else{let s=!r.encoder.useRecords;for(var i in t)t.hasOwnProperty(i)&&(s&&e(i,r),e(t[i],r))}}break;case"function":console.log(t)}}(a,t),t.values.length>0){b[lZ++]=216,b[lZ++]=51,l4(4);let e=t.values;A(e),l4(0),l4(0),p=Object.create(o||null);for(let t=0,r=e.length;t<r;t++)p[e[t]]=t}}v=l&uh;try{if(v)return;if(A(a),lQ&&ue(t,A),h.offset=lZ,n&&n.idsToInsert){(lZ+=2*n.idsToInsert.length)>T&&C(lZ),h.offset=lZ;let e=function(e,t){let r;let i=2*t.length,s=e.length-i;t.sort((e,t)=>e.offset>t.offset?1:-1);for(let r=0;r<t.length;r++){let i=t[r];for(let t of(i.id=r,i.references))e[t++]=r>>8,e[t]=255&r}for(;r=t.pop();){let t=r.offset;e.copyWithin(t+i,t,s);let n=t+(i-=2);e[n++]=216,e[n++]=28,s=t}return e}(b.subarray(t,lZ),n.idsToInsert);return n=null,e}if(l&uo)return b.start=t,b.end=lZ,b;return b.subarray(t,lZ)}finally{if(r){if(w<10&&w++,r.length>u&&(r.length=u),E>1e4)r.transitions=null,w=0,E=0,m.length>0&&(m=[]);else if(m.length>0&&!c){for(let e=0,t=m.length;e<t;e++)m[e][l1]=void 0;m=[]}}if(i&&h.saveShared){h.structures.length>u&&(h.structures=h.structures.slice(0,u));let e=b.subarray(t,lZ);if(!1===h.updateSharedData())return h.encode(a);return e}l&ua&&(lZ=t)}},this.findCommonStringsToPack=()=>(d=new Map,o||(o=Object.create(null)),e=>{let t=e&&e.threshold||4,r=this.pack?e.maxPrivatePackedValues||16:0;for(let[e,s]of(f||(f=this.sharedValues=[]),d))s.count>t&&(o[e]=r++,f.push(e),i=!0);for(;this.saveShared&&!1===this.updateSharedData(););d=null});let A=r=>{lZ>T&&(b=C(lZ));var i,s=typeof r;if("string"===s){let s;if(p){let t=p[r];if(t>=0){t<16?b[lZ++]=t+224:(b[lZ++]=198,1&t?A(15-t>>1):A(t-16>>1));return}if(d&&!e.pack){let e=d.get(r);e?e.count++:d.set(r,{count:1})}}let n=r.length;if(lQ&&n>=4&&n<1024){if((lQ.size+=n)>61440){let e;let r=(lQ[0]?3*lQ[0].length+lQ[1].length:0)+10;lZ+r>T&&(b=C(lZ+r)),b[lZ++]=217,b[lZ++]=223,b[lZ++]=249,b[lZ++]=lQ.position?132:130,b[lZ++]=26,e=lZ-t,lZ+=4,lQ.position&&ue(t,A),(lQ=["",""]).size=0,lQ.position=e}let e=l0.test(r);lQ[e?0:1]+=r,b[lZ++]=e?206:207,A(n);return}s=n<32?1:n<256?2:n<65536?3:5;let o=3*n;if(lZ+o>T&&(b=C(lZ+o)),n<64||!a){let e,t,o,a=lZ+s;for(e=0;e<n;e++)(t=r.charCodeAt(e))<128?b[a++]=t:(t<2048?b[a++]=t>>6|192:((64512&t)==55296&&(64512&(o=r.charCodeAt(e+1)))==56320?(t=65536+((1023&t)<<10)+(1023&o),e++,b[a++]=t>>18|240,b[a++]=t>>12&63|128):b[a++]=t>>12|224,b[a++]=t>>6&63|128),b[a++]=63&t|128);i=a-lZ-s}else i=a(r,lZ+s,o);i<24?b[lZ++]=96|i:i<256?(s<2&&b.copyWithin(lZ+2,lZ+1,lZ+1+i),b[lZ++]=120,b[lZ++]=i):i<65536?(s<3&&b.copyWithin(lZ+3,lZ+2,lZ+2+i),b[lZ++]=121,b[lZ++]=i>>8,b[lZ++]=255&i):(s<5&&b.copyWithin(lZ+5,lZ+3,lZ+3+i),b[lZ++]=122,x.setUint32(lZ,i),lZ+=4),lZ+=i}else if("number"===s){if(this.alwaysUseFloat||r>>>0!==r){if(this.alwaysUseFloat||r>>0!==r){let e;if((e=this.useFloat32)>0&&r<4294967296&&r>=-2147483648){let t;if(b[lZ++]=250,x.setFloat32(lZ,r),e<4||(t=r*lX[(127&b[lZ])<<1|b[lZ+1]>>7])>>0===t){lZ+=4;return}lZ--}b[lZ++]=251,x.setFloat64(lZ,r),lZ+=8}else r>=-24?b[lZ++]=31-r:r>=-256?(b[lZ++]=56,b[lZ++]=~r):r>=-65536?(b[lZ++]=57,x.setUint16(lZ,~r),lZ+=2):(b[lZ++]=58,x.setUint32(lZ,~r),lZ+=4)}else r<24?b[lZ++]=r:r<256?(b[lZ++]=24,b[lZ++]=r):r<65536?(b[lZ++]=25,b[lZ++]=r>>8,b[lZ++]=255&r):(b[lZ++]=26,x.setUint32(lZ,r),lZ+=4)}else if("object"===s){if(r){if(n){let e=n.get(r);if(e){if(b[lZ++]=216,b[lZ++]=29,b[lZ++]=25,!e.references){let t=n.idsToInsert||(n.idsToInsert=[]);e.references=[],t.push(e)}e.references.push(lZ-t),lZ+=2;return}n.set(r,{offset:lZ-t})}let e=r.constructor;if(e===Object)S(r,!0);else if(e===Array){(i=r.length)<24?b[lZ++]=128|i:l4(i);for(let e=0;e<i;e++)A(r[e])}else if(e===Map){if((this.mapsAsObjects?!1!==this.useTag259ForMaps:this.useTag259ForMaps)&&(b[lZ++]=217,b[lZ++]=1,b[lZ++]=3),(i=r.size)<24?b[lZ++]=160|i:i<256?(b[lZ++]=184,b[lZ++]=i):i<65536?(b[lZ++]=185,b[lZ++]=i>>8,b[lZ++]=255&i):(b[lZ++]=186,x.setUint32(lZ,i),lZ+=4),h.keyMap)for(let[e,t]of r)A(h.encodeKey(e)),A(t);else for(let[e,t]of r)A(e),A(t)}else{for(let e=0,t=y.length;e<t;e++)if(r instanceof _[e]){let t=y[e],i=t.tag;void 0==i&&(i=t.getTag&&t.getTag.call(this,r)),i<24?b[lZ++]=192|i:i<256?(b[lZ++]=216,b[lZ++]=i):i<65536?(b[lZ++]=217,b[lZ++]=i>>8,b[lZ++]=255&i):i>-1&&(b[lZ++]=218,x.setUint32(lZ,i),lZ+=4),t.encode.call(this,r,A,C);return}if(r[Symbol.iterator]){if(v){let e=Error("Iterable should be serialized as iterator");throw e.iteratorNotHandled=!0,e}for(let e of(b[lZ++]=159,r))A(e);b[lZ++]=255;return}if(r[Symbol.asyncIterator]||l5(r)){let e=Error("Iterable/blob should be serialized as iterator");throw e.iteratorNotHandled=!0,e}if(this.useToJSON&&r.toJSON){let e=r.toJSON();if(e!==r)return A(e)}S(r,!r.hasOwnProperty)}}else b[lZ++]=246}else if("boolean"===s)b[lZ++]=r?245:244;else if("bigint"===s){if(r<BigInt(1)<<BigInt(64)&&r>=0)b[lZ++]=27,x.setBigUint64(lZ,r);else if(r>-(BigInt(1)<<BigInt(64))&&r<0)b[lZ++]=59,x.setBigUint64(lZ,-r-BigInt(1));else if(this.largeBigIntToFloat)b[lZ++]=251,x.setFloat64(lZ,Number(r));else throw RangeError(r+" was too large to fit in CBOR 64-bit integer format, set largeBigIntToFloat to convert to float-64");lZ+=8}else if("undefined"===s)b[lZ++]=247;else throw Error("Unknown type: "+s)},S=!1===this.useRecords?this.variableMapSize?e=>{let t=Object.keys(e),r=Object.values(e),i=t.length;if(i<24?b[lZ++]=160|i:i<256?(b[lZ++]=184,b[lZ++]=i):i<65536?(b[lZ++]=185,b[lZ++]=i>>8,b[lZ++]=255&i):(b[lZ++]=186,x.setUint32(lZ,i),lZ+=4),h.keyMap)for(let e=0;e<i;e++)A(h.encodeKey(t[e])),A(r[e]);else for(let e=0;e<i;e++)A(t[e]),A(r[e])}:(e,r)=>{b[lZ++]=185;let i=lZ-t;lZ+=2;let s=0;if(h.keyMap)for(let t in e)(r||e.hasOwnProperty(t))&&(A(h.encodeKey(t)),A(e[t]),s++);else for(let t in e)(r||e.hasOwnProperty(t))&&(A(t),A(e[t]),s++);b[i+++t]=s>>8,b[i+t]=255&s}:(e,t)=>{let r,n,o,a=s.transitions||(s.transitions=Object.create(null)),h=0,l=0;if(this.keyMap){l=(n=Object.keys(e).map(e=>this.encodeKey(e))).length;for(let e=0;e<l;e++){let t=n[e];!(o=a[t])&&(o=a[t]=Object.create(null),h++),a=o}}else for(let i in e)(t||e.hasOwnProperty(i))&&(!(o=a[i])&&(1048576&a[l1]&&(r=65535&a[l1]),o=a[i]=Object.create(null),h++),a=o,l++);let c=a[l1];if(void 0!==c)c&=65535,b[lZ++]=217,b[lZ++]=c>>8|224,b[lZ++]=255&c;else if(n||(n=a.__keys__||(a.__keys__=Object.keys(e))),void 0===r?((c=s.nextId++)||(c=0,s.nextId=1),c>=256&&(s.nextId=(c=u)+1)):c=r,s[c]=n,c<u){b[lZ++]=217,b[lZ++]=c>>8|224,b[lZ++]=255&c,a=s.transitions;for(let e=0;e<l;e++)(void 0===a[l1]||1048576&a[l1])&&(a[l1]=c),a=a[n[e]];a[l1]=1048576|c,i=!0}else{if(a[l1]=c,x.setUint32(lZ,3655335680),lZ+=3,h&&(E+=w*h),m.length>=256-u&&(m.shift()[l1]=void 0),m.push(a),l4(l+2),A(57344+c),A(n),null===t)return;for(let r in e)(t||e.hasOwnProperty(r))&&A(e[r]);return}if(l<24?b[lZ++]=128|l:l4(l),null!==t)for(let r in e)(t||e.hasOwnProperty(r))&&A(e[r])},C=e=>{let r;if(e>16777216){if(e-t>lJ)throw Error("Encoded buffer would be larger than maximum buffer size");r=Math.min(lJ,4096*Math.round(Math.max((e-t)*(e>67108864?1.25:2),4194304)/4096))}else r=(Math.max(e-t<<2,b.length-1)>>12)+1<<12;let i=new lq(r);return x=new DataView(i.buffer,0,r),b.copy?b.copy(i,0,t,e):i.set(b.slice(t,e)),lZ-=t,t=0,T=i.length-10,b=i},R=100,I=1e3;function*P(e,r,i){let s=e.constructor;if(s===Object){let t=!1!==h.useRecords;for(let i in t?S(e,null):l2(Object.keys(e).length,160),e){let s=e[i];t||A(i),s&&"object"==typeof s?r[i]?yield*P(s,r[i]):yield*M(s,r,i):A(s)}}else if(s===Array){let i=e.length;l4(i);for(let s=0;s<i;s++){let i=e[s];i&&("object"==typeof i||lZ-t>R)?r.element?yield*P(i,r.element):yield*M(i,r,"element"):A(i)}}else if(e[Symbol.iterator]){for(let i of(b[lZ++]=159,e))i&&("object"==typeof i||lZ-t>R)?r.element?yield*P(i,r.element):yield*M(i,r,"element"):A(i);b[lZ++]=255}else l5(e)?(l2(e.size,64),yield b.subarray(t,lZ),yield e,D()):e[Symbol.asyncIterator]?(b[lZ++]=159,yield b.subarray(t,lZ),yield e,D(),b[lZ++]=255):A(e);i&&lZ>t?yield b.subarray(t,lZ):lZ-t>R&&(yield b.subarray(t,lZ),D())}function*M(e,r,i){let s=lZ-t;try{A(e),lZ-t>R&&(yield b.subarray(t,lZ),D())}catch(n){if(n.iteratorNotHandled)r[i]={},lZ=t+s,yield*P.call(this,e,r[i]);else throw n}}function D(){R=I,h.encode(null,uh)}function k(e,t,r){return(R=t&&t.chunkThreshold?I=t.chunkThreshold:100,e&&"object"==typeof e)?(h.encode(null,uh),r(e,h.iterateProperties||(h.iterateProperties={}),!0)):[h.encode(e)]}async function*O(e,t){for(let r of P(e,t,!0)){let e=r.constructor;if(e===lK||e===Uint8Array)yield r;else if(l5(r)){let e,t=r.stream().getReader();for(;!(e=await t.read()).done;)yield e.value}else if(r[Symbol.asyncIterator])for await(let e of r)D(),e?yield*O(e,t.async||(t.async={})):yield h.encode(e);else yield r}}this.encodeAsIterable=function(e,t){return k(e,t,P)},this.encodeAsAsyncIterable=function(e,t){return k(e,t,O)}}useBuffer(e){x=new DataView((b=e).buffer,b.byteOffset,b.byteLength),lZ=0}clearSharedData(){this.structures&&(this.structures=[]),this.sharedValues&&(this.sharedValues=void 0)}updateSharedData(){let e=this.sharedVersion||0;this.sharedVersion=e+1;let t=this.structures.slice(0),r=new l3(t,this.sharedValues,this.sharedVersion),i=this.saveShared(r,t=>(t&&t.version||0)==e);return!1===i?(r=this.getShared()||{},this.structures=r.structures||[],this.sharedValues=r.packedValues,this.sharedVersion=r.version,this.structures.nextId=this.structures.length):t.forEach((e,t)=>this.structures[t]=e),i}}({useRecords:!1});ut.encode,ut.encodeAsIterable,ut.encodeAsAsyncIterable;const{NEVER:ur,ALWAYS:ui,DECIMAL_ROUND:us,DECIMAL_FIT:un}={NEVER:0,ALWAYS:1,DECIMAL_ROUND:3,DECIMAL_FIT:4},uo=512,ua=1024,uh=2048;var ln=eI("ippNs");function ul(e,t,r){e.setUint32(t,Math.floor(r/4294967296)),e.setUint32(t+4,r)}function uu(e,t){return 4294967296*e.getInt32(t)+e.getUint32(t+4)}ln.Buffer;var uc={},ud=uc={};function up(){throw Error("setTimeout has not been defined")}function uf(){throw Error("clearTimeout has not been defined")}function um(e){if(eh===setTimeout)return setTimeout(e,0);if((eh===up||!eh)&&setTimeout)return eh=setTimeout,setTimeout(e,0);try{return eh(e,0)}catch(t){try{return eh.call(null,e,0)}catch(t){return eh.call(this,e,0)}}}!function(){try{eh="function"==typeof setTimeout?setTimeout:up}catch(e){eh=up}try{el="function"==typeof clearTimeout?clearTimeout:uf}catch(e){el=uf}}();var ug=[],uy=!1,u_=-1;function uv(){uy&&eu&&(uy=!1,eu.length?ug=eu.concat(ug):u_=-1,ug.length&&ub())}function ub(){if(!uy){var e=um(uv);uy=!0;for(var t=ug.length;t;){for(eu=ug,ug=[];++u_<t;)eu&&eu[u_].run();u_=-1,t=ug.length}eu=null,uy=!1,function(e){if(el===clearTimeout)return clearTimeout(e);if((el===uf||!el)&&clearTimeout)return el=clearTimeout,clearTimeout(e);try{el(e)}catch(t){try{return el.call(null,e)}catch(t){return el.call(this,e)}}}(e)}}function ux(e,t){this.fun=e,this.array=t}function uT(){}ud.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];ug.push(new ux(e,t)),1!==ug.length||uy||um(ub)},ux.prototype.run=function(){this.fun.apply(null,this.array)},ud.title="browser",ud.browser=!0,ud.env={},ud.argv=[],ud.version="",ud.versions={},ud.on=uT,ud.addListener=uT,ud.once=uT,ud.off=uT,ud.removeListener=uT,ud.removeAllListeners=uT,ud.emit=uT,ud.prependListener=uT,ud.prependOnceListener=uT,ud.listeners=function(e){return[]},ud.binding=function(e){throw Error("process.binding is not supported")},ud.cwd=function(){return"/"},ud.chdir=function(e){throw Error("process.chdir is not supported")},ud.umask=function(){return 0};var uE=(void 0===uc||(null===(ec=null==uc?void 0:uc.env)||void 0===ec?void 0:ec.TEXT_ENCODING)!=="never")&&"undefined"!=typeof TextEncoder&&"undefined"!=typeof TextDecoder;function uw(e){for(var t=e.length,r=0,i=0;i<t;){var s=e.charCodeAt(i++);if((4294967168&s)==0){r++;continue}if((4294965248&s)==0)r+=2;else{if(s>=55296&&s<=56319&&i<t){var n=e.charCodeAt(i);(64512&n)==56320&&(++i,s=((1023&s)<<10)+(1023&n)+65536)}(4294901760&s)==0?r+=3:r+=4}}return r}var uA=uE?new TextEncoder:void 0,uS=uE?void 0!==uc&&(null===(ed=null==uc?void 0:uc.env)||void 0===ed?void 0:ed.TEXT_ENCODING)!=="force"?200:0:4294967295,uC=(null==uA?void 0:uA.encodeInto)?function(e,t,r){uA.encodeInto(e,t.subarray(r))}:function(e,t,r){t.set(uA.encode(e),r)};function uR(e,t,r){for(var i=t,s=i+r,n=[],o="";i<s;){var a=e[i++];if((128&a)==0)n.push(a);else if((224&a)==192){var h=63&e[i++];n.push((31&a)<<6|h)}else if((240&a)==224){var h=63&e[i++],l=63&e[i++];n.push((31&a)<<12|h<<6|l)}else if((248&a)==240){var h=63&e[i++],l=63&e[i++],u=(7&a)<<18|h<<12|l<<6|63&e[i++];u>65535&&(u-=65536,n.push(u>>>10&1023|55296),u=56320|1023&u),n.push(u)}else n.push(a);n.length>=4096&&(o+=String.fromCharCode.apply(String,n),n.length=0)}return n.length>0&&(o+=String.fromCharCode.apply(String,n)),o}var uI=uE?new TextDecoder:null,uP=uE?void 0!==uc&&(null===(ep=null==uc?void 0:uc.env)||void 0===ep?void 0:ep.TEXT_DECODER)!=="force"?200:0:4294967295,uM=function(e,t){this.type=e,this.data=t},uD=(J=function(e,t){return(J=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}J(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),uk=function(e){function t(r){var i=e.call(this,r)||this;return Object.setPrototypeOf(i,Object.create(t.prototype)),Object.defineProperty(i,"name",{configurable:!0,enumerable:!1,value:t.name}),i}return uD(t,e),t}(Error),uO={type:-1,encode:function(e){var t,r,i,s;return e instanceof Date?function(e){var t=e.sec,r=e.nsec;if(t>=0&&r>=0&&t<=17179869183){if(0===r&&t<=4294967295){var i=new Uint8Array(4),s=new DataView(i.buffer);return s.setUint32(0,t),i}var n=t/4294967296,i=new Uint8Array(8),s=new DataView(i.buffer);return s.setUint32(0,r<<2|3&n),s.setUint32(4,4294967295&t),i}var i=new Uint8Array(12),s=new DataView(i.buffer);return s.setUint32(0,r),ul(s,4,t),i}((r=Math.floor((t=e.getTime())/1e3),s=Math.floor((i=(t-1e3*r)*1e6)/1e9),{sec:r+s,nsec:i-1e9*s})):null},decode:function(e){var t=function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);switch(e.byteLength){case 4:var r=t.getUint32(0),i=0;return{sec:r,nsec:0};case 8:var s=t.getUint32(0),r=(3&s)*4294967296+t.getUint32(4),i=s>>>2;return{sec:r,nsec:i};case 12:var r=uu(t,4),i=t.getUint32(0);return{sec:r,nsec:i};default:throw new uk("Unrecognized data size for timestamp (expected 4, 8, or 12): ".concat(e.length))}}(e);return new Date(1e3*t.sec+t.nsec/1e6)}},uB=function(){function e(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(uO)}return e.prototype.register=function(e){var t=e.type,r=e.encode,i=e.decode;if(t>=0)this.encoders[t]=r,this.decoders[t]=i;else{var s=1+t;this.builtInEncoders[s]=r,this.builtInDecoders[s]=i}},e.prototype.tryToEncode=function(e,t){for(var r=0;r<this.builtInEncoders.length;r++){var i=this.builtInEncoders[r];if(null!=i){var s=i(e,t);if(null!=s){var n=-1-r;return new uM(n,s)}}}for(var r=0;r<this.encoders.length;r++){var i=this.encoders[r];if(null!=i){var s=i(e,t);if(null!=s){var n=r;return new uM(n,s)}}}return e instanceof uM?e:null},e.prototype.decode=function(e,t,r){var i=t<0?this.builtInDecoders[-1-t]:this.decoders[t];return i?i(e,t,r):new uM(t,e)},e.defaultCodec=new e,e}();function uL(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e instanceof ArrayBuffer?new Uint8Array(e):Uint8Array.from(e)}function uF(e){return"".concat(e<0?"-":"","0x").concat(Math.abs(e).toString(16).padStart(2,"0"))}!function(){function e(e,t,r,i,s,n,o,a){void 0===e&&(e=uB.defaultCodec),void 0===t&&(t=void 0),void 0===r&&(r=100),void 0===i&&(i=2048),void 0===s&&(s=!1),void 0===n&&(n=!1),void 0===o&&(o=!1),void 0===a&&(a=!1),this.extensionCodec=e,this.context=t,this.maxDepth=r,this.initialBufferSize=i,this.sortKeys=s,this.forceFloat32=n,this.ignoreUndefined=o,this.forceIntegerToFloat=a,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}e.prototype.reinitializeState=function(){this.pos=0},e.prototype.encodeSharedRef=function(e){return this.reinitializeState(),this.doEncode(e,1),this.bytes.subarray(0,this.pos)},e.prototype.encode=function(e){return this.reinitializeState(),this.doEncode(e,1),this.bytes.slice(0,this.pos)},e.prototype.doEncode=function(e,t){if(t>this.maxDepth)throw Error("Too deep objects in depth ".concat(t));null==e?this.encodeNil():"boolean"==typeof e?this.encodeBoolean(e):"number"==typeof e?this.encodeNumber(e):"string"==typeof e?this.encodeString(e):this.encodeObject(e,t)},e.prototype.ensureBufferSizeToWrite=function(e){var t=this.pos+e;this.view.byteLength<t&&this.resizeBuffer(2*t)},e.prototype.resizeBuffer=function(e){var t=new ArrayBuffer(e),r=new Uint8Array(t),i=new DataView(t);r.set(this.bytes),this.view=i,this.bytes=r},e.prototype.encodeNil=function(){this.writeU8(192)},e.prototype.encodeBoolean=function(e){!1===e?this.writeU8(194):this.writeU8(195)},e.prototype.encodeNumber=function(e){Number.isSafeInteger(e)&&!this.forceIntegerToFloat?e>=0?e<128?this.writeU8(e):e<256?(this.writeU8(204),this.writeU8(e)):e<65536?(this.writeU8(205),this.writeU16(e)):e<4294967296?(this.writeU8(206),this.writeU32(e)):(this.writeU8(207),this.writeU64(e)):e>=-32?this.writeU8(224|e+32):e>=-128?(this.writeU8(208),this.writeI8(e)):e>=-32768?(this.writeU8(209),this.writeI16(e)):e>=-2147483648?(this.writeU8(210),this.writeI32(e)):(this.writeU8(211),this.writeI64(e)):this.forceFloat32?(this.writeU8(202),this.writeF32(e)):(this.writeU8(203),this.writeF64(e))},e.prototype.writeStringHeader=function(e){if(e<32)this.writeU8(160+e);else if(e<256)this.writeU8(217),this.writeU8(e);else if(e<65536)this.writeU8(218),this.writeU16(e);else if(e<4294967296)this.writeU8(219),this.writeU32(e);else throw Error("Too long string: ".concat(e," bytes in UTF-8"))},e.prototype.encodeString=function(e){if(e.length>uS){var t=uw(e);this.ensureBufferSizeToWrite(5+t),this.writeStringHeader(t),uC(e,this.bytes,this.pos),this.pos+=t}else{var t=uw(e);this.ensureBufferSizeToWrite(5+t),this.writeStringHeader(t),function(e,t,r){for(var i=e.length,s=r,n=0;n<i;){var o=e.charCodeAt(n++);if((4294967168&o)==0){t[s++]=o;continue}if((4294965248&o)==0)t[s++]=o>>6&31|192;else{if(o>=55296&&o<=56319&&n<i){var a=e.charCodeAt(n);(64512&a)==56320&&(++n,o=((1023&o)<<10)+(1023&a)+65536)}(4294901760&o)==0?t[s++]=o>>12&15|224:(t[s++]=o>>18&7|240,t[s++]=o>>12&63|128),t[s++]=o>>6&63|128}t[s++]=63&o|128}}(e,this.bytes,this.pos),this.pos+=t}},e.prototype.encodeObject=function(e,t){var r=this.extensionCodec.tryToEncode(e,this.context);if(null!=r)this.encodeExtension(r);else if(Array.isArray(e))this.encodeArray(e,t);else if(ArrayBuffer.isView(e))this.encodeBinary(e);else if("object"==typeof e)this.encodeMap(e,t);else throw Error("Unrecognized object: ".concat(Object.prototype.toString.apply(e)))},e.prototype.encodeBinary=function(e){var t=e.byteLength;if(t<256)this.writeU8(196),this.writeU8(t);else if(t<65536)this.writeU8(197),this.writeU16(t);else if(t<4294967296)this.writeU8(198),this.writeU32(t);else throw Error("Too large binary: ".concat(t));var r=uL(e);this.writeU8a(r)},e.prototype.encodeArray=function(e,t){var r=e.length;if(r<16)this.writeU8(144+r);else if(r<65536)this.writeU8(220),this.writeU16(r);else if(r<4294967296)this.writeU8(221),this.writeU32(r);else throw Error("Too large array: ".concat(r));for(var i=0;i<e.length;i++){var s=e[i];this.doEncode(s,t+1)}},e.prototype.countWithoutUndefined=function(e,t){for(var r=0,i=0;i<t.length;i++)void 0!==e[t[i]]&&r++;return r},e.prototype.encodeMap=function(e,t){var r=Object.keys(e);this.sortKeys&&r.sort();var i=this.ignoreUndefined?this.countWithoutUndefined(e,r):r.length;if(i<16)this.writeU8(128+i);else if(i<65536)this.writeU8(222),this.writeU16(i);else if(i<4294967296)this.writeU8(223),this.writeU32(i);else throw Error("Too large map object: ".concat(i));for(var s=0;s<r.length;s++){var n=r[s],o=e[n];this.ignoreUndefined&&void 0===o||(this.encodeString(n),this.doEncode(o,t+1))}},e.prototype.encodeExtension=function(e){var t=e.data.length;if(1===t)this.writeU8(212);else if(2===t)this.writeU8(213);else if(4===t)this.writeU8(214);else if(8===t)this.writeU8(215);else if(16===t)this.writeU8(216);else if(t<256)this.writeU8(199),this.writeU8(t);else if(t<65536)this.writeU8(200),this.writeU16(t);else if(t<4294967296)this.writeU8(201),this.writeU32(t);else throw Error("Too large extension object: ".concat(t));this.writeI8(e.type),this.writeU8a(e.data)},e.prototype.writeU8=function(e){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,e),this.pos++},e.prototype.writeU8a=function(e){var t=e.length;this.ensureBufferSizeToWrite(t),this.bytes.set(e,this.pos),this.pos+=t},e.prototype.writeI8=function(e){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,e),this.pos++},e.prototype.writeU16=function(e){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,e),this.pos+=2},e.prototype.writeI16=function(e){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,e),this.pos+=2},e.prototype.writeU32=function(e){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,e),this.pos+=4},e.prototype.writeI32=function(e){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,e),this.pos+=4},e.prototype.writeF32=function(e){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,e),this.pos+=4},e.prototype.writeF64=function(e){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,e),this.pos+=8},e.prototype.writeU64=function(e){var t,r;this.ensureBufferSizeToWrite(8),t=this.view,r=this.pos,t.setUint32(r,e/4294967296),t.setUint32(r+4,e),this.pos+=8},e.prototype.writeI64=function(e){this.ensureBufferSizeToWrite(8),ul(this.view,this.pos,e),this.pos+=8}}();var uN=function(){function e(e,t){void 0===e&&(e=16),void 0===t&&(t=16),this.maxKeyLength=e,this.maxLengthPerKey=t,this.hit=0,this.miss=0,this.caches=[];for(var r=0;r<this.maxKeyLength;r++)this.caches.push([])}return e.prototype.canBeCached=function(e){return e>0&&e<=this.maxKeyLength},e.prototype.find=function(e,t,r){var i=this.caches[r-1];e:for(var s=0;s<i.length;s++){for(var n=i[s],o=n.bytes,a=0;a<r;a++)if(o[a]!==e[t+a])continue e;return n.str}return null},e.prototype.store=function(e,t){var r=this.caches[e.length-1],i={bytes:e,str:t};r.length>=this.maxLengthPerKey?r[Math.random()*r.length|0]=i:r.push(i)},e.prototype.decode=function(e,t,r){var i=this.find(e,t,r);if(null!=i)return this.hit++,i;this.miss++;var s=uR(e,t,r),n=Uint8Array.prototype.slice.call(e,t,t+r);return this.store(n,s),s},e}(),uU=function(e,t){var r,i,s,n,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return n={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function a(n){return function(a){return function(n){if(r)throw TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(s=2&n[0]?i.return:n[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,n[1])).done)return s;switch(i=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,i=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(!(s=(s=o.trys).length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){o=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){o.label=n[1];break}if(6===n[0]&&o.label<s[1]){o.label=s[1],s=n;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(n);break}s[2]&&o.ops.pop(),o.trys.pop();continue}n=t.call(e,o)}catch(e){n=[6,e],i=0}finally{r=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,a])}}},uG=function(e){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(r){t[r]=e[r]&&function(t){return new Promise(function(i,s){!function(e,t,r,i){Promise.resolve(i).then(function(t){e({value:t,done:r})},t)}(i,s,(t=e[r](t)).done,t.value)})}}},uj=function(e){return this instanceof uj?(this.v=e,this):new uj(e)},uH=function(e,t,r){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var i,s=r.apply(e,t||[]),n=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(e){s[e]&&(i[e]=function(t){return new Promise(function(r,i){n.push([e,t,r,i])>1||a(e,t)})})}function a(e,t){try{var r;(r=s[e](t)).value instanceof uj?Promise.resolve(r.value.v).then(h,l):u(n[0][2],r)}catch(e){u(n[0][3],e)}}function h(e){a("next",e)}function l(e){a("throw",e)}function u(e,t){e(t),n.shift(),n.length&&a(n[0][0],n[0][1])}},uz=function(e){var t=typeof e;return"string"===t||"number"===t},uV=new DataView(new ArrayBuffer(0)),uX=new Uint8Array(uV.buffer),uW=function(){try{uV.getInt8(0)}catch(e){return e.constructor}throw Error("never reached")}(),u$=new uW("Insufficient data"),uY=new uN;function uq(e,t,r,i){Object.defineProperty(e,t,{get:r,set:i,enumerable:!0,configurable:!0})}!function(){function e(e,t,r,i,s,n,o,a){void 0===e&&(e=uB.defaultCodec),void 0===t&&(t=void 0),void 0===r&&(r=4294967295),void 0===i&&(i=4294967295),void 0===s&&(s=4294967295),void 0===n&&(n=4294967295),void 0===o&&(o=4294967295),void 0===a&&(a=uY),this.extensionCodec=e,this.context=t,this.maxStrLength=r,this.maxBinLength=i,this.maxArrayLength=s,this.maxMapLength=n,this.maxExtLength=o,this.keyDecoder=a,this.totalPos=0,this.pos=0,this.view=uV,this.bytes=uX,this.headByte=-1,this.stack=[]}e.prototype.reinitializeState=function(){this.totalPos=0,this.headByte=-1,this.stack.length=0},e.prototype.setBuffer=function(e){this.bytes=uL(e),this.view=function(e){if(e instanceof ArrayBuffer)return new DataView(e);var t=uL(e);return new DataView(t.buffer,t.byteOffset,t.byteLength)}(this.bytes),this.pos=0},e.prototype.appendBuffer=function(e){if(-1!==this.headByte||this.hasRemaining(1)){var t=this.bytes.subarray(this.pos),r=uL(e),i=new Uint8Array(t.length+r.length);i.set(t),i.set(r,t.length),this.setBuffer(i)}else this.setBuffer(e)},e.prototype.hasRemaining=function(e){return this.view.byteLength-this.pos>=e},e.prototype.createExtraByteError=function(e){var t=this.view,r=this.pos;return RangeError("Extra ".concat(t.byteLength-r," of ").concat(t.byteLength," byte(s) found at buffer[").concat(e,"]"))},e.prototype.decode=function(e){this.reinitializeState(),this.setBuffer(e);var t=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return t},e.prototype.decodeMulti=function(e){return uU(this,function(t){switch(t.label){case 0:this.reinitializeState(),this.setBuffer(e),t.label=1;case 1:if(!this.hasRemaining(1))return[3,3];return[4,this.doDecodeSync()];case 2:return t.sent(),[3,1];case 3:return[2]}})},e.prototype.decodeAsync=function(e){var t,r,i,s,n,o,a,h;return n=this,o=void 0,a=void 0,h=function(){var n,o,a,h,l,u,c;return uU(this,function(d){switch(d.label){case 0:n=!1,d.label=1;case 1:d.trys.push([1,6,7,12]),t=uG(e),d.label=2;case 2:return[4,t.next()];case 3:if((r=d.sent()).done)return[3,5];if(a=r.value,n)throw this.createExtraByteError(this.totalPos);this.appendBuffer(a);try{o=this.doDecodeSync(),n=!0}catch(e){if(!(e instanceof uW))throw e}this.totalPos+=this.pos,d.label=4;case 4:return[3,2];case 5:return[3,12];case 6:return i={error:d.sent()},[3,12];case 7:if(d.trys.push([7,,10,11]),!(r&&!r.done&&(s=t.return)))return[3,9];return[4,s.call(t)];case 8:d.sent(),d.label=9;case 9:return[3,11];case 10:if(i)throw i.error;return[7];case 11:return[7];case 12:if(n){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return[2,o]}throw h=this,l=h.headByte,u=h.pos,c=h.totalPos,RangeError("Insufficient data in parsing ".concat(uF(l)," at ").concat(c," (").concat(u," in the current buffer)"))}})},new(a||(a=Promise))(function(e,t){function r(e){try{s(h.next(e))}catch(e){t(e)}}function i(e){try{s(h.throw(e))}catch(e){t(e)}}function s(t){var s;t.done?e(t.value):((s=t.value)instanceof a?s:new a(function(e){e(s)})).then(r,i)}s((h=h.apply(n,o||[])).next())})},e.prototype.decodeArrayStream=function(e){return this.decodeMultiAsync(e,!0)},e.prototype.decodeStream=function(e){return this.decodeMultiAsync(e,!1)},e.prototype.decodeMultiAsync=function(e,t){return uH(this,arguments,function(){var r,i,s,n,o,a,h,l;return uU(this,function(u){switch(u.label){case 0:r=t,i=-1,u.label=1;case 1:u.trys.push([1,13,14,19]),s=uG(e),u.label=2;case 2:return[4,uj(s.next())];case 3:if((n=u.sent()).done)return[3,12];if(o=n.value,t&&0===i)throw this.createExtraByteError(this.totalPos);this.appendBuffer(o),r&&(i=this.readArraySize(),r=!1,this.complete()),u.label=4;case 4:u.trys.push([4,9,,10]),u.label=5;case 5:return[4,uj(this.doDecodeSync())];case 6:return[4,u.sent()];case 7:if(u.sent(),0==--i)return[3,8];return[3,5];case 8:return[3,10];case 9:if(!((a=u.sent())instanceof uW))throw a;return[3,10];case 10:this.totalPos+=this.pos,u.label=11;case 11:return[3,2];case 12:return[3,19];case 13:return h={error:u.sent()},[3,19];case 14:if(u.trys.push([14,,17,18]),!(n&&!n.done&&(l=s.return)))return[3,16];return[4,uj(l.call(s))];case 15:u.sent(),u.label=16;case 16:return[3,18];case 17:if(h)throw h.error;return[7];case 18:return[7];case 19:return[2]}})})},e.prototype.doDecodeSync=function(){t:for(;;){var e=this.readHeadByte(),t=void 0;if(e>=224)t=e-256;else if(e<192){if(e<128)t=e;else if(e<144){var r=e-128;if(0!==r){this.pushMapState(r),this.complete();continue}t={}}else if(e<160){var r=e-144;if(0!==r){this.pushArrayState(r),this.complete();continue}t=[]}else{var i=e-160;t=this.decodeUtf8String(i,0)}}else if(192===e)t=null;else if(194===e)t=!1;else if(195===e)t=!0;else if(202===e)t=this.readF32();else if(203===e)t=this.readF64();else if(204===e)t=this.readU8();else if(205===e)t=this.readU16();else if(206===e)t=this.readU32();else if(207===e)t=this.readU64();else if(208===e)t=this.readI8();else if(209===e)t=this.readI16();else if(210===e)t=this.readI32();else if(211===e)t=this.readI64();else if(217===e){var i=this.lookU8();t=this.decodeUtf8String(i,1)}else if(218===e){var i=this.lookU16();t=this.decodeUtf8String(i,2)}else if(219===e){var i=this.lookU32();t=this.decodeUtf8String(i,4)}else if(220===e){var r=this.readU16();if(0!==r){this.pushArrayState(r),this.complete();continue}t=[]}else if(221===e){var r=this.readU32();if(0!==r){this.pushArrayState(r),this.complete();continue}t=[]}else if(222===e){var r=this.readU16();if(0!==r){this.pushMapState(r),this.complete();continue}t={}}else if(223===e){var r=this.readU32();if(0!==r){this.pushMapState(r),this.complete();continue}t={}}else if(196===e){var r=this.lookU8();t=this.decodeBinary(r,1)}else if(197===e){var r=this.lookU16();t=this.decodeBinary(r,2)}else if(198===e){var r=this.lookU32();t=this.decodeBinary(r,4)}else if(212===e)t=this.decodeExtension(1,0);else if(213===e)t=this.decodeExtension(2,0);else if(214===e)t=this.decodeExtension(4,0);else if(215===e)t=this.decodeExtension(8,0);else if(216===e)t=this.decodeExtension(16,0);else if(199===e){var r=this.lookU8();t=this.decodeExtension(r,1)}else if(200===e){var r=this.lookU16();t=this.decodeExtension(r,2)}else if(201===e){var r=this.lookU32();t=this.decodeExtension(r,4)}else throw new uk("Unrecognized type byte: ".concat(uF(e)));this.complete();for(var s=this.stack;s.length>0;){var n=s[s.length-1];if(0===n.type){if(n.array[n.position]=t,n.position++,n.position===n.size)s.pop(),t=n.array;else continue t}else if(1===n.type){if(!uz(t))throw new uk("The type of key must be string or number but "+typeof t);if("__proto__"===t)throw new uk("The key __proto__ is not allowed");n.key=t,n.type=2;continue t}else if(n.map[n.key]=t,n.readCount++,n.readCount===n.size)s.pop(),t=n.map;else{n.key=null,n.type=1;continue t}}return t}},e.prototype.readHeadByte=function(){return -1===this.headByte&&(this.headByte=this.readU8()),this.headByte},e.prototype.complete=function(){this.headByte=-1},e.prototype.readArraySize=function(){var e=this.readHeadByte();switch(e){case 220:return this.readU16();case 221:return this.readU32();default:if(e<160)return e-144;throw new uk("Unrecognized array type byte: ".concat(uF(e)))}},e.prototype.pushMapState=function(e){if(e>this.maxMapLength)throw new uk("Max length exceeded: map length (".concat(e,") > maxMapLengthLength (").concat(this.maxMapLength,")"));this.stack.push({type:1,size:e,key:null,readCount:0,map:{}})},e.prototype.pushArrayState=function(e){if(e>this.maxArrayLength)throw new uk("Max length exceeded: array length (".concat(e,") > maxArrayLength (").concat(this.maxArrayLength,")"));this.stack.push({type:0,size:e,array:Array(e),position:0})},e.prototype.decodeUtf8String=function(e,t){if(e>this.maxStrLength)throw new uk("Max length exceeded: UTF-8 byte length (".concat(e,") > maxStrLength (").concat(this.maxStrLength,")"));if(this.bytes.byteLength<this.pos+t+e)throw u$;var r,i,s,n=this.pos+t;return this.stateIsMapKey()&&(null===(i=this.keyDecoder)||void 0===i?void 0:i.canBeCached(e))?s=this.keyDecoder.decode(this.bytes,n,e):e>uP?(r=this.bytes.subarray(n,n+e),s=uI.decode(r)):s=uR(this.bytes,n,e),this.pos+=t+e,s},e.prototype.stateIsMapKey=function(){return this.stack.length>0&&1===this.stack[this.stack.length-1].type},e.prototype.decodeBinary=function(e,t){if(e>this.maxBinLength)throw new uk("Max length exceeded: bin length (".concat(e,") > maxBinLength (").concat(this.maxBinLength,")"));if(!this.hasRemaining(e+t))throw u$;var r=this.pos+t,i=this.bytes.subarray(r,r+e);return this.pos+=t+e,i},e.prototype.decodeExtension=function(e,t){if(e>this.maxExtLength)throw new uk("Max length exceeded: ext length (".concat(e,") > maxExtLength (").concat(this.maxExtLength,")"));var r=this.view.getInt8(this.pos+t),i=this.decodeBinary(e,t+1);return this.extensionCodec.decode(i,r,this.context)},e.prototype.lookU8=function(){return this.view.getUint8(this.pos)},e.prototype.lookU16=function(){return this.view.getUint16(this.pos)},e.prototype.lookU32=function(){return this.view.getUint32(this.pos)},e.prototype.readU8=function(){var e=this.view.getUint8(this.pos);return this.pos++,e},e.prototype.readI8=function(){var e=this.view.getInt8(this.pos);return this.pos++,e},e.prototype.readU16=function(){var e=this.view.getUint16(this.pos);return this.pos+=2,e},e.prototype.readI16=function(){var e=this.view.getInt16(this.pos);return this.pos+=2,e},e.prototype.readU32=function(){var e=this.view.getUint32(this.pos);return this.pos+=4,e},e.prototype.readI32=function(){var e=this.view.getInt32(this.pos);return this.pos+=4,e},e.prototype.readU64=function(){var e,t,r=(e=this.view,t=this.pos,4294967296*e.getUint32(t)+e.getUint32(t+4));return this.pos+=8,r},e.prototype.readI64=function(){var e=uu(this.view,this.pos);return this.pos+=8,e},e.prototype.readF32=function(){var e=this.view.getFloat32(this.pos);return this.pos+=4,e},e.prototype.readF64=function(){var e=this.view.getFloat64(this.pos);return this.pos+=8,e}}();class uK{constructor(){this.chunkedMTU=16300,this._dataCount=1,this.chunk=e=>{let t=[],r=e.byteLength,i=Math.ceil(r/this.chunkedMTU),s=0,n=0;for(;n<r;){let o=Math.min(r,n+this.chunkedMTU),a=e.slice(n,o),h={__peerData:this._dataCount,n:s,data:a,total:i};t.push(h),n=o,s++}return this._dataCount++,t}}}const uJ=ls.default||ls,uZ=new class{isWebRTCSupported(){return"undefined"!=typeof RTCPeerConnection}isBrowserSupported(){let e=this.getBrowser(),t=this.getVersion();return!!this.supportedBrowsers.includes(e)&&("chrome"===e?t>=this.minChromeVersion:"firefox"===e?t>=this.minFirefoxVersion:"safari"===e&&!this.isIOS&&t>=this.minSafariVersion)}getBrowser(){return uJ.browserDetails.browser}getVersion(){return uJ.browserDetails.version||0}isUnifiedPlanSupported(){let e;let t=this.getBrowser(),r=uJ.browserDetails.version||0;if("chrome"===t&&r<this.minChromeVersion)return!1;if("firefox"===t&&r>=this.minFirefoxVersion)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let i=!1;try{(e=new RTCPeerConnection).addTransceiver("audio"),i=!0}catch(e){}finally{e&&e.close()}return i}toString(){return`Supports:
    browser:${this.getBrowser()}
    version:${this.getVersion()}
    isIOS:${this.isIOS}
    isWebRTCSupported:${this.isWebRTCSupported()}
    isBrowserSupported:${this.isBrowserSupported()}
    isUnifiedPlanSupported:${this.isUnifiedPlanSupported()}`}constructor(){this.isIOS=["iPad","iPhone","iPod"].includes(navigator.platform),this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}},uQ=e=>!e||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(e),u0=()=>Math.random().toString(36).slice(2),u1={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["turn:eu-0.turn.peerjs.com:3478","turn:us-0.turn.peerjs.com:3478"],username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"},u2=new class extends uK{noop(){}blobToArrayBuffer(e,t){let r=new FileReader;return r.onload=function(e){e.target&&t(e.target.result)},r.readAsArrayBuffer(e),r}binaryStringToArrayBuffer(e){let t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=255&e.charCodeAt(r);return t.buffer}isSecure(){return"https:"===location.protocol}constructor(...e){super(...e),this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.defaultConfig=u1,this.browser=uZ.getBrowser(),this.browserVersion=uZ.getVersion(),this.pack=hl,this.unpack=hh,this.supports=function(){let e;let t={browser:uZ.isBrowserSupported(),webRTC:uZ.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!t.webRTC)return t;try{let r;e=new RTCPeerConnection(u1),t.audioVideo=!0;try{r=e.createDataChannel("_PEERJSTEST",{ordered:!0}),t.data=!0,t.reliable=!!r.ordered;try{r.binaryType="blob",t.binaryBlob=!uZ.isIOS}catch(e){}}catch(e){}finally{r&&r.close()}}catch(e){}finally{e&&e.close()}return t}(),this.validateId=uQ,this.randomToken=u0}};(Z=ef||(ef={}))[Z.Disabled=0]="Disabled",Z[Z.Errors=1]="Errors",Z[Z.Warnings=2]="Warnings",Z[Z.All=3]="All";var u3=new class{get logLevel(){return this._logLevel}set logLevel(e){this._logLevel=e}log(...e){this._logLevel>=3&&this._print(3,...e)}warn(...e){this._logLevel>=2&&this._print(2,...e)}error(...e){this._logLevel>=1&&this._print(1,...e)}setLogFunction(e){this._print=e}_print(e,...t){let r=["PeerJS: ",...t];for(let e in r)r[e]instanceof Error&&(r[e]="("+r[e].name+") "+r[e].message);e>=3?console.log(...r):e>=2?console.warn("WARNING",...r):e>=1&&console.error("ERROR",...r)}constructor(){this._logLevel=0}},u4={},u6=Object.prototype.hasOwnProperty,u5="~";function u8(){}function u9(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function u7(e,t,r,i,s){if("function"!=typeof r)throw TypeError("The listener must be a function");var n=new u9(r,i||e,s),o=u5?u5+t:t;return e._events[o]?e._events[o].fn?e._events[o]=[e._events[o],n]:e._events[o].push(n):(e._events[o]=n,e._eventsCount++),e}function ce(e,t){0==--e._eventsCount?e._events=new u8:delete e._events[t]}function ct(){this._events=new u8,this._eventsCount=0}Object.create&&(u8.prototype=Object.create(null),new u8().__proto__||(u5=!1)),ct.prototype.eventNames=function(){var e,t,r=[];if(0===this._eventsCount)return r;for(t in e=this._events)u6.call(e,t)&&r.push(u5?t.slice(1):t);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},ct.prototype.listeners=function(e){var t=u5?u5+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,s=r.length,n=Array(s);i<s;i++)n[i]=r[i].fn;return n},ct.prototype.listenerCount=function(e){var t=u5?u5+e:e,r=this._events[t];return r?r.fn?1:r.length:0},ct.prototype.emit=function(e,t,r,i,s,n){var o=u5?u5+e:e;if(!this._events[o])return!1;var a,h,l=this._events[o],u=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),u){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,r),!0;case 4:return l.fn.call(l.context,t,r,i),!0;case 5:return l.fn.call(l.context,t,r,i,s),!0;case 6:return l.fn.call(l.context,t,r,i,s,n),!0}for(h=1,a=Array(u-1);h<u;h++)a[h-1]=arguments[h];l.fn.apply(l.context,a)}else{var c,d=l.length;for(h=0;h<d;h++)switch(l[h].once&&this.removeListener(e,l[h].fn,void 0,!0),u){case 1:l[h].fn.call(l[h].context);break;case 2:l[h].fn.call(l[h].context,t);break;case 3:l[h].fn.call(l[h].context,t,r);break;case 4:l[h].fn.call(l[h].context,t,r,i);break;default:if(!a)for(c=1,a=Array(u-1);c<u;c++)a[c-1]=arguments[c];l[h].fn.apply(l[h].context,a)}}return!0},ct.prototype.on=function(e,t,r){return u7(this,e,t,r,!1)},ct.prototype.once=function(e,t,r){return u7(this,e,t,r,!0)},ct.prototype.removeListener=function(e,t,r,i){var s=u5?u5+e:e;if(!this._events[s])return this;if(!t)return ce(this,s),this;var n=this._events[s];if(n.fn)n.fn!==t||i&&!n.once||r&&n.context!==r||ce(this,s);else{for(var o=0,a=[],h=n.length;o<h;o++)(n[o].fn!==t||i&&!n[o].once||r&&n[o].context!==r)&&a.push(n[o]);a.length?this._events[s]=1===a.length?a[0]:a:ce(this,s)}return this},ct.prototype.removeAllListeners=function(e){var t;return e?(t=u5?u5+e:e,this._events[t]&&ce(this,t)):(this._events=new u8,this._eventsCount=0),this},ct.prototype.off=ct.prototype.removeListener,ct.prototype.addListener=ct.prototype.on,ct.prefixed=u5,ct.EventEmitter=ct,u4=ct;var cr={};uq(cr,"ConnectionType",()=>em),uq(cr,"PeerErrorType",()=>eg),uq(cr,"BaseConnectionErrorType",()=>ey),uq(cr,"DataConnectionErrorType",()=>e_),uq(cr,"SerializationType",()=>ev),uq(cr,"SocketEventType",()=>eb),uq(cr,"ServerMessageType",()=>ex),(Q=em||(em={})).Data="data",Q.Media="media",(ee=eg||(eg={})).BrowserIncompatible="browser-incompatible",ee.Disconnected="disconnected",ee.InvalidID="invalid-id",ee.InvalidKey="invalid-key",ee.Network="network",ee.PeerUnavailable="peer-unavailable",ee.SslUnavailable="ssl-unavailable",ee.ServerError="server-error",ee.SocketError="socket-error",ee.SocketClosed="socket-closed",ee.UnavailableID="unavailable-id",ee.WebRTC="webrtc",(et=ey||(ey={})).NegotiationFailed="negotiation-failed",et.ConnectionClosed="connection-closed",(er=e_||(e_={})).NotOpenYet="not-open-yet",er.MessageToBig="message-too-big",(ei=ev||(ev={})).Binary="binary",ei.BinaryUTF8="binary-utf8",ei.JSON="json",ei.None="raw",(es=eb||(eb={})).Message="message",es.Disconnected="disconnected",es.Error="error",es.Close="close",(en=ex||(ex={})).Heartbeat="HEARTBEAT",en.Candidate="CANDIDATE",en.Offer="OFFER",en.Answer="ANSWER",en.Open="OPEN",en.Error="ERROR",en.IdTaken="ID-TAKEN",en.InvalidKey="INVALID-KEY",en.Leave="LEAVE",en.Expire="EXPIRE";var ci={};ci=JSON.parse('{"name":"peerjs","version":"1.5.2","keywords":["peerjs","webrtc","p2p","rtc"],"description":"PeerJS client","homepage":"https://peerjs.com","bugs":{"url":"https://github.com/peers/peerjs/issues"},"repository":{"type":"git","url":"https://github.com/peers/peerjs"},"license":"MIT","contributors":["Michelle Bu <michelle@michellebu.com>","afrokick <devbyru@gmail.com>","ericz <really.ez@gmail.com>","Jairo <kidandcat@gmail.com>","Jonas Gloning <34194370+jonasgloning@users.noreply.github.com>","Jairo Caro-Accino Viciana <jairo@galax.be>","Carlos Caballero <carlos.caballero.gonzalez@gmail.com>","hc <hheennrryy@gmail.com>","Muhammad Asif <capripio@gmail.com>","PrashoonB <prashoonbhattacharjee@gmail.com>","Harsh Bardhan Mishra <47351025+HarshCasper@users.noreply.github.com>","akotynski <aleksanderkotbury@gmail.com>","lmb <i@lmb.io>","Jairooo <jairocaro@msn.com>","Moritz Stckler <moritz.stueckler@gmail.com>","Simon <crydotsnakegithub@gmail.com>","Denis Lukov <denismassters@gmail.com>","Philipp Hancke <fippo@andyet.net>","Hans Oksendahl <hansoksendahl@gmail.com>","Jess <jessachandler@gmail.com>","khankuan <khankuan@gmail.com>","DUODVK <kurmanov.work@gmail.com>","XiZhao <kwang1imsa@gmail.com>","Matthias Lohr <matthias@lohr.me>","=frank tree <=frnktrb@googlemail.com>","Andre Eckardt <aeckardt@outlook.com>","Chris Cowan <agentme49@gmail.com>","Alex Chuev <alex@chuev.com>","alxnull <alxnull@e.mail.de>","Yemel Jardi <angel.jardi@gmail.com>","Ben Parnell <benjaminparnell.94@gmail.com>","Benny Lichtner <bennlich@gmail.com>","fresheneesz <bitetrudpublic@gmail.com>","bob.barstead@exaptive.com <bob.barstead@exaptive.com>","chandika <chandika@gmail.com>","emersion <contact@emersion.fr>","Christopher Van <cvan@users.noreply.github.com>","eddieherm <edhermoso@gmail.com>","Eduardo Pinho <enet4mikeenet@gmail.com>","Evandro Zanatta <ezanatta@tray.net.br>","Gardner Bickford <gardner@users.noreply.github.com>","Gian Luca <gianluca.cecchi@cynny.com>","PatrickJS <github@gdi2290.com>","jonnyf <github@jonathanfoss.co.uk>","Hizkia Felix <hizkifw@gmail.com>","Hristo Oskov <hristo.oskov@gmail.com>","Isaac Madwed <i.madwed@gmail.com>","Ilya Konanykhin <ilya.konanykhin@gmail.com>","jasonbarry <jasbarry@me.com>","Jonathan Burke <jonathan.burke.1311@googlemail.com>","Josh Hamit <josh.hamit@gmail.com>","Jordan Austin <jrax86@gmail.com>","Joel Wetzell <jwetzell@yahoo.com>","xizhao <kevin.wang@cloudera.com>","Alberto Torres <kungfoobar@gmail.com>","Jonathan Mayol <mayoljonathan@gmail.com>","Jefferson Felix <me@jsfelix.dev>","Rolf Erik Lekang <me@rolflekang.com>","Kevin Mai-Husan Chia <mhchia@users.noreply.github.com>","Pepijn de Vos <pepijndevos@gmail.com>","JooYoung <qkdlql@naver.com>","Tobias Speicher <rootcommander@gmail.com>","Steve Blaurock <sblaurock@gmail.com>","Kyrylo Shegeda <shegeda@ualberta.ca>","Diwank Singh Tomer <singh@diwank.name>","Soren Balko <Soeren.Balko@gmail.com>","Arpit Solanki <solankiarpit1997@gmail.com>","Yuki Ito <yuki@gnnk.net>","Artur Zayats <zag2art@gmail.com>"],"funding":{"type":"opencollective","url":"https://opencollective.com/peer"},"collective":{"type":"opencollective","url":"https://opencollective.com/peer"},"files":["dist/*"],"sideEffects":["lib/global.ts","lib/supports.ts"],"main":"dist/bundler.cjs","module":"dist/bundler.mjs","browser-minified":"dist/peerjs.min.js","browser-unminified":"dist/peerjs.js","browser-minified-cbor":"dist/serializer.cbor.mjs","browser-minified-msgpack":"dist/serializer.msgpack.mjs","types":"dist/types.d.ts","engines":{"node":">= 14"},"targets":{"types":{"source":"lib/exports.ts"},"main":{"source":"lib/exports.ts","sourceMap":{"inlineSources":true}},"module":{"source":"lib/exports.ts","includeNodeModules":["eventemitter3"],"sourceMap":{"inlineSources":true}},"browser-minified":{"context":"browser","outputFormat":"global","optimize":true,"engines":{"browsers":"chrome >= 83, edge >= 83, firefox >= 80, safari >= 15"},"source":"lib/global.ts"},"browser-unminified":{"context":"browser","outputFormat":"global","optimize":false,"engines":{"browsers":"chrome >= 83, edge >= 83, firefox >= 80, safari >= 15"},"source":"lib/global.ts"},"browser-minified-cbor":{"context":"browser","outputFormat":"esmodule","isLibrary":true,"optimize":true,"engines":{"browsers":"chrome >= 83, edge >= 83, firefox >= 102, safari >= 15"},"source":"lib/dataconnection/StreamConnection/Cbor.ts"},"browser-minified-msgpack":{"context":"browser","outputFormat":"esmodule","isLibrary":true,"optimize":true,"engines":{"browsers":"chrome >= 83, edge >= 83, firefox >= 102, safari >= 15"},"source":"lib/dataconnection/StreamConnection/MsgPack.ts"}},"scripts":{"contributors":"git-authors-cli --print=false && prettier --write package.json && git add package.json package-lock.json && git commit -m \\"chore(contributors): update and sort contributors list\\"","check":"tsc --noEmit && tsc -p e2e/tsconfig.json --noEmit","watch":"parcel watch","build":"rm -rf dist && parcel build","prepublishOnly":"npm run build","test":"jest","test:watch":"jest --watch","coverage":"jest --coverage --collectCoverageFrom=\\"./lib/**\\"","format":"prettier --write .","format:check":"prettier --check .","semantic-release":"semantic-release","e2e":"wdio run e2e/wdio.local.conf.ts","e2e:bstack":"wdio run e2e/wdio.bstack.conf.ts"},"devDependencies":{"@parcel/config-default":"^2.9.3","@parcel/packager-ts":"^2.9.3","@parcel/transformer-typescript-tsc":"^2.9.3","@parcel/transformer-typescript-types":"^2.9.3","@semantic-release/changelog":"^6.0.1","@semantic-release/git":"^10.0.1","@swc/core":"^1.3.27","@swc/jest":"^0.2.24","@types/jasmine":"^4.3.4","@wdio/browserstack-service":"^8.11.2","@wdio/cli":"^8.11.2","@wdio/globals":"^8.11.2","@wdio/jasmine-framework":"^8.11.2","@wdio/local-runner":"^8.11.2","@wdio/spec-reporter":"^8.11.2","@wdio/types":"^8.10.4","http-server":"^14.1.1","jest":"^29.3.1","jest-environment-jsdom":"^29.3.1","mock-socket":"^9.0.0","parcel":"^2.9.3","prettier":"^3.0.0","semantic-release":"^21.0.0","ts-node":"^10.9.1","typescript":"^5.0.0","wdio-geckodriver-service":"^5.0.1"},"dependencies":{"@msgpack/msgpack":"^2.8.0","cbor-x":"1.5.4","eventemitter3":"^4.0.7","peerjs-js-binarypack":"^2.1.0","webrtc-adapter":"^8.0.0"},"alias":{"process":false,"buffer":false}}');class cs extends u4.EventEmitter{constructor(e,t,r,i,s,n=5e3){super(),this.pingInterval=n,this._disconnected=!0,this._messagesQueue=[],this._baseUrl=(e?"wss://":"ws://")+t+":"+r+i+"peerjs?key="+s}start(e,t){this._id=e;let r=`${this._baseUrl}&id=${e}&token=${t}`;!this._socket&&this._disconnected&&(this._socket=new WebSocket(r+"&version="+ci.version),this._disconnected=!1,this._socket.onmessage=e=>{let t;try{t=JSON.parse(e.data),u3.log("Server message received:",t)}catch(t){u3.log("Invalid server message",e.data);return}this.emit(eb.Message,t)},this._socket.onclose=e=>{this._disconnected||(u3.log("Socket closed.",e),this._cleanup(),this._disconnected=!0,this.emit(eb.Disconnected))},this._socket.onopen=()=>{this._disconnected||(this._sendQueuedMessages(),u3.log("Socket open"),this._scheduleHeartbeat())})}_scheduleHeartbeat(){this._wsPingTimer=setTimeout(()=>{this._sendHeartbeat()},this.pingInterval)}_sendHeartbeat(){if(!this._wsOpen()){u3.log("Cannot send heartbeat, because socket closed");return}let e=JSON.stringify({type:ex.Heartbeat});this._socket.send(e),this._scheduleHeartbeat()}_wsOpen(){return!!this._socket&&1===this._socket.readyState}_sendQueuedMessages(){let e=[...this._messagesQueue];for(let t of(this._messagesQueue=[],e))this.send(t)}send(e){if(this._disconnected)return;if(!this._id){this._messagesQueue.push(e);return}if(!e.type){this.emit(eb.Error,"Invalid message");return}if(!this._wsOpen())return;let t=JSON.stringify(e);this._socket.send(t)}close(){this._disconnected||(this._cleanup(),this._disconnected=!0)}_cleanup(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)}}class cn{constructor(e){this.connection=e}startConnection(e){let t=this._startPeerConnection();if(this.connection.peerConnection=t,this.connection.type===em.Media&&e._stream&&this._addTracksToConnection(e._stream,t),e.originator){let r=this.connection,i={ordered:!!e.reliable},s=t.createDataChannel(r.label,i);r._initializeDataChannel(s),this._makeOffer()}else this.handleSDP("OFFER",e.sdp)}_startPeerConnection(){u3.log("Creating RTCPeerConnection.");let e=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(e),e}_setupListeners(e){let t=this.connection.peer,r=this.connection.connectionId,i=this.connection.type,s=this.connection.provider;u3.log("Listening for ICE candidates."),e.onicecandidate=e=>{e.candidate&&e.candidate.candidate&&(u3.log(`Received ICE candidates for ${t}:`,e.candidate),s.socket.send({type:ex.Candidate,payload:{candidate:e.candidate,type:i,connectionId:r},dst:t}))},e.oniceconnectionstatechange=()=>{switch(e.iceConnectionState){case"failed":u3.log("iceConnectionState is failed, closing connections to "+t),this.connection.emitError(ey.NegotiationFailed,"Negotiation of connection to "+t+" failed."),this.connection.close();break;case"closed":u3.log("iceConnectionState is closed, closing connections to "+t),this.connection.emitError(ey.ConnectionClosed,"Connection to "+t+" closed."),this.connection.close();break;case"disconnected":u3.log("iceConnectionState changed to disconnected on the connection with "+t);break;case"completed":e.onicecandidate=()=>{}}this.connection.emit("iceStateChanged",e.iceConnectionState)},u3.log("Listening for data channel"),e.ondatachannel=e=>{u3.log("Received data channel");let i=e.channel;s.getConnection(t,r)._initializeDataChannel(i)},u3.log("Listening for remote stream"),e.ontrack=e=>{u3.log("Received remote stream");let i=e.streams[0],n=s.getConnection(t,r);n.type===em.Media&&this._addStreamToMediaConnection(i,n)}}cleanup(){u3.log("Cleaning up PeerConnection to "+this.connection.peer);let e=this.connection.peerConnection;if(!e)return;this.connection.peerConnection=null,e.onicecandidate=e.oniceconnectionstatechange=e.ondatachannel=e.ontrack=()=>{};let t="closed"!==e.signalingState,r=!1,i=this.connection.dataChannel;i&&(r=!!i.readyState&&"closed"!==i.readyState),(t||r)&&e.close()}async _makeOffer(){let e=this.connection.peerConnection,t=this.connection.provider;try{let r=await e.createOffer(this.connection.options.constraints);u3.log("Created offer."),this.connection.options.sdpTransform&&"function"==typeof this.connection.options.sdpTransform&&(r.sdp=this.connection.options.sdpTransform(r.sdp)||r.sdp);try{await e.setLocalDescription(r),u3.log("Set localDescription:",r,`for:${this.connection.peer}`);let i={sdp:r,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata};if(this.connection.type===em.Data){let e=this.connection;i={...i,label:e.label,reliable:e.reliable,serialization:e.serialization}}t.socket.send({type:ex.Offer,payload:i,dst:this.connection.peer})}catch(e){"OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"!=e&&(t.emitError(eg.WebRTC,e),u3.log("Failed to setLocalDescription, ",e))}}catch(e){t.emitError(eg.WebRTC,e),u3.log("Failed to createOffer, ",e)}}async _makeAnswer(){let e=this.connection.peerConnection,t=this.connection.provider;try{let r=await e.createAnswer();u3.log("Created answer."),this.connection.options.sdpTransform&&"function"==typeof this.connection.options.sdpTransform&&(r.sdp=this.connection.options.sdpTransform(r.sdp)||r.sdp);try{await e.setLocalDescription(r),u3.log("Set localDescription:",r,`for:${this.connection.peer}`),t.socket.send({type:ex.Answer,payload:{sdp:r,type:this.connection.type,connectionId:this.connection.connectionId},dst:this.connection.peer})}catch(e){t.emitError(eg.WebRTC,e),u3.log("Failed to setLocalDescription, ",e)}}catch(e){t.emitError(eg.WebRTC,e),u3.log("Failed to create answer, ",e)}}async handleSDP(e,t){t=new RTCSessionDescription(t);let r=this.connection.peerConnection,i=this.connection.provider;u3.log("Setting remote description",t);try{await r.setRemoteDescription(t),u3.log(`Set remoteDescription:${e} for:${this.connection.peer}`),"OFFER"===e&&await this._makeAnswer()}catch(e){i.emitError(eg.WebRTC,e),u3.log("Failed to setRemoteDescription, ",e)}}async handleCandidate(e){u3.log("handleCandidate:",e);try{await this.connection.peerConnection.addIceCandidate(e),u3.log(`Added ICE candidate for:${this.connection.peer}`)}catch(e){this.connection.provider.emitError(eg.WebRTC,e),u3.log("Failed to handleCandidate, ",e)}}_addTracksToConnection(e,t){if(u3.log(`add tracks from stream ${e.id} to peer connection`),!t.addTrack)return u3.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");e.getTracks().forEach(r=>{t.addTrack(r,e)})}_addStreamToMediaConnection(e,t){u3.log(`add stream ${e.id} to media connection ${t.connectionId}`),t.addStream(e)}}class co extends u4.EventEmitter{emitError(e,t){u3.error("Error:",t),this.emit("error",new ca(`${e}`,t))}}class ca extends Error{constructor(e,t){"string"==typeof t?super(t):(super(),Object.assign(this,t)),this.type=e}}class ch extends co{get open(){return this._open}constructor(e,t,r){super(),this.peer=e,this.provider=t,this.options=r,this._open=!1,this.metadata=r.metadata}}class cl extends ch{static #e=this.ID_PREFIX="mc_";get type(){return em.Media}get localStream(){return this._localStream}get remoteStream(){return this._remoteStream}constructor(e,t,r){super(e,t,r),this._localStream=this.options._stream,this.connectionId=this.options.connectionId||cl.ID_PREFIX+u2.randomToken(),this._negotiator=new cn(this),this._localStream&&this._negotiator.startConnection({_stream:this._localStream,originator:!0})}_initializeDataChannel(e){this.dataChannel=e,this.dataChannel.onopen=()=>{u3.log(`DC#${this.connectionId} dc connection success`),this.emit("willCloseOnRemote")},this.dataChannel.onclose=()=>{u3.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}addStream(e){u3.log("Receiving stream",e),this._remoteStream=e,super.emit("stream",e)}handleMessage(e){let t=e.type,r=e.payload;switch(e.type){case ex.Answer:this._negotiator.handleSDP(t,r.sdp),this._open=!0;break;case ex.Candidate:this._negotiator.handleCandidate(r.candidate);break;default:u3.warn(`Unrecognized message type:${t} from peer:${this.peer}`)}}answer(e,t={}){if(this._localStream){u3.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");return}for(let r of(this._localStream=e,t&&t.sdpTransform&&(this.options.sdpTransform=t.sdpTransform),this._negotiator.startConnection({...this.options._payload,_stream:e}),this.provider._getMessages(this.connectionId)))this.handleMessage(r);this._open=!0}close(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,super.emit("close"))}}class cu{constructor(e){this._options=e}_buildRequest(e){let t=this._options.secure?"https":"http",{host:r,port:i,path:s,key:n}=this._options,o=new URL(`${t}://${r}:${i}${s}${n}/${e}`);return o.searchParams.set("ts",`${Date.now()}${Math.random()}`),o.searchParams.set("version",ci.version),fetch(o.href,{referrerPolicy:this._options.referrerPolicy})}async retrieveId(){try{let e=await this._buildRequest("id");if(200!==e.status)throw Error(`Error. Status:${e.status}`);return e.text()}catch(t){u3.error("Error retrieving ID",t);let e="";throw"/"===this._options.path&&this._options.host!==u2.CLOUD_HOST&&(e=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),Error("Could not get an ID from the server."+e)}}async listAllPeers(){try{let e=await this._buildRequest("peers");if(200!==e.status){if(401===e.status){let e="";throw e=this._options.host===u2.CLOUD_HOST?"It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":"You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",Error("It doesn't look like you have permission to list peers IDs. "+e)}throw Error(`Error. Status:${e.status}`)}return e.json()}catch(e){throw u3.error("Error retrieving list peers",e),Error("Could not get list peers from the server."+e)}}}class cc extends ch{static #e=this.ID_PREFIX="dc_";static #t=this.MAX_BUFFERED_AMOUNT=8388608;get type(){return em.Data}constructor(e,t,r){super(e,t,r),this.connectionId=this.options.connectionId||cc.ID_PREFIX+u0(),this.label=this.options.label||this.connectionId,this.reliable=!!this.options.reliable,this._negotiator=new cn(this),this._negotiator.startConnection(this.options._payload||{originator:!0,reliable:this.reliable})}_initializeDataChannel(e){this.dataChannel=e,this.dataChannel.onopen=()=>{u3.log(`DC#${this.connectionId} dc connection success`),this._open=!0,this.emit("open")},this.dataChannel.onmessage=e=>{u3.log(`DC#${this.connectionId} dc onmessage:`,e.data)},this.dataChannel.onclose=()=>{u3.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}close(e){if(e?.flush){this.send({__peerData:{type:"close"}});return}this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this.dataChannel=null),this.open&&(this._open=!1,super.emit("close"))}send(e,t=!1){if(!this.open){this.emitError(e_.NotOpenYet,"Connection is not open. You should listen for the `open` event before sending messages.");return}return this._send(e,t)}async handleMessage(e){let t=e.payload;switch(e.type){case ex.Answer:await this._negotiator.handleSDP(e.type,t.sdp);break;case ex.Candidate:await this._negotiator.handleCandidate(t.candidate);break;default:u3.warn("Unrecognized message type:",e.type,"from peer:",this.peer)}}}class cd extends cc{get bufferSize(){return this._bufferSize}_initializeDataChannel(e){super._initializeDataChannel(e),this.dataChannel.binaryType="arraybuffer",this.dataChannel.addEventListener("message",e=>this._handleDataMessage(e))}_bufferedSend(e){(this._buffering||!this._trySend(e))&&(this._buffer.push(e),this._bufferSize=this._buffer.length)}_trySend(e){if(!this.open)return!1;if(this.dataChannel.bufferedAmount>cc.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(()=>{this._buffering=!1,this._tryBuffer()},50),!1;try{this.dataChannel.send(e)}catch(e){return u3.error(`DC#:${this.connectionId} Error when sending:`,e),this._buffering=!0,this.close(),!1}return!0}_tryBuffer(){if(!this.open||0===this._buffer.length)return;let e=this._buffer[0];this._trySend(e)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}close(e){if(e?.flush){this.send({__peerData:{type:"close"}});return}this._buffer=[],this._bufferSize=0,super.close()}constructor(...e){super(...e),this._buffer=[],this._bufferSize=0,this._buffering=!1}}class cp extends cd{close(e){super.close(e),this._chunkedData={}}constructor(e,t,r){super(e,t,r),this.chunker=new uK,this.serialization=ev.Binary,this._chunkedData={}}_handleDataMessage({data:e}){let t=hh(e),r=t.__peerData;if(r){if("close"===r.type){this.close();return}this._handleChunk(t);return}this.emit("data",t)}_handleChunk(e){let t=e.__peerData,r=this._chunkedData[t]||{data:[],count:0,total:e.total};if(r.data[e.n]=new Uint8Array(e.data),r.count++,this._chunkedData[t]=r,r.total===r.count){delete this._chunkedData[t];let e=function(e){let t=0;for(let r of e)t+=r.byteLength;let r=new Uint8Array(t),i=0;for(let t of e)r.set(t,i),i+=t.byteLength;return r}(r.data);this._handleDataMessage({data:e})}}_send(e,t){let r=hl(e);if(r instanceof Promise)return this._send_blob(r);if(!t&&r.byteLength>this.chunker.chunkedMTU){this._sendChunks(r);return}this._bufferedSend(r)}async _send_blob(e){let t=await e;if(t.byteLength>this.chunker.chunkedMTU){this._sendChunks(t);return}this._bufferedSend(t)}_sendChunks(e){let t=this.chunker.chunk(e);for(let e of(u3.log(`DC#${this.connectionId} Try to send ${t.length} chunks...`),t))this.send(e,!0)}}class cf extends cd{_handleDataMessage({data:e}){super.emit("data",e)}_send(e,t){this._bufferedSend(e)}constructor(...e){super(...e),this.serialization=ev.None}}class cm extends cd{_handleDataMessage({data:e}){let t=this.parse(this.decoder.decode(e)),r=t.__peerData;if(r&&"close"===r.type){this.close();return}this.emit("data",t)}_send(e,t){let r=this.encoder.encode(this.stringify(e));if(r.byteLength>=u2.chunkedMTU){this.emitError(e_.MessageToBig,"Message too big for JSON channel");return}this._bufferedSend(r)}constructor(...e){super(...e),this.serialization=ev.JSON,this.encoder=new TextEncoder,this.decoder=new TextDecoder,this.stringify=JSON.stringify,this.parse=JSON.parse}}class cg extends co{static #e=this.DEFAULT_KEY="peerjs";get id(){return this._id}get options(){return this._options}get open(){return this._open}get socket(){return this._socket}get connections(){let e=Object.create(null);for(let[t,r]of this._connections)e[t]=r;return e}get destroyed(){return this._destroyed}get disconnected(){return this._disconnected}constructor(e,t){let r;if(super(),this._serializers={raw:cf,json:cm,binary:cp,"binary-utf8":cp,default:cp},this._id=null,this._lastServerId=null,this._destroyed=!1,this._disconnected=!1,this._open=!1,this._connections=new Map,this._lostMessages=new Map,e&&e.constructor==Object?t=e:e&&(r=e.toString()),t={debug:0,host:u2.CLOUD_HOST,port:u2.CLOUD_PORT,path:"/",key:cg.DEFAULT_KEY,token:u2.randomToken(),config:u2.defaultConfig,referrerPolicy:"strict-origin-when-cross-origin",serializers:{},...t},this._options=t,this._serializers={...this._serializers,...this.options.serializers},"/"===this._options.host&&(this._options.host=window.location.hostname),this._options.path&&("/"!==this._options.path[0]&&(this._options.path="/"+this._options.path),"/"!==this._options.path[this._options.path.length-1]&&(this._options.path+="/")),void 0===this._options.secure&&this._options.host!==u2.CLOUD_HOST?this._options.secure=u2.isSecure():this._options.host==u2.CLOUD_HOST&&(this._options.secure=!0),this._options.logFunction&&u3.setLogFunction(this._options.logFunction),u3.logLevel=this._options.debug||0,this._api=new cu(t),this._socket=this._createServerConnection(),!u2.supports.audioVideo&&!u2.supports.data){this._delayedAbort(eg.BrowserIncompatible,"The current browser does not support WebRTC");return}if(r&&!u2.validateId(r)){this._delayedAbort(eg.InvalidID,`ID "${r}" is invalid`);return}r?this._initialize(r):this._api.retrieveId().then(e=>this._initialize(e)).catch(e=>this._abort(eg.ServerError,e))}_createServerConnection(){let e=new cs(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return e.on(eb.Message,e=>{this._handleMessage(e)}),e.on(eb.Error,e=>{this._abort(eg.SocketError,e)}),e.on(eb.Disconnected,()=>{this.disconnected||(this.emitError(eg.Network,"Lost connection to server."),this.disconnect())}),e.on(eb.Close,()=>{this.disconnected||this._abort(eg.SocketClosed,"Underlying socket is already closed.")}),e}_initialize(e){this._id=e,this.socket.start(e,this._options.token)}_handleMessage(e){let t=e.type,r=e.payload,i=e.src;switch(t){case ex.Open:this._lastServerId=this.id,this._open=!0,this.emit("open",this.id);break;case ex.Error:this._abort(eg.ServerError,r.msg);break;case ex.IdTaken:this._abort(eg.UnavailableID,`ID "${this.id}" is taken`);break;case ex.InvalidKey:this._abort(eg.InvalidKey,`API KEY "${this._options.key}" is invalid`);break;case ex.Leave:u3.log(`Received leave message from ${i}`),this._cleanupPeer(i),this._connections.delete(i);break;case ex.Expire:this.emitError(eg.PeerUnavailable,`Could not connect to peer ${i}`);break;case ex.Offer:{let e=r.connectionId,t=this.getConnection(i,e);if(t&&(t.close(),u3.warn(`Offer received for existing Connection ID:${e}`)),r.type===em.Media){let s=new cl(i,this,{connectionId:e,_payload:r,metadata:r.metadata});t=s,this._addConnection(i,t),this.emit("call",s)}else if(r.type===em.Data){let s=new this._serializers[r.serialization](i,this,{connectionId:e,_payload:r,metadata:r.metadata,label:r.label,serialization:r.serialization,reliable:r.reliable});t=s,this._addConnection(i,t),this.emit("connection",s)}else{u3.warn(`Received malformed connection type:${r.type}`);return}for(let r of this._getMessages(e))t.handleMessage(r);break}default:{if(!r){u3.warn(`You received a malformed message from ${i} of type ${t}`);return}let s=r.connectionId,n=this.getConnection(i,s);n&&n.peerConnection?n.handleMessage(e):s?this._storeMessage(s,e):u3.warn("You received an unrecognized message:",e)}}}_storeMessage(e,t){this._lostMessages.has(e)||this._lostMessages.set(e,[]),this._lostMessages.get(e).push(t)}_getMessages(e){let t=this._lostMessages.get(e);return t?(this._lostMessages.delete(e),t):[]}connect(e,t={}){if(t={serialization:"default",...t},this.disconnected){u3.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),this.emitError(eg.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}let r=new this._serializers[t.serialization](e,this,t);return this._addConnection(e,r),r}call(e,t,r={}){if(this.disconnected){u3.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),this.emitError(eg.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}if(!t){u3.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.");return}let i=new cl(e,this,{...r,_stream:t});return this._addConnection(e,i),i}_addConnection(e,t){u3.log(`add connection ${t.type}:${t.connectionId} to peerId:${e}`),this._connections.has(e)||this._connections.set(e,[]),this._connections.get(e).push(t)}_removeConnection(e){let t=this._connections.get(e.peer);if(t){let r=t.indexOf(e);-1!==r&&t.splice(r,1)}this._lostMessages.delete(e.connectionId)}getConnection(e,t){let r=this._connections.get(e);if(!r)return null;for(let e of r)if(e.connectionId===t)return e;return null}_delayedAbort(e,t){setTimeout(()=>{this._abort(e,t)},0)}_abort(e,t){u3.error("Aborting!"),this.emitError(e,t),this._lastServerId?this.disconnect():this.destroy()}destroy(){this.destroyed||(u3.log(`Destroy peer with ID:${this.id}`),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit("close"))}_cleanup(){for(let e of this._connections.keys())this._cleanupPeer(e),this._connections.delete(e);this.socket.removeAllListeners()}_cleanupPeer(e){let t=this._connections.get(e);if(t)for(let e of t)e.close()}disconnect(){if(this.disconnected)return;let e=this.id;u3.log(`Disconnect peer with ID:${e}`),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=e,this._id=null,this.emit("disconnected",e)}reconnect(){if(this.disconnected&&!this.destroyed)u3.log(`Attempting reconnection to server with ID ${this._lastServerId}`),this._disconnected=!1,this._initialize(this._lastServerId);else if(this.destroyed)throw Error("This peer cannot reconnect to the server. It has already been destroyed.");else if(this.disconnected||this.open)throw Error(`Peer ${this.id} cannot reconnect because it is not disconnected from the server!`);else u3.error("In a hurry? We're still trying to make the initial connection!")}listAllPeers(e=e=>{}){this._api.listAllPeers().then(t=>e(t)).catch(e=>this._abort(eg.ServerError,e))}}Symbol.for(null);class cy{constructor(e){this.userId=e,this.members=[],this.unloadListener=()=>this.destroy(),this.listeners=[],this.peer=new cg(e),this.peer.on("error",e=>{cF(`${e.name}: ${e.message} [${e.type}]`)}),this.peer.on("connection",e=>this.addDataConnectionEventHandlers(e)),window.addEventListener("beforeunload",this.unloadListener)}emit(e,t){this.listeners.forEach(r=>r(e,t))}addDataConnectionEventHandlers(e){e.on("open",()=>{this.members.push(e),e.send({type:"members-list",message:this.members.map(e=>e.peer).filter(t=>t!==e.peer)}),this.emit(e.peer,{type:"announce",message:e.peer})}),e.on("close",()=>{this.members=this.members.filter(t=>t!==e),this.emit(e.peer,{type:"player-disconnected",message:null})}),e.on("data",t=>{if("members-list"===t.type){t.message.forEach(e=>{if(!this.members.some(t=>t.peer===e)){let t=this.peer.connect(e);this.addDataConnectionEventHandlers(t)}});return}this.emit(e.peer,t)}),e.on("error",()=>{console.log("error")})}connectToMember(e){this.peer.once("open",()=>{let t=this.peer.connect(e);this.addDataConnectionEventHandlers(t)})}destroy(){this.peer.destroy(),window.removeEventListener("beforeunload",this.unloadListener)}address(){return this.userId}on(e,t){this.listeners.push(t)}send(e){this.listeners.forEach(t=>t(this.userId,e)),this.members.forEach(t=>t.send(e))}}class c_{constructor(e,t){this.x=e,this.y=t}get length(){return Math.sqrt(this.x*this.x+this.y*this.y)}get normalized(){let e=this.length;return new c_(this.x/e,this.y/e)}static distance(e,t){return new c_(t.x-e.x,t.y-e.y).length}}(eo=eT||(eT={}))[eo.OFF=0]="OFF",eo[eo.HELD=1]="HELD",eo[eo.PRESSED=2]="PRESSED";class cv{static get instance(){if(cv._instance)return cv._instance;throw Error("Controls is not created!")}keyDown(e){cv.instance.keyboard.set(e.key.toLowerCase(),1),e.preventDefault()}keyUp(e){cv.instance.keyboard.set(e.key.toLowerCase(),2),e.preventDefault(),requestAnimationFrame(()=>cv.instance.keyboard.set(e.key.toLowerCase(),0))}mouseMove(e){cv.instance.mouse.position=new c_(e.offsetX,e.offsetY)}mouseDown(e){0===e.button&&(cv.instance.mouse.pressed=!0)}mouseUp(e){0===e.button&&(cv.instance.mouse.pressed=!1)}constructor(e){this.keyboard=new Map,this.mouse={position:new c_(0,0),pressed:!1},e.addEventListener("keydown",e=>this.keyDown(e)),e.addEventListener("keyup",this.keyUp),e.addEventListener("mousemove",this.mouseMove),e.addEventListener("mousedown",this.mouseDown),e.addEventListener("mouseup",this.mouseUp),cv._instance=this}}(ea=eE||(eE={})).Bullet="bullet",ea.Spaceship="spaceship",ea.Jet="jet";class cb extends ng{constructor(e,t){super(),this.health=100,this.angularVelocity=0,this.engOn=!0,this.engBroken=!1,this.rcsOn=!0,this.rcsBroken=!1,this.gyroOn=!0,this.gyroBroken=!1,this.speed=200,this.afterburner=100,this._room=e,this.velocity=new c_(0,0);let r=sh.from(t);r.rotate=2;let i=new nv(r);this.graphics=i,this.graphics.anchor.x=.5,this.graphics.anchor.y=.5,this.addChild(this.graphics);let s=sh.from(eE.Jet);this.jetL=new nv(s),this.jetL.angle=-90,this.jetL.anchor.x=.5,this.jetL.anchor.y=0,this.jetL.x=50,this.jetL.y=35,this.jetL.scale.set(.4,.5),this.graphics.addChild(this.jetL),this.jetR=new nv(s),this.jetR.angle=-90,this.jetR.anchor.x=.5,this.jetR.anchor.y=0,this.jetR.x=50,this.jetR.y=-35,this.jetR.scale.set(.4,.5),this.graphics.addChild(this.jetR);let n=sh.from(eE.Bullet);this.healthBar=new aq(n,1.5*this.health,16),this.healthBar.tileScale={x:.2,y:.1},this.healthBar.position={x:-75,y:-90},this.healthBar.anchor.x=0,this.healthBar.anchor.y=.5,this.healthBar.tint=65280;let o=new aq(n,150,16);o.tileScale={x:.2,y:.1},o.position={x:-75,y:-94},o.anchor.x=0,o.anchor.y=.5,o.tint=16711680,this.addChild(o),this.addChild(this.healthBar),this.shield=new a$(oT.get("shield").animations.default),this.shield.anchor.x=.5,this.shield.anchor.y=.5,this.shield.scale.x=1.6,this.shield.scale.y=1.6,this.shield.alpha=.4,this.shield.animationSpeed=.1,this.graphics.addChild(this.shield),this.shield.play()}update(e){let t=new c_(0,0);cv.instance.keyboard.get("w")===eT.HELD&&(t.y+=-1),cv.instance.keyboard.get("a")===eT.HELD&&(t.x+=-1),cv.instance.keyboard.get("s")===eT.HELD&&(t.y+=1),cv.instance.keyboard.get("d")===eT.HELD&&(t.x+=1),cv.instance.keyboard.get(" ")===eT.HELD&&this.afterburner>0?(this.afterburner>1&&(this.speed=600),this.afterburner-=e/2):(this.speed=200,this.afterburner<100&&(this.afterburner+=e/4)),cv.instance.keyboard.get("e")===eT.PRESSED&&(this.engOn=!this.engOn),cv.instance.keyboard.get("r")===eT.PRESSED&&(this.rcsOn=!this.rcsOn),cv.instance.keyboard.get("g")===eT.PRESSED&&(this.gyroOn=!this.gyroOn),this.jetL.scale.y=-.4*t.y*this.speed/200+.1*t.x+Math.random()/20+.1,this.jetR.scale.y=-.4*t.y*this.speed/200-.1*t.x+Math.random()/20+.1,this.jetL.alpha=.75+Math.random()/4,this.jetR.alpha=.75+Math.random()/4,t.x&&this.engOn&&!this.engBroken?this.angularVelocity=this.angularVelocity-.01*this.angularVelocity*e+t.x*e*.1:this.gyroOn&&!this.gyroBroken&&(this.angularVelocity-=.1*this.angularVelocity*e),(!this.engOn||this.engBroken)&&(this.jetL.alpha=0,this.jetR.alpha=0),this.graphics.angle=(this.graphics.angle+this.angularVelocity*e)%360,this.healthBar.width=1.5*this.health,t.y&&this.engOn&&!this.engBroken?this.velocity=new c_(this.velocity.x-.005*this.velocity.x*e+this.speed*t.y*e*Math.cos(this.graphics.rotation),this.velocity.y-.005*this.velocity.y*e+this.speed*t.y*e*Math.sin(this.graphics.rotation)):this.rcsOn&&!this.rcsBroken&&this.engOn&&!this.engBroken&&(this.velocity=new c_(this.velocity.x-.03*this.velocity.x*e,this.velocity.y-.03*this.velocity.y*e)),this.x=this.x+this.velocity.x*e/1e3,this.y=this.y+this.velocity.y*e/1e3,this._room.send({type:"player-state",message:{position:{x:this.x,y:this.y},angle:this.graphics.angle,health:this.health,d:{x:t.x,y:t.y},engine:!this.engBroken&&this.engOn,speed:this.speed}})}}class cx extends nv{constructor(e,t,r,i,s){super(sh.from(eE.Bullet)),this.position=e,this.velocity=t,this.angle=r+90,this.anchor.x=.5,this.anchor.y=.5,this.owner=i,this.id=s}update(e){this.x=this.x+this.velocity.x*e/1e3,this.y=this.y+this.velocity.y*e/1e3}}const cT=e=>void 0!==e.update,cE=(e,t,r)=>t>r?Math.min(Math.max(e,r),t):Math.min(Math.max(e,t),r);class cw extends ng{constructor(e){super(),this.velocity=new c_(0,0),this.d=new c_(0,0),this.graphics=new nv(sh.from(e)),this.graphics.anchor.x=.5,this.graphics.anchor.y=.5,this.graphics.tint=16711680,this.addChild(this.graphics);let t=sh.from(eE.Jet);this.jetL=new nv(t),this.jetL.angle=-90,this.jetL.anchor.x=.5,this.jetL.anchor.y=0,this.jetL.x=50,this.jetL.y=35,this.jetL.scale.set(.4,.5),this.graphics.addChild(this.jetL),this.jetR=new nv(t),this.jetR.angle=-90,this.jetR.anchor.x=.5,this.jetR.anchor.y=0,this.jetR.x=50,this.jetR.y=-35,this.jetR.scale.set(.4,.5),this.graphics.addChild(this.jetR);let r=sh.from(eE.Bullet);this.healthBar=new aq(r,1.5*this.health,16),this.healthBar.tileScale={x:.2,y:.1},this.healthBar.position={x:-75,y:-90},this.healthBar.anchor.x=0,this.healthBar.anchor.y=.5,this.healthBar.tint=65280;let i=new aq(r,150,16);i.tileScale={x:.2,y:.1},i.position={x:-75,y:-94},i.anchor.x=0,i.anchor.y=.5,i.tint=16711680,this.addChild(i),this.addChild(this.healthBar)}update(e){this.jetL.scale.y=-.4*this.d.y*this.speed/200+.1*this.d.x+Math.random()/20+.1,this.jetR.scale.y=-.4*this.d.y*this.speed/200-.1*this.d.x+Math.random()/20+.1,this.jetL.alpha=.75+Math.random()/4,this.jetR.alpha=.75+Math.random()/4,this.engine||(this.jetL.alpha=0,this.jetR.alpha=0),this.x=this.x+this.velocity.x*e/1e3,this.y=this.y+this.velocity.y*e/1e3,this.healthBar.width=1.5*this.health}}class cA extends ng{constructor(e,t){super(),this.timer=0,this.positionText=new aD,this.velText=new aD,this.engText=new aD,this.rcsText=new aD,this.gyroText=new aD,this.shieldText=new aD,this.afterburnerFuel=new ap,this.gameManager=t,this.screen=e,this.velText.anchor.x=.5,this.velText.style.fill="#fff",this.velText.style.fontFamily="Consolas, monospace",this.velText.style.fontWeight="bold",this.addChild(this.velText),this.engText.text="[x] ENG",this.engText.style.fill="#0f0",this.engText.style.fontFamily="Consolas, monospace",this.engText.style.fontWeight="bold",this.addChild(this.engText),this.rcsText.text="[x] RCS",this.rcsText.style.fill="#0f0",this.rcsText.style.fontFamily="Consolas, monospace",this.rcsText.style.fontWeight="bold",this.addChild(this.rcsText),this.gyroText.text="[x] GYRO",this.gyroText.style.fill="#0f0",this.gyroText.style.fontFamily="Consolas, monospace",this.gyroText.style.fontWeight="bold",this.addChild(this.gyroText),this.shieldText.text="[x] SHLD",this.shieldText.style.fill="#0f0",this.shieldText.style.fontFamily="Consolas, monospace",this.shieldText.style.fontWeight="bold",this.addChild(this.shieldText),this.positionText.text="",this.positionText.style.fill="#fff",this.positionText.style.fontFamily="Consolas, monospace",this.positionText.style.fontWeight="bold",this.addChild(this.positionText),this.addChild(this.afterburnerFuel),this.redrawGUI()}redrawGUI(){this.velText.x=this.screen.width/2,this.velText.y=this.screen.height-40,this.engText.x=this.screen.width/2+this.screen.width/12,this.engText.y=this.screen.height-120-10,this.rcsText.x=this.screen.width/2+this.screen.width/12,this.rcsText.y=this.screen.height-90-10,this.gyroText.x=this.screen.width/2+this.screen.width/12,this.gyroText.y=this.screen.height-60-10,this.shieldText.x=this.screen.width/2+this.screen.width/12,this.shieldText.y=this.screen.height-30-10,this.positionText.x=this.screen.left+30,this.positionText.y=this.screen.top+30,this.afterburnerFuel.x=this.screen.width/2-this.screen.width/12,this.afterburnerFuel.y=this.screen.height-120}update(e){this.velText.text=this.gameManager.player.velocity.length.toFixed(0),this.positionText.text=`${this.gameManager.player.x.toFixed()}  ${this.gameManager.player.y.toFixed()}`,this.afterburnerFuel.clear(),this.afterburnerFuel.beginFill(65280),this.afterburnerFuel.drawRect(0,100-this.gameManager.player.afterburner,20,this.gameManager.player.afterburner),this.afterburnerFuel.endFill(),this.timer+=e;let t=Math.round(this.timer/500)%2;this.gameManager.player.engBroken?(t?this.engText.text="[!] ENG":this.engText.text="[ ] ENG",this.engText.style.fill="#f00"):this.gameManager.player.engOn?(this.engText.text="[x] ENG",this.engText.style.fill="#0f0"):(this.engText.text="[ ] ENG",this.engText.style.fill="#f00"),this.gameManager.player.rcsBroken?(t?this.rcsText.text="[!] RCS":this.rcsText.text="[ ] RCS",this.rcsText.style.fill="#f00"):this.gameManager.player.rcsOn?(this.rcsText.text="[x] RCS",this.rcsText.style.fill="#0f0"):(this.rcsText.text="[ ] RCS",this.rcsText.style.fill="#f00"),this.gameManager.player.gyroBroken?(t?this.gyroText.text="[!] GYRO":this.gyroText.text="[ ] GYRO",this.gyroText.style.fill="#f00"):this.gameManager.player.gyroOn?(this.gyroText.text="[x] GYRO",this.gyroText.style.fill="#0f0"):(this.gyroText.text="[ ] GYRO",this.gyroText.style.fill="#f00")}}const cS=e=>{let t=[16777215,16777215,16746581,8947967];e.clear();for(let r=-300;r<300;r++)for(let i=-300;i<300;i++){let s=Math.random(),n=Math.random(),o=Math.random();e.beginFill(t[Math.floor(s*s*t.length)],n*n*Math.max(o,n)*.6+.4),e.drawCircle(100*r+100*Math.random()-50,100*i+100*Math.random()-50,o*o*o*3)}e.endFill()};class cC{constructor(e,t,r){this.cameraFollowAllMode=!1,this.fullscreen=!1,this.app=e,this.camera=t,this.room=r,this.enemies=new Map,this.bullets=[]}onPlayerState(e,t){if(this.enemies.has(e)){let r=this.enemies.get(e);r.x=t.position.x,r.y=t.position.y,r.graphics.angle=t.angle,r.health=t.health,r.d.x=t.d.x,r.d.y=t.d.y,r.engine=t.engine,r.speed=t.speed}else{let t=new cw(eE.Spaceship);this.enemies.set(e,t),this.camera.addChild(t)}}onBulletShot(e,t){let r=new cx(t.position,t.velocity,t.angle,e,t.id);this.bullets.push(r),this.camera.addChild(r)}onBulletCollided(e){let t=this.bullets.findIndex(t=>t.id===e.id&&t.owner===e.owner),r=this.bullets.splice(t,1);r[0]&&r[0].destroy()}checkPlayerBulletsCollision(){for(let e of this.bullets)e.owner!==this.room.address()&&40>c_.distance(new c_(this.player.x,this.player.y),new c_(e.x,e.y))&&(this.room.send({type:"bullet-collided",message:{owner:e.owner,id:e.id}}),this.onBulletCollided({owner:e.owner,id:e.id}),this.player.health-=5,Math.random()<.1-this.player.health/1e3&&(this.player.gyroBroken=!0),Math.random()<.1-this.player.health/1e3&&(this.player.rcsBroken=!0),Math.random()<.05-this.player.health/1e3&&(this.player.engBroken=!0),this.player.health<0&&(this.player.x=0,this.player.y=0,this.player.velocity=new c_(0,0),this.player.health=100,this.player.rotation=0,this.player.gyroBroken=!1,this.player.rcsBroken=!1,this.player.engBroken=!1,this.room.send({type:"kill",message:{killer:e.owner,target:this.room.address()}})))}playerShoot(e){let t=this.player.graphics.rotation,r=Math.PI/12,i=new c_(-Math.cos(t),-Math.sin(t)),s=new c_(-Math.cos(t-r),-Math.sin(t-r)),n=new c_(-Math.cos(t+r),-Math.sin(t+r)),o=this.camera.screenToWorldPoint(cv.instance.mouse.position),a=new c_(i.y,-i.x),h=e%2*2-1,l=new c_(this.player.x+h*a.x*20+120*i.x,this.player.y+h*a.y*20+120*i.y),u=new c_(o.x-l.x,o.y-l.y).normalized,c=new c_(cE(u.x,s.x,n.x),cE(u.y,s.y,n.y)),d={id:e,position:l,angle:180*Math.atan2(c.y,c.x)/Math.PI,velocity:new c_(5e4*c.x+this.player.velocity.x,5e4*c.y+this.player.velocity.y)};this.onBulletShot(this.room.address(),d),this.room.send({type:"bullet-shot",message:d})}async loadAssets(){oT.add({alias:"shield",src:"/assets/spritesheet.json"}),oT.add({alias:eE.Spaceship,src:"/assets/spaceship_sprite.png"}),oT.add({alias:eE.Bullet,src:"/assets/long-ray.png"}),oT.add({alias:eE.Jet,src:"/assets/jet.png"}),await oT.load([eE.Spaceship,eE.Bullet,eE.Jet,"shield"]),console.log(oT.cache)}async startGame(){await this.loadAssets(),this.player=new cb(this.room,eE.Spaceship),this.camera.addChild(this.player);let e=new ap;cS(e),this.camera.addChild(e),this.camera.setChildIndex(e,0);let t=0,r=5;this.ui=new cA(this.app.screen,this),this.app.stage.addChild(this.ui),this.app.ticker.add(e=>{for(let t of(this.ui.update(this.app.ticker.deltaMS),this.camera.children))cT(t)&&t.update(e);this.checkPlayerBulletsCollision(),cv.instance.keyboard.get("tab")===eT.PRESSED&&(console.log("change follow mode"),this.cameraFollowAllMode=!this.cameraFollowAllMode),cv.instance.keyboard.get("f")===eT.PRESSED&&(console.log("change follow mode"),this.fullscreen=!this.fullscreen,this.fullscreen?(document.querySelector("canvas")?.requestFullscreen(),this.app.screen.width=window.screen.width,this.app.screen.height=window.screen.height,this.app.view.width=window.screen.width,this.app.view.height=window.screen.height):(document.exitFullscreen(),this.app.screen.width=1280,this.app.screen.height=720,this.app.view.width=1280,this.app.view.height=720),this.ui.redrawGUI());let i=cv.instance.mouse.position,s=Math.max(.4,Math.min(.6,5e3/this.player.velocity.length)),n=new c_(0,0),o=this.app.screen.width,a=this.app.screen.height;if(this.cameraFollowAllMode){let e=Array.from(this.enemies.values());e.push(this.player);let t=e.reduce((e,t)=>t.position.x<e?t.position.x:e,9999999),r=e.reduce((e,t)=>t.position.x>e?t.position.x:e,-9999999),h=e.reduce((e,t)=>t.position.y<e?t.position.y:e,9999999);s=Math.min(.8,.7*o/(r-t),.7*a/(e.reduce((e,t)=>t.position.y>e?t.position.y:e,-9999999)-h));let l=e.reduce((e,t)=>t.position.x+e,0)/e.length+(i.x-o/2)*.4,u=e.reduce((e,t)=>t.position.y+e,0)/e.length+(i.y-a/2)*.4;n=new c_(o/2-l*s,a/2-u*s)}else{let e={x:this.player.x+this.player.velocity.x*s/20+(i.x-o/2)*.4,y:this.player.y+this.player.velocity.y*s/20+(i.y-a/2)*.4};n=new c_(o/2-e.x*s,a/2-e.y*s)}this.camera.desiredPosition.x=n.x,this.camera.desiredPosition.y=n.y,this.camera.desiredZoom=s,r-=e,cv.instance.mouse.pressed&&r<0&&(r=5,this.playerShoot(t),t++),this.camera.update(e)})}}const cR=document.querySelector("div.lobby-controls"),cI=document.querySelector("input#nickname"),cP=document.querySelector("button#host"),cM=document.querySelector("input#lobby"),cD=document.querySelector("button#join"),ck=new n$({view:document.querySelector("canvas"),width:1280,height:720});ck.view.tabIndex=1,ck.view.autofocus=!0;const cO=new class extends ng{constructor(){super(),this.desiredPosition=new c_(0,0),this.zoom=1,this.desiredZoom=1}screenToWorldPoint(e){return new c_((-this.position.x+e.x)/this.zoom,(-this.position.y+e.y)/this.zoom)}update(e){let t=this.desiredZoom-this.zoom;this.zoom=+this.zoom+t*e/15,this.scale.x=this.zoom,this.scale.y=this.zoom;let r={x:this.desiredPosition.x-this.position.x,y:this.desiredPosition.y-this.position.y};this.position.x=this.position.x+r.x*e/15,this.position.y=this.position.y+r.y*e/15}};ck.stage.addChild(cO),new cv(ck.view);const cB=localStorage.getItem("nickname");cB&&(cI.value=cB);let cL=null;const cF=e=>{let t=document.querySelector("#error");t&&(t.textContent=e)},cN=(e,t)=>{localStorage.setItem("nickname",e),cL=new cy(`${e}_p2pspacegame`),t&&(console.log("connect"),cL.connectToMember(`${t}_p2pspacegame`));let r=new cC(ck,cO,cL);cR.hidden=!0,cL.on("message",(e,{type:t,message:i})=>{switch(t){case"player-state":e!==cL?.address()&&r.onPlayerState(e,i);break;case"bullet-shot":e!==cL?.address()&&r.onBulletShot(e,i);break;case"bullet-collided":e!==cL?.address()&&r.onBulletCollided(i)}}),r.startGame()};cP.addEventListener("click",e=>{cN(cI.value)}),cD.addEventListener("click",e=>{cN(cI.value,cM.value)});
//# sourceMappingURL=index.5709b0bc.js.map
